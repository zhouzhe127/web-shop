(window.webpackJsonp=window.webpackJsonp||[]).push([["package_add_tag_win"],{"08e6":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("win",{attrs:{align:"center",height:560,width:800,ok:t.btnOk,cancel:t.btnCancel},on:{winEvent:t.goodListWin}},[s("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),t._v(" "),s("div",{attrs:{slot:"content",id:"packTan"},slot:"content"},[s("div",{staticClass:"oBox"},[s("div",{staticClass:"meal-space"},[s("div",{staticClass:"line"},[s("label",{staticClass:"required fl",staticStyle:{width:"50px",height:"40px","text-align":"center","line-height":"40px"}},[t._v("名称")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.tagName,expression:"tagName"}],staticClass:"input fl",staticStyle:{width:"200px",height:"40px",border:"1px solid #d7d7d7"},attrs:{maxlength:"10",type:"text",placeholder:"输入名称"},domProps:{value:t.tagName},on:{input:function(e){e.target.composing||(t.tagName=e.target.value)}}}),t._v(" "),s("label",{staticClass:"required fl",staticStyle:{width:"65px","margin-left":"35px","margin-right":"10px",height:"40px","text-align":"center","line-height":"40px"}},[t._v(t._s(1==t.packageType?"可选数量":"总数量"))]),t._v(" "),1==t.packageType?s("sub-add",{attrs:{bindnum:t.totalNum},on:{toClick:t.getSubAdd}}):t._e(),t._v(" "),0==t.packageType?s("span",{staticStyle:{height:"40px","text-align":"center","line-height":"40px"}},[t._v(t._s(t.totalNum))]):t._e()],1)])]),t._v(" "),s("section",{staticClass:"configBox"},[s("section",{staticClass:"oCont",staticStyle:{width:"100%"}},[s("ul",{staticStyle:{float:"left","margin-left":"20px"}},[s("li",{staticStyle:{width:"210px",float:"left"}},[s("section",{staticClass:"fl detLi"},[s("section",{staticClass:"tableList",on:{click:t.showOneArea}},[s("span",{staticClass:"oSpan"},[t._v(t._s(t.oneArea.oneAreaName))]),t._v(" "),s("div",{staticClass:"fl"},[s("i")])]),t._v(" "),t.oneArea.oneAreaBtn?s("div",{staticClass:"detDiv"},[s("i",{staticClass:"detI"}),t._v(" "),s("div",{staticStyle:{width:"100%",height:"100%","overflow-y":"auto","z-index":"16"}},t._l(t.oneArea.oneAreaList,function(e,a){return s("section",{key:a,staticClass:"shoName",class:{"shoName-select-one":e&&e.selected},on:{click:function(s){t.selectOneArea(a,e)}}},[t._v(t._s(e.name))])}))]):t._e()])]),t._v(" "),s("li",{staticStyle:{width:"210px","margin-left":"20px",float:"left"}},[s("section",{staticClass:"fl detLi"},[s("section",{staticClass:"tableList",on:{click:t.showTwoArea}},[s("span",{staticClass:"oSpan"},[t._v(t._s(t.twoArea.twoAreaName))]),t._v(" "),s("div",{staticClass:"fl"},[s("i")])]),t._v(" "),t.twoArea.twoAreaBtn?s("div",{staticClass:"detDiv",staticStyle:{left:"-180px"}},[s("i",{staticClass:"detI",staticStyle:{left:"290px"}}),t._v(" "),s("div",{staticStyle:{width:"100%",height:"100%","overflow-y":"auto","z-index":"16"}},t._l(t.twoArea.twoAreaList,function(e,a){return s("section",{key:a,staticClass:"shoName",class:{"shoName-select-one":e&&e.selected},on:{click:function(s){t.selectTwoArea(a,e)}}},[t._v(t._s(e.name))])}))]):t._e()])]),t._v(" "),s("li",{staticStyle:{width:"180px","margin-left":"20px",float:"left"}},[s("div",{staticClass:"search"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"search-input",staticStyle:{height:"40px"},attrs:{type:"text",placeholder:"请输入名称"},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}}),t._v(" "),s("a",{staticClass:"search-btn",staticStyle:{"background-color":"#29A7E1",height:"40px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.searchGoods()}}})])]),t._v(" "),s("li",{staticStyle:{width:"60px","margin-left":"10px",float:"left"}},[s("a",{staticClass:"gray",staticStyle:{width:"60px",height:"40px","line-height":"40px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.recSearch()}}},[t._v("重置")])])])]),t._v(" "),s("ul",{staticClass:"aUl"},[t.allGood?s("section",t._l(t.goodsCom,function(e,a){return s("li",{key:a,staticClass:"aLi"},[s("span",{class:{"shoName-select":e.selected},staticStyle:{float:"left"},on:{click:function(s){t.funSetIsSelect(e,a)}}},[t._v(t._s(e.goodsName))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.packageGoodsNum,expression:"item.packageGoodsNum"}],staticClass:"input-content",attrs:{maxlength:"3"},domProps:{value:e.packageGoodsNum},on:{keyup:function(s){t.funSetGoodsNum(e,a)},input:function(s){s.target.composing||t.$set(e,"packageGoodsNum",s.target.value)}}}),t._v(" "),s("span",[t._v(t._s(e.unit))])])})):t._e(),t._v(" "),t.allGood?t._e():s("section",[t.oneGoodList.goodsList.length>0?s("div",{staticClass:"onecate"},[s("section",{staticClass:"onecataTitle"},[s("i",{staticClass:"twoI",class:{oneI:"0"==t.L2ID}}),t._v(" "),s("li",{staticClass:"twoTitle ",class:{oneTitle:"0"==t.L2ID}},[t._v(t._s(t.oneGoodList.name))])]),t._v(" "),s("section",{staticStyle:{width:"600px",float:"left"}},t._l(t.oneGoodList.goodsList,function(e,a){return s("li",{key:a,staticClass:"aLi"},[s("span",{class:{"shoName-select":e.selected},staticStyle:{float:"left"},on:{click:function(s){t.funSetIsSelect(e,a)}}},[t._v(t._s(e.goodsName))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.packageGoodsNum,expression:"item.packageGoodsNum"}],staticClass:"input-content",attrs:{maxlength:"3"},domProps:{value:e.packageGoodsNum},on:{keyup:function(s){t.funSetGoodsNum(e,a)},input:function(s){s.target.composing||t.$set(e,"packageGoodsNum",s.target.value)}}}),t._v(" "),s("span",[t._v(t._s(e.unit))])])}))]):t._e(),t._v(" "),t._l(t.oneGoodList.child,function(e,a){return e.goodsList.length>0?s("div",{key:a,staticClass:"onecate"},[s("section",{staticClass:"onecataTitle"},[s("i",{staticClass:"twoI"}),t._v(" "),s("li",{staticClass:"twoTitle"},[t._v(t._s(e.name))])]),t._v(" "),s("section",{staticStyle:{width:"600px",float:"left"}},t._l(e.goodsList,function(e,a){return s("li",{key:a,staticClass:"aLi"},[s("span",{class:{"shoName-select":e.selected},staticStyle:{float:"left"},on:{click:function(s){t.funSetIsSelect(e,a)}}},[t._v(t._s(e.goodsName))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.packageGoodsNum,expression:"item.packageGoodsNum"}],staticClass:"input-content",attrs:{maxlength:"3"},domProps:{value:e.packageGoodsNum},on:{keyup:function(s){t.funSetGoodsNum(e,a)},input:function(s){s.target.composing||t.$set(e,"packageGoodsNum",s.target.value)}}}),t._v(" "),s("span",[t._v(t._s(e.unit))])])}))]):t._e()})],2)])])])])};a._withStripped=!0;var o=s("81a2"),i=s("f6ce");function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function a(o,i){try{var n=e[o](i),c=n.value}catch(t){return void s(t)}if(!n.done)return Promise.resolve(c).then(function(t){a("next",t)},function(t){a("throw",t)});t(c)}("next")})}}var c={data:function(){return{shopId:"",title:"",oneArea:{oneAreaBtn:!1,oneAreaName:"请选择一级分类",oneAreaIndex:-1,oneAreaList:[{id:"0",name:"全部"}]},twoArea:{twoAreaBtn:!1,twoAreaName:"请选择二级分类",twoAreaIndex:-1,twoAreaList:[{id:"0",name:"全部二级分类"}]},goodsCom:[],goodList:[],L1ID:0,L2ID:0,oneGoodList:{},newOneGoodList:{},allGood:!0,version:{},search:"",packageType:1,tagName:"",totalNum:null,btnOk:{},btnCancel:{}}},mounted:function(){var t=i.a.session("userShop");this.shopId=t.currentShop.id,this.initBtn(),this.getOneAreaList(),this.getGoodsList(),document.addEventListener("click",this.myClick)},destroyed:function(){document.removeEventListener("click",this.myClick)},props:{pObj:null},components:{win:function(){return s.e("win").then(s.bind(null,"f60a"))},subAdd:function(){return s.e("subadd").then(s.bind(null,"e7ea"))}},methods:{initBtn:function(){this.packageType=this.pObj.packageType,this.tagName=this.pObj.tagName,this.totalNum=this.pObj.totalNum,this.title=this.pObj.title,this.tagName?(this.btnCancel={content:"删除",style:"background-color:#c33"},this.btnOk={content:"确定"}):(this.btnCancel={content:"取消"},this.btnOk={content:"确定"})},recSearch:function(){this.selectOneArea(0,{id:0}),this.oneArea.oneAreaName="请选择一级分类",this.L1ID,this.search=""},getSubAdd:function(t){this.totalNum=t},myClick:function(){this.oneArea.oneAreaBtn=!1,this.twoArea.twoAreaBtn=!1},searchGoods:function(){for(var t=[],e=this.goodList,s=0;s<e.length;s++){var a=e[s].goodsName.toLowerCase(),o=this.search;a&&a.indexOf(o)>-1&&t.push(e[s])}this.oneArea.oneAreaName="请选择一级分类",this.L1ID,this.twoArea={twoAreaBtn:!1,twoAreaName:"请选择二级分类",twoAreaIndex:-1,twoAreaList:[{id:"0",name:"全部二级分类"}]},this.allGood=!0,this.goodsCom=t},goodListWin:function(t){var e=this;if("ok"==t){if(!this.tagName||0==this.tagName.trim().length||/[\s&"'"']/im.test(this.tagName))return this.$store.commit("setWin",{title:"提示信息",content:"请输入标识名！并且分类名中不能含有&和引号!"}),!1;var s=this.counterSelectGoods(this.goodList);if(0==s.total)return void this.$store.commit("setWin",{title:"提示信息",content:"请选择商品"});s.tagName=this.tagName;if((this.pObj.tagName?this.pObj.packageTag.filter(function(t){return t.tagName!=e.pObj.tagName}):this.pObj.packageTag).some(function(t){if(t.tagName==e.tagName.trim())return!0}))return this.$store.commit("setWin",{title:"温馨提示",content:"该标识名已经存在!"}),!1;if(1==this.packageType&&s.total<this.totalNum)return this.$store.commit("setWin",{title:"温馨提示",content:"选中的商品总数量不能小于'可选数量'!"}),!1;this.pObj.tagName?(1==this.pObj.packageType&&(s.total=this.totalNum),this.$emit("throwTagWin","edit",s)):(1==this.pObj.packageType&&(s.total=this.totalNum),this.$emit("throwTagWin","add",s))}else"cancel"==t&&this.pObj.tagName?this.$store.commit("setWin",{title:"温馨提示",content:"确认删除该标识?",winType:"confirm",callback:function(t){"ok"==t&&e.$emit("throwTagWin","delete")}}):this.$emit("throwTagWin","close")},getGoodsList:function(){var t=[],e={};t=this.pObj.goodsList;for(var s=0;s<t.length;s++)this.$set(t[s],"selected",!1),this.$set(t[s],"packageGoodsNum",""),e[t[s].id]||(e[t[s].id]=s);for(var a=this.pObj.selGoods,o=0;o<a.length;o++){var i=e[a[o].gid];(i||void 0!=i)&&(t[i].selected=!0,t[i].packageGoodsNum=a[o].packageGoodsNum)}this.goodsCom=t,this.goodList=t},funSetIsSelect:function(t,e){if(console.log(e),t.selected=!t.selected,t.selected?t.packageGoodsNum="1":t.packageGoodsNum=0,0==this.packageType){var s=this.counterSelectGoods(this.goodList);this.totalNum=s.total}},funSetGoodsNum:function(t,e){console.log(e);var s=t.packageGoodsNum;if(/^[\d]+$/g.test(s)?t.packageGoodsNum=parseInt(1*s):t.packageGoodsNum="",1*t.packageGoodsNum==0?t.selected=!1:t.selected=!0,0==this.packageType){var a=this.counterSelectGoods(this.goodList);this.totalNum=a.total}},counterSelectGoods:function(t){for(var e={goods:[],total:0},s=0;s<t.length;s++)t[s].selected&&(e.goods.push(t[s]),e.total=e.total+parseInt(1*t[s].packageGoodsNum));return e},showOneArea:function(t){t.stopPropagation(),this.twoArea.twoAreaBtn=!1,this.oneArea.oneAreaBtn=!this.oneArea.oneAreaBtn},showTwoArea:function(t){if(t.stopPropagation(),0==this.L1ID)return this.$store.commit("setWin",{title:"温馨提示",winType:"alert",content:"请先选择一个一级分类"}),!1;this.oneArea.oneAreaBtn=!1,this.twoArea.twoAreaBtn=!this.twoArea.twoAreaBtn},selectOneArea:function(t,e){this.search="";for(var s=0;s<this.oneArea.oneAreaList.length;s++)this.oneArea.oneAreaList[s].selected=!1;if(e.selected=!0,this.oneArea.oneAreaBtn=!1,this.twoArea.twoAreaName="请选择二级分类",this.L1ID=e.id,this.L2ID=0,0==t)this.allGood=!0,this.goodsCom=this.goodList,this.oneArea.oneAreaName="全部";else{this.allGood=!1,this.oneArea.oneAreaName=e.name,this.oneArea.oneAreaIndex=t;var a=this.goodList;e.goodsList=[],this.twoArea.twoAreaList=[{id:"0",name:"全部二级分类"}];for(var o=0;o<e.child.length;o++)this.$set(e.child[o],"selected",!1),this.$set(e.child[o],"packageGoodsNum",""),this.twoArea.twoAreaList.push(e.child[o]),e.child[o].goodsList=[];for(var i=0;i<a.length;i++)for(var n=0;n<a[i].cids.length;n++){e.id==a[i].cids[n]&&e.goodsList.push(a[i]);for(var c=0;c<e.child.length;c++)e.child[c].id==a[i].cids[n]&&e.child[c].goodsList.push(a[i])}this.oneGoodList=e,this.newOneGoodList=e}},selectTwoArea:function(t,e){this.search="",this.twoArea.twoAreaName=e.name;for(var s=this.twoArea.twoAreaList,a=0;a<s.length;a++)s[a].selected=!1;e.selected=!0,this.twoArea.twoAreaBtn=!1;var o=this.newOneGoodList,i={};if(0==e.id)o.goodsList=[],this.oneGoodList=o;else{for(var n=0;n<o.child.length;n++)e.id==o.child[n].id&&(i=o.child[n]);this.oneGoodList=i}this.L2ID=e.id},ShopGetExtra:function(){var t=this;return n(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.ShopGetExtra({data:{}});case 2:return s=t.sent,t.abrupt("return",s);case 4:case"end":return t.stop()}},e,t)}))()},getOneAreaList:function(){var t=this;return n(regeneratorRuntime.mark(function e(){var s,a,n,c,r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=i.a.session("httpGoodVersion"),a=!1,e.next=4,t.ShopGetExtra();case 4:if(t.version=e.sent,s&&t.version.otherConfigVer==s.otherConfigVer?a=!0:(a=!1,i.a.session("httpGoodVersion",t.version)),t.oneArea.oneAreaList=[{id:"0",name:"全部"}],n=[{id:"0",name:"全部"}],c=void 0,!(r=i.a.session("areaList"))||!a){e.next=14;break}c=r,e.next=18;break;case 14:return e.next=16,o.a.getCategoryList({data:{shopId:t.shopId}});case 16:c=e.sent,i.a.session("areaList",c);case 18:for(l=0;l<c.length;l++)t.$set(c[l],"selected",!1),n.push(c[l]);t.oneArea.oneAreaList=n;case 20:case"end":return e.stop()}},e,t)}))()}}},r=(s("5f55"),s("7610")),l=Object(r.a)(c,a,[],!1,null,"d54bf9d6",null);l.options.__file="src\\module\\goods_config\\package_com\\package_add_tag_win.vue";e.default=l.exports},"5f55":function(t,e,s){"use strict";var a=s("61a2");s.n(a).a},"61a2":function(t,e,s){}}]);