(window.webpackJsonp=window.webpackJsonp||[]).push([["material_create"],{"17e2":function(t,e,i){"use strict";var n=i("86ae");i.n(n).a},"86ae":function(t,e,i){},"8e35":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAyRTk3N0U3NjkwOTExRTY4MzI2OEU1NkY3Qjg2QTA3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAyRTk3N0U4NjkwOTExRTY4MzI2OEU1NkY3Qjg2QTA3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDJFOTc3RTU2OTA5MTFFNjgzMjY4RTU2RjdCODZBMDciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDJFOTc3RTY2OTA5MTFFNjgzMjY4RTU2RjdCODZBMDciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7A3duJAAAANElEQVR42mL6//8/Ax6MDPCpY2BioBIYNYiOBrEA8X8i1f4fel5jJNI7jKPpaNQgHAAgwAAuLjvvigxAWAAAAABJRU5ErkJggg=="},dc05:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"material-create"}},[n("div",{staticClass:"split-title"},[t._v("\n\t\t\t新建物料\n\t\t")]),t._v(" "),n("div",[n("div",{staticClass:"label-content"},[n("label",{staticClass:"required label"},[t._v("物料名称")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.materialName,expression:"materialName"}],staticClass:"input",attrs:{type:"text",maxlength:"20",placeholder:"请输入物料名称"},domProps:{value:t.materialName},on:{input:function(e){e.target.composing||(t.materialName=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"label-content"},[n("label",{staticClass:"require label"},[t._v("物料简码")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.materialCode,expression:"materialCode"}],staticClass:"input",attrs:{type:"text",maxlength:"20",placeholder:"请输入物料简码"},domProps:{value:t.materialCode},on:{input:function(e){e.target.composing||(t.materialCode=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"label-content"},[n("label",{staticClass:"required label"},[t._v("物料类型")]),t._v(" "),n("div",{staticStyle:{width:"210px",display:"inline-block"}},[n("el-select",{attrs:{placeholder:"全部类型"},model:{value:t.typeValue,callback:function(e){t.typeValue=e},expression:"typeValue"}},t._l(t.typeCate,function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)]),t._v(" "),n("div",{staticClass:"label-content"},[n("label",{staticClass:"required label"},[t._v("物料分类")]),t._v(" "),n("div",{staticClass:"img-div",on:{click:function(e){t.openCategoryWin("category")}}},[n("img",{attrs:{src:i("8e35"),alt:"添加"}}),t._v("添加分类\n\t\t\t\t")]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.selectCategory.length>0,expression:"selectCategory.length>0"}],staticClass:"tips"},[t._v("\n                    (已选择:\n                        "),t._l(t.selectCategory,function(e,i){return n("i",{key:i},[t._v(t._s(e.name)),i!=t.selectCategory.length-1?n("i",[t._v(",")]):t._e()])}),t._v("\n                    )\n                ")],2)]),t._v(" "),n("div",{staticClass:"label-content"},[n("label",{staticClass:"label"},[t._v("品牌")]),t._v(" "),n("div",{staticClass:"img-div",on:{click:function(e){t.openAddBrand("brand")}}},[n("img",{attrs:{src:i("8e35"),alt:"添加"}}),t._v("添加品牌\n\t\t\t\t")]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.selectBrand.length>0,expression:"selectBrand.length>0"}],staticClass:"tips"},[t._v("\n                    (已选择:\n                        "),t._l(t.selectBrand,function(e,i){return n("i",{key:i},[t._v(t._s(e.name))])}),t._v("\n                    )\n                ")],2)]),t._v(" "),n("div",{staticClass:"label-content"},[n("label",{staticClass:"required label"},[t._v("保质期")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.validityObj.time,expression:"validityObj.time"}],staticClass:"input validity-input",attrs:{type:"text",maxlength:"3"},domProps:{value:t.validityObj.time},on:{input:function(e){e.target.composing||t.$set(t.validityObj,"time",e.target.value)}}}),t._v(" "),n("div",{staticClass:"validity",on:{click:t.hideUnitSelect}},[n("span",{staticClass:"validity-num"},[t._v(t._s(t.validityObj.type))]),t._v(" "),n("span",{staticClass:"validity-trangle"}),t._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.validityObj.show,expression:"validityObj.show"}],staticClass:"validity-ul"},t._l(t.validityTypeArr,function(e,i){return n("li",{key:i,on:{click:function(i){t.getValidity(e)}}},[t._v(t._s(e.name))])}))])]),t._v(" "),n("div",{staticClass:"label-content"},[n("label",{staticClass:"required label"},[t._v("物料单位")]),t._v(" "),n("div",{staticClass:"img-div",on:{click:function(e){t.openAddUnitWin("unit")}}},[n("img",{attrs:{src:i("8e35"),alt:"添加"}}),t._v("添加单位\n\t\t\t\t")]),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.selectUnit.length>0,expression:"selectUnit.length>0"}],staticClass:"tips"},[t._v("\n                    (已选择:\n                        "),t._l(t.selectUnit,function(e,i){return n("i",{key:i},[t._v(t._s(e.name)),i!=t.selectUnit.length-1?n("i",[t._v(",")]):t._e()])}),t._v("\n                    )\n                ")],2)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.selectUnit.length>0,expression:"selectUnit.length>0"}],staticClass:"label-content"},[n("label",{staticClass:"required label"},[t._v("默认单位")]),t._v(" "),n("mul-select",{staticStyle:{"margin-left":"-3px"},attrs:{width:210,sorts:t.selectUnitName,name:t.unitObj.de},on:{emit:t.getSelectUnitDe}})],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.selectUnit.length>0,expression:"selectUnit.length>0"}],staticClass:"label-content"},[n("label",{staticClass:"required label"},[t._v("最小单位")]),t._v(" "),n("mul-select",{staticStyle:{"margin-left":"-3px"},attrs:{width:210,sorts:t.selectUnitName,name:t.unitObj.min},on:{emit:t.getSelectUnitMin}})],1),t._v(" "),t._l(t.groupUnit,function(e,i){return e.unitId!=t.unitObj.minId?n("div",{key:i,staticClass:"label-content"},[n("label",{class:{required:0==i,label:!0}},[t._v(t._s(0==i?"单位换算":""))]),t._v(" "),n("div",{staticClass:"unit-div"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"item.value"}],attrs:{type:"text",placeholder:"请输入数字",maxlength:"15"},domProps:{value:e.value},on:{input:function(i){i.target.composing||t.$set(e,"value",i.target.value)}}}),t._v(" "),n("span",{attrs:{title:e.minName}},[t._v(t._s(e.minName))])]),t._v(" "),n("span",{staticClass:"equal-unit"},[t._v("=1 "+t._s(e.unitName))])]):t._e()})],2),t._v(" "),t.isBrand?n("div",{staticClass:"split-title"},[t._v("\n\t\t\t分销价格\n\t\t")]):t._e(),t._v(" "),t._l(t.dispiceArr,function(e,i){return t.isBrand?n("div",{key:i,staticClass:"label-content"},[n("div",{staticClass:"inline-box"},[n("label",{staticClass:"require label"},[t._v(t._s(e.name))]),t._v(" "),n("div",{staticClass:"input-box"},[n("el-input",{attrs:{placeholder:"请输入价格"},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"list.value"}})],1)]),t._v(" "),n("div",{staticClass:"inline-box"},[n("label",{staticClass:"require label"},[t._v("单位")]),t._v(" "),n("el-select",{attrs:{placeholder:"请选择单位"},model:{value:e.unitId,callback:function(i){t.$set(e,"unitId",i)},expression:"list.unitId"}},t._l(t.selectUnit,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)]):t._e()}),t._v(" "),n("div",{staticClass:"bottom"},[n("div",{staticClass:"gray-btn gray",on:{click:function(e){t.clickBtn("cancel")}}},[t._v("取消")]),t._v(" "),n("div",{staticClass:"new-btn new",on:{click:function(e){t.clickBtn("continue")}}},[t._v("继续新建")]),t._v(" "),n("div",{staticClass:"yellow-btn yellow",on:{click:function(e){t.clickBtn("ok")}}},[t._v("确定")])]),t._v(" "),n(t.showCom,{tag:"component",attrs:{pObj:t.comObj,list:t.comObj.category,selectList:t.comObj.selectCategory,title:t.comObj.title,radio:t.comObj.radio,tips:t.comObj.tips,showTips:!1},on:{throwCommonWin:t.closeCommonWin}})],2)};n._withStripped=!0;var a=i("81a2"),s=i("05dd"),l=i("f6ce");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(a,s){try{var l=e[a](s),r=l.value}catch(t){return void i(t)}if(!l.done)return Promise.resolve(r).then(function(t){n("next",t)},function(t){n("throw",t)});t(r)}("next")})}}var c={data:function(){return{validityTypeArr:[{id:0,name:"月"},{id:1,name:"日"},{id:2,name:"年"}],flag:"",isBrand:!1,showCom:"",comObj:{},validityObj:{time:"",type:"日",show:!1},materialName:"",materialCode:"",category:[],selectCategory:[],units:[],selectUnitName:[],selectUnit:[],unitObj:{min:"请选择最小单位",minId:"",de:"请选择默认单位",deId:""},groupUnit:[],selectBrand:[],brandList:[],dispiceArr:[],updateArr:[],typeCate:[{value:0,label:"成品"},{value:1,label:"半成品"},{value:2,label:"普通物料"}],typeValue:""}},methods:{closeCommonWin:function(t,e){if("cancel"!=e&&"close"!=e){switch(this.flag){case"category":this.selectCategory=t;break;case"brand":this.selectBrand=t;break;case"unit":if(t.length>5)return void this.$store.commit("setWin",{title:"温馨提示",content:"最多可添加5个单位哦!"});if(this.selectUnit=t,this.selectUnitName=this.selectUnit.map(function(t){return t.name}),this.groupUnit=[],1==this.selectUnit.length){var i=this.selectUnit[0];this.unitObj={min:i.name,minId:i.id,de:i.name,deId:i.id};var n={unitId:i.id,unitName:i.name,value:i.id==this.unitObj.minId?1:"",minId:this.unitObj.minId,minName:this.unitObj.min};this.groupUnit.push(n)}else this.unitObj={min:"请选择最小单位",minId:"",de:"请选择默认单位",deId:""}}this.flag="",this.showCom=""}else this.showCom=""},openCategoryWin:function(t){this.showCom="addCategory",this.flag=t,this.comObj={category:this.category,title:"选择分类",selectCategory:this.selectCategory,radio:!0,tips:"请先配置分类!"}},openAddUnitWin:function(t){this.showCom="unitBrand",this.flag=t,this.comObj={title:"添加单位",list:this.units,selectlist:this.selectUnit,radio:!1,tips:"请先配置单位!"}},openAddBrand:function(t){this.showCom="unitBrand",this.flag=t,this.comObj={title:"添加品牌",list:this.brandList,selectlist:this.selectBrand,radio:!0,tips:"请先配置品牌"}},getValidity:function(t){this.validityObj.type=t.name},hideUnitSelect:function(t){this.validityObj.show=!this.validityObj.show,t.cancelBubble=!0},getSelectUnitDe:function(t){var e=this;this.units.some(function(i){if(i.name==e.selectUnitName[t])return e.unitObj.de=i.name,e.unitObj.deId=i.id,!0})},getSelectUnitMin:function(t){var e=this;this.selectUnit.some(function(i){if(i.name==e.selectUnitName[t])return e.unitObj.min=i.name,e.unitObj.minId=i.id,!0}),this.groupUnit=[];for(var i=0,n=this.selectUnit.length;i<n;i++){var a=this.selectUnit[i],s={unitId:a.id,unitName:a.name,value:a.id==this.unitObj.minId?1:"",minId:this.unitObj.minId,minName:this.unitObj.min};this.groupUnit.push(s)}var l=null;this.groupUnit=this.groupUnit.filter(function(t){if(!t.value)return!0;l=t}),l&&this.groupUnit.push(l)},clickBtn:function(t){var e=this;switch(l.a.session("tabactive",1),t){case"continue":case"ok":if(!this.checkform())return;var i=this.formatData();this.MaterialAddMaterial(i).then(function(){"ok"==t&&e.$router.go(-1),"continue"==t&&(e.$store.commit("setWin",{title:"温馨提示",content:"新建物料成功!"}),e.initData())});break;case"cancel":this.$router.go(-1)}},formatData:function(){var t=this,e=null;this.selectBrand[0]&&(e=this.selectBrand[0].id);var i=null;this.validityTypeArr.some(function(e){e.name==t.validityObj.type&&(i=e.id)});var n=[];this.selectCategory.forEach(function(t){n.push(t.id)});var a=[];this.groupUnit.forEach(function(e){var i=e.unitId==t.unitObj.deId?1:0,n=e.unitId==t.unitObj.minId?1:0,s={muId:e.unitId,value:e.value,isDefault:i,isMin:n};a.push(s)});var s={name:this.materialName,BC:this.materialCode,brandId:e,validity:this.validityObj.time,validityType:i,cids:n.join(","),unitData:a,type:this.typeValue};return this.isBrand&&(s.distributionData=this.updateArr),s},checkform:function(){var t=this;if(s.a.checkData({materialName:{cond:"$$.length>0 && $$.length<=20",pro:"请输入20字以内的名称!"},materialCode:{reg:/^[0-9A-Za-z]{0,20}$/,pro:"简码由英文,数字组成!"}},this))if(""!==this.typeValue){if(s.a.checkData({time:{reg:/[1-9]\d{0,2}/,pro:"保质期由1-3位数字组成!"}},this.validityObj))if(0!=this.selectCategory.length)if(0!=this.selectUnit.length){if(this.unitObj.minId&&this.unitObj.deId){var e=this.groupUnit.some(function(e){if(!/^[1-9]\d{0,10}(\.\d{0,3})?$/.test(e.value))return t.$store.commit("setWin",{title:"温馨提示",content:"请输入大于1的换算数字,最多可含3位小数!"}),!0}),i=!0;return this.isBrand&&(this.updateArr=[],this.dispiceArr.map(function(e){""!==e.value&&(""===e.unitId&&(t.$store.commit("setWin",{title:"温馨提示",content:"请选择分销价单位！"}),i=!1),t.updateArr.push(e),/^([+-]?)\d*\.?\d+$/.test(e.value)||(t.$message({message:"请输入正确价格！",type:"warning"}),i=!1))})),console.log(i),!!i&&!e}this.$store.commit("setWin",{title:"温馨提示",content:"请选择最小单位与默认单位!"})}else this.$store.commit("setWin",{content:"请选择单位!",title:"温馨提示"});else this.$store.commit("setWin",{content:"请选择分类!",title:"温馨提示"})}else this.$message.error("请选择物料类型!")},initData:function(){this.flag="",this.showCom="",this.comObj={},this.materialName="",this.materialCode="",this.selectUnit=[],this.selectCategory=[],this.selectBrand=[],this.typeValue="",this.unitObj={min:"",minId:"",de:"",deId:""},this.groupUnit=[],this.validityObj={time:"",type:"日",show:!1},this.dispiceArr.map(function(t){t.value="",t.unitId=""})},MaterialGetCategoryList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.MaterialGetCategoryList({data:{}});case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},e,t)}))()},MaterialGetUnitList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.MaterialGetUnitList({data:{}});case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},e,t)}))()},InvoicingBrandList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.InvoicingBrandList({data:{}});case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},e,t)}))()},MaterialAddMaterial:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.MaterialAddMaterial({data:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},i,e)}))()},getDistr:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.invoicingGetDistributionConfig();case 2:i=e.sent,Array.isArray(i)||(i=[]),i.map(function(e){var i={};Object.assign(i,{distributionId:e.id,value:"",name:e.name,unitId:""}),t.dispiceArr.push(i)});case 5:case"end":return e.stop()}},e,t)}))()},domEvent:function(){this.validityObj.show=!1}},mounted:function(){var t=this,e=l.a.session("userShop");this.isBrand="3"==e.currentShop.ischain,this.MaterialGetCategoryList().then(function(e){var i=e;e.forEach(function(e){if(e.child=[],0==e.pid){for(var n=0,a=i.length;n<a;n++)e.id==i[n].pid&&e.id!=i[n].id&&e.child.push(i[n]);t.category.push(e)}})}),this.MaterialGetUnitList().then(function(e){t.units=e}),this.InvoicingBrandList().then(function(e){t.brandList=e}),this.getDistr(),document.addEventListener("click",this.domEvent)},components:{unitBrand:function(){return i.e("unit_brand_win").then(i.bind(null,"86b8"))},mulSelect:function(){return i.e("select_btn").then(i.bind(null,"3d41"))},addCategory:function(){return i.e("add_category_com").then(i.bind(null,"16ef"))}},beforeDestroy:function(){document.removeEventListener("click",this.domEvent)}},o=(i("17e2"),i("6ceb")),u=Object(o.a)(c,n,[],!1,null,"ec2e2eb2",null);u.options.__file="src\\module\\invoicing_system\\warehouse_manage\\material_create.vue";e.default=u.exports}}]);