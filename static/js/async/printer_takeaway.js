(window.webpackJsonp=window.webpackJsonp||[]).push([["printer_takeaway"],{"04b8":function(t,e,a){},4965:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"fl user-content",staticStyle:{width:"100%"},attrs:{id:"printercon"}},[s("section",{staticClass:"user-info"},[s("div",{staticClass:"button",on:{click:t.addColor}},[s("a",{staticClass:"select",attrs:{href:"javascript:void(0);"}},[t._v("全部")]),t._v(" "),s("a",{attrs:{href:"javascript:void(0);"}},[t._v("饿了么")]),t._v(" "),s("a",{attrs:{href:"javascript:void(0);"}},[t._v("美团")]),t._v(" "),s("a",{attrs:{href:"javascript:void(0);"}},[t._v("百度")])]),t._v(" "),s("section",{staticClass:"commodity-box"},[s("section",{staticClass:"commodityAdd fl",on:{click:function(e){t.openWin({pid:null,types:"addPcon",index:null})}}},[t._m(0)]),t._v(" "),t._l(t.conList,function(e,a){return t.allkind||e.areaIds==t.show?s("section",{key:a,staticClass:"fl box",on:{click:function(s){t.openWin({pid:e.id,types:"edit",index:a,status:e.authStatus})}}},[s("section",{staticClass:"bor"},[s("section",{staticClass:"fl",staticStyle:{width:"100%","text-indent":"10px"}},[s("section",{staticClass:"spanFont"},[t._v("单据数据：\n\t\t\t\t\t\t\t"),s("span",{staticClass:"spanFont"},[t._v(t._s(e.orderName))])]),t._v(" "),s("section",{staticClass:"spanFont"},[t._v("打印机：\n\t\t\t\t\t\t\t"),s("span",{staticClass:"spanFont"},[t._v(t._s(e.printerName))])])])]),t._v(" "),0==t.takeoutList[e.areaIds]?s("section",{staticClass:"bat"},[s("span",{on:{click:function(a){t.addWarrant(e.areaIds,a)}}},[t._v("激活授权")])]):s("section",{staticClass:"bated"})]):t._e()}),t._v(" "),t.showMt?s("meiTuan-warrant",{attrs:{urlData:t.urlData},on:{show:t.hidden}}):t._e()],2)]),t._v(" "),t.turn?s("div",{staticClass:"loading"},[s("img",{attrs:{src:a("b8bc")}})]):t._e(),t._v(" "),s("transition",{attrs:{name:"fade"}},[s(t.showCom,{tag:"component",attrs:{pObj:t.comObj},on:{toClick:t.getReturnInfo}})],1)],1)},n=[function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"combox"},[e("img",{attrs:{src:a("f518"),alt:"添加"}}),this._v(" "),e("h3",[this._v("新建打印机配置")])])}];s._withStripped=!0;var i=a("81a2"),r=a("f6ce");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function s(n,i){try{var r=e[n](i),o=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(o).then(function(t){s("next",t)},function(t){s("throw",t)});t(o)}("next")})}}var d={data:function(){return{userData:{},shopId:"",brandId:"",conList:[],editType:"",urlData:"",showMt:!1,goods:"",category:"",erpDishData:{dishes:[]},authoriseList:[],takeoutList:{},turn:!1,allkind:!0,show:null,showBounced:!1,postFirstPid:null,postFirstTypes:null,postFirstIndex:null,title:null,showCom:"",comObj:{}}},methods:{hidden:function(t){this.showMt=t},addColor:function(t){var e=document.querySelectorAll("#printercon .button a");if(1===t.target.nodeType&&"a"===t.target.nodeName.toLocaleLowerCase()){for(var a=0;a<e.length;a++)e[a]===t.target&&(0==a?(this.allkind=!0,this.show=null):1==a?(this.show=1,this.allkind=!1):2==a?(this.show=2,this.allkind=!1):3==a&&(this.show=3,this.allkind=!1)),e[a].removeAttribute("class");t.target.className="select"}},init:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a,s,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.turn=!0,e.next=3,i.a.takeoutprintGetList({data:{}});case 3:return a=e.sent,s=a,e.next=7,i.a.takeoutGetTakeOutList({data:{brandId:t.brandId}});case 7:(n=e.sent).forEach(function(e){t.takeoutList[e.id]=e.status}),t.authoriseList=n,t.conList=s,t.turn=!1;case 12:case"end":return e.stop()}},e,t)}))()},openWin:function(t){var e=t.pid,a=t.types,s=t.index;if(0==t.status)return!1;"addPcon"==a?this.title="新建打印机配置":"edit"==a&&(this.title="修改打印机配置"),this.postFirstPid=e,this.postFirstTypes=a,this.postFirstIndex=s,this.showCom="printWin",this.comObj={postFirstPid:this.postFirstPid,postFirstTypes:this.postFirstTypes,postFirstIndex:this.postFirstIndex,title:this.title}},getReturnInfo:function(t,e){var a=this;return o(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!t){s.next=8;break}if(!e){s.next=5;break}return a.showCom="",setTimeout(o(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.init();case 2:case"end":return t.stop()}},t,a)})),2e3),s.abrupt("return");case 5:return a.showCom="",s.next=8,a.init();case 8:case"end":return s.stop()}},s,a)}))()},addWarrant:function(t,e){var a=this;return o(regeneratorRuntime.mark(function s(){var n,r,d,c,u,h;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(2==t){s.next=11;break}return sessionStorage.setItem("waimai",t),n=window.open("","newWindow"),s.next=5,i.a.getAuthorizationUrl({data:{type:t,brandId:a.brandId,shopId:a.userData.currentShop.shopId}});case 5:r=s.sent,n.location=r,d=0,c=setInterval(o(regeneratorRuntime.mark(function e(){var s,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d+=1,e.next=3,i.a.getReturnInfo({data:{type:t}});case 3:1==(s=e.sent)?(a.init(),clearInterval(c),r=window.location.href,n.location=r,a.getShopList()):0==s&&(n.close(),clearInterval(c),a.$store.commit("setWin",{content:"授权失败"})),d>60&&(n.close(),a.init(),clearInterval(c));case 6:case"end":return e.stop()}},e,a)})),3e3),s.next=20;break;case 11:if(2!=t){s.next=20;break}return e.stopPropagation(),u=window.location.href,a.getGoods(),s.next=17,i.a.getAuthorizationUrl({data:{type:t,brandId:a.brandId,shopId:a.userData.currentShop.id}});case 17:h=s.sent,a.urlData=h+"&eOrigin="+u,a.showMt=!0;case 20:case"end":return s.stop()}},s,a)}))()},getGoods:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a,s,n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getAllGoods({data:{page:1,num:9999,shopIds:t.userData.currentShop.id}});case 2:return a=e.sent,t.goods=a,e.next=6,i.a.getAllCategory({data:{shopIds:t.userData.currentShop.id}});case 6:for(s=e.sent,t.category=s,n=0;n<t.goods.length;n++)for(r={categoryName:"",eDishCode:"",eDishSkuCode:"",dishNameWithSpec:""},o=0;o<t.category.length;o++)t.goods[n].cids[0]==t.category[o].id&&(r.categoryName=t.category[o].name,r.eDishSkuCode=t.goods[n].id,r.eDishCode=t.goods[n].id,r.dishNameWithSpec=t.goods[n].goodsName,t.erpDishData.dishes.push(r));case 9:case"end":return e.stop()}},e,t)}))()},cancel:function(t){t.stopPropagation()},getShopList:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a,s,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.a.session("takeaway_shop_cObj",null),r.a.session("takeaway_shop_list",null),a=void 0,s=void 0,n=void 0,r.a.session("takeaway_select_data")&&(a=r.a.session("takeaway_select_data").split("_"),s=a[0],n=a[1]),t.next=6,i.a.getTakeOutShoplist({data:{shopId:s,id:s,ischain:n}});case 6:o=t.sent,r.a.session("takeaway_shop_list",o);case 8:case"end":return t.stop()}},e,t)}))()},listeningAuthorized:function(){var t,e=this;window.onmessage=(t=o(regeneratorRuntime.mark(function t(a){var s,n,r,o,d,c,u,h,p,l,f,g,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e.erpDishData,"msg-token"!=a.data.event){t.next=8;break}return t.next=4,i.a.addMeituanShopRelation({data:{shopId:e.userData.currentShop.id,brandId:e.brandId,mtShopId:a.data.value.poiId,mtShopName:a.data.value.poiName}});case 4:t.sent&&e.init(),t.next=48;break;case 8:if("finish-storebind"!=a.data.event){t.next=12;break}e.showMt=!1,t.next=48;break;case 12:if("setPrinter"!=a.data.event){t.next=16;break}window.location.reload(),t.next=48;break;case 16:if("cancelSetPrinter"!=a.data.event){t.next=20;break}e.showMt=!1,t.next=48;break;case 20:if("getErpDishData"!=a.data.event){t.next=24;break}a.source.postMessage({event:"erpDishData",value:s},"*"),t.next=48;break;case 24:if("savedDishConnectionData"!=a.data.event){t.next=31;break}for(0==a.data.value.unMatchedNum&&(e.showMt=!1),n=a.data.value.data,r={dishes:[]},o=0;o<n.length;o++){for((d={dishId:"",eDishId:"",dishSkuId:[]}).dishId=n[o].dishId,d.eDishId=n[o].eDishCode,c=0;c<n[o].waiMaiDishSkuMappings.length;c++)d.dishSkuId.push(n[o].waiMaiDishSkuMappings[c].dishSkuId);r.dishes.push(d)}t.next=48;break;case 31:if("setWaimaiDish"!=a.data.event){t.next=40;break}for(u={dishes:[]},h=a.data.value.dishes,p=0;p<h.length;p++)(l={dishId:"",eDishCode:"",waiMaiDishSkuMappings:[{eDishSkuCode:"",dishSkuId:""}]}).dishId=h[p].dishId,l.eDishCode=h[p].dishSkuId,l.waiMaiDishSkuMappings[0].eDishSkuCode=h[p].dishSkuId,l.waiMaiDishSkuMappings[0].dishSkuId=h[p].dishSkuId,u.dishes.push(l),(f={categoryName:"",eDishCode:"",eDishSkuCode:"",dishNameWithSpec:""}).categoryName=h[p].categoryName,f.eDishCode=h[p].dishSkuId,f.eDishSkuCode=h[p].dishSkuId,f.dishNameWithSpec=h[p].dishName+"("+h[p].spec+")",s.dishes.push(f);for(g=0;g<u.dishes.length;g++)for(v=0;v<u.dishes.length;v++)g!=v&&u.dishes[g].dishId==u.dishes[v].dishId&&(u.dishes[g].waiMaiDishSkuMappings.push(u.dishes[v].waiMaiDishSkuMappings[0]),u.dishes.splice(v,1));a.source.postMessage({event:"erpDishData",value:s},"*"),a.source.postMessage({event:"dishMatchData",value:u},"*"),t.next=48;break;case 40:if("releaseBinding"!=a.data.event){t.next=48;break}return t.next=43,i.a.mtRedisClean();case 43:if(t.sent){t.next=46;break}return t.abrupt("return");case 46:e.init(),e.showMt=!1;case 48:case"end":return t.stop()}},t,e)})),function(e){return t.apply(this,arguments)})}},mounted:function(){var t=this,e=r.a.session("userShop"),a=e.currentShop.id,s=void 0;s=e.currentShop.brandId?e.currentShop.brandId:0,this.userData=e,this.shopId=a,this.brandId=s,this.init(),document.onclick=function(){t.showMt=!1},this.listeningAuthorized()},components:{printWin:function(){return a.e("printaddedit_win").then(a.bind(null,"e80b"))},meiTuanWarrant:function(){return a.e("iframe_warrant").then(a.bind(null,"6d65"))}}},c=(a("54ce"),a("7610")),u=Object(c.a)(d,s,n,!1,null,"19d46408",null);u.options.__file="src\\module\\outfood\\takeawayprint\\printer_takeaway.vue";e.default=u.exports},"54ce":function(t,e,a){"use strict";var s=a("04b8");a.n(s).a},b8bc:function(t,e,a){t.exports=a.p+"images/preloader.3e54c692.gif"},f518:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAvCAYAAABzJ5OsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAKxJREFUeNrs2LENgzAQhWE7ygAZgQ2yApsk9S1hGMJeB7ERGzhHh+w0EXdF0P8ky9IV8BVH8Yi11mCdUsqg1/s4E5HJ+j334JMdn5qZOf4W/jjgwYMHDx48ePDgwYMHD/7XxJxzV5aNOuyrmc0eBfxbWfZIYm2ugt/XZtOzGj/3oefZzFbzD9bpj9mo13KciUhkbcCDBw8ePHjw4MGDBw8e/MkC7hGPUt/lI8AAt9oYPL6CVYkAAAAASUVORK5CYII="}}]);