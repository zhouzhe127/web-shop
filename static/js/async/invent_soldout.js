(window.webpackJsonp=window.webpackJsonp||[]).push([["invent_soldout"],{"37d9":function(t,e,s){},"75f4":function(t,e,s){"use strict";var n=s("37d9");s.n(n).a},a543:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"newlose"}},[s("div",{staticClass:"titleTop"},[s("div",{staticClass:"topbox"},[s("i"),t._v(" "),s("h3",[t._v("新增下架")]),t._v(" "),t._l(32,function(t){return s("div",{key:t,staticClass:"dian"})})],2)]),t._v(" "),2!=t.type?s("div",{staticClass:"conBox"},[s("label",{staticClass:"content-box"},[s("span",{staticClass:"required"},[t._v("下架类型")]),t._v(" "),s("select-btn",{ref:"select",attrs:{sorts:t.soldType,width:240},on:{selOn:t.selectList}})],1),t._v(" "),1==t.type?s("label",{staticClass:"content-box"},[s("span",{staticClass:"required"},[t._v("批次选择")]),t._v(" "),s("section",{staticClass:"tableListInp chairFix",staticStyle:{"vertical-align":"middle"},on:{click:t.showWar}},[s("span",{staticClass:"inptext"},[t._v(t._s(t.selectWar.batchCode))]),t._v(" "),t._m(0)])]):t._e(),t._v(" "),s("label",{staticClass:"content-box"},[s("span",{staticClass:"required"},[t._v("下架数量")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.soldNum,expression:"soldNum"}],staticClass:"right",attrs:{type:"text",placeholder:"请填写下架数量",maxlength:"9"},domProps:{value:t.soldNum},on:{input:[function(e){e.target.composing||(t.soldNum=e.target.value)},t.changeNum]}})]),t._v(" "),s("label",{staticClass:"content-box"},[s("span",{staticClass:"req"},[t._v("下架原因")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.resion,expression:"resion"}],staticClass:"right",attrs:{type:"text",placeholder:"选填",maxlength:"40"},domProps:{value:t.resion},on:{input:function(e){e.target.composing||(t.resion=e.target.value)}}})])]):s("soldout-new",{ref:"soldoutNew",on:{sleType:t.selectList}}),t._v(" "),s("div",{staticStyle:{"margin-top":"50px","margin-left":"120px"}},[s("a",{staticClass:"gray",staticStyle:{width:"120px","margin-right":"20px"},attrs:{href:"javascript:void(0);"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("a",{staticClass:"yellow",staticStyle:{width:"120px","margin-right":"20px",background:"none",color:"#f8941f",border:"1px solid #f8941f"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.comeon(!1)}}},[t._v("继续下架")]),t._v(" "),s("a",{staticClass:"yellow",staticStyle:{width:"120px"},attrs:{href:"javascript:void(0);"},on:{click:t.save}},[t._v("确定")])]),t._v(" "),t.batchSle?s("manageEdit",{attrs:{detail:t.detail,gid:t.gid},on:{winEvent:t.chooseBatch}}):t._e()],1)};n._withStripped=!0;var a=s("81a2"),r=s("05dd");function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function n(a,r){try{var i=e[a](r),o=i.value}catch(t){return void s(t)}if(!i.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}("next")})}}var o={data:function(){return{soldNum:"",resion:"",soldType:["下架到耗损","下架到库存","下架到库存(新增批次)"],selectWar:"",batchSle:!1,type:0,checkHttp:!0,totalSurplus:0,surplus:0,price:""}},props:["detail","gid","allNum"],methods:{cancel:function(){this.$emit("soldBack",!1)},changeNum:function(){this.soldNum.includes(".")&&(this.soldNum=this.soldNum.substr(0,this.soldNum.indexOf(".")+4))},comeon:function(t){var e=this;return i(regeneratorRuntime.mark(function s(){var n;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(2==e.type){s.next=29;break}if(e.allNum){s.next=4;break}return e.alert("无上架数量"),s.abrupt("return",!1);case 4:if(e.soldNum&&0!=e.soldNum){s.next=7;break}return e.alert("下架架数量有误"),s.abrupt("return",!1);case 7:if(!e.checkNum()){s.next=9;break}return s.abrupt("return",!1);case 9:if((n={}).gid=e.gid,n.num=e.soldNum,n.cause=e.resion,0!=e.type){s.next=17;break}n.type=1,s.next=26;break;case 17:if(e.selectWar){s.next=20;break}return e.alert("请选择批次"),s.abrupt("return",!1);case 20:n.type=2,n.wid=e.selectWar.wid,n.areaId=e.selectWar.areaId,n.batchId=e.selectWar.batchId,n.surplus=e.surplus,n.totalSurplus=e.totalSurplus;case 26:e.checkHttp&&a.a.invoicing_loss({data:n}).then(function(s){e.$emit("soldBack",s),e.totalSurplus=s.totalSurplus,e.surplus=s.surplus,t&&e.cancel(),e.setNone(),e.alert("下架成功")}),s.next=33;break;case 29:return s.next=31,e.soldNew();case 31:t&&e.cancel(),e.setNone();case 33:case"end":return s.stop()}},s,e)}))()},soldNew:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var s,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.$refs.soldoutNew,t.soldNum=s.soldNum,t.price=s.price,!t.checkNum()){e.next=5;break}return e.abrupt("return",!1);case 5:if(""!=s.wid){e.next=8;break}return t.alert("请选择仓库"),e.abrupt("return",!1);case 8:if(s.win.selects[0]){e.next=11;break}return t.alert("请选择供应商"),e.abrupt("return",!1);case 11:if(r.a.checkData({price:{reg:/^([+]?)\d*\.?\d+$/,pro:"价格输入有误"}},t)){e.next=13;break}return e.abrupt("return",!1);case 13:return e.next=15,a.a.invoicing_shelveNewBatch({data:{gid:t.gid,wid:s.wid,areaId:s.areaId,supplierId:s.win.selects[0],num:s.soldNum,purchasePrice:s.price,productionTime:parseInt(s.startTime/1e3),expiryTime:parseInt(s.endTime/1e3),batchCode:s.batchCode,articleNo:s.artNo,cause:s.remarks}});case 15:n=e.sent,t.$emit("soldBack",n),t.setNone(),t.alert("下架成功");case 19:case"end":return e.stop()}},e,t)}))()},checkNum:function(){return!r.a.checkData({soldNum:{pro:"数量输入有误",fn:function(){return this.soldNum<=Number(this.allNum)&&this.soldNum>=0||!!/^([+]?)\d*\.?\d+$/.test(this.soldNum)}}},this)},save:function(){this.comeon(!0)},selectList:function(t){this.type=t},setNone:function(){this.soldNum="",this.resion="",2==this.type&&(this.$refs.soldoutNew.soldNum="")},showWar:function(){this.batchSle=!0},chooseBatch:function(t,e){this.batchSle=!1,"ok"==t&&(console.log(e),e&&(this.selectWar=e,this.totalSurplus=e.totalSurplus,this.surplus=e.surplus))},alert:function(t,e){this.$store.commit("setWin",{title:e,winType:"alert",content:t})}},components:{selectBtn:function(){return s.e("select_btn").then(s.bind(null,"3d41"))},manageEdit:function(){return s.e("manage_edit_win").then(s.bind(null,"2c29"))},soldoutNew:function(){return s.e("soldout_new").then(s.bind(null,"107d"))}}},c=(s("75f4"),s("6ceb")),l=Object(c.a)(o,n,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl"},[e("span",{staticClass:"addstyle"},[this._v("+")])])}],!1,null,"5ec3a395",null);l.options.__file="src\\module\\invoicing_system\\invoicing\\invent_soldout.vue";e.default=l.exports}}]);