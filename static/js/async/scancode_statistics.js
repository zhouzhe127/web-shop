(window.webpackJsonp=window.webpackJsonp||[]).push([["scancode_statistics"],{1140:function(t,e,s){},"278a":function(t,e,s){"use strict";s.r(e);var a=s("81a2"),n=s("f6ce"),i=s("05dd");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function a(n,i){try{var o=e[n](i),r=o.value}catch(t){return void s(t)}if(!o.done)return Promise.resolve(r).then(function(t){a("next",t)},function(t){a("throw",t)});t(r)}("next")})}}var r={data:function(){return{page:1,num:10,endTotal:1,ischain:"",startObj:{time:(new Date).setHours(0,0,0,0),width:170},endObj:{time:(new Date).setHours(23,59,59,999),width:170},isOpenTime:!1,postSelectShopList:[],selectName:null,shopIds:null,staticLists:[],isloadingstatus:!1,allFormList:[],formList:[],timer:"",showtype:"all",constructionsName:"",constructionsId:"",timeout:"",taskId:"",loading:!1,timerqueue:[],transmitId:[]}},methods:{getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},selectBusinessHours:function(){this.isOpenTime=!this.isOpenTime},getSelectShopList:function(t){console.log(this.postSelectShopList),this.transmitId=t;for(var e="",s=0;s<this.postSelectShopList.length;s++)this.transmitId.includes(this.postSelectShopList[s].id)?(this.postSelectShopList[s].selected=!0,e=e+this.postSelectShopList[s].name+","):this.postSelectShopList[s].selected=!1;this.shopIds=t.join(","),this.selectName=""==e?"请选择店铺":e},checkData:function(){return this.endObj.time-this.startObj.time>i.a.timeConst.THREEMONTHS?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"只能查询间隔三个月的数据"}),!1):this.startObj.time-this.endObj.time>0?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"查询时间选择错误"}),!1):""==this.shopIds?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请选择店铺"}),!1):1!=this.loading||(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"正在搜索,请勿重复点击"}),!1)},resetting:function(){this.startObj.time=(new Date).setHours(0,0,0,0),this.endObj.time=(new Date).setHours(23,59,59,999),this.isOpenTime=!1,this.getshopIdorshopName(),this.scanPayQuery()},tableEvent:function(){},setPage:function(){this.endTotal=Math.ceil(this.allFormList.length/this.num);var t=(this.page-1)*this.num,e=this.page*this.num,s=this.allFormList.slice(t,e);this.formList=s},scanPayQuery:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.checkData()){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,t.isloadingstatus=!1,e.next=6,a.a.scanPayQuery({data:{startTime:parseInt(t.startObj.time/1e3),endTime:parseInt(t.endObj.time/1e3),shopIds:t.shopIds,isOpenTime:Number(t.isOpenTime)}});case 6:(s=e.sent)&&(t.taskId=s,t.timer=setInterval(function(){t.getTaskStatus(s)},2e3));case 8:case"end":return e.stop()}},e,t)}))()},getTaskStatus:function(t){var e=this;return o(regeneratorRuntime.mark(function s(){var n;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.a.getScanTaskStatus({data:{taskId:t}});case 2:if(n=s.sent,e.timeout=setTimeout(function(){if(!e.isloadingstatus){for(e.loading=!1,e.$store.commit("setWin",{content:"页面加载失败,请重新加载",title:"操作提示",winType:"alert"}),clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());return!1}},2e4),e.timerqueue.push(e.timeout),1==n){for(clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());e.getScanPayData(t)}case 6:case"end":return s.stop()}},s,e)}))()},getScanPayData:function(t){var e=this;return o(regeneratorRuntime.mark(function s(){var n;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.a.getScanPayData({data:{taskId:t,showDetail:0,showShopId:"",showDay:""}});case 2:(n=s.sent)&&(e.loading=!1,e.isloadingstatus=!0,e.staticLists=[],e.staticLists.push(n.total),e.allFormList=n.list,e.$nextTick(function(){e.setPage()}));case 4:case"end":return s.stop()}},s,e)}))()},getshopName:function(t){var e="",s=!0,a=!1,n=void 0;try{for(var i,o=this.postSelectShopList[Symbol.iterator]();!(s=(i=o.next()).done);s=!0){var r=i.value;r.id==t&&(e=r.name?r.name:r.shopName)}}catch(t){a=!0,n=t}finally{try{!s&&o.return&&o.return()}finally{if(a)throw n}}return e},getDetailShow:function(t){var e=this;this.showtype=t,this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){e.Export()}}])},showoneshopDetail:function(t){this.showtype="one",this.constructionsName=this.getshopName(t.shopId),this.constructionsId=t.shopId},getshopIdorshopName:function(){if("3"==this.ischain){var t=n.a.session("shopList"),e=[],s=[],a=!0,i=!1,o=void 0;try{for(var r,l=t[Symbol.iterator]();!(a=(r=l.next()).done);a=!0){var c=r.value;c.selected=!0,c.name=c.shopName,e.push(c.id),s.push(c.name)}}catch(t){i=!0,o=t}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}this.shopIds=e.join(","),this.selectName=s.join(","),this.postSelectShopList=t,this.transmitId=t.map(function(t){return t.id})}else this.shopIds=n.a.session("userShop").currentShop.id,this.selectName=n.a.session("userShop").currentShop.name,this.postSelectShopList.push(n.a.session("userShop").currentShop)},Export:function(){var t=this;return o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.exportScanPayData({data:{taskId:t.taskId,showDetail:0,showShopId:"",showDay:"",isExport:1}});case 2:case"end":return e.stop()}},e,t)}))()},handleSizeChange:function(t){this.num=t,this.setPage()},pageChange:function(t){this.page=t,this.setPage()}},components:{calendar:function(){return s.e("calendar_result").then(s.bind(null,"9265"))},pageElement:function(){return s.e("page_element").then(s.bind(null,"5921"))},comTable:function(){return s.e("table").then(s.bind(null,"4360"))},oneshopStatics:function(){return s.e("scancode_shopstatistics").then(s.bind(null,"738a"))},elShopList:function(){return s.e("el_shopList").then(s.bind(null,"60ff"))}},mounted:function(){var t=this;this.ischain=n.a.session("userShop").currentShop.ischain,this.getshopIdorshopName(),this.scanPayQuery(),this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){t.Export()}}])},destroyed:function(){clearInterval(this.timer),clearTimeout(this.timeout)}},l=(s("7b35"),s("d801")),c=Object(l.a)(r,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"scancode"}},["all"==t.showtype?s("section",[s("div",{staticClass:"order-order-data"},[s("ul",[s("section",{staticClass:"statisticsList fl"},[s("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp",editable:!1},on:{change:t.getStartTime},model:{value:t.startObj.time,callback:function(e){t.$set(t.startObj,"time",e)},expression:"startObj.time"}})],1),t._v(" "),s("span",{staticClass:"to"},[t._v("至")]),t._v(" "),s("section",{staticClass:"statisticsList fl"},[s("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp"},on:{change:t.getEndTime},model:{value:t.endObj.time,callback:function(e){t.$set(t.endObj,"time",e)},expression:"endObj.time"}})],1),t._v(" "),s("li",[s("div",{staticClass:"checkBox",class:{selected:t.isOpenTime},on:{click:t.selectBusinessHours}}),t._v(" "),s("span",{staticStyle:{"font-size":"16px"}},[t._v("按营业时间")])]),t._v(" "),"3"==t.ischain?s("li",[s("elShopList",{attrs:{shopIds:t.transmitId},on:{chooseShop:t.getSelectShopList}})],1):t._e(),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.scanPayQuery}},[t._v("筛选")]),t._v(" "),s("el-button",{attrs:{type:"info"},on:{click:t.resetting}},[t._v("重置")])],1)]),t._v(" "),s("div",{staticClass:"choiceshop"},[s("div",{staticClass:"choiceshop_l"},[t._v("\n\t\t\t\t选择店铺:\n\t\t\t")]),t._v(" "),s("div",{staticClass:"choiceshop_r"},[t._v("\n\t\t\t\t"+t._s(t.selectName)+"\n\t\t\t")])]),t._v(" "),s("section",{staticStyle:{"margin-bottom":"20px"}},[s("el-table",{staticStyle:{width:"1436px"},attrs:{data:t.staticLists,border:"",stripe:!0,"header-cell-style":{"background-color":"#f5f7fa"},"header-row-style":{height:"40px"},"row-style":{height:"70px"}}},[s("el-table-column",{attrs:{fixed:"",prop:"days",label:"天数",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"支付次数",prop:"payTimes",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{prop:"totalConsumption",label:"消费总额",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"优惠总额",prop:"totalDiscount",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"代金券",prop:"totalConsumption",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.totalVouchersPain)+"("+t._s(e.row.totalVouchersNum)+"张)")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"实收总额",prop:"totalPain",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"积分抵扣总额",prop:"totalPointCash",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"会员消费总额",prop:"totalMemberConsumption",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"微信支付总额",prop:"totalWeChatPain",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"支付宝支付总额",prop:"totalAliPayPain",align:"center"}})],1)],1),t._v(" "),s("div",{staticClass:"list_box",staticStyle:{width:"100%"}},[s("div",{staticClass:"list_title"},[s("div",{staticClass:"list_title_l fl"},[s("span",[t._v("快捷支付统计")]),t._v(" "),s("span"),t._v(" "),s("span",[t._v("共\n\t\t\t\t\t\t\t"),s("a",{attrs:{href:"javascript:;"}},[t._v(t._s(t.allFormList.length))]),t._v("个条目")])]),t._v(" "),s("div",{staticClass:"list_title_r fr"})]),t._v(" "),s("el-table",{attrs:{data:t.formList,border:"",stripe:!0,"header-cell-style":{"background-color":"#f5f7fa"},"header-row-style":{height:"40px"},"row-style":{height:"70px"}}},[s("el-table-column",{attrs:{fixed:"",prop:"shopId",label:"店铺名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticStyle:{color:"#e1bb4a"},on:{click:function(s){t.showoneshopDetail(e.row)}}},[t._v(t._s(t.getshopName(e.row.shopId)))])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"支付次数",prop:"payTimes",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{prop:"totalConsumption",label:"消费总额",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"优惠总额",prop:"totalDiscount",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"代金券",prop:"totalConsumption",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.totalVouchersPain)+"("+t._s(e.row.totalVouchersNum)+"张)")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"实收总额",prop:"totalPain",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"积分抵扣总额",prop:"totalPointCash",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"会员消费总额",prop:"totalMemberConsumption",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"微信支付总额",prop:"totalWeChatPain",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"支付宝支付总额",prop:"totalAliPayPain",align:"center"}})],1)],1),t._v(" "),s("div",{staticClass:"pageWrap"},[s("el-pagination",{attrs:{background:"","current-page":t.page,"page-size":t.num,layout:"sizes, prev, pager, next","page-count":t.endTotal,"page-sizes":[10,20,30]},on:{"size-change":t.handleSizeChange,"current-change":t.pageChange}})],1)]):t._e(),t._v(" "),"one"==t.showtype?s("oneshop-statics",{attrs:{constructionsName:t.constructionsName,startTime:t.startObj.time,endTime:t.endObj.time,isOpenTime:t.isOpenTime,constructionsId:t.constructionsId,taskId:t.taskId},on:{throwWinResult:t.getDetailShow}}):t._e()],1)},[],!1,null,"d46d0c28",null);e.default=c.exports},"7b35":function(t,e,s){"use strict";var a=s("1140");s.n(a).a}}]);