(window.webpackJsonp=window.webpackJsonp||[]).push([["scancode_statistics"],{"36e3":function(t,e,a){"use strict";var s=a("b89a");a.n(s).a},b89a:function(t,e,a){},de00:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"scancode"}},["all"==t.showtype?a("section",[a("div",{staticClass:"order-order-data"},[a("ul",[a("section",{staticClass:"statisticsList fl"},[a("section",{staticClass:"tableListInp"},[a("calendar",{attrs:{pObj:t.startObj},on:{throwTime:t.getStartTime}})],1)]),t._v(" "),a("span",{staticClass:"to"},[t._v("至")]),t._v(" "),a("section",{staticClass:"statisticsList fl"},[a("section",{staticClass:"tableListInp"},[a("calendar",{attrs:{pObj:t.endObj},on:{throwTime:t.getEndTime}})],1)]),t._v(" "),a("li",[a("div",{staticClass:"checkBox",class:{selected:t.isOpenTime},on:{click:t.selectBusinessHours}}),t._v(" "),a("span",{staticStyle:{"font-size":"16px"}},[t._v("按营业时间")])]),t._v(" "),"3"==t.ischain?a("li",[a("selectstore",{attrs:{sorts:t.postSelectShopList,tipName:t.selectName},on:{emit:t.getSelectShopList}})],1):t._e(),t._v(" "),a("a",{staticClass:"fl blue secBtn",attrs:{href:"javascript:void(0)"},on:{click:function(e){t.scanPayQuery()}}},[t._v("搜索")]),t._v(" "),a("a",{staticClass:"fl gray recBtn",attrs:{href:"javascript:void(0)"},on:{click:function(e){t.resetting()}}},[t._v("重置")])])]),t._v(" "),a("div",{staticClass:"choiceshop"},[a("div",{staticClass:"choiceshop_l"},[t._v("\n\t\t\t\t选择店铺:\n\t\t\t")]),t._v(" "),a("div",{staticClass:"choiceshop_r"},[t._v("\n\t\t\t\t"+t._s(t.selectName)+"\n\t\t\t")])]),t._v(" "),a("section",{staticStyle:{"margin-bottom":"20px"}},[a("com-table",{attrs:{listHeight:80,listWidth:1400,showHand:!1,titleData:t.titleList,introData:t.staticLists},on:{tableEvent:t.tableEvent},scopedSlots:t._u([{key:"con-4",fn:function(e){return a("div",{},[t._v("\n\t\t\t\t\t"+t._s(e.data.totalVouchersPain)+"("+t._s(e.data.totalVouchersNum)+"张)\n\t\t\t\t")])}}])})],1),t._v(" "),a("section",[a("com-table",{attrs:{listHeight:80,listWidth:1400,showHand:!1,titleData:t.shoptitleList,introData:t.formList},on:{tableEvent:t.tableEvent},scopedSlots:t._u([{key:"con-0",fn:function(e){return a("div",{on:{click:function(a){t.showoneshopDetail(e.data)}}},[t._v("\n\t\t\t\t\t"+t._s(t.getshopName(e.data.shopId))+"\n\t\t\t\t")])}},{key:"con-4",fn:function(e){return a("div",{},[t._v("\n\t\t\t\t\t"+t._s(e.data.totalVouchersPain)+"("+t._s(e.data.totalVouchersNum)+"张)\n\t\t\t\t")])}}])})],1),t._v(" "),a("section",{staticClass:"turn-page"},[a("pageElement",{attrs:{page:Number(t.page),total:Number(t.endTotal),numArr:[10,20,30,40,50],isNoJump:!0},on:{pageNum:t.getPageNum}})],1)]):t._e(),t._v(" "),"one"==t.showtype?a("oneshop-statics",{attrs:{constructionsName:t.constructionsName,startTime:t.startObj.time,endTime:t.endObj.time,isOpenTime:t.isOpenTime,constructionsId:t.constructionsId,taskId:t.taskId},on:{throwWinResult:t.getDetailShow}}):t._e()],1)};s._withStripped=!0;var i=a("81a2"),n=a("f6ce"),o=a("05dd");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function s(i,n){try{var o=e[i](n),r=o.value}catch(t){return void a(t)}if(!o.done)return Promise.resolve(r).then(function(t){s("next",t)},function(t){s("throw",t)});t(r)}("next")})}}var c={data:function(){return{page:1,num:10,endTotal:1,ischain:"",startObj:{time:(new Date).setHours(0,0,0,0),width:170},endObj:{time:(new Date).setHours(23,59,59,999),width:170},isOpenTime:!1,postSelectShopList:[],selectName:null,shopIds:null,staticLists:[],isloadingstatus:!1,titleList:[{titleName:"天数",dataName:"days"},{titleName:"支付次数",dataName:"payTimes"},{titleName:"消费总额 ",dataName:"totalConsumption"},{titleName:"优惠总额",dataName:"totalDiscount"},{titleName:"代金券"},{titleName:"实收总额",dataName:"totalPain"},{titleName:"积分抵扣总额",dataName:"totalPointCash"},{titleName:"会员消费总额",dataName:"totalMemberConsumption"},{titleName:"微信支付总额",dataName:"totalWeChatPain"},{titleName:"支付宝支付总额",dataName:"totalAliPayPain"}],shoptitleList:[{titleName:"店铺名称",dataName:"shopId",conStyle:{color:"#27a8e0",cursor:"pointer"}},{titleName:"支付次数",dataName:"payTimes"},{titleName:"消费总额 ",dataName:"totalConsumption"},{titleName:"优惠总额",dataName:"totalDiscount"},{titleName:"代金券"},{titleName:"实收总额",dataName:"totalPain"},{titleName:"积分抵扣总额",dataName:"totalPointCash"},{titleName:"会员消费总额",dataName:"totalMemberConsumption"},{titleName:"微信支付总额",dataName:"totalWeChatPain"},{titleName:"支付宝支付总额",dataName:"totalAliPayPain"}],allFormList:[],formList:[],timer:"",showtype:"all",constructionsName:"",constructionsId:"",timeout:"",taskId:"",loading:!1,timerqueue:[]}},methods:{getStartTime:function(t){this.startObj.time=new Date(t).getTime()},getEndTime:function(t){this.endObj.time=new Date(t).getTime()},selectBusinessHours:function(){this.isOpenTime=!this.isOpenTime},getSelectShopList:function(t){this.postSelectShopList=t;for(var e=[],a=[],s=0;s<t.length;s++)1==t[s].selected&&(e.push(t[s].id),a.push(t[s].name));this.shopIds=e.join(","),this.selectName=""==a?"请选择店铺":a.join(",")},checkData:function(){return this.endObj.time-this.startObj.time>o.a.timeConst.THREEMONTHS?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"只能查询间隔三个月的数据"}),!1):this.startObj.time-this.endObj.time>0?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"查询时间选择错误"}),!1):""==this.shopIds?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请选择店铺"}),!1):1!=this.loading||(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"正在搜索,请勿重复点击"}),!1)},resetting:function(){this.startObj.time=(new Date).setHours(0,0,0,0),this.endObj.time=(new Date).setHours(23,59,59,999),this.isOpenTime=!1,this.getshopIdorshopName(),this.scanPayQuery()},tableEvent:function(){},getPageNum:function(t){this.page=t.page,this.num=t.num,this.setPage()},setPage:function(){this.endTotal=Math.ceil(this.allFormList.length/this.num);var t=(this.page-1)*this.num,e=this.page*this.num,a=this.allFormList.slice(t,e);this.formList=a},scanPayQuery:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.checkData()){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,t.isloadingstatus=!1,e.next=6,i.a.scanPayQuery({data:{startTime:parseInt(t.startObj.time/1e3),endTime:parseInt(t.endObj.time/1e3),shopIds:t.shopIds,isOpenTime:Number(t.isOpenTime)}});case 6:(a=e.sent)&&(t.taskId=a,t.timer=setInterval(function(){t.getTaskStatus(a)},2e3));case 8:case"end":return e.stop()}},e,t)}))()},getTaskStatus:function(t){var e=this;return r(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.getScanTaskStatus({data:{taskId:t}});case 2:if(s=a.sent,e.timeout=setTimeout(function(){if(!e.isloadingstatus){for(e.loading=!1,e.$store.commit("setWin",{content:"页面加载失败,请重新加载",title:"操作提示",winType:"alert"}),clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());return!1}},1e4),e.timerqueue.push(e.timeout),1==s){for(clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());e.getScanPayData(t)}case 6:case"end":return a.stop()}},a,e)}))()},getScanPayData:function(t){var e=this;return r(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.getScanPayData({data:{taskId:t,showDetail:0,showShopId:"",showDay:""}});case 2:(s=a.sent)&&(e.loading=!1,e.isloadingstatus=!0,e.staticLists=[],e.staticLists.push(s.total),e.allFormList=s.list,e.$nextTick(function(){e.setPage()}));case 4:case"end":return a.stop()}},a,e)}))()},getshopName:function(t){var e="",a=!0,s=!1,i=void 0;try{for(var n,o=this.postSelectShopList[Symbol.iterator]();!(a=(n=o.next()).done);a=!0){var r=n.value;r.id==t&&(e=r.name?r.name:r.shopName)}}catch(t){s=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(s)throw i}}return e},getDetailShow:function(t){var e=this;this.showtype=t,this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){e.Export()}}])},showoneshopDetail:function(t){this.showtype="one",this.constructionsName=this.getshopName(t.shopId),this.constructionsId=t.shopId},getshopIdorshopName:function(){if("3"==this.ischain){var t=n.a.session("shopList"),e=[],a=[],s=!0,i=!1,o=void 0;try{for(var r,c=t[Symbol.iterator]();!(s=(r=c.next()).done);s=!0){var l=r.value;l.selected=!0,l.name=l.shopName,e.push(l.id),a.push(l.name)}}catch(t){i=!0,o=t}finally{try{!s&&c.return&&c.return()}finally{if(i)throw o}}this.shopIds=e.join(","),this.selectName=a.join(","),this.postSelectShopList=t}else this.shopIds=n.a.session("userShop").currentShop.id,this.selectName=n.a.session("userShop").currentShop.name,this.postSelectShopList.push(n.a.session("userShop").currentShop)},Export:function(){var t=this;return r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.exportScanPayData({data:{taskId:t.taskId,showDetail:0,showShopId:"",showDay:"",isExport:1}});case 2:case"end":return e.stop()}},e,t)}))()}},components:{calendar:function(){return a.e("calendar_result").then(a.bind(null,"9265"))},selectstore:function(){return a.e("win").then(a.bind(null,"cb83"))},pageElement:function(){return a.e("page_element").then(a.bind(null,"5921"))},comTable:function(){return a.e("table").then(a.bind(null,"4360"))},oneshopStatics:function(){return a.e("scancode_shopstatistics").then(a.bind(null,"b2ec"))}},created:function(){var t={titleStyle:{fontSize:"16px"}},e={conStyle:{color:"#ff9800"}},a=!0,s=!1,i=void 0;try{for(var n,o=this.titleList[Symbol.iterator]();!(a=(n=o.next()).done);a=!0){var r=n.value;Object.assign(r,t,e)}}catch(t){s=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(s)throw i}}var c=!0,l=!1,u=void 0;try{for(var m,h=this.shoptitleList[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var d=m.value;Object.assign(d,t)}}catch(t){l=!0,u=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw u}}},mounted:function(){var t=this;this.ischain=n.a.session("userShop").currentShop.ischain,this.getshopIdorshopName(),this.scanPayQuery(),this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){t.Export()}}])},destroyed:function(){clearInterval(this.timer),clearTimeout(this.timeout)}},l=(a("36e3"),a("6ceb")),u=Object(l.a)(c,s,[],!1,null,"d74b6e8e",null);u.options.__file="src\\module\\statistics\\scancode_statistics.vue";e.default=u.exports}}]);