(window.webpackJsonp=window.webpackJsonp||[]).push([["single_goods"],{"0615":function(t,e,s){"use strict";var a=s("8d3c");s.n(a).a},"22f1":function(t,e,s){"use strict";s.r(e);var a=s("bbb9"),i=s("f6ce"),n=s("5c92"),o=s("81a2"),r=s("44e7");function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function a(i,n){try{var o=e[i](n),r=o.value}catch(t){return void s(t)}if(!o.done)return Promise.resolve(r).then(function(t){a("next",t)},function(t){a("throw",t)});t(r)}("next")})}}var l={data:function(){return{startTime:(new Date).setHours(0,0,0,0),endTime:(new Date).setHours(0,0,0,0),page:1,pageShow:10,pageTotal:1,list:[],listLength:0,openTime:1,posiTips:"",helpIconDom:null,tipShow:!1,tipsText:"",tipsContent:{sales:"商品；已销售的数量（不包含退品，包含赠品）公式：商品总数-退品数=销量",amount:"不计算任何优惠且不包含退品金额",actual:"商品原价减去商品的优惠金额（未计算整单减免）"},repeat:!0,timerId:"",loading:!1,taskId:"",isBrand:"",shopId:"",token:"",uploadUrl:""}},components:{pageBtn:function(){return s.e("page_element").then(s.bind(null,"5921"))},calendar:function(){return s.e("calendar_type").then(s.bind(null,"f2dd"))}},created:function(){this.userData=i.a.session("userShop"),this.isBrand="3"==this.userData.currentShop.ischain?1:0,this.shopId=this.userData.currentShop.id,this.token=this.userData.accessToken,this.uploadUrl=this.userData.uploadUrl},mounted:function(){var t=this;this.$store.commit("setPageTools",{leadOut:function(){t.exportData()}}),this.getData()},destroyed:function(){r.a.clear(this.timerId)},methods:{startTimeChange:function(t){this.startTime=t},endTimeChange:function(t){this.endTime=t},filter:function(){this.page=1,this.getData()},getData:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s,i,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.validate()){e.next=2;break}return e.abrupt("return");case 2:return s=a.a.format(new Date(t.startTime),"yyMMdd"),i=a.a.format(new Date(t.endTime),"yyMMdd"),e.next=6,o.a.goodssalesGetItemList({data:{startTime:s,endTime:i,page:t.page,num:t.pageShow,isOpenTime:t.openTime}});case 6:n=e.sent,t.list=n.list,t.pageTotal=n.totalPage,t.listLength=n.totalCount;case 10:case"end":return e.stop()}},e,t)}))()},exportData:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.repeat){e.next=3;break}return t.$store.commit("setWin",{title:"提示信息",content:"当前查询尚未结束，请结束后再进行查询或刷新浏览器重新查询！"}),e.abrupt("return");case 3:return s=a.a.format(new Date(t.startTime),"yyMMdd"),i=a.a.format(new Date(t.endTime),"yyMMdd"),e.next=7,o.a.goodssalesExportStat({data:{startTime:s,endTime:i,isOpenTime:t.openTime,shopId:t.shopId}}).then(function(e){t.taskId=e,t.repeat=!1,t.loading=!0,t.timerId=r.a.add(function(){o.a.taskInfo({data:{taskId:t.taskId}}).then(function(e){3==e.status?(r.a.clear(t.timerId),t.repeat=!0,o.a.goodssalesGetFileUrl({data:{shopId:t.shopId,startTime:s,endTime:i,isOpenTime:t.openTime}}).then(function(e){t.loading=!1;var s=t.uploadUrl+e;Object(n.a)({url:s,method:"get",token:t.token,shopId:t.shopId})})):2==e.status&&(r.a.clear(t.timerId),t.loading=!1,t.repeat=!0,t.$store.commit("setWin",{title:"提示信息",content:"请求失败，请重试！"}))})},1e3,60,!1,function(){r.a.clear(t.timerId),t.repeat=!0,t.loading=!1,t.$store.commit("setWin",{title:"提示信息",content:"请求超时，请重试！"})})});case 7:case"end":return e.stop()}},e,t)}))()},reset:function(){this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(0,0,0,0),this.getData()},timeCheck:function(){this.openTime=1==this.openTime?0:1},validate:function(){return!(parseInt(this.startTime/1e3/3600/24)>parseInt(this.endTime/1e3/3600/24))||(this.$store.commit("setWin",{title:"提示信息",content:"开始时间不能大于结束时间"}),!1)},tips:function(t){var e=t.target;if(e.className.includes("fi"))if(this.tipShow&&e==this.helpIconDom)this.tipShow=!1,this.posiTips="",document.removeEventListener("click",this.tipsClose);else{var s=e.getAttribute("data-name"),a=e.offsetTop+25,i=e.offsetLeft-270;this.tipsText=this.tipsContent[s],this.posiTips="top:"+a+"px;left:"+i+"px",this.tipShow=!0,this.helpIconDom=e,document.addEventListener("click",this.tipsClose)}},tipsClose:function(t){t.target.className.includes("fi")||(this.tipShow=!1,this.posiTips="",document.removeEventListener("click",this.tipsClose))},pageChange:function(t){this.page=t.page,this.pageShow=t.num,this.getData()}}},p=(s("0615"),s("d801")),d=Object(p.a)(l,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"single-goods"},[a("div",{staticClass:"filter"},[a("div",{staticClass:"inline-box"},[a("calendar",{attrs:{time:t.startTime,type:0,format:"yyyy年MM月dd日"},on:{emit:t.startTimeChange}})],1),t._v(" "),a("span",{staticClass:"inline-span"},[t._v("至")]),t._v(" "),a("div",{staticClass:"inline-box date-box"},[a("calendar",{attrs:{time:t.endTime,type:0,format:"yyyy年MM月dd日"},on:{emit:t.endTimeChange}})],1),t._v(" "),a("div",{staticClass:"inline-box check-box select-ban"},[a("i",{staticClass:"check-btn fi",class:{"fi-ok":1==this.openTime},on:{click:t.timeCheck}}),t._v("\n\t\t\t按营业时间\n\t\t")]),t._v(" "),a("div",{staticClass:"inline-box button-box"},[a("span",{staticClass:"blue",on:{click:t.filter}},[t._v("筛选")]),t._v(" "),a("span",{staticClass:"gray",on:{click:t.reset}},[t._v("重置")])])]),t._v(" "),t.loading?t._e():a("div",{staticClass:"main"},[a("div",{staticClass:"list"},[a("div",{staticClass:"head"},[t._v("\n\t\t\t\t单品统计 · 共\n\t\t\t\t"),a("em",[t._v(" "+t._s(t.listLength)+" ")]),t._v("条数据\n\t\t\t")]),t._v(" "),a("div",{staticClass:"title",on:{click:t.tips}},[a("span",{staticClass:"wide"},[t._v("商品名称")]),t._v(" "),a("span",{staticClass:"wide"},[t._v("条码")]),t._v(" "),a("span",[t._v("单价")]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),a("span",[t._v("消费占比")]),t._v(" "),t._m(2),t._v(" "),a("span",[t._v("实收占比")])]),t._v(" "),a("ul",[t._l(t.list,function(e,s){return a("li",{key:s},[a("span",{staticClass:"wide",attrs:{title:e.gName}},[a("em",[t._v(t._s(e.gName))])]),t._v(" "),a("span",{staticClass:"wide"},[a("em",[t._v(t._s(e.barCode)),a("br"),t._v(t._s(e.secBarCode))])]),t._v(" "),a("span",[t._v(t._s(e.price))]),t._v(" "),a("span",[t._v(t._s(e.sales))]),t._v(" "),a("span",[t._v(t._s(e.consumeAmount))]),t._v(" "),a("span",[t._v(t._s(e.consumeProportion))]),t._v(" "),a("span",[t._v(t._s(e.paidIn))]),t._v(" "),a("span",[t._v(t._s(e.paidInProportion))])])}),t._v(" "),t.list.length?t._e():a("li",{staticClass:"empty"},[t._v("- 暂无条目 -")])],2)]),t._v(" "),a("div",{staticClass:"page-box"},[a("pageBtn",{attrs:{total:t.pageTotal,page:t.page,isNoJump:!0},on:{pageNum:t.pageChange}})],1),t._v(" "),t.tipShow?a("div",{staticClass:"busi-tips",style:t.posiTips},[a("em"),t._v(t._s(t.tipsText))]):t._e()]),t._v(" "),t.loading?a("div",{staticClass:"loading"},[a("img",{attrs:{src:s("b8bc")}})]):t._e()])},[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("销量\n\t\t\t\t\t"),e("em",{staticClass:"fi",attrs:{"data-name":"sales"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("消费金额\n\t\t\t\t\t"),e("em",{staticClass:"fi",attrs:{"data-name":"amount"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("实收金额\n\t\t\t\t\t"),e("em",{staticClass:"fi",attrs:{"data-name":"actual"}})])}],!1,null,"f30caeb8",null);e.default=d.exports},"8d3c":function(t,e,s){},b8bc:function(t,e,s){t.exports=s.p+"images/preloader.3e54c692.gif"}}]);