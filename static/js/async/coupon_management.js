(window.webpackJsonp=window.webpackJsonp||[]).push([["coupon_management"],{"10f0":function(n,e,t){"use strict";var o=t("d1d8");t.n(o).a},b366:function(n,e,t){"use strict";t.r(e);var o=t("81a2"),i=t("f6ce"),a=t("bbb9");function u(n){return function(){var e=n.apply(this,arguments);return new Promise(function(n,t){return function o(i,a){try{var u=e[i](a),c=u.value}catch(n){return void t(n)}if(!u.done)return Promise.resolve(c).then(function(n){o("next",n)},function(n){o("throw",n)});n(c)}("next")})}}var c={data:function(){return{ischain:"",couponList:[],page:1,total:1,index:null,pageNum:10,pageCount:0,valueTime:[(new Date).setHours(0,0,0,0),(new Date).setHours(23,59,59,999)],days:0,indexOn:0,bannerList:[{index:0,name:"未关联"},{index:1,name:"已关联"},{index:-1,name:"已过期"}],isShowCa:!1,changeMnage:!0,showCoupon:!1,couponInfo:"",allTotal:100,pageTotal:10,couponType:0,couponDetail:Object,couponTypeList:{1:"单品减免",2:"整单减免",3:"单品打折",4:"整单打折",5:"赠菜",6:"代金券",7:"积分卡券"},unbindWin:!1,asyncId:"",count:0}},computed:{start:{get:function(){return a.a.format(new Date(this.atime),"yyyy-MM-dd")}},end:{get:function(){return a.a.format(new Date(this.btime),"yyyy-MM-dd")}},day:{get:function(){return Math.floor((this.btime-this.atime)/864e5)}}},methods:{toEditCoupon:function(n){"nochange"==n?this.showCoupon=!1:(this.showCoupon=!1,this.couponDetail=n,this.couponType=n.type)},returnTime:function(n){return n-=0,n*=1e3,a.a.format(new Date(n),"yyyy-MM-dd")},getEndTime:function(n){var e=a.a.deepCopy(n);return 0==e.validityType?"领券后"+e.relativeTime+"天过期":1==e.validityType?(e.endTime-=0,e.endTime=1e3*e.endTime,a.a.format(new Date(e.endTime),"yyyy-MM-dd")+"过期"):void 0},inte:function(n,e){var t=this;return u(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t.indexOn=n,e&&(t.page=1),i.next=4,o.a.getCouponList({data:{page:t.page,num:t.pageNum,status:t.indexOn,fromDate:parseInt(t.valueTime[0]/1e3),toDate:parseInt(t.valueTime[1]/1e3)}});case 4:a=i.sent,t.couponList=a.list,a.count&&(t.count=a.count),t.total=a.total;case 8:case"end":return i.stop()}},i,t)}))()},showCalendar:function(){this.isShowCa=!this.isShowCa},seachData:function(){this.inte(this.indexOn)},modfycoupons:function(n){var e=this;if("2"==this.indexOn)return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"过期优惠券无法编辑"}),!1;this.$store.commit("setWin",{winType:"confirm",title:"提示信息",content:"确认修改吗？",callback:function(t){"ok"==t&&e.changeCoupon(n)}})},changeCoupon:function(n){var e=this;return u(regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.getCouponById({data:{couponId:n.id}});case 2:i=t.sent,e.couponDetail=i,e.couponType=i.type,e.changeMnage=!1;case 6:case"end":return t.stop()}},t,e)}))()},delCoupon:function(n){var e=this;return u(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.deleteCoupon({data:{couponId:n.id}});case 2:e.inte(e.indexOn);case 3:case"end":return t.stop()}},t,e)}))()},deletecoupons:function(n){var e=this;this.$store.commit("setWin",{winType:"confirm",title:"提示信息",content:"确认要删除吗？",callback:function(t){"ok"==t&&e.delCoupon(n)}})},opencoupons:function(n,e){this.showCoupon=!0,this.couponInfo={index:n,item:e}},getcouponResult:function(){this.couponType=0,this.inte(this.indexOn)},syncCoupon:function(){var n=this;return u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.syncCoupon({data:{couponId:n.asyncId}});case 2:e.sent&&n.$store.commit("setWin",{content:"同步成功",title:"操作提示",winType:"alert"});case 4:case"end":return e.stop()}},e,n)}))()},unbundlingCoupon:function(n){this.asyncId=n.id,this.unbindWin=!0},getResult:function(n){"ok"==n&&this.syncCoupon(),this.unbindWin=!1},handleSizeChange:function(n){this.pageNum=n,this.inte(this.indexOn)},pageChange:function(n){this.page=n,this.inte(this.indexOn)}},mounted:function(){this.inte(this.indexOn),this.ischain=i.a.session("userShop").currentShop.ischain},components:{"can-multi":function(){return t.e("can_multi").then(t.bind(null,"742e"))},breakCoupon:function(){return t.e("breaks_coupon").then(t.bind(null,"7f53"))},discountCoupon:function(){return t.e("discount_coupon").then(t.bind(null,"4e1e"))},giveCoupon:function(){return t.e("give_coupon").then(t.bind(null,"7651"))},vouchersCoupon:function(){return t.e("vouchers_coupon").then(t.bind(null,"b025"))},intergralcardCoupon:function(){return t.e("integralcard_coupon").then(t.bind(null,"ec50"))},"coupon-manage-win":function(){return t.e("coupon_manage_win").then(t.bind(null,"6aa4"))},page:function(){return t.e("page_element").then(t.bind(null,"5921"))},comTable:function(){return t.e("table").then(t.bind(null,"4360"))},maunBundling:function(){return t.e("coupon_maunbundling_win").then(t.bind(null,"1975"))}}},r=(t("10f0"),t("d801")),s=Object(r.a)(c,function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",[0==n.couponType?t("section",{attrs:{id:"management"}},[t("div",{staticClass:"test"},[t("el-date-picker",{staticClass:"fl",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp",clearable:!1},model:{value:n.valueTime,callback:function(e){n.valueTime=e},expression:"valueTime"}}),n._v(" "),t("el-button",{staticClass:"fl",attrs:{type:"primary",icon:"el-icon-search"},on:{click:n.seachData}})],1),n._v(" "),t("div",{staticClass:"clearfix",staticStyle:{"margin-bottom":"20px"}},n._l(n.bannerList,function(e,o){return t("section",{key:o,staticClass:"diel",class:{on:n.indexOn==o},on:{click:function(){n.inte(o,"1")}}},[n._v(n._s(e.name))])})),n._v(" "),t("div",{staticClass:"list_box",staticStyle:{width:"100%"}},[t("div",{staticClass:"list_title"},[t("div",{staticClass:"list_title_l fl"},[t("span",[n._v("优惠券列表")]),n._v(" "),t("span"),n._v(" "),t("span",[n._v("共\n\t\t\t\t\t\t\t"),t("a",{attrs:{href:"javascript:;"}},[n._v(n._s(n.count))]),n._v("条记录")])]),n._v(" "),t("div",{staticClass:"list_title_r fr"})]),n._v(" "),t("el-table",{attrs:{data:n.couponList,border:"",stripe:!0,"header-cell-style":{"background-color":"#f5f7fa"},"header-row-style":{height:"40px"},"row-style":{height:"60px"}}},[t("el-table-column",{attrs:{fixed:"",prop:"createTime",label:"创建时间",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("span",[n._v(n._s(n.returnTime(e.row.createTime)))])]}}])}),n._v(" "),t("el-table-column",{attrs:{label:"优惠券名称",prop:"name",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{prop:"createTime",label:"到期时间",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("span",[n._v(n._s(n.getEndTime(e.row)))])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"type",label:"类型",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("span",[n._v(n._s(n.couponTypeList[e.row.type]))])]}}])}),n._v(" "),t("el-table-column",{attrs:{label:"操作",align:"center",width:"280"},scopedSlots:n._u([{key:"default",fn:function(e){return[1==n.ischain||2==n.ischain?t("div",[t("el-button",{attrs:{size:"medium",type:"text"},on:{click:function(t){n.opencoupons(e.$index,e.row)}}},[n._v("查看详情")])],1):t("div",[t("el-button",{staticStyle:{color:"rgb(40, 168, 224)"},attrs:{size:"medium",type:"text"},on:{click:function(t){n.unbundlingCoupon(e.row)}}},[n._v("同步")]),n._v(" "),t("span",{staticStyle:{padding:"0 5px",color:"#D2D2D2"}},[n._v("|")]),n._v(" "),t("el-button",{staticStyle:{color:"#E1BB4A"},attrs:{size:"medium",type:"text"},on:{click:function(t){n.opencoupons(e.$index,e.row)}}},[n._v("查看详情")]),n._v(" "),t("span",{staticStyle:{padding:"0 5px",color:"#D2D2D2"}},[n._v("|")]),n._v(" "),t("el-button",{staticStyle:{color:"#ff8d00"},attrs:{size:"medium",type:"text"},on:{click:function(t){n.modfycoupons(e.row)}}},[n._v("编辑")]),n._v(" "),t("span",{staticStyle:{padding:"0 5px",color:"#D2D2D2"}},[n._v("|")]),n._v(" "),t("el-button",{staticStyle:{color:"#fd3f1f"},attrs:{size:"medium",type:"text"},on:{click:function(t){n.deletecoupons(e.row)}}},[n._v("删除")])],1)]}}])})],1)],1),n._v(" "),t("div",{staticClass:"pageWrap"},[t("el-pagination",{attrs:{background:"","current-page":n.page,"page-size":n.pageNum,layout:"sizes, prev, pager, next","page-count":n.total,"page-sizes":[10,20,30]},on:{"size-change":n.handleSizeChange,"current-change":n.pageChange}})],1)]):n._e(),n._v(" "),1==n.couponType||2==n.couponType?t("breakCoupon",{attrs:{couponDetail:n.couponDetail},on:{changeMnage:n.getcouponResult}}):n._e(),n._v(" "),3==n.couponType||4==n.couponType?t("discountCoupon",{attrs:{couponDetail:n.couponDetail},on:{changeMnage:n.getcouponResult}}):n._e(),n._v(" "),5==n.couponType?t("giveCoupon",{attrs:{couponDetail:n.couponDetail},on:{changeMnage:n.getcouponResult}}):n._e(),n._v(" "),6==n.couponType?t("vouchersCoupon",{attrs:{couponDetail:n.couponDetail},on:{changeMnage:n.getcouponResult}}):n._e(),n._v(" "),7==n.couponType?t("intergralcardCoupon",{attrs:{couponDetail:n.couponDetail},on:{changeMnage:n.getcouponResult}}):n._e(),n._v(" "),n.showCoupon?t("coupon-manage-win",n._b({on:{changeCoupon:n.toEditCoupon}},"coupon-manage-win",n.couponInfo,!1)):n._e(),n._v(" "),n.unbindWin?t("maunBundling",{on:{getAppliedWin:n.getResult}}):n._e()],1)},[],!1,null,"46cea4fa",null);e.default=s.exports},d1d8:function(n,e,t){}}]);