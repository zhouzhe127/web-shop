(window.webpackJsonp=window.webpackJsonp||[]).push([["survey"],{3342:function(t,e,s){"use strict";var n=s("59be");s.n(n).a},"59be":function(t,e,s){},a428:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{attrs:{id:"survey"},on:{click:t.tips}},[n("section",{staticClass:"top"},[n("span",{staticStyle:{"margin-right":"100px"}},[n("span",{staticStyle:{"font-weight":"bold","font-size":"16px"}},[t._v("HI,\n\t\t\t\t"),n("span",{staticStyle:{color:"#2980B9","font-size":"16px"}},[t._v(t._s(t.userData.user.name))])]),t._v("\n\t\t\t欢迎回来！\n\t\t")]),t._v(" "),n("span",[t._v("今天是：\n\t\t\t"),n("span",{staticStyle:{"font-weight":"bold","font-size":"16px"}},[t._v(t._s(t.newTime))])])]),t._v(" "),n("div",{staticStyle:{height:"10px"}}),t._v(" "),t.coverShow&&!t.isContent?n("div",{staticClass:"loding-cover"},[n("img",{attrs:{src:s("b8bc")}})]):t._e(),t._v(" "),t.coverShow||t.isContent?t._e():n("div",{staticClass:"left"},[n("div",{staticStyle:{"margin-bottom":"15px"}},[n("div",{staticClass:"specific"},t._l(t.eachList,function(e,s){return n("div",{key:s},[e.data.length>=2?n("div",{staticClass:"block"},[n("div",{staticClass:"name"},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t\t\t"),e.iconShow?n("em",{staticClass:"help-icon",attrs:{"data-name":e.field}}):t._e()]),t._v(" "),n("div",{staticClass:"total"},[n("P",{staticClass:"num"},[n("span",[t._v(t._s(e.total))]),t._v(" "),e.iconShow?n("em",[t._v("."+t._s(t.salesPoint[e.field]))]):t._e()])],1),t._v(" "),n("div",{staticClass:"branch"},t._l(e.data,function(s){return n("div",{staticClass:"box",style:{width:2==e.data.length?"49%":"33.33%"}},[n("span",[t._v(t._s(s.name))]),t._v(" "),n("p",{attrs:{title:s.showData}},[t._v(t._s(s.showData))])])}))]):t._e(),t._v(" "),e.data.length<2?n("div",{staticClass:"block"},[n("div",{staticClass:"name"},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t\t\t"),e.iconShow?n("em",{staticClass:"help-icon",attrs:{"data-name":e.field}}):t._e()]),t._v(" "),n("div",{staticClass:"totalOne"},[0==e.data.length?n("P",{staticClass:"num"},[n("span",[t._v(t._s(e.total))]),t._v(" "),e.iconShow?n("em",[t._v("."+t._s(t.salesPoint[e.field]))]):t._e()]):t._e(),t._v(" "),1==e.data.length?n("P",{staticClass:"num"},[n("span",{staticStyle:{"font-size":"16px","margin-right":"5px"}},[t._v(t._s(e.data[0].name))]),t._v(" "),n("span",[t._v(t._s(e.total))]),t._v(" "),e.iconShow?n("em",[t._v("."+t._s(t.salesPoint[e.field]))]):t._e()]):t._e()],1)]):t._e()])}))]),t._v(" "),t.echarts&&!t.isBrand?n("pieChart",{attrs:{pie:t.pie,echarts:t.echarts}}):t._e(),t._v(" "),t.isBrand&&t.echarts&&t.userShopIdStr.length>1?n("barChart",{staticStyle:{"margin-bottom":"40px"},attrs:{bar:t.bar,echarts:t.echarts,shopList:t.shopList}}):t._e(),t._v(" "),t.echarts&&!t.isBrand?n("lineChart",{staticStyle:{"margin-bottom":"40px"},attrs:{line:t.line,echarts:t.echarts}}):t._e(),t._v(" "),t.tipShow?n("div",{staticClass:"busi-tips",style:t.posiTips},[n("em"),t._v(t._s(t.tipsText))]):t._e()],1),t._v(" "),t.isContent?n("div",{staticClass:"isContent"},[n("div",{staticClass:"head"},[t._v(t._s(t.noticeContent.title)+"\n\t\t\t"),n("span",{staticStyle:{float:"right","margin-right":"30px",cursor:"pointer"},on:{click:function(e){t.toBack()}}},[t._v("返回")])]),t._v(" "),n("div",{staticClass:"content"},[n("div",{staticStyle:{"margin-top":"30px"}},[n("span",{domProps:{innerHTML:t._s(t.line2br(t.noticeContent.content))}})]),t._v(" "),n("div",{staticStyle:{float:"right",margin:"40px 100px 20px 0"}},[t._v(t._s(t.noticeContent.time))])])]):t._e(),t._v(" "),n("div",{staticClass:"right"},[t.noticeList.length>0?n("section",{staticClass:"right-content"},[n("div",{staticClass:"head"},[t._v("通知")]),t._v(" "),n("div",{staticClass:"content"},t._l(t.noticeList,function(e){return n("section",[n("div",[t._v(t._s(e.time))]),t._v(" "),n("div",{class:{"title ":e.isContent},staticStyle:{"margin-bottom":"15px"},on:{click:function(s){t.toContent(e)}}},[t._v(t._s(e.title))])])}))]):t._e(),t._v(" "),t.updateList.length>0?n("section",{staticClass:"right-two"},[n("div",{staticClass:"head"},[t._v("近期更新")]),t._v(" "),n("div",{staticClass:"content"})]):t._e()])])};n._withStripped=!0;var a=s("f6ce"),i=s("bbb9"),o=s("44e7"),r=s("81a2");function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function n(a,i){try{var o=e[a](i),r=o.value}catch(t){return void s(t)}if(!o.done)return Promise.resolve(r).then(function(t){n("next",t)},function(t){n("throw",t)});t(r)}("next")})}}var u={data:function(){return{echarts:null,newTime:"",eachList:[{name:"营业总额（元）",field:"business",iconShow:!0,data:[]},{name:"优惠总额（元）",field:"discount",iconShow:!0,data:[]},{name:"入账金额（元）",field:"amount",iconShow:!0,data:[]},{name:"订单量（单）",field:"orderNumber",data:[]}],sales:{eatIn:{business:0,amount:0,orderNumber:0,discount:0,passengerFlow:0},takeOut:{business:0,amount:0,orderNumber:0,discount:0,passengerFlow:0},quickPayment:{business:0,amount:0,orderNumber:0,discount:0,passengerFlow:0},total:{business:0,amount:0,orderNumber:0,discount:0,passengerFlow:0},businessMom:{business:0,amount:0,orderNumber:0,discount:0,passengerFlow:0}},salesPoint:{business:"00",discount:"00",amount:"00"},tipsContent:{business:"该时间段内所有堂吃商品原价+堂吃服务费+外卖商品原价 = 营业总额（不计入退品）",discount:"活动优惠券、店内优惠（整单减免、整单折扣、整单强折、单品减免、单品折扣、赠菜金额、积分抵扣）以及外卖活动优惠金额",amount:"入账总额 = 营业总额 - 优惠总额（不计入未入账的支付方式的金额）"},tipsText:"",tipShow:!1,posiTips:"",helpIconDom:null,coverShow:!0,pie:[],line:[],userShopIdStr:[],shopIds:"",shopList:[],repeat:!0,taskId:"",timerId:"",noticeList:[],updateList:[],noticeContent:{},isContent:!1}},created:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var n,o,r,c,u,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.newTime=i.a.format((new Date).getTime(),"yyyy-MM-dd"),t.userData=a.a.session("userShop"),t.isBrand="3"==t.userData.currentShop.ischain,!t.isBrand){e.next=25;break}for(n=!0,o=!1,r=void 0,e.prev=7,c=a.a.session("shopList")[Symbol.iterator]();!(n=(u=c.next()).done);n=!0)l=u.value,t.userShopIdStr.push(l.id),d={id:l.id,name:l.shopName,selected:!0},t.shopList.push(d);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),o=!0,r=e.t0;case 15:e.prev=15,e.prev=16,!n&&c.return&&c.return();case 18:if(e.prev=18,!o){e.next=21;break}throw r;case 21:return e.finish(18);case 22:return e.finish(15);case 23:t.shopIds=t.userShopIdStr.join("-"),console.log(t.shopIds);case 25:return t.init(),e.next=28,s.e("echarts").then(function(){var t=s("375c");return"object"==typeof t&&t&&t.__esModule?t:Object.assign({},"object"==typeof t&&t,{default:t})});case 28:t.echarts=e.sent,t.getNoticeList();case 30:case"end":return e.stop()}},e,t,[[7,11,15,23],[16,,18,22]])}))()},methods:{getNoticeList:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.getSurveyNoticeList({data:{}});case 2:(s=e.sent)&&(t.noticeList=s.map(function(t){return t.time=i.a.format(t.time,"yyyy-MM-dd"),t.isContent&&(t.title=t.title+">>"),t}),console.log(t.noticeList));case 4:case"end":return e.stop()}},e,t)}))()},toContent:function(t){var e=this;return c(regeneratorRuntime.mark(function s(){var n;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.a.noticeSurveyGetOne({data:{id:t.id}});case 2:(n=s.sent)&&(e.isContent=!0,n.time=i.a.format(n.time,"yyyy-MM-dd"),e.noticeContent=n,console.log(n));case 4:case"end":return s.stop()}},s,e)}))()},toBack:function(){this.isContent=!1},line2br:function(t){return t.split("\n").join("<br/>")},analytic:function(){var t=this.sales;for(var e in t)if("total"==e)for(var s in t[e])if("orderNumber"!=s){var n=(t[e][s]+"").split(".");n[1]?(n[1].length<=1&&(n[1]=n[1]+"0"),this.salesPoint[s]=(n[1]+"").substring(0,2)):this.salesPoint[s]="00"}},init:function(){this.isBrand?1==this.userShopIdStr.length?(this.getData(this.userShopIdStr.toString()),console.log("品牌下店铺数为1")):(console.log("品牌下店铺数大于1"),this.getTaskId()):(console.log("单店"),this.getData(this.userData.currentShop.id))},getData:function(t){var e=this;return c(regeneratorRuntime.mark(function s(){var n,a;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e.coverShow=!0,s.next=3,r.a.statisticsBusiness({data:{endTime:i.a.format((new Date).getTime(),"yyyyMMdd"),startTime:i.a.format((new Date).getTime()-5184e6,"yyyyMMdd"),dateType:1,isOpenTime:1,shopId:t}});case 3:return n=s.sent,e.sales=n.sales,e.pie=n.proportion,s.next=8,r.a.statisticsBusiness({data:{endTime:i.a.format((new Date).getTime(),"yyyyMMdd"),startTime:i.a.format((new Date).getTime()-5184e5,"yyyyMMdd"),dateType:1,isOpenTime:1,shopId:t}});case 8:a=s.sent,e.line=a.list,e.coverShow=!1,e.analytic(),e.doDate();case 13:case"end":return s.stop()}},s,e)}))()},getTaskId:function(){var t=this;return c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.repeat){e.next=3;break}return t.$store.commit("setWin",{title:"提示信息",content:"当前查询尚未结束，请结束后再进行查询或刷新浏览器重新查询！"}),e.abrupt("return");case 3:r.a.createBusinessTask({data:{startTime:i.a.format((new Date).getTime()-5184e6,"yyyyMMdd"),endTime:i.a.format((new Date).getTime(),"yyyyMMdd"),dateType:1,shopIds:t.shopIds,isOpenTime:1}}).then(function(e){t.taskId=e,t.repeat=!1,t.coverShow=!0,t.timerId=o.a.add(function(){r.a.taskInfo({data:{taskId:t.taskId}}).then(function(e){3==e.status?t.getDataBrand():2==e.status&&(o.a.clear(t.timerId),t.coverShow=!1,t.repeat=!0,t.$store.commit("setWin",{title:"提示信息",content:"请求失败，请重试！"}))})},1e3,600,!1,function(){o.a.clear(t.timerId),t.repeat=!0,t.coverShow=!1,t.$store.commit("setWin",{title:"提示信息",content:"请求超时，请重试！"})})});case 4:case"end":return e.stop()}},e,t)}))()},getDataBrand:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.statisticsBrandBusiness({data:{startTime:i.a.format((new Date).getTime()-5184e6,"yyyyMMdd"),endTime:i.a.format((new Date).getTime(),"yyyyMMdd"),dateType:1,shopIds:t.shopIds,isOpenTime:1}});case 2:s=e.sent,o.a.clear(t.timerId),t.repeat=!0,s?(console.log(s),t.sales=s.sales,t.bar=s.columnar,t.analytic(),t.doDate(),t.coverShow=!1):t.$store.commit("setWin",{title:"提示信息",content:"请求失败，请重试..."});case 6:case"end":return e.stop()}},e,t)}))()},doDate:function(){for(var t=["business","discount","amount","orderNumber"],e=0;e<t.length;e++)this.eachList[e].data=[],0!=this.sales.eatIn[t[e]]&&(this.eachList[e].data[this.eachList[e].data.length]={name:"堂吃",showData:3==e?this.sales.eatIn[t[e]]:this.sales.eatIn[t[e]].toFixed(2)}),0!=this.sales.takeOut[t[e]]&&(this.eachList[e].data[this.eachList[e].data.length]={name:"外卖",showData:3==e?this.sales.takeOut[t[e]]:this.sales.takeOut[t[e]].toFixed(2)}),0!=this.sales.quickPayment[t[e]]&&(this.eachList[e].data[this.eachList[e].data.length]={name:"快捷支付",showData:3==e?this.sales.takeOut[t[e]]:this.sales.quickPayment[t[e]].toFixed(2)}),this.eachList[e].total=parseInt(this.sales.total[t[e]]);this.pie.totalHuo={discount:this.eachList[1].total,amount:this.eachList[2].total}},tips:function(t){var e=t.target;if("help-icon"==e.className)if(this.tipShow&&e==this.helpIconDom)this.tipShow=!1,this.posiTips="",document.removeEventListener("click",this.tipsClose);else{var s=e.getAttribute("data-name"),n=e.offsetTop-15,a=e.offsetLeft+30;this.tipsText=this.tipsContent[s],this.posiTips="top:"+n+"px;left:"+a+"px",this.tipShow=!0,this.helpIconDom=e,document.addEventListener("click",this.tipsClose)}},tipsClose:function(t){t.target.className.includes("help-icon")||(this.tipShow=!1,this.posiTips="",document.removeEventListener("click",this.tipsClose))}},components:{pieChart:function(){return s.e("survey_pie").then(s.bind(null,"e8d4"))},lineChart:function(){return s.e("survey_line").then(s.bind(null,"631c"))},barChart:function(){return s.e("survey_bar").then(s.bind(null,"06b0"))}}},l=(s("3342"),s("7610")),d=Object(l.a)(u,n,[],!1,null,"41c6afc1",null);d.options.__file="src\\module\\home_page\\survey.vue";e.default=d.exports},b8bc:function(t,e,s){t.exports=s.p+"images/preloader.3e54c692.gif"}}]);