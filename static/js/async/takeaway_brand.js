(window.webpackJsonp=window.webpackJsonp||[]).push([["takeaway_brand"],{"302b":function(e,t,r){"use strict";r.r(t);var i=r("81a2"),n=r("f6ce"),s=r("bbb9");function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function i(n,s){try{var a=t[n](s),o=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(o).then(function(e){i("next",e)},function(e){i("throw",e)});e(o)}("next")})}}var o={data:function(){return{userData:{},startTime:(new Date).setHours(0,0,0,0),endTime:(new Date).setHours(23,59,59,999),orderListInDays:[],isZeroPays:[],payTotalNum:{orderNum:0,totalNum:0,goodsNum:0,discountNum:0,deliverFee:0,activityFee:0,goodsTotalPrice:0,income:0},newpayTotalNum:[],isOpenTime:"",startH:"",startM:"",startS:"",endH:"",endM:"",endS:"",isBrand:"",selectName:"",selectShopList:null,postSelectShopList:null,shopIds:"",taskId:"",agwge:!0,loading:!0,takeawaytypeList:["全部","饿了么","美团","百度外卖"],takeawaytypeBtn:!1,num:10,total:1,currentPage:1,shopInfo:null,selectTypeNum:"",transmitId:[]}},computed:{totalNum:function(){return Math.ceil(this.orderListInDays.length/this.num)},lists:function(){var e=(this.currentPage-1)*this.num,t=this.currentPage*this.num;return this.orderListInDays.slice(e,t)}},methods:{renderHeader:function(e,t){var r=t.column,i="",n=r.label,s=r.property;return"商品总数"==n&&"totalNum"==s?i="该时间段的商品总数包含了订单中所有的商品数量（包括赠品和退品）":"商品数"==n&&"totalNum"==s?i="该店铺在该时间段内的商品总数包含了订单中所有的商品数量（包括赠品和退品）":"销量"==n&&"goodsNum"==s?i="该时间段已销售的数量（不包含退品数）公式：商品总数-退品数=销量":"优惠总额"==n&&"activityFee"==s?i="该时间段所有的优惠金额总计":"优惠金额"==n&&"activityFee"==s?i="该店铺在该时间段内所有的优惠金额总计":"消费总额"==n&&"goodsTotalPrice"==s?i="该时段内所有商品原价的金额总计（不计入退品金额）":"消费金额"==n&&"goodsTotalPrice"==s?i="该店铺在该时间段内所有商品原价的金额总计（不计入退品金额）":"入账总额"==n&&"income"==s?i="该时间段中实际收入的金额（不计入未入实账的支付方式的金额）":"入账金额"==n&&"income"==s&&(i="该店铺在该时间段内实际收入的金额（不计入未入实账的支付方式的金额）"),e("div",[e("span",{},r.label),e("el-popover",{attrs:{effect:"dark",content:i,placement:"bottom",width:"300"}},[e("span",{class:"el-icon-question",slot:"reference",style:"font-size: 18px;margin-left:5px;"})])])},initBtn:function(){var e=this,t=[{name:"导出",style:{},fn:function(){e.exportOrder()}}];this.$store.commit("setPageTools",t)},pageClick:function(e){this.currentPage=e},numChange:function(e){this.num=e,this.currentPage=1},toOrder:function(){var e;e={name:"orderBrand",startTime:this.startTime,endTime:this.endTime,isOpenTime:this.isOpenTime},n.a.session("orderBrand",e),this.$router.push({path:"/admin/orderStatistics",query:this.$route.query})},toProprietary:function(){this.$router.push({path:"/admin/orderStatistics/orderProprietaryBrand",query:this.$route.query})},selectBusinessHours:function(){this.isOpenTime=!this.isOpenTime},getStartTime:function(e){this.newStartTime=e},getEndTime:function(e){this.newEndTime=e},showtakeawaytypeList:function(e){e.stopPropagation(),this.takeawaytypeBtn=!this.takeawaytypeBtn},openDayDetial:function(e){var t={startTime:this.startTime,endTime:this.endTime,allDayPage:this.currentPage,isOpenTime:this.isOpenTime,selectShops:this.isOpenTime,isbrandJoin:!0,itemDetial:e,selectShopList:this.selectShopList,shopId:e.id,type:this.selectTypeNum};n.a.session("brandDetial",t),this.$router.push({path:"/admin/orderStatistics/orderTakeaway",query:this.$route.query})},init:function(){this.getOrderListInDays()},sreachOrderInDays:function(){return this.endTime-this.startTime>80352e5?(this.$store.commit("setWin",{title:"操作提示",content:"最大只能查询三个月时间"}),!1):parseInt(this.startTime/1e3)-parseInt(this.endTime/1e3)>0?(this.$store.commit("setWin",{title:"操作提示",content:"时间选择错误"}),!1):void this.getOrderListInDays()},resetting:function(){this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(23,59,59,999),this.isOpenTime=!0,this.selectName="",this.selectTypeNum="";for(var e=0;e<this.selectShopList.length;e++)this.selectShopList[e].selected=!0,this.selectName=this.selectName+this.selectShopList[e].shopName+",";this.transmitId=this.selectShopList.map(function(e){return e.id}),this.getOrderListInDays()},getOrderListInDays:function(){var e=this;return a(regeneratorRuntime.mark(function t(){var r,n,o,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.loading=!1,""!=e.shopIds){t.next=4;break}return e.$store.commit("setWin",{title:"操作提示",content:"请选择要查询的店铺"}),t.abrupt("return",!1);case 4:return e.startTime=new Date(e.startTime).getTime(),e.endTime=new Date(e.endTime).getTime(),r=e.startTime,n=e.endTime,e.startH=s.a.format(r,"hh"),e.startM=s.a.format(r,"mm"),e.startS=s.a.format(r,"ss"),e.endH=s.a.format(n,"hh"),e.endM=s.a.format(n,"mm"),e.endS=s.a.format(n,"ss"),o=0,t.next=17,i.a.OrderReport({data:{trueShopId:e.userData.currentShop.id,type:"7",timeType:"1",startTime:parseInt(e.startTime/1e3),endTime:parseInt(e.endTime/1e3),takeoutType:e.selectTypeNum,isOpenTime:Number(e.isOpenTime),shopIds:e.shopIds}});case 17:(l=t.sent).taskId&&(e.taskId=l.taskId,window.timer=setInterval(a(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o++,t.next=3,i.a.taskInfo({data:{trueShopId:e.userData.currentShop.id,taskId:e.taskId}});case 3:r=t.sent,e.agwge=!0,2==r.status?(e.$store.commit("setWin",{content:"请求失败，请重试！"}),e.loading=!1,clearInterval(window.timer)):3==r.status?(e.loading=!0,e.getrrrrrr(e.taskId),clearInterval(window.timer)):e.agwge=!1,o>60&&(e.agwge=!1,clearInterval(window.timer));case 7:case"end":return t.stop()}},t,e)})),1e3),0==e.agwge&&clearInterval(window.timer));case 19:case"end":return t.stop()}},t,e)}))()},getrrrrrr:function(e){var t=this;return a(regeneratorRuntime.mark(function r(){var n,s,a,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.newpayTotalNum=[],r.next=3,i.a.getOrderManyShopsStat({data:{taskId:e,type:7,brandId:t.userData.currentShop.id}});case 3:if(0!=(n=r.sent).length){r.next=7;break}return t.orderListInDays=[],r.abrupt("return");case 7:for(t.orderListInDays=n.list,t.payTotalNum=n.total,t.newpayTotalNum.push(t.payTotalNum),s={},a=0;a<t.orderListInDays.length;a++)for(o=0;o<t.selectShopList.length;o++)t.selectShopList[o].id==t.orderListInDays[a].shopId&&(t.orderListInDays[a].shopName=t.selectShopList[o].shopName,s[t.selectShopList[o].id]=t.orderListInDays[a].shopName,t.shopInfo=s);t.shopInfo=s;case 13:case"end":return r.stop()}},r,t)}))()},getOrderListMonPage:function(){this.getOrderListInDays()},exportOrder:function(){var e=this;return a(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=e.orderListInDays.length){t.next=3;break}return e.$store.commit("setWin",{title:"操作提示",content:"没有订单可以导出"}),t.abrupt("return",!1);case 3:if(r=80352e5,!(e.endTime-e.startTime>r)){t.next=9;break}return e.$store.commit("setWin",{title:"操作提示",content:"最大只能查询三个月时间"}),t.abrupt("return",!1);case 9:if(!(parseInt(e.startTime/1e3)-parseInt(e.endTime/1e3)>0)){t.next=12;break}return e.$store.commit("setWin",{title:"操作提示",content:"时间选择错误"}),t.abrupt("return",!1);case 12:return t.next=14,i.a.exportManyShopsOrderStat({data:{brandId:e.userData.currentShop.id,taskId:e.taskId,type:7,shopInfo:JSON.stringify(e.shopInfo),format:"csv"}});case 14:case"end":return t.stop()}},t,e)}))()},getSelectShopList:function(e){this.transmitId=e;for(var t="",r=0;r<this.postSelectShopList.length;r++)this.transmitId.includes(this.postSelectShopList[r].id)?(this.postSelectShopList[r].selected=!0,t=t+this.postSelectShopList[r].name+","):this.postSelectShopList[r].selected=!1;this.shopIds=e.join(","),this.selectName=""==t?"请选择店铺":t},getTakeawayType:function(e){this.selectTypeNum=e}},destroyed:function(){clearInterval(window.timer)},mounted:function(){this.initBtn();for(var e=n.a.session("userShop"),t=n.a.session("brandorderDetial"),r=n.a.session("takeoutBrand"),i=n.a.session("shopList"),s=0;s<i.length;s++)i[s].selected=!0;var a="",o="";t&&(i=t.selectShopList);var l=[];i.forEach(function(e){var t={id:e.id,name:e.shopName,selected:e.selected};l.push(t)}),this.transmitId=i.map(function(e){return e.id});for(var c=0;c<i.length;c++)1==i[c].selected&&(a=a+i[c].id+",",o=o+i[c].shopName+",");var d=a.split("").length;""!==a&&(a=a.substring(0,d-1)),this.startTime=t?t.startTime:r?r.startTime:(new Date).setHours(0,0,0,0),this.endTime=t?t.endTime:r?r.endTime:(new Date).setHours(23,59,59,999),this.isOpenTime=t?t.isOpenTime:!r||r.isOpenTime,this.isBrand="3"==e.currentShop.ischain,this.userData=e,this.selectShopList=t?t.selectShopList:i,this.postSelectShopList=l,this.selectTypeNum=t?t.type:"",this.shopIds=a,this.selectName=""==o?"请选择店铺":o,0!=this.selectShopList.length?"3"===e.currentShop.ischain?(this.init(),sessionStorage.removeItem("brandorderDetial"),sessionStorage.removeItem("takeoutBrand")):this.$router.push({path:"/admin/orderStatistics/orderTakeaway",query:this.$route.query}):this.$store.commit("setWin",{title:"操作提示",content:"没有可选店铺"})},components:{calendar:function(){return r.e("calendar_result").then(r.bind(null,"9265"))},elShopList:function(){return r.e("el_shopList").then(r.bind(null,"60ff"))}}},l=(r("b0da"),r("d801")),c=Object(l.a)(o,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-top":"20px"},attrs:{id:"statistics-order"}},[i("div",{staticClass:"button"},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:e.toOrder}},[e._v("堂吃")]),e._v(" "),i("a",{staticClass:"select",attrs:{href:"javascript:void(0);"}},[e._v("外卖")]),e._v(" "),i("a",{attrs:{id:"returncolor",href:"javascript:void(0);"},on:{click:e.toProprietary}},[e._v("自营外卖")])]),e._v(" "),i("div",{staticClass:"order-order-data"},[i("div",{staticStyle:{display:"inline-block",margin:"10px 0"}},[i("el-date-picker",{attrs:{clearable:!1,type:"datetime",placeholder:"选择日期"},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),e._v(" "),i("span",{staticStyle:{width:"25px","line-height":"40px","text-align":"center"}},[e._v("至")]),e._v(" "),i("el-date-picker",{attrs:{clearable:!1,type:"datetime",placeholder:"选择日期"},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}})],1),e._v(" "),i("div",{staticStyle:{display:"inline-block",margin:"10px 0"}},[i("div",{class:{selected:e.isOpenTime},staticStyle:{width:"20px",height:"20px",cursor:"pointer",border:"1px solid #28A8E0",margin:"10px 10px",float:"left"},on:{click:e.selectBusinessHours}}),e._v(" "),i("span",{staticStyle:{"font-size":"16px"}},[e._v("按营业时间")]),e._v(" "),i("elShopList",{attrs:{shopIds:e.transmitId},on:{chooseShop:e.getSelectShopList}})],1),e._v(" "),i("div",{staticStyle:{display:"inline-block",margin:"10px 0"}},[i("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择外卖类型"},model:{value:e.selectTypeNum,callback:function(t){e.selectTypeNum=t},expression:"selectTypeNum"}},e._l(e.takeawaytypeList,function(e,t){return i("el-option",{key:t,attrs:{label:e,value:t}})})),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.sreachOrderInDays()}}},[e._v("搜索")]),e._v(" "),i("el-button",{attrs:{type:"info"},on:{click:function(t){e.resetting()}}},[e._v("重置")])],1)]),e._v(" "),i("section",{staticStyle:{width:"100%",overflow:"hidden",height:"auto","line-height":"40px","margin-top":"10px"}},[i("section",{staticStyle:{width:"80px",height:"20px","line-height":"20px",float:"left"}},[e._v("选择店铺：")]),e._v(" "),i("section",{staticStyle:{height:"auto","line-height":"20px",float:"left"}},[e._v(e._s(e.selectName))])]),e._v(" "),e.loading?e._e():i("div",{staticStyle:{width:"128px",margin:"200px auto"}},[i("img",{attrs:{src:r("b8bc")}})]),e._v(" "),e.loading?i("section",{staticClass:"allBox"},[i("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"","row-style":{color:"#f8941f"},"header-cell-style":{"background-color":"#f5f7fa"},data:e.newpayTotalNum,border:""}},[i("el-table-column",{attrs:{width:"250",align:"center",prop:"days",label:"天数"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100",align:"center",prop:"orderNum",label:"订单数"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","render-header":e.renderHeader,"show-overflow-tooltip":"",align:"center",prop:"totalNum",label:"商品总数"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100","render-header":e.renderHeader,"show-overflow-tooltip":"",align:"center",prop:"goodsNum",label:"销量"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",align:"center",prop:"discountNum",label:"赠品总数"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",align:"center",prop:"deliverFee",label:"配送总额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.deliverFee).toFixed(2)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","render-header":e.renderHeader,"show-overflow-tooltip":"",align:"center",prop:"activityFee",label:"优惠总额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.activityFee).toFixed(2)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","render-header":e.renderHeader,align:"center","show-overflow-tooltip":"",prop:"goodsTotalPrice",label:"消费总额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.goodsTotalPrice).toFixed(2)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","render-header":e.renderHeader,"show-overflow-tooltip":"",align:"center",property:"income",label:"入账总额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.income).toFixed(2)))])]}}])})],1),e._v(" "),i("section",{staticStyle:{"margin-top":"20px"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"","header-cell-style":{"background-color":"#f5f7fa"},data:e.lists,border:""}},[i("el-table-column",{attrs:{fixed:"",width:"250",align:"center",prop:"shopName",label:"店铺名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticStyle:{color:"#00AAE7",cursor:"pointer"},on:{click:function(r){e.openDayDetial(t.row)}}},[e._v(e._s(t.row.shopName))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100",align:"center",prop:"orderNum",label:"订单数"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","render-header":e.renderHeader,"show-overflow-tooltip":"",align:"center",prop:"totalNum",label:"商品数"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100","render-header":e.renderHeader,"show-overflow-tooltip":"",align:"center",prop:"goodsNum",label:"销量"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",align:"center",prop:"discountNum",label:"赠品数"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100","show-overflow-tooltip":"",align:"center",prop:"deliverFee",label:"配送金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.deliverFee).toFixed(2)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","show-overflow-tooltip":"",align:"center",prop:"activityFee",label:"优惠金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.activityFee).toFixed(2)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","render-header":e.renderHeader,align:"center","show-overflow-tooltip":"",prop:"goodsTotalPrice",label:"消费金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.goodsTotalPrice).toFixed(2)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"120","render-header":e.renderHeader,"show-overflow-tooltip":"",align:"center",property:"income",label:"入账金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(parseFloat(t.row.income).toFixed(2)))])]}}])})],1)],1)],1):e._e(),e._v(" "),i("div",{staticStyle:{margin:"20px 0"}},[i("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-count":e.totalNum,"page-size":e.num,layout:"sizes, prev, pager, next","page-sizes":[10,20,30]},on:{"size-change":e.numChange,"current-change":e.pageClick}})],1)])},[],!1,null,"7b9e410c",null);t.default=c.exports},"4e83":function(e,t,r){},b0da:function(e,t,r){"use strict";var i=r("4e83");r.n(i).a},b8bc:function(e,t,r){e.exports=r.p+"images/preloader.3e54c692.gif"}}]);