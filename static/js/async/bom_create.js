(window.webpackJsonp=window.webpackJsonp||[]).push([["bom_create"],{5089:function(t,e,s){"use strict";s.r(e);var i=s("81a2"),a=s("bbb9"),n=s("f6ce");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function i(a,n){try{var r=e[a](n),o=r.value}catch(t){return void s(t)}if(!r.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}("next")})}}var o={data:function(){return s="",(e="isBrand")in(t={bomId:"",createUid:"",createName:"",detail:[],param:{gid:""},tips:{gid:"请选择商品"},wlTips:{wids:"请选择仓库消耗排序",minNum:"消耗量不能为空"},bomNum:"",materialInfo:"",remark:"",page:1,wid:"",gList:[],goodsList:[],goodsEnd:!1,goodsName:"",goodsType:"",timerId:"",sortSend:{},showWin:null,type:1,ownerName:"",isBrand:0,isPublic:1,isAuto:1,isAutoBool:!0,isOversold:1,isOversoldBool:!0,booleanShared:!0,isShared:1,addWlShow:!1,index:0,wlList:[],wlListEach:[],warehouse:[],sendWlList:[],alreadyGoods:[],isVeryLarge:!1,showPage:50,totalNum:0,cid:"",pGoodsList:[],pCategory:[],pObj:{},searchName:"",isSearch:!1,saveObj:{},isClick:!1,shopId:""})?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t;var t,e,s},created:function(){this.userData=n.a.session("userShop")},mounted:function(){this.initData(),this.getBomListByShopId(),this.getWarehouseList(),this.getCategoryList()},components:{selectBtn:function(){return s.e("select_btn").then(s.bind(null,"3d41"))},onOff:function(){return s.e("on_off").then(s.bind(null,"034b"))},addMaterial:function(){return s.e("output_select_supplies").then(s.bind(null,"0c3f"))},warehouseSort:function(){return s.e("bom_create_sort").then(s.bind(null,"a987"))},listPage:function(){return s.e("list_page").then(s.bind(null,"d975"))}},methods:{initData:function(){this.createUid=this.userData.user.id,this.createName=this.userData.user.name,this.shopId=this.userData.currentShop.id,this.isBrand="3"==this.userData.currentShop.ischain},getWarehouseList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.warehouseWarehouseList();case 2:s=e.sent,t.warehouse=s;case 4:case"end":return e.stop()}},e,t)}))()},getGoodsList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getGoodsList({data:{page:t.page,num:t.showPage}});case 2:s=e.sent,t.goodsList=s.list,t.totalNum=s.total,t.setBomGoodsAlready(),t.pObj.totalNum=t.totalNum,t.pObj.currentPage=t.page;case 8:case"end":return e.stop()}},e,t)}))()},searchGoodsList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.goodsGetListByCid({data:{goodsName:t.searchName,cid:t.cid,page:t.page,num:t.showPage}});case 2:s=e.sent,t.goodsList=s.list,t.totalNum=s.totalNum,t.setBomGoodsAlready(),t.pObj.totalNum=t.totalNum;case 7:case"end":return e.stop()}},e,t)}))()},bomAdd:function(t){var e=this;return r(regeneratorRuntime.mark(function s(){var a;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!e.isClick){s.next=3;break}return e.$store.commit("setWin",{title:"温馨提示",content:"请勿重复点击"}),s.abrupt("return");case 3:return e.isClick=!0,a=null,s.prev=5,s.next=8,i.a.bomBillmaterialAddBom({data:t},!0);case 8:a=s.sent,s.next=15;break;case 11:s.prev=11,s.t0=s.catch(5),e.$message({message:s.t0.error.message,type:"error"}),e.isClick=!1;case 15:a&&(e.$message({message:"BOM单新建成功！",type:"success"}),e.$router.push({path:"/admin/bomList",query:e.$route.query}));case 16:case"end":return s.stop()}},s,e,[[5,11]])}))()},getBomListByShopId:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getBomListByShopId();case 2:s=e.sent,t.areadyGoods=s,t.getGoodsList();case 5:case"end":return e.stop()}},e,t)}))()},setBomGoodsAlready:function(){var t=[];if(this.areadyGoods.length){var e=!0,s=!1,i=void 0;try{for(var n,r=this.goodsList[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value,l=!0,u=!1,c=void 0;try{for(var d,m=this.areadyGoods[Symbol.iterator]();!(l=(d=m.next()).done);l=!0){if(d.value==o.id){o.alreadySel=!0;break}o.alreadySel=!1}}catch(t){u=!0,c=t}finally{try{!l&&m.return&&m.return()}finally{if(u)throw c}}(1!=o.isInvoicing&&0==o.type||1==o.type)&&t.push(o)}}catch(t){s=!0,i=t}finally{try{!e&&r.return&&r.return()}finally{if(s)throw i}}this.goodsList=t}else{var h=!0,v=!1,p=void 0;try{for(var f,g=this.goodsList[Symbol.iterator]();!(h=(f=g.next()).done);h=!0){var _=f.value;(1!=_.isInvoicing&&0==_.type||1==_.type)&&t.push(_)}}catch(t){v=!0,p=t}finally{try{!h&&g.return&&g.return()}finally{if(v)throw p}}this.goodsList=t}this.pGoodsList=a.a.deepCopy(t)},cancel:function(){n.a.session("bomListDestroy",!0),this.$router.push({path:"/admin/bomList",query:this.$route.query})},confirm:function(){if(this.checkForm()){var t=this.formatData();if(this.isVeryLarge)return this.$store.commit("setWin",{title:"温馨提示",content:"物料消耗量数量太大"}),!1;this.bomAdd(t)}},getAuto:function(t){this.isAutoBool=t,this.isAuto=t?1:0},getOversold:function(t){this.isOversoldBool=t,this.isOversold=t?1:0},getCategoryList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getCategoryList();case 2:s=e.sent,t.pCategory=s;case 4:case"end":return e.stop()}},e,t)}))()},openGoods:function(){this.showWin="listPage",this.pObj={title:"选择商品",currentPage:this.page,totalNum:this.totalNum,showPageNum:6,selGoods:[this.param.gid],fieldName:"goodsName",onlyCategoryId:!0}},getSelectGoods:function(t){"ok"==t.status?t.selList.length?(this.param.gid=t.selList[0].id,this.goodsName=t.selList[0].goodsName,this.goodsType=t.selList[0].type,this.showWin=null):this.$store.commit("setWin",{title:"提示信息",content:"请选择要关联的商品"}):"close"==t.status||"cancel"==t.status?this.showWin=null:"search"==t.status?t.cid||t.search?(this.isSearch=!0,this.searchGoods(t),this.saveObj=a.a.deepCopy(t)):(this.isSearch=!1,this.getGoodsList()):"page"==t.status&&(this.page=t.page,this.isSearch?this.searchGoods(this.saveObj):this.getGoodsList())},searchGoods:function(t){this.searchName=t.search,this.cid=t.cid,this.searchGoodsList(),this.pObj.currentPage=1},selectUnit:function(t){var e=this.wlListEach[this.index],s=e.unit[t];1==s.isMin?(e.min=s.name,e.minId=s.muId,e.def="",e.defNum="",e.defId=s.muId):(e.def=s.name,e.defId=s.muId),e.value=s.value},addWlClick:function(){this.sleSupplies=this.wlList,this.addWlShow=!0},getWlSelect:function(t){t&&(this.wlList=t,this.setWlList()),this.addWlShow=!1},setWlList:function(){var t=[],e=!0,s=!1,i=void 0;try{for(var a,n=this.wlList[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value,o={wids:[],mid:r.id,unit:r.unit,name:r.name,minNum:"",defNum:"",yield:100},l=this.unitConv(r);for(var u in l)o[u]=l[u];t.push(o)}}catch(t){s=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(s)throw i}}this.wlListEach=t},unitConv:function(t){var e=[],s=0,i="",a="",n="",r="",o=1;for(var l in t.unit){var u=t.unit[l];e.push(u.name),1==u.isMin?(a=u.name,n=u.muId,1==u.isDefault&&(r=u.muId,s=l)):1==u.isDefault&&(i=u.name,r=u.muId,o=u.value,s=l)}return{unitName:e,min:a,minId:n,def:i,defId:r,value:o,uninIndex:s}},unitComp:function(){var t=[],e=!0,s=!1,i=void 0;try{for(var a,n=this.wlListEach[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value,o=Number(r.minNum)+Number(r.defNum*r.value);this.isVeryLarge=o>999999999;var l={mid:r.mid,consumeUnit:r.defId,consumeNum:o,wids:r.wids.join(","),minUnit:r.minId,yield:Number(r.yield)/100};this.isCreate||(l.id=r.id),t.push(l)}}catch(t){s=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(s)throw i}}return JSON.stringify(t)},listHandle:function(t){var e=t.target;this.index=t.currentTarget.getAttribute("data-index");var s=e.className;if(s.includes("delete")){var i=e.getAttribute("data-mid");this.deleteList(this.wlListEach,i,"mid"),this.deleteList(this.wlList,i,"id")}else s.includes("sort")&&(this.showWin="warehouseSort",this.sortSend={list:this.warehouse,widList:this.wlListEach[this.index].wids,shopId:this.shopId,isBrand:this.isBrand})},deleteList:function(t,e,s){for(var i in t)t[i][s]==e&&t.splice(i,1)},getSortArr:function(t){t&&(this.wlListEach[this.index].wids=t),this.showWin=null},tabClick:function(t){var e=t.target;if("span"==e.tagName.toLocaleLowerCase()){var s=e.getAttribute("data-index");this.isPublic=s}},codeInput:function(t){var e=t.target.value;e=e.replace(/[^A-Za-z0-9]/g,""),this.bomNum=e,t.target.value=e},checkForm:function(){for(var t in this.tips)if(this.param[t]=this.param[t].trim(),0==this.param[t].length){var e=this.tips[t];return this.$store.commit("setWin",{title:"温馨提示",content:e}),!1}if(!this.wlListEach.length)return this.$store.commit("setWin",{title:"温馨提示",content:"请选择物料消耗"}),!1;for(var s in this.wlListEach){var i=this.wlListEach[s],a=Number(i.defNum),n=Number(i.minNum);if(0==i.wids.length)return this.checkTips(i.name,"请选择仓库消耗排序");if(isNaN(a)||isNaN(n))return this.checkTips(i.name,"物料消耗量必须为数字"),!1;if(isNaN(i.yield))return this.checkTips(i.name,"出成率必须为数字"),!1;if(Number(i.yield)>100)return this.checkTips(i.name,"出成率不能大于100%"),!1;if(a+n<=0)return this.checkTips(i.name,"物料消耗量必须大于0")}return!0},checkTips:function(t,e){var s="("+t+") "+e;return this.$message({message:s,type:"error"}),!1},formatData:function(){this.materialInfo=this.unitComp();var t="";return 0!=this.goodsType&&1!=this.goodsType||(t=0),{createUid:this.createUid,isPublic:this.isPublic,gid:this.param.gid,isAuto:this.isAuto,isOversold:this.isOversold,type:t,bomNum:this.bomNum,remark:this.remark,materialInfo:this.materialInfo}}}},l=(s("e8ea"),s("d801")),u=Object(l.a)(o,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"create-bom"}},[s("div",{staticClass:"scroll-box"},[t.addWlShow?t._e():[s("div",{staticClass:"create"},[t._v("新建BOM单")]),t._v(" "),s("div",{staticClass:"store-content"},[s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name required"},[t._v("创建人")]),t._v(" "),s("span",{staticClass:"word"},[t._v(t._s(t.createName))])]),t._v(" "),s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name required"},[t._v("BOM单类型")]),t._v(" "),s("div",{staticClass:"tab-box",on:{click:t.tabClick}},[s("span",{class:{active:1==t.isPublic},attrs:{"data-index":"1"}},[t._v("公开")]),t._v(" "),s("span",{class:{active:-1==t.isPublic},attrs:{"data-index":"-1"}},[t._v("私密")])])]),t._v(" "),s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name"},[t._v("BOM单编号")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.bomNum,expression:"bomNum"}],staticClass:"store-input",attrs:{type:"text",placeholder:"请输入BOM单编号",maxlength:"20"},domProps:{value:t.bomNum},on:{input:[function(e){e.target.composing||(t.bomNum=e.target.value)},t.codeInput],propertychange:t.codeInput}}),t._v(" "),t._m(0)]),t._v(" "),s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name required"},[t._v("商品名称")]),t._v(" "),s("div",{staticClass:"add-blong",on:{click:t.openGoods}},[s("em",{staticClass:"img-span"}),t._v("选择商品\n\t\t\t\t\t")]),t._v(" "),t.goodsName?s("em",{staticClass:"now-select"},[t._v("( 已选择："+t._s(t.goodsName)+" )")]):t._e(),t._v(" "),t.goodsName?t._e():s("em",{staticClass:"now-select"},[t._v("( 请选择商品 )")])]),t._v(" "),s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name required"},[t._v("自动消耗")]),t._v(" "),s("div",{staticClass:"shared-box"},[s("on-off",{attrs:{status:t.isAutoBool},on:{statusChange:t.getAuto}})],1)]),t._v(" "),s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name required"},[t._v("库存可以为负数")]),t._v(" "),s("div",{staticClass:"shared-box"},[s("on-off",{attrs:{status:t.isOversoldBool},on:{statusChange:t.getOversold}})],1)]),t._v(" "),s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name"},[t._v("备注")]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.remark,expression:"remark"}],staticClass:"text-area",attrs:{placeholder:"请输入备注信息",maxlength:"40"},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value)}}}),t._v(" "),t._m(1)]),t._v(" "),s("div",{staticClass:"store-list"},[s("label",{staticClass:"store-name required"},[t._v("物料消耗")]),t._v(" "),s("div",{staticClass:"add-blong",on:{click:t.addWlClick}},[s("em",{staticClass:"img-span"}),t._v("添加物料\n\t\t\t\t\t")])])]),t._v(" "),t.wlListEach.length?s("div",{staticClass:"consume-list"},[s("div",{staticClass:"head"},[t._v("物料消耗列表 · 共\n\t\t\t\t\t"),s("em",[t._v(t._s(t.wlListEach.length))]),t._v(" 个条目")]),t._v(" "),s("div",{staticClass:"list"},[t._m(2),t._v(" "),t._l(t.wlListEach,function(e,i){return s("div",{key:i,staticClass:"item",attrs:{"data-index":i},on:{click:t.listHandle}},[s("div",{staticClass:"unit"},[s("em",{staticClass:"handle-btn delete",attrs:{"data-mid":e.mid}},[t._v("删除")]),t._v(" "),s("em",{staticClass:"handle-btn sort"},[t._v("仓库消耗排序")])]),t._v(" "),s("div",{staticClass:"unit pad"},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t\t")]),t._v(" "),s("div",{staticClass:"unit"},[s("select-btn",{staticClass:"select-btn",attrs:{sorts:e.unitName,index:e.uninIndex,width:100},on:{emit:t.selectUnit}})],1),t._v(" "),s("div",{staticClass:"unit wide"},[e.def?[s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.defNum,expression:"item.defNum"}],attrs:{type:"text",placeholder:"输入数字",maxlength:"10"},domProps:{value:e.defNum},on:{input:function(s){s.target.composing||t.$set(e,"defNum",s.target.value)}}}),t._v(" "),s("em",{attrs:{title:e.def}},[t._v(t._s(e.def))])]),t._v(" "),s("span",[t._v(" + ")])]:t._e(),t._v(" "),s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.minNum,expression:"item.minNum"}],attrs:{type:"text",placeholder:"输入数字",maxlength:"10"},domProps:{value:e.minNum},on:{input:function(s){s.target.composing||t.$set(e,"minNum",s.target.value)}}}),t._v(" "),s("em",{attrs:{title:e.min}},[t._v(t._s(e.min))])])],2),t._v(" "),s("div",{staticClass:"unit"},[s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.yield,expression:"item.yield"}],attrs:{type:"text",placeholder:"输入数字"},domProps:{value:e.yield},on:{input:function(s){s.target.composing||t.$set(e,"yield",s.target.value)}}}),t._v(" "),s("em",[t._v("%")])])]),t._v(" "),s("div",{staticClass:"unit pad"},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.wids.length)+"\n\t\t\t\t\t\t")])])})],2)]):t._e(),t._v(" "),s("div",{staticClass:"store-content"},[s("div",{staticClass:"bottom-btn"},[s("div",{staticClass:"gray cancel-btn",on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("div",{staticClass:"yellow ok-btn",on:{click:t.confirm}},[t._v("确定")])])]),t._v(" "),s(t.showWin,{tag:"component",attrs:{winOpen:t.sortSend,pGoodsList:t.pGoodsList,pCategory:t.pCategory,pObj:t.pObj},on:{emit:t.getSortArr,selectGoods:t.getSelectGoods}})],t._v(" "),t.addWlShow?s("add-material",{attrs:{sleSupplies:t.sleSupplies},on:{select:t.getWlSelect}}):t._e()],2)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"font-limit"},[e("em"),this._v("限20字以内,数字/字母\n\t\t\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"font-limit"},[e("em"),this._v("限40字以内\n\t\t\t\t\t")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"title"},[s("span",[t._v("操作")]),t._v(" "),s("span",[t._v("物料名称")]),t._v(" "),s("span",[t._v("消耗单位")]),t._v(" "),s("span",{staticClass:"wide"},[t._v("毛料")]),t._v(" "),s("span",[t._v("出成率")]),t._v(" "),s("span",[t._v("已选仓库数")])])}],!1,null,"5d152098",null);e.default=u.exports},"788a":function(t,e,s){},e8ea:function(t,e,s){"use strict";var i=s("788a");s.n(i).a}}]);