(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_birth"],{"7a67":function(t,e,i){"use strict";var a=i("82c3");i.n(a).a},"82c3":function(t,e,i){},ede9:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"birth_act"},[t._m(0),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动名称")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.actName,expression:"actName"}],staticClass:"name",attrs:{type:"text",placeholder:"请输入活动标题",maxlength:"10"},domProps:{value:t.actName},on:{input:function(e){e.target.composing||(t.actName=e.target.value)}}})])]),t._v(" "),t._m(1),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("关联优惠券")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("a",{staticClass:"addclassify",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:t.addCount}},[t._v("选择关联优惠券")]),t._v(" "),t.selectCoupon.length>0?i("span",[t._v("(已关联"+t._s(t.selectCoupon.length)+"张)")]):t._e()])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动期限")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("select-btn",{attrs:{name:t.durationName,sorts:t.durationList.map(function(t){return t.name}),width:200},on:{selOn:t.selexpirationTime}})],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("推送日期")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("span",[t._v("提前")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.pushdateNum,expression:"pushdateNum"}],staticClass:"name",staticStyle:{width:"200px",margin:"0 10px"},attrs:{type:"text",placeholder:"请输入推送日期"},domProps:{value:t.pushdateNum},on:{input:function(e){e.target.composing||(t.pushdateNum=e.target.value)}}}),t._v(" "),i("span",[t._v("天,发起生日活动推送")])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("推送时间")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("span",{staticStyle:{"margin-right":"10px"}},[t._v("每日")]),t._v(" "),i("select-btn",{attrs:{name:t.pushNum,sorts:t.pushtimeList.map(function(t){return t.name}),width:200},on:{selOn:t.selpushtime}}),t._v(" "),i("span",{staticStyle:{"margin-left":"10px"}},[t._v("时,发起生日活动推送")])],1)]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("消息推送渠道")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("mulSelect",{staticClass:"fl",attrs:{styles:{backgroundColor:"rgb(240,240,240)"},list:t.goodsType,selects:t.goodsSelect,name:"name",keyName:"id"},on:{selOn:t.selOn}}),t._v(" "),t._m(4)],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("内容设置")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.contentSetting,expression:"contentSetting"}],attrs:{placeholder:"请输入内容设置",maxlength:"151"},domProps:{value:t.contentSetting},on:{input:function(e){e.target.composing||(t.contentSetting=e.target.value)}}}),t._v(" "),t._m(5),t._v(" "),i("div",{staticClass:"limit"},[i("p",[t._v("引用参数:\n\t\t\t\t\t"),t._l(t.parameter,function(e,a){return i("a",{key:a,staticStyle:{color:"#FF9200"},on:{click:function(e){t.addParameter(a,1)}}},[t._v(t._s(e.name))])})],2)])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("活动说明")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.explain,expression:"explain"}],attrs:{placeholder:"请输入活动说明",maxlength:"151"},domProps:{value:t.explain},on:{input:function(e){e.target.composing||(t.explain=e.target.value)}}}),t._v(" "),t._m(6)])]),t._v(" "),i("div",{staticClass:"box",staticStyle:{"margin-top":"100px","padding-left":"70px"}},[i("a",{staticClass:"gray",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:t.returnAct}},[t._v("取消")]),t._v(" "),t.isactivityDetail?[i("a",{staticClass:"gray",staticStyle:{width:"200px",background:"#858585"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.birthSave("0")}}},[t._v("保存")]),t._v(" "),t.edit?t._e():i("a",{staticClass:"yellow",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.birthSave("1")}}},[t._v("发布")])]:t._e()],2),t._v(" "),t.showBirthCoupon?i("birthCoupon",{attrs:{selectCoupon:t.selectCoupon,couponList:t.couponList},on:{winEvent:t.winEvent}}):t._e()],1)};a._withStripped=!0;var n=i("f6ce"),s=i("bbb9"),r=i("81a2"),o=i("05dd");function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function a(n,s){try{var r=e[n](s),o=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(o).then(function(t){a("next",t)},function(t){a("throw",t)});t(o)}("next")})}}var l={data:function(){return{edit:!1,editId:"",actName:"",durationList:[{name:"永久",id:0},{name:"一年",id:1},{name:"二年",id:2}],durationId:-1,durationName:"全部",explain:"",isclick:!1,pushdateNum:"",pushtimeList:[{name:"8"},{name:"9"},{name:"10"},{name:"14"},{name:"15"},{name:"16"},{name:"17"},{name:"18"},{name:"21"},{name:"22"},{name:"23"}],pushNum:"8",goodsType:[{name:"微信",id:"1"}],goodsSelect:[],customSelect:[],msmStatus:!1,marketingStatus:!1,activityDetail:{},shopList:[],contentSetting:"",parameter:[{name:"【会员姓名】",id:"{memberName}"},{name:"【会员生日】",id:"{memberBirthday}"},{name:"【优惠券名称】",id:"{couponName}"},{name:"【优惠券数量】",id:"{couponNum}"},{name:"【活动名称】",id:"{activityName}"}],showBirthCoupon:!1,couponList:[],selectCoupon:[],isactivityDetail:!0}},watch:{explain:function(){this.explain.length>150&&(this.valiData("仅限150个字符"),this.explain=this.explain.substr(0,150))},contentSetting:function(){this.contentSetting.length>150&&(this.valiData("仅限150个字符"),this.contentSetting=this.contentSetting.substr(0,150))}},methods:{valiData:function(t,e,i){this.$store.commit("setWin",{content:t,title:e,winType:i})},selexpirationTime:function(t){this.durationName=this.durationList[t].name,this.durationId=this.durationList[t].id},selpushtime:function(t){this.pushNum=this.pushtimeList[t].name},addParameter:function(t){this.contentSetting+=this.parameter[t].id},winEvent:function(t){this.showBirthCoupon=!1,"ok"==t.status&&(this.selectCoupon=t.data.select,this.couponList=t.data.list)},selOn:function(t){this.goodsSelect=t},returnAct:function(){this.$router.push("/admin/activity/generalActivity")},addCount:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var i,a,n,s,o,c,l,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.getGetCouponCondition({});case 2:for(i=e.sent,a=[],n=!0,s=!1,o=void 0,e.prev=7,c=i[Symbol.iterator]();!(n=(l=c.next()).done);n=!0)7!=(u=l.value).type&&a.push(u);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),s=!0,o=e.t0;case 15:e.prev=15,e.prev=16,!n&&c.return&&c.return();case 18:if(e.prev=18,!s){e.next=21;break}throw o;case 21:return e.finish(18);case 22:return e.finish(15);case 23:t.couponList=a,t.goodsCom=i,t.goodsCom.forEach(function(t){t.num=1}),t.showBirthCoupon=!0;case 27:case"end":return e.stop()}},e,t,[[7,11,15,23],[16,,18,22]])}))()},checkForm:function(){return!!o.a.checkData({isclick:{cond:"$$!==true",pro:"请勿重复保存"},actName:"活动名称未设置",selectCoupon:{cond:"$$.length!=0",pro:"请关联优惠券"},pushdateNum:{reg:/^([0-9]|(1[0-9])|(2[0-9])|(3[0-1]))$/,pro:"请填写推送日期，推送日期必须为0~31的正整数"}},this)},birthSave:function(t){var e=this;return c(regeneratorRuntime.mark(function i(){var a,n,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e.checkForm()){i.next=2;break}return i.abrupt("return");case 2:if(e.edit){i.next=10;break}return a=[],n={couponIds:e.selectCoupon,pushChannel:e.goodsSelect.toString().replace(/,/g,""),msgContent:e.contentSetting},a.push(n),i.next=8,r.a.fissionActivity({data:{type:0,mouldType:0,name:e.actName,advanceTime:e.pushdateNum+","+e.pushNum,explain:e.explain,objectType:2,limit:e.durationId,getType:0,isAuto:t,rule:JSON.stringify(a)}});case 8:i.next=21;break;case 10:return e.activityDetail.name=e.actName,e.activityDetail.advanceTime=e.pushdateNum+","+e.pushNum,e.activityDetail.explain=e.explain,e.activityDetail.rule[0].couponIds=e.selectCoupon,e.activityDetail.rule[0].msgContent=e.contentSetting,e.activityDetail.rule[0].pushChannel=e.goodsSelect.toString().replace(/,/g,""),e.activityDetail.limit=e.durationId,e.activityDetail.rule=s.a.deepCopy(e.activityDetail.rule),e.activityDetail.isAuto=t,i.next=21,r.a.fissionActivity({data:{activityId:e.editId,data:JSON.stringify(e.activityDetail)}});case 21:o="0"==t?"保存成功":"发布成功",e.valiData(o),e.returnAct();case 24:case"end":return i.stop()}},i,e)}))()},getActivityDetail:function(t){var e=this;return c(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.a.newgetActivityDetail({data:{activityId:t.id,type:t.type,mouldType:t.mouldType}});case 2:a=i.sent,e.activityDetail=a,e.actName=a.name,e.explain=a.explain,e.pushdateNum=a.advanceTime.split(",")[0],e.pushNum=a.advanceTime.split(",")[1],e.goodsSelect=a.rule[0].pushChannel.length>1?a.rule[0].pushChannel.split("").toString().split(","):a.rule[0].pushChannel.split(","),e.contentSetting=a.rule[0].msgContent,e.goodsIds=JSON.parse(a.rule[0].couponIds),e.selectCoupon=JSON.parse(a.rule[0].couponIds),e.durationId=a.limit,e.durationName=e.durationList[a.limit].name,e.edit=!0;case 15:case"end":return i.stop()}},i,e)}))()}},components:{mulSelect:function(){return i.e("mul_select").then(i.bind(null,"7d09"))},birthCoupon:function(){return i.e("activity_birth_coupon").then(i.bind(null,"2d94"))},selectBtn:function(){return i.e("select_btn").then(i.bind(null,"3d41"))}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){t.returnAct()}}]);var e=n.a.session("activityInfo");e&&(e.isShowdetail&&(this.isactivityDetail=!1),this.editId=e.id,this.getActivityDetail(e))},beforeDestroy:function(){n.a.session("activityInfo",null)}},u=(i("7a67"),i("6ceb")),v=Object(u.a)(l,a,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("生日活动")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"online-box clearfix"},[e("span",{staticClass:"online-sub fl required"},[this._v("活动对象")]),this._v(" "),e("div",{staticClass:"rightHalf"},[e("span",{staticClass:"obj"},[this._v("全体会员")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"online-box clearfix"},[e("span",{staticClass:"online-sub fl required"},[this._v("获得方式")]),this._v(" "),e("div",{staticClass:"rightHalf"},[e("span",{staticClass:"obj"},[this._v("自动获得")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("活动通知")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 活动发布后将通过该渠道触发会员\n\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bluehandle-tips"},[e("i"),this._v(" 活动发布后将通过该渠道触发会员\n\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bluehandle-tips"},[e("i"),this._v(" 限150字以内\n\t\t\t")])}],!1,null,"23780519",null);v.options.__file="src\\module\\marketing_tools\\new_activity\\activity_birth.vue";e.default=v.exports}}]);