(window.webpackJsonp=window.webpackJsonp||[]).push([["cooperating_partner"],{"6abc":function(t,e,i){"use strict";var n=i("8182");i.n(n).a},8182:function(t,e,i){},b9d6:function(t,e,i){"use strict";i.r(e);var n=[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"img",staticStyle:{"margin-top":"35px"}},[e("img",{staticStyle:{width:"47px",height:"47px"},attrs:{src:i("f518")}})])}],a=i("81a2"),r=i("f6ce"),s=i("bbb9"),o=i("05dd");function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(a,r){try{var s=e[a](r),o=s.value}catch(t){return void i(t)}if(!s.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}("next")})}}function g(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var l={data:function(){return{cpPower:"",shopId:"",brandId:"",list:[],info:null,sort:"",coopName:"",description:"",bigImgUrl:"",uploadUrl:"",imgList:[],deleteImgList:[],index:null,showDelete:!1,deleteImage:[],updateImage:[],addImage:[],packageWin:!1,title:"",detailIndex:"",widthWin:"1200",hauto:"auto"}},computed:{ok:function(){return this.info?{content:"保存"}:{content:"添加",style:{background:"#f8941f"}}},cancel:function(){return this.info?{content:"删除",style:{background:"#c33"}}:{content:"取消",style:{background:"#a0a0a0"}}}},methods:{closeWin:function(t){if("ok"==t){if(!this.cpPower)return this.$store.commit("setWin",{title:"提示信息",content:"加盟店或直营店没有合作品牌的更改权限",winType:"alert"}),this.packageWin=!1,!0;if(!o.a.checkData({coopName:{cond:"$$.trim() != '' || $$.match(/^\\s+$/g)",pro:"品牌的名字不能为空"},description:{cond:"$$.trim() != '' || $$.match(/^\\s+$/g)",pro:"品牌介绍不能为空"},bigImgUrl:{cond:"$$.length > 0",pro:"品牌缩略图片不能为空"},imgList:{cond:"$$.length > 0",pro:"品牌详情图片至少要有一个"}},this))return!1;if(this.addImage.length>0||this.imgList.length>0)for(var e=[].concat(g(this.addImage),g(this.imgList)),i=0;i<e.length;i++)if(e[i].sort>255)return this.$store.commit("setWin",{content:"排序数值不能大于255",winType:"alert",timerPowerOff:1e3}),!1;this.packageWin=!1,this.info?this.editPartner():this.addPartner(),this.packageWin=!1}else{if(!this.cpPower&&"cancel"==t)return this.$store.commit("setWin",{title:"提示信息",content:"加盟店或直营店没有合作品牌的删除权限",winType:"alert"}),this.packageWin=!1,!0;"cancel"==t&&this.info?(this.packageWin=!1,this.delPartner()):this.packageWin=!1}},open:function(t,e){this.getDetail(t,e)},changeImgList:function(t){var e=this;return c(regeneratorRuntime.mark(function i(){var n,s,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n="bannerImgs"+t,i.next=3,a.a.bannerImgUpload({data:{type:8,shopId:r.a.session("shopId")},formId:n});case 3:s=i.sent,(o=e.imgList[e.index]).imageName=s,e.imgList.splice(e.index,o);case 7:case"end":return i.stop()}},i,e)}))()},getList:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.getPartnerList({data:{shopId:t.shopId}});case 2:i=e.sent,t.list=s.a.sortByAll(i);case 4:case"end":return e.stop()}},e,t)}))()},getDetail:function(t,e){var i=this;return c(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=21;break}return n.next=3,a.a.getPartnerById({data:{id:t,shopId:i.shopId}});case 3:r=n.sent,i.packageWin=!0,i.info=r,i.sort=r.sort,i.coopName=r.nickName,i.description=r.description,i.bigImgUrl=r.minImage,i.imgList=r.image,i.deleteImgList=r.image,i.index=null,i.showDelete=!0,i.deleteImage=[],i.updateImage=[],i.addImage=[],i.title="合作品牌详情",i.detailIndex=e,n.next=36;break;case 21:i.packageWin=!0,i.info=null,i.sort=1,i.coopName="",i.description="",i.bigImgUrl="",i.imgList=[],i.deleteImgList=[],i.index=null,i.showDelete=!1,i.deleteImage=[],i.updateImage=[],i.addImage=[],i.title="新建合作品牌",i.detailIndex="";case 36:case"end":return n.stop()}},n,i)}))()},fileBannerChange:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var i,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.bannerImgUpload({data:{type:8,shopId:r.a.session("shopId")},formId:"bannerImg"});case 2:(i=e.sent)&&((n={}).sort=t.getSort(),n.imageName=i,t.info&&(n.pid=t.info.id,t.addImage.push(n)),t.imgList.length<10?t.imgList.push(n):t.$store.commit("setWin",{winType:"alert",content:"最多上传十张图片",title:"提示信息"}));case 4:case"end":return e.stop()}},e,t)}))()},fileNameChange:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.bigImgUpload({data:{type:8,shopId:r.a.session("shopId")},formId:"bigImg"});case 2:i=e.sent,t.bigImgUrl=i;case 4:case"end":return e.stop()}},e,t)}))()},getSort:function(){var t=s.a.deepCopy(s.a.sortByAll(this.imgList));return 0==t.length?1:t[t.length-1].sort-0+1},pushImgList:function(t){var e=this;return c(regeneratorRuntime.mark(function i(){var n,r,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:t&&((n={}).sort=e.getSort(),n.imageName=t.data,e.info&&(n.pid=e.info.id,e.addImage.push(n)),e.imgList.length<10?e.imgList.push(n):e.$store.commit("setWin",{title:"提示信息",content:"最多上传十张图片",winType:"alert"}),r="bannerImgs"+(e.imgList.length-1),s="bannerImgs_upload"+(e.imgList.length-1),Promise.resolve().then(c(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.a.bigImgUpload({data:{type:8,shopId:e.shopId},formId:r,url:o.a.host.shop+s});case 2:(n=e.imgList[e.index]).imageName=t,e.imgList.splice(e.index,n);case 5:case"end":return i.stop()}},i,e)}))));case 1:case"end":return i.stop()}},i,e)}))()},delImageInList:function(t,e){this.imgList.splice(t,1),e.id&&this.deleteImage.push(e)},changeIndex:function(t){var e=this;return c(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e.index=t;case 1:case"end":return i.stop()}},i,e)}))()},editPartner:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var i,n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.getIndexInArr(t.deleteImage),n={},r={id:t.info.id,nickName:t.coopName,sort:t.sort,description:t.description,minImage:t.bigImgUrl,shopId:t.shopId},t.imgList.length>0&&(n.updateImage=t.imgList),t.addImage.length>0&&(n.addImage=t.addImage),(t.addImage.length>0||t.imgList.length>0)&&(r.image=JSON.stringify(n)),i.length>0&&(r.deleteImage=i),e.next=9,a.a.editPartner({data:r});case 9:(o=e.sent).imageNum=o.image.length,t.list.splice(t.detailIndex,1,o),t.list=s.a.sortByAll(t.list),t.$store.commit("setWin",{title:"提示信息",content:"修改成功",winType:"alert",timerPowerOff:1e3});case 14:case"end":return e.stop()}},e,t)}))()},getIndexInArr:function(t){for(var e="",i=0;i<t.length;i++)t[i].id?(e+=t[i].id,i<t.length-1&&(e+=",")):","==e[e.length-1]&&(e=e.substring(0,e.length-1));return e},delPartner:function(){var t=this;return c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.delPartner({data:{id:t.info.id,shopId:t.shopId}});case 2:t.list.splice(t.detailIndex,1),t.$store.commit("setWin",{title:"提示信息",content:"删除成功",winType:"alert"});case 4:case"end":return e.stop()}},e,t)}))()},addPartner:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.addPartner({data:{nickName:t.coopName,sort:t.sort,description:t.description,minImage:t.bigImgUrl,image:JSON.stringify(t.imgList),shopId:t.shopId}});case 2:i=e.sent,t.$store.commit("setWin",{title:"提示信息",content:"添加成功",winType:"alert"}),t.list.push(i),i.imageNum=i.image.length,t.list=s.a.sortByAll(t.list);case 7:case"end":return e.stop()}},e,t)}))()}},mounted:function(){window.innerWidth<1440&&(this.widthWin="1000",this.hauto="560"),o.a.uploadFn=this.fileBannerChange;var t=r.a.session("userShop");t&&t.accessToken&&t.currentShop?(this.shopId=t.currentShop.id,this.brandId=t.currentShop.brandId,this.uploadUrl=t.uploadUrl):this.$router.push("/login"),t.currentShop&&3==t.currentShop.ischain&&(this.cpPower=!0),t.currentShop&&0==t.currentShop.ischain&&(this.cpPower=!0),this.getList()},components:{win:function(){return i.e("win").then(i.bind(null,"f60a"))},"sub-add":function(){return i.e("subadd").then(i.bind(null,"e7ea"))}}},d=(i("6abc"),i("d801")),m=Object(d.a)(l,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"alert-win"},[n("div",{staticClass:"dx-cp",attrs:{id:"cooperating-partner"}},[t.cpPower?n("div",{staticClass:"addc fl",on:{click:function(e){t.open()}}},[t._m(0),t._v(" "),n("div",{staticStyle:{color:"#4F4F50","margin-top":"30px"}},[t._v("新增合作品牌")])]):t._e(),t._v(" "),t._l(t.list,function(e,i){return[n("div",{key:i,staticClass:"cps fl",on:{click:function(n){t.open(e.id,i)}}},[n("div",{staticClass:"num"},[t._v("\n\t\t\t\t\t"+t._s(i+1)+"\n\t\t\t\t")]),t._v(" "),n("div",{staticClass:"name"},[t._v("\n\t\t\t\t\t"+t._s(e.nickName)+"\n\t\t\t\t")]),t._v(" "),n("div",{staticClass:"fl",staticStyle:{"padding-left":"16px",color:"#666362",height:"40px","line-height":"40px","font-size":"16px"}},[t._v("\n\t\t\t\t\t"+t._s(e.imageNum)+"张图\n\t\t\t\t")])])]})],2),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.packageWin?n("win",{attrs:{width:t.widthWin,height:t.hauto,ok:t.ok,cancel:t.cancel},on:{winEvent:t.closeWin}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),t._v(" "),n("div",{attrs:{slot:"content",id:"alert-win"},slot:"content"},[n("div",{staticClass:"left"},[n("div",{staticClass:"options"},[n("div",{staticClass:"fl required",staticStyle:{margin:"0 40px"}},[t._v("品牌名称")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.coopName,expression:"coopName"}],staticClass:"input fl",staticStyle:{border:"1px solid #7A7B7C",width:"220px"},attrs:{type:"text",maxlength:"20"},domProps:{value:t.coopName},on:{input:function(e){e.target.composing||(t.coopName=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"options isGray"},[n("div",{staticClass:"fl required",staticStyle:{margin:"0 40px 0 68px"}},[t._v("排序")]),t._v(" "),n("sub-add",{attrs:{bindnum:t.sort,maxnum:255,minnum:1},on:{toClick:function(e){t.sort=arguments[0]}}})],1),t._v(" "),n("div",{staticClass:"options",staticStyle:{height:"170px"}},[n("div",{staticClass:"fl required",staticStyle:{margin:"0 40px"}},[t._v("品牌介绍")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"describe cpdes",attrs:{maxlength:"100",placeholder:"请添加品牌描述,100字"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"options "},[n("div",{staticClass:"fl required",staticStyle:{margin:"0 40px 0 12px"}},[t._v("添加缩略图片")]),t._v(" "),t.bigImgUrl?n("div",{staticClass:"showImg",staticStyle:{position:"relative","background-color":"#F5F6F7"}},[""==t.bigImgUrl?n("img",{staticStyle:{cursor:"pointer",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",width:"47px",height:"47px"},attrs:{src:i("f518")}}):t._e(),t._v(" "),""!=t.bigImgUrl?n("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:"缩略图",src:t.uploadUrl+t.bigImgUrl}}):t._e(),t._v(" "),n("div",{staticClass:"hoverImg"},[n("a",{staticClass:"yellow updateImg",staticStyle:{width:"100px",height:"40px","line-height":"40px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},attrs:{href:"javascript:void(0);"}},[t._v("编辑\n\t\t\t\t\t\t\t\t\t"),n("form",{attrs:{enctype:"multipart/form-data",id:"bigImg"}},[n("input",{attrs:{type:"file",id:"bigImg_upload",accept:"image/jpeg,image/png,image/gif,image/tiff",name:"image"},on:{change:t.fileNameChange}})])])])]):n("div",{staticClass:"showImg updateImg",staticStyle:{position:"relative","background-color":"#F5F6F7"}},[""==t.bigImgUrl?n("img",{staticStyle:{cursor:"pointer",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",width:"47px",height:"47px"},attrs:{src:i("f518")}}):t._e(),t._v(" "),n("form",{attrs:{enctype:"multipart/form-data",id:"bigImg"}},[n("input",{attrs:{type:"file",id:"bigImg_upload",accept:"image/jpeg,image/png,image/gif,image/tiff",name:"image"},on:{change:t.fileNameChange}})]),t._v(" "),""!=t.bigImgUrl?n("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:"缩略图",src:t.uploadUrl+t.bigImgUrl}}):t._e()])]),t._v(" "),n("div",{staticClass:"options"},[n("div",{staticClass:"fl",staticStyle:{margin:"0 40px 0 230px",color:"#616161"}},[t._v("规格750*400")])])]),t._v(" "),n("div",{staticClass:"right"},[n("div",{staticClass:"required fl",staticStyle:{width:"100%",height:"30px","line-height":"30px","padding-left":"40px","margin-top":"20px"}},[t._v("添加详情图片")]),t._v(" "),n("div",{staticClass:" fl",staticStyle:{color:"#616161",height:"20px","line-height":"20px",width:"100%","padding-left":"40px","margin-bottom":"5px"}},[t._v("规格750*1106(最多10张)")]),t._v(" "),n("div",{staticClass:"show-imgs"},[t._l(t.imgList,function(e,i){return[n("div",{key:i,staticClass:"cps-img"},[n("div",{staticClass:"c-imgs"},[n("div",{staticClass:"mesking"},[n("div",{staticStyle:{width:"64%",height:"30px","line-height":"30px","margin-top":"45px","margin-left":"18%","background-color":"red",position:"relative"}},[n("a",{staticClass:"yellow updateImg",staticStyle:{width:"100%",height:"100%","line-height":"30px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.changeIndex(i)}}},[t._v("编辑\n\t\t\t\t\t\t\t\t\t\t\t\t"),n("form",{attrs:{enctype:"multipart/form-data",id:"bannerImgs"+i}},[n("input",{attrs:{type:"file",id:"bannerImgs_upload"+i,accept:"image/jpeg,image/png,image/gif,image/tiff",name:"image"},on:{change:function(e){t.changeImgList(i)}}})])])]),t._v(" "),n("a",{staticClass:"gray",staticStyle:{width:"64%",height:"30px","line-height":"30px","margin-top":"10px","margin-left":"18%"},attrs:{href:"javascript:void(0);"},on:{click:function(n){t.delImageInList(i,e)}}},[t._v("删除")])]),t._v(" "),n("img",{attrs:{src:t.uploadUrl+e.imageName}})]),t._v(" "),n("div",{staticClass:"operates"},[n("sub-add",{attrs:{bindnum:e.sort,maxnum:255,minnum:1},on:{toClick:function(t){e.sort=arguments[0]}}})],1)])]}),t._v(" "),t.imgList.length<10?n("div",{staticClass:"one-cimgs updateImg"},[n("img",{staticStyle:{cursor:"pointer",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"},attrs:{src:i("f518")}}),t._v(" "),n("form",{attrs:{enctype:"multipart/form-data",id:"bannerImg"}},[n("input",{attrs:{type:"file",id:"bannerImg_upload",accept:"image/jpeg,image/png,image/gif,image/tiff",name:"image"},on:{change:t.fileBannerChange}})])]):t._e()],2)])])]):t._e()],1)],1)},n,!1,null,"6dda3f19",null);e.default=m.exports},f518:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAvCAYAAABzJ5OsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAKxJREFUeNrs2LENgzAQhWE7ygAZgQ2yApsk9S1hGMJeB7ERGzhHh+w0EXdF0P8ky9IV8BVH8Yi11mCdUsqg1/s4E5HJ+j334JMdn5qZOf4W/jjgwYMHDx48ePDgwYMHD/7XxJxzV5aNOuyrmc0eBfxbWfZIYm2ugt/XZtOzGj/3oefZzFbzD9bpj9mo13KciUhkbcCDBw8ePHjw4MGDBw8e/MkC7hGPUt/lI8AAt9oYPL6CVYkAAAAASUVORK5CYII="}}]);