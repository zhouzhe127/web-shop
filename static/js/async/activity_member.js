(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_member"],{"8c7f":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"fissoin"}},[e._m(0),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[e._v("活动标题")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.activityName,expression:"activityName"}],staticClass:"name",attrs:{type:"text",placeholder:"请输入活动标题"},domProps:{value:e.activityName},on:{input:function(t){t.target.composing||(e.activityName=t.target.value)}}})])]),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("活动时间")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[i("calendar",{ref:"startCal",staticClass:"fl",attrs:{pObj:e.startObj},on:{throwTime:e.getStartTime}}),e._v(" "),i("span",{staticClass:"fl",staticStyle:{width:"40px","text-align":"center","margin-right":"0"}},[e._v("-")]),e._v(" "),i("calendar",{ref:"endCal",staticClass:"fl",attrs:{pObj:e.endObj},on:{throwTime:e.getEndTime}})],1),e._v(" "),i("span",{staticClass:"fl",staticStyle:{"text-align":"left","text-indent":"20px",color:"#A3A3A3"}},[e._v("共"+e._s(e.returnInt)+"天")])])]),e._v(" "),e._m(1),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[e._v("会员日设置")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("use-time",{attrs:{useDate:e.useDate},on:{getTime:e.getResult}})],1)]),e._v(" "),e._m(2),e._v(" "),i("div",{staticClass:"rules"},[i("div",{staticClass:"ruleList"},e._l(e.ruleObj,function(t,s){return i("span",{class:e.ruleIndex==s?"active":"",on:{click:function(t){e.getDetails(s)}}},[e._v(e._s(t.levelName))])})),e._v(" "),e._l(e.ruleObj,function(t,s){return e.ruleIndex==s?i("div",{staticClass:"rulecontent"},[i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("享有会员折扣")]),e._v(" "),i("onOff",{key:1,attrs:{status:t.isDiscount},on:{statusChange:e.openflipSwitch}})],1),e._v(" "),t.isDiscount?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("折扣率")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("section",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.discountParam,expression:"item.discountParam"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入正整数",maxlength:"2",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.discountParam},on:{input:function(i){i.target.composing||e.$set(t,"discountParam",i.target.value)}}}),e._v(" "),i("span",[e._v("%")])])])]):e._e(),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("享有积分翻倍")]),e._v(" "),i("onOff",{key:1,attrs:{status:t.isDouble},on:{statusChange:e.doubleIntegral}})],1),e._v(" "),t.isDouble?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("积分获取")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("singleSelect",{key:"id",attrs:{index:t.pointType,styles:{width:"108px",border:"1px solid #cecdcd",marginRight:"8px"},list:e.list,name:"name"},on:{selOn:e.haveIndex}})],1)]):e._e(),e._v(" "),1==t.isDouble&&0==t.pointType?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("设置改等级积分比例")]),e._v(" "),i("div",{staticClass:"fl setinp"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.cash,expression:"item.cash"}],staticClass:"fl",attrs:{type:"text",placeholder:"请输入现金",onkeyup:"value=value.replace(/[^\\d.]/g,'')",maxlength:"6"},domProps:{value:t.cash},on:{blur:function(t){e.formatValue("cash")},input:function(i){i.target.composing||e.$set(t,"cash",i.target.value)}}}),e._v(" "),i("i",{staticClass:"fl colon"},[e._v(":")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.point,expression:"item.point"}],staticClass:"fl",attrs:{type:"text",placeholder:"请输入积分",onkeyup:"value=value.replace(/[^\\d]/g,'')",maxlength:"8"},domProps:{value:t.point},on:{input:function(i){i.target.composing||e.$set(t,"point",i.target.value)}}})])]):e._e(),e._v(" "),1==t.isDouble&&1==t.pointType?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("获得基础积分")]),e._v(" "),i("div",{staticClass:"fl setinp"},[i("section",{staticClass:"sinp"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.pointMultiples,expression:"item.pointMultiples"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入倍数",maxlength:"5",onkeyup:"value=value.replace(/[^\\d.]/g,'')"},domProps:{value:t.pointMultiples},on:{blur:function(t){e.formatValue("pointMultiples")},input:function(i){i.target.composing||e.$set(t,"pointMultiples",i.target.value)}}}),e._v(" "),i("span",[e._v("倍")])]),e._v(" "),e._m(3,!0)])]):e._e()]):e._e()})],2),e._v(" "),i("div",{staticClass:"online-box clearfix",staticStyle:{"padding-left":"100px"}},[i("a",{staticClass:"gray fl",staticStyle:{width:"200px","margin-right":"10px","background-color":"#a7a7a7"},attrs:{href:"javascript:void(0);"},on:{click:e.closePage}},[e._v("取消")]),e._v(" "),i("a",{staticClass:"gray fl",staticStyle:{width:"200px","margin-right":"10px"},attrs:{href:"javascript:void(0);"},on:{click:function(t){e.saveConfig(" 0 ")}}},[e._v("保存")]),e._v(" "),""==e.editId?i("a",{staticClass:"yellow fl",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(t){e.saveConfig(" 1 ")}}},[e._v("发布")]):e._e()])])};s._withStripped=!0;var a=i("81a2"),n=i("f6ce"),r=i("bbb9");function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function s(a,n){try{var r=t[a](n),l=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(l).then(function(e){s("next",e)},function(e){s("throw",e)});e(l)}("next")})}}var u={data:function(){return{startObj:{time:r.a.getTime({time:new Date}).start},endObj:{time:(new Date).getTime()},dates:(new Date).getTime(),returnInt:1,list:[{name:"按比例",id:0},{name:"按积分规则",id:1}],useDate:{list:["指定每周使用时段","指定每月使用日期和时段 "],index:0,week:[{startslotH:"12",startslotM:"00",endslotH:"00",endslotM:"00",isNextDay:!1,week:[]}],month:[{startslotH:"12",startslotM:"00",endslotH:"00",endslotM:"00",isNextDay:!1,month:[]}],show:!1},activityName:"",discount:"",editId:"",ruleId:"",gradeList:[],ruleIndex:0,ruleObj:[]}},methods:{closePage:function(){this.$router.push("/admin/activity")},openflipSwitch:function(e){this.ruleObj[this.ruleIndex].isDiscount=e},doubleIntegral:function(e){this.ruleObj[this.ruleIndex].isDouble=e},getStartTime:function(e){this.startObj.time=e},getEndTime:function(e){this.endObj.time=e},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},valiData:function(e,t,i){this.$store.commit("setWin",{content:e,title:t,winType:i})},transformDate:function(e){return r.a.format(new Date(e),"yyyy-MM-dd")},haveIndex:function(e){this.ruleObj[this.ruleIndex].pointType=e},getResult:function(e){this.useDate=e},changeArrToNeed:function(e,t){for(var i=[],s=0;s<e.length;s++){var a={};a.startslotH=e[s].startslot.split(":")[0],a.startslotM=e[s].startslot.split(":")[1],a.endslotH=e[s].endslot.split(":")[0],a.endslotM=e[s].endslot.split(":")[1],a.isNextDay=e[s].isNextDay,"w"==t?a.week=e[s].week:"m"==t&&(a.month=e[s].month),i.push(a)}return i},checkForm:function(){var e=[],t="";if(""==this.activityName)return this.valiData("活动标题不能为空!"),!1;0==this.useDate.index?(e=this.useDate.week,t="使用时段请选择日期(周)"):1==this.useDate.index&&(e=this.useDate.month,t="使用时段请选择日期(月)");for(var i=0;i<e.length;i++)if(0==this.useDate.index){if(0==e[i].week.length)return this.valiData(t),!1}else if(1==this.useDate.index&&0==e[i].month.length)return this.valiData(t),!1;for(var s=0;s<this.ruleObj.length;s++){if(this.ruleObj[s].isDiscount&&""==this.ruleObj[s].discountParam)return this.valiData("请填写"+this.ruleObj[s].levelName+"的折扣率!"),!1;if(this.ruleObj[s].isDouble&&0==this.ruleObj[s].pointType){if(""==this.ruleObj[s].cash)return this.valiData("请填写"+this.ruleObj[s].levelName+"的比例现金!"),!1;if(""==this.ruleObj[s].point)return this.valiData("请填写"+this.ruleObj[s].levelName+"的比例积分!"),!1}if(this.ruleObj[s].isDouble&&1==this.ruleObj[s].pointType){if(""==this.ruleObj[s].pointMultiples)return this.valiData("请填写"+this.ruleObj[s].levelName+"的积分倍数!"),!1;if(Number(this.ruleObj[s].pointMultiples)<=0||Number(this.ruleObj[s].pointMultiples)>99.99)return this.valiData(this.ruleObj[s].levelName+"的积分倍数区间应为0.01～99.99!"),!1}}return!0},changeArr:function(e,t){for(var i=[],s=0;s<e.length;s++){var a={};"w"==t?a.week=e[s].week.sort(function(e,t){return e-t}):"m"==t&&(a.month=e[s].month.sort(function(e,t){return e-t})),a.isNextDay=e[s].isNextDay;var n=e[s].startslotH+":"+e[s].startslotM,r=e[s].endslotH+":"+e[s].endslotM;a.startslot=n,a.endslot=r,i.push(a)}return i},saveConfig:function(e){this.checkForm()&&(""==this.editId?this.addConfig(e):this.ediConfig(e))},addConfig:function(e){var t=this;return o(regeneratorRuntime.mark(function i(){var s,n,r,o,u,c,v,d,p,m,f;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:for(s={},0==t.useDate.index&&(s.type="week",s.list=t.changeArr(t.useDate.week,"w")),1==t.useDate.index&&(s.type="month",s.list=t.changeArr(t.useDate.month,"m")),n={},r=!0,o=!1,u=void 0,i.prev=7,c=t.ruleObj[Symbol.iterator]();!(r=(v=c.next()).done);r=!0)d=v.value,p=d.levelId,n=Object.assign(n,l({},p,{levelId:d.levelId,levelName:d.levelName,isDiscount:Number(d.isDiscount),discountParam:d.discountParam,isDouble:Number(d.isDouble),pointType:d.pointType,point:d.point,cash:d.cash,pointMultiples:d.pointMultiples}));i.next=15;break;case 11:i.prev=11,i.t0=i.catch(7),o=!0,u=i.t0;case 15:i.prev=15,i.prev=16,!r&&c.return&&c.return();case 18:if(i.prev=18,!o){i.next=21;break}throw u;case 21:return i.finish(18);case 22:return i.finish(15);case 23:return(m=[]).push({couponIds:{useTimeRule:s,levelRule:n}}),i.next=28,a.a.fissionActivity({data:{type:5,mouldType:0,name:t.activityName,objectType:2,startTime:parseInt(t.startObj.time/1e3),endTime:parseInt(t.endObj.time/1e3),isAuto:e,rule:JSON.stringify(m)}});case 28:f=0==e?"保存成功":"发布成功",t.valiData(f),t.closePage();case 31:case"end":return i.stop()}},i,t,[[7,11,15,23],[16,,18,22]])}))()},ediConfig:function(e){var t=this;return o(regeneratorRuntime.mark(function i(){var s,n,r,o,u,c,v,d,p,m,f,h,b;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:for((s={}).type=5,s.mouldType=0,s.name=t.activityName,s.objectType=2,s.startTime=parseInt(t.startObj.time/1e3),s.endTime=parseInt(t.endObj.time/1e3),s.isAuto=e,s.rule=[],n={},0==t.useDate.index&&(n.type="week",n.list=t.changeArr(t.useDate.week,"w")),1==t.useDate.index&&(n.type="month",n.list=t.changeArr(t.useDate.month,"m")),r={},o=!0,u=!1,c=void 0,i.prev=16,v=t.ruleObj[Symbol.iterator]();!(o=(d=v.next()).done);o=!0)p=d.value,m=p.levelId,r=Object.assign(r,l({},m,{levelId:p.levelId,levelName:p.levelName,isDiscount:Number(p.isDiscount),discountParam:p.discountParam,isDouble:Number(p.isDouble),pointType:p.pointType,point:p.point,cash:p.cash,pointMultiples:p.pointMultiples}));i.next=24;break;case 20:i.prev=20,i.t0=i.catch(16),u=!0,c=i.t0;case 24:i.prev=24,i.prev=25,!o&&v.return&&v.return();case 27:if(i.prev=27,!u){i.next=30;break}throw c;case 30:return i.finish(27);case 31:return i.finish(24);case 32:return f=[],h={id:t.ruleId,couponIds:{useTimeRule:n,levelRule:r}},f.push(h),s.rule=f,i.next=38,a.a.fissionActivity({data:{activityId:t.editId,data:JSON.stringify(s)}});case 38:b=0==e?"保存成功":"发布成功",t.valiData(b),t.closePage();case 41:case"end":return i.stop()}},i,t,[[16,20,24,32],[25,,27,31]])}))()},getActivityDetail:function(e){var t=this;return o(regeneratorRuntime.mark(function i(){var s,n,l,o,u,c,v,d,p;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.a.getActivityDetails({data:{activityId:e.id}});case 2:if(!(s=i.sent)){i.next=52;break}t.activityName=s.name,t.startObj.time=1e3*s.startTime,t.endObj.time=1e3*s.endTime,t.ruleId=s.rule[0].id,r.a.isEmptyObject(s.rule[0].couponIds.useTimeRule)&&(t.useDate.index=0),r.a.isEmptyObject(s.rule[0].couponIds.useTimeRule)||"week"!=s.rule[0].couponIds.useTimeRule.type||(t.useDate.index=0),r.a.isEmptyObject(s.rule[0].couponIds.useTimeRule)||"month"!=s.rule[0].couponIds.useTimeRule.type||(t.useDate.index=1),0==t.useDate.index&&s.rule[0].couponIds.useTimeRule&&s.rule[0].couponIds.useTimeRule.list&&(t.useDate.week=t.changeArrToNeed(s.rule[0].couponIds.useTimeRule.list,"w")),1==t.useDate.index&&s.rule[0].couponIds.useTimeRule&&s.rule[0].couponIds.useTimeRule.list&&(t.useDate.month=t.changeArrToNeed(s.rule[0].couponIds.useTimeRule.list,"m")),n=s.rule[0].couponIds.levelRule,l=!0,o=!1,u=void 0,i.prev=17,c=t.ruleObj[Symbol.iterator]();case 19:if(l=(v=c.next()).done){i.next=38;break}d=v.value,i.t0=regeneratorRuntime.keys(n);case 22:if((i.t1=i.t0()).done){i.next=35;break}if(p=i.t1.value,d.levelId!=p){i.next=33;break}return d.cash=n[p].cash,d.discountParam=n[p].discountParam,d.isDiscount=Boolean(n[p].isDiscount),d.isDouble=Boolean(n[p].isDouble),d.point=n[p].point,d.pointMultiples=n[p].pointMultiples,d.pointType=n[p].pointType,i.abrupt("break",35);case 33:i.next=22;break;case 35:l=!0,i.next=19;break;case 38:i.next=44;break;case 40:i.prev=40,i.t2=i.catch(17),o=!0,u=i.t2;case 44:i.prev=44,i.prev=45,!l&&c.return&&c.return();case 47:if(i.prev=47,!o){i.next=50;break}throw u;case 50:return i.finish(47);case 51:return i.finish(44);case 52:case"end":return i.stop()}},i,t,[[17,40,44,52],[45,,47,51]])}))()},getList:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var i,s,n,r,l,o,u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.memberGetList({data:{}});case 2:for(i=t.sent,e.gradeList=i,s=!0,n=!1,r=void 0,t.prev=7,l=e.gradeList[Symbol.iterator]();!(s=(o=l.next()).done);s=!0)u=o.value,c={levelId:u.id,levelName:u.name,isDiscount:!1,discountParam:"",isDouble:!1,pointType:0,point:"",cash:"",pointMultiples:""},e.ruleObj.push(c);t.next=15;break;case 11:t.prev=11,t.t0=t.catch(7),n=!0,r=t.t0;case 15:t.prev=15,t.prev=16,!s&&l.return&&l.return();case 18:if(t.prev=18,!n){t.next=21;break}throw r;case 21:return t.finish(18);case 22:return t.finish(15);case 23:case"end":return t.stop()}},t,e,[[7,11,15,23],[16,,18,22]])}))()},getDetails:function(e){this.ruleIndex=e},formatValue:function(e){this.ruleObj[this.ruleIndex][e]=r.a.toFloatStr(this.ruleObj[this.ruleIndex][e],2)}},components:{"can-multi":function(){return i.e("can_multi").then(i.bind(null,"742e"))},onOff:function(){return i.e("on_off").then(i.bind(null,"034b"))},singleSelect:function(){return i.e("mul_select").then(i.bind(null,"7231"))},"use-time":function(){return i.e("activity_usetime").then(i.bind(null,"e204"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange"},mounted:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){e.closePage()}}]),t.next=3,e.getList();case 3:(i=n.a.session("activityInfo"))&&(e.editId=i.id,e.getActivityDetail(i));case 5:case"end":return t.stop()}},t,e)}))()},beforeDestroy:function(){n.a.session("activityInfo",null)}},c=(i("f5af"),i("7610")),v=Object(c.a)(u,s,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"set-line"},[t("div",{staticClass:"titles"},[this._v("活动设置")]),this._v(" "),t("div",{staticClass:"line"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"online-box clearfix"},[t("span",{staticClass:"online-sub fl required"},[this._v("活动对象")]),this._v(" "),t("div",{staticClass:"rightHalf"},[t("span",{staticClass:"fans"},[this._v("全体会员")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"set-line"},[t("div",{staticClass:"titles"},[this._v("营销规则设置")]),this._v(" "),t("div",{staticClass:"line"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"fl handle-tips"},[t("i"),this._v(" 允许输入区间：0.01~99.99\n\t\t\t\t\t")])}],!1,null,"65ea8406",null);v.options.__file="src\\module\\marketing_tools\\activity_member.vue";t.default=v.exports},ca07:function(e,t,i){},f5af:function(e,t,i){"use strict";var s=i("ca07");i.n(s).a}}]);