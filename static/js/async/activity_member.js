(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_member"],{"1eb6":function(e,t,i){"use strict";var s=i("e9bc");i.n(s).a},e9bc:function(e,t,i){},ed4b:function(e,t,i){"use strict";i.r(t);var s=i("81a2"),n=i("f6ce"),a=i("bbb9");function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function s(n,a){try{var r=t[n](a),l=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(l).then(function(e){s("next",e)},function(e){s("throw",e)});e(l)}("next")})}}var u={data:function(){return{startObj:{time:a.a.getTime({time:new Date}).start},endObj:{time:(new Date).getTime()},dates:(new Date).getTime(),returnInt:1,list:[{name:"按比例",id:0},{name:"按积分规则",id:1}],useDate:{list:["指定每周使用时段","指定每月使用日期和时段 "],index:0,week:[{startslotH:"12",startslotM:"00",endslotH:"00",endslotM:"00",isNextDay:!1,week:[]}],month:[{startslotH:"12",startslotM:"00",endslotH:"00",endslotM:"00",isNextDay:!1,month:[]}],show:!1},activityName:"",discount:"",editId:"",ruleId:"",gradeList:[],ruleIndex:0,ruleObj:[],isactivityDetail:!0}},methods:{closePage:function(){this.$router.push("/admin/activity/generalActivity")},openflipSwitch:function(e){this.ruleObj[this.ruleIndex].isDiscount=e},doubleIntegral:function(e){this.ruleObj[this.ruleIndex].isDouble=e},getStartTime:function(e){this.startObj.time=e},getEndTime:function(e){this.endObj.time=e},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},valiData:function(e,t,i){this.$store.commit("setWin",{content:e,title:t,winType:i})},transformDate:function(e){return a.a.format(new Date(e),"yyyy-MM-dd")},haveIndex:function(e){this.ruleObj[this.ruleIndex].pointType=e},getResult:function(e){this.useDate=e},changeArrToNeed:function(e,t){for(var i=[],s=0;s<e.length;s++){var n={};n.startslotH=e[s].startslot.split(":")[0],n.startslotM=e[s].startslot.split(":")[1],n.endslotH=e[s].endslot.split(":")[0],n.endslotM=e[s].endslot.split(":")[1],n.isNextDay=e[s].isNextDay,"w"==t?n.week=e[s].week:"m"==t&&(n.month=e[s].month),i.push(n)}return i},checkForm:function(){var e=[],t="";if(""==this.activityName)return this.valiData("活动标题不能为空!"),!1;0==this.useDate.index?(e=this.useDate.week,t="使用时段请选择日期(周)"):1==this.useDate.index&&(e=this.useDate.month,t="使用时段请选择日期(月)");for(var i=0;i<e.length;i++)if(0==this.useDate.index){if(0==e[i].week.length)return this.valiData(t),!1}else if(1==this.useDate.index&&0==e[i].month.length)return this.valiData(t),!1;for(var s=0;s<this.ruleObj.length;s++){if(this.ruleObj[s].isDiscount&&""==this.ruleObj[s].discountParam)return this.valiData("请填写"+this.ruleObj[s].levelName+"的折扣率!"),!1;if(this.ruleObj[s].isDouble&&0==this.ruleObj[s].pointType){if(""==this.ruleObj[s].cash)return this.valiData("请填写"+this.ruleObj[s].levelName+"的比例现金!"),!1;if(""==this.ruleObj[s].point)return this.valiData("请填写"+this.ruleObj[s].levelName+"的比例积分!"),!1}if(this.ruleObj[s].isDouble&&1==this.ruleObj[s].pointType){if(""==this.ruleObj[s].pointMultiples)return this.valiData("请填写"+this.ruleObj[s].levelName+"的积分倍数!"),!1;if(Number(this.ruleObj[s].pointMultiples)<=0||Number(this.ruleObj[s].pointMultiples)>99.99)return this.valiData(this.ruleObj[s].levelName+"的积分倍数区间应为0.01～99.99!"),!1}}return!0},changeArr:function(e,t){for(var i=[],s=0;s<e.length;s++){var n={};"w"==t?n.week=e[s].week.sort(function(e,t){return e-t}):"m"==t&&(n.month=e[s].month.sort(function(e,t){return e-t})),n.isNextDay=e[s].isNextDay;var a=e[s].startslotH+":"+e[s].startslotM,r=e[s].endslotH+":"+e[s].endslotM;n.startslot=a,n.endslot=r,i.push(n)}return i},saveConfig:function(e){this.checkForm()&&(""==this.editId?this.addConfig(e):this.ediConfig(e))},addConfig:function(e){var t=this;return l(regeneratorRuntime.mark(function i(){var n,a,l,u,o,c,v,d,p,m,h;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:for(n={},0==t.useDate.index&&(n.type="week",n.list=t.changeArr(t.useDate.week,"w")),1==t.useDate.index&&(n.type="month",n.list=t.changeArr(t.useDate.month,"m")),a={},l=!0,u=!1,o=void 0,i.prev=7,c=t.ruleObj[Symbol.iterator]();!(l=(v=c.next()).done);l=!0)d=v.value,p=d.levelId,a=Object.assign(a,r({},p,{levelId:d.levelId,levelName:d.levelName,isDiscount:Number(d.isDiscount),discountParam:d.discountParam,isDouble:Number(d.isDouble),pointType:d.pointType,point:d.point,cash:d.cash,pointMultiples:d.pointMultiples}));i.next=15;break;case 11:i.prev=11,i.t0=i.catch(7),u=!0,o=i.t0;case 15:i.prev=15,i.prev=16,!l&&c.return&&c.return();case 18:if(i.prev=18,!u){i.next=21;break}throw o;case 21:return i.finish(18);case 22:return i.finish(15);case 23:return(m=[]).push({couponIds:{useTimeRule:n,levelRule:a}}),i.next=28,s.a.fissionActivity({data:{type:5,mouldType:0,name:t.activityName,objectType:2,startTime:parseInt(t.startObj.time/1e3),endTime:parseInt(t.endObj.time/1e3),isAuto:e,rule:JSON.stringify(m)}});case 28:h=0==e?"保存成功":"发布成功",t.valiData(h),t.closePage();case 31:case"end":return i.stop()}},i,t,[[7,11,15,23],[16,,18,22]])}))()},ediConfig:function(e){var t=this;return l(regeneratorRuntime.mark(function i(){var n,a,l,u,o,c,v,d,p,m,h,f,b;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:for((n={}).type=5,n.mouldType=0,n.name=t.activityName,n.objectType=2,n.startTime=parseInt(t.startObj.time/1e3),n.endTime=parseInt(t.endObj.time/1e3),n.isAuto=e,n.rule=[],a={},0==t.useDate.index&&(a.type="week",a.list=t.changeArr(t.useDate.week,"w")),1==t.useDate.index&&(a.type="month",a.list=t.changeArr(t.useDate.month,"m")),l={},u=!0,o=!1,c=void 0,i.prev=16,v=t.ruleObj[Symbol.iterator]();!(u=(d=v.next()).done);u=!0)p=d.value,m=p.levelId,l=Object.assign(l,r({},m,{levelId:p.levelId,levelName:p.levelName,isDiscount:Number(p.isDiscount),discountParam:p.discountParam,isDouble:Number(p.isDouble),pointType:p.pointType,point:p.point,cash:p.cash,pointMultiples:p.pointMultiples}));i.next=24;break;case 20:i.prev=20,i.t0=i.catch(16),o=!0,c=i.t0;case 24:i.prev=24,i.prev=25,!u&&v.return&&v.return();case 27:if(i.prev=27,!o){i.next=30;break}throw c;case 30:return i.finish(27);case 31:return i.finish(24);case 32:return h=[],f={id:t.ruleId,couponIds:{useTimeRule:a,levelRule:l}},h.push(f),n.rule=h,i.next=38,s.a.fissionActivity({data:{activityId:t.editId,data:JSON.stringify(n)}});case 38:b=0==e?"保存成功":"发布成功",t.valiData(b),t.closePage();case 41:case"end":return i.stop()}},i,t,[[16,20,24,32],[25,,27,31]])}))()},getActivityDetail:function(e){var t=this;return l(regeneratorRuntime.mark(function i(){var n,r,l,u,o,c,v,d,p,m;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.newgetActivityDetail({data:{activityId:e.id,type:e.type,mouldType:e.mouldType}});case 2:if(!(n=i.sent)){i.next=53;break}t.activityName=n.name,t.startObj.time=1e3*n.startTime,t.endObj.time=1e3*n.endTime,t.ruleId=n.rule[0].id,r=JSON.parse(n.rule[0].couponIds),a.a.isEmptyObject(r.useTimeRule)&&(t.useDate.index=0),a.a.isEmptyObject(r.useTimeRule)||"week"!=r.useTimeRule.type||(t.useDate.index=0),a.a.isEmptyObject(r.useTimeRule)||"month"!=r.useTimeRule.type||(t.useDate.index=1),0==t.useDate.index&&r.useTimeRule&&r.useTimeRule.list&&(t.useDate.week=t.changeArrToNeed(r.useTimeRule.list,"w")),1==t.useDate.index&&r.useTimeRule&&r.useTimeRule.list&&(t.useDate.month=t.changeArrToNeed(r.useTimeRule.list,"m")),l=r.levelRule,u=!0,o=!1,c=void 0,i.prev=18,v=t.ruleObj[Symbol.iterator]();case 20:if(u=(d=v.next()).done){i.next=39;break}p=d.value,i.t0=regeneratorRuntime.keys(l);case 23:if((i.t1=i.t0()).done){i.next=36;break}if(m=i.t1.value,p.levelId!=m){i.next=34;break}return p.cash=l[m].cash,p.discountParam=l[m].discountParam,p.isDiscount=Boolean(l[m].isDiscount),p.isDouble=Boolean(l[m].isDouble),p.point=l[m].point,p.pointMultiples=l[m].pointMultiples,p.pointType=l[m].pointType,i.abrupt("break",36);case 34:i.next=23;break;case 36:u=!0,i.next=20;break;case 39:i.next=45;break;case 41:i.prev=41,i.t2=i.catch(18),o=!0,c=i.t2;case 45:i.prev=45,i.prev=46,!u&&v.return&&v.return();case 48:if(i.prev=48,!o){i.next=51;break}throw c;case 51:return i.finish(48);case 52:return i.finish(45);case 53:case"end":return i.stop()}},i,t,[[18,41,45,53],[46,,48,52]])}))()},getList:function(){var e=this;return l(regeneratorRuntime.mark(function t(){var i,n,a,r,l,u,o,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.memberGetList({data:{}});case 2:for(i=t.sent,e.gradeList=i,n=!0,a=!1,r=void 0,t.prev=7,l=e.gradeList[Symbol.iterator]();!(n=(u=l.next()).done);n=!0)o=u.value,c={levelId:o.id,levelName:o.name,isDiscount:!1,discountParam:"",isDouble:!1,pointType:0,point:"",cash:"",pointMultiples:""},e.ruleObj.push(c);t.next=15;break;case 11:t.prev=11,t.t0=t.catch(7),a=!0,r=t.t0;case 15:t.prev=15,t.prev=16,!n&&l.return&&l.return();case 18:if(t.prev=18,!a){t.next=21;break}throw r;case 21:return t.finish(18);case 22:return t.finish(15);case 23:case"end":return t.stop()}},t,e,[[7,11,15,23],[16,,18,22]])}))()},getDetails:function(e){this.ruleIndex=e},formatValue:function(e){this.ruleObj[this.ruleIndex][e]=a.a.toFloatStr(this.ruleObj[this.ruleIndex][e],2)}},components:{"can-multi":function(){return i.e("can_multi").then(i.bind(null,"742e"))},onOff:function(){return i.e("on_off").then(i.bind(null,"034b"))},singleSelect:function(){return i.e("mul_select").then(i.bind(null,"7231"))},"use-time":function(){return i.e("activity_usetime").then(i.bind(null,"9c64"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange"},mounted:function(){var e=this;return l(regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){e.closePage()}}]),t.next=3,e.getList();case 3:i=n.a.session("activityInfo"),n.a.session("activityDetail")&&(e.isactivityDetail=!1),i&&(e.editId=i.id,e.getActivityDetail(i));case 7:case"end":return t.stop()}},t,e)}))()},beforeDestroy:function(){n.a.session("activityInfo",null),n.a.session("activityDetail",null)}},o=(i("1eb6"),i("d801")),c=Object(o.a)(u,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"fissoin"}},[e._m(0),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[e._v("活动名称")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("el-input",{attrs:{maxlength:"10",placeholder:"请输入活动标题"},model:{value:e.activityName,callback:function(t){e.activityName=t},expression:"activityName"}})],1)]),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("活动时间")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[i("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp"},on:{change:e.getStartTime},model:{value:e.startObj.time,callback:function(t){e.$set(e.startObj,"time",t)},expression:"startObj.time"}}),e._v(" "),i("span",{staticClass:"fl",staticStyle:{width:"40px","text-align":"center","margin-right":"0"}},[e._v("-")]),e._v(" "),i("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp"},on:{change:e.getEndTime},model:{value:e.endObj.time,callback:function(t){e.$set(e.endObj,"time",t)},expression:"endObj.time"}})],1),e._v(" "),i("span",{staticClass:"fl",staticStyle:{"text-align":"left","text-indent":"20px",color:"#A3A3A3"}},[e._v("共"+e._s(e.returnInt)+"天")])])]),e._v(" "),e._m(1),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[e._v("会员日设置")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("use-time",{attrs:{useDate:e.useDate},on:{getTime:e.getResult}})],1)]),e._v(" "),e._m(2),e._v(" "),i("div",{staticClass:"rules"},[i("div",{staticClass:"ruleList"},e._l(e.ruleObj,function(t,s){return i("span",{class:e.ruleIndex==s?"active":"",on:{click:function(t){e.getDetails(s)}}},[e._v(e._s(t.levelName))])})),e._v(" "),e._l(e.ruleObj,function(t,s){return e.ruleIndex==s?i("div",{staticClass:"rulecontent"},[i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("享有会员折扣")]),e._v(" "),i("onOff",{key:1,attrs:{status:t.isDiscount},on:{statusChange:e.openflipSwitch}})],1),e._v(" "),t.isDiscount?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("折扣率")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("el-input",{staticStyle:{width:"179px"},attrs:{placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.discountParam,callback:function(i){e.$set(t,"discountParam",i)},expression:"item.discountParam"}},[i("template",{slot:"suffix"},[e._v("%")])],2)],1)]):e._e(),e._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("享有积分翻倍")]),e._v(" "),i("onOff",{key:1,attrs:{status:t.isDouble},on:{statusChange:e.doubleIntegral}})],1),e._v(" "),t.isDouble?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("积分获取")]),e._v(" "),i("div",{staticClass:"rightHalf"},[i("singleSelect",{key:"id",attrs:{index:t.pointType,styles:{width:"108px",border:"1px solid #cecdcd",marginRight:"8px"},list:e.list,name:"name"},on:{selOn:e.haveIndex}})],1)]):e._e(),e._v(" "),1==t.isDouble&&0==t.pointType?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("设置该等级积分比例")]),e._v(" "),i("div",{staticClass:"fl setinp"},[i("el-input",{staticClass:"fl",staticStyle:{width:"auto"},attrs:{maxlength:"6",placeholder:"请输入现金",onkeyup:"value=value.replace(/[^\\d.]/g,'')"},on:{blur:function(t){e.formatValue("cash")}},model:{value:t.cash,callback:function(i){e.$set(t,"cash",i)},expression:"item.cash"}}),e._v(" "),i("i",{staticClass:"fl colon"},[e._v(":")]),e._v(" "),i("el-input",{staticClass:"fl",staticStyle:{width:"auto"},attrs:{maxlength:"8",placeholder:"请输入积分",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.point,callback:function(i){e.$set(t,"point",i)},expression:"item.point"}})],1)]):e._e(),e._v(" "),1==t.isDouble&&1==t.pointType?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[e._v("获得基础积分")]),e._v(" "),i("div",{staticClass:"fl setinp"},[i("el-input",{staticClass:"fl",staticStyle:{width:"179px"},attrs:{placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d.]/g,'')"},on:{blur:function(t){e.formatValue("pointMultiples")}},model:{value:t.pointMultiples,callback:function(i){e.$set(t,"pointMultiples",i)},expression:"item.pointMultiples"}},[i("template",{slot:"suffix"},[e._v("倍")])],2),e._v(" "),e._m(3,!0)],1)]):e._e()]):e._e()})],2),e._v(" "),i("div",{staticClass:"online-box clearfix",staticStyle:{"padding-left":"100px"}},[i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"info",plain:""},on:{click:e.closePage}},[e._v("取消")]),e._v(" "),e.isactivityDetail?i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"info"},on:{click:function(t){e.saveConfig("0")}}},[e._v("保存")]):e._e(),e._v(" "),""==e.editId?i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"primary"},on:{click:function(t){e.saveConfig("1")}}},[e._v("发布")]):e._e()],1)])},[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"set-line"},[t("div",{staticClass:"titles"},[this._v("活动设置")]),this._v(" "),t("div",{staticClass:"line"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"online-box clearfix"},[t("span",{staticClass:"online-sub fl required"},[this._v("活动对象")]),this._v(" "),t("div",{staticClass:"rightHalf"},[t("span",{staticClass:"obj"},[this._v("全体会员")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"set-line"},[t("div",{staticClass:"titles"},[this._v("营销规则设置")]),this._v(" "),t("div",{staticClass:"line"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"fl handle-tips"},[t("i"),this._v(" 允许输入区间：0.01~99.99\n\t\t\t\t\t")])}],!1,null,"d536cbd4",null);t.default=c.exports}}]);