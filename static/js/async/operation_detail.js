(window.webpackJsonp=window.webpackJsonp||[]).push([["operation_detail"],{2708:function(t,e,i){"use strict";i.r(e);var a=i("81a2"),n=i("f6ce"),s=i("bbb9");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function a(n,s){try{var r=e[n](s),o=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(o).then(function(t){a("next",t)},function(t){a("throw",t)});t(o)}("next")})}}var o={data:function(){return{showCom:!1,details:{},allStatus:{1:"未出货",2:"待入货",3:"调度中",4:"已取消",5:"已完成",6:"已完成(异常)"},matTypeHash:{0:"成品",1:"半成品",2:"普通物料"},detailObj:{},detailObjInto:{},outGoods:[],outMaterial:[],enterList:[],enterGoods:[],enterMaterial:[],printShow:!1,printShowInto:!1,mainShow:!0,enterShow:!0,detailId:"",dispatchId:"",dynamic:"",disType:1,selIndex:-1,operate:{name:"",time:""},wareId:"",btnArr:[],outDetails:{},uid:"",isExamine:!1,isBrand:0,wareDetail:{},dialogVisible:!1,isTotalLog:!1,logObj:{id:"",tab:"",type:""}}},components:{detailList:function(){return i.e("operation_detail_list").then(i.bind(null,"0777"))},outputPrint:function(){return i.e("output_shipper_print").then(i.bind(null,"ba23"))},outputPrintInto:function(){return i.e("output_shipper_print").then(i.bind(null,"62ac"))},enterGoods:function(){return i.e("enter_goods").then(i.bind(null,"cd0c"))}},beforeRouteEnter:function(t,e,i){"/admin/inventoryManagement/publicDetails"==e.path?i(function(t){t.isTotalLog=!0}):i()},mounted:function(){var t=this;this.initBtn(),this.detailId=this.$route.query.id;var e=n.a.session("userShop");this.isBrand="3"==e.currentShop.ischain?1:0;var i=n.a.session("clusionToOperationDetail");i&&(this.isExamine=i,n.a.session("clusionToOperationDetail",null)),this.uid=e.user.id,this.init().then(function(){t.isTotalLog&&t.totalLog()})},methods:{initBtn:function(){var t=this;this.btnArr=[{name:"打印",className:"warning",type:5,fn:function(){1==t.disType?t.printShow=!0:2==t.disType&&(t.printShowInto=!0),t.mainShow=!1,t.$store.commit("setPageTools",[])}},{name:"返回",className:"info",type:4,fn:function(){n.a.session("operationRequestDestroy",!0),t.$router.go(-1)}}],this.$store.commit("setPageTools",this.btnArr)},totalLog:function(){if(this.detailId=this.$route.query.id,this.logObj={id:this.$route.query.intoId,tab:this.$route.query.logTab,type:this.$route.query.logType},1==this.logObj.tab)this.selIndex=-1;else for(var t=0;t<this.enterList.length;t++){var e=this.enterList[t];this.logObj.id==e.id&&(this.selIndex=t)}},setInitBtn:function(){var t=this;if(this.initBtn(),!this.isExamine){if(1==this.dynamic){var e,i=[{name:"取消调度",className:"danger",type:5,fn:function(){t.cancelMethod()}},{name:"确认出货",className:"primary",type:4,fn:function(){t.confirmMethod()}}];(e=this.btnArr).unshift.apply(e,i)}if(2==this.dynamic){var a,n=[{name:"入货",className:"primary",type:4,fn:function(){t.$router.push({path:"/admin/operation/enterGoods",query:t.$route.query})}}];(a=this.btnArr).unshift.apply(a,n)}this.$store.commit("setPageTools",this.btnArr)}},openWareWin:function(t){var e=this;return r(regeneratorRuntime.mark(function n(){var s,r,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.wareId=t,n.next=3,a.a.warehouseGetWarehouse({data:{id:e.wareId}});case 3:return s=n.sent,n.next=6,i.e("area_cn").then(i.bind(null,"f529"));case 6:r=n.sent,o=r.default,s.provinceName=o.getNameByCode(s.province),s.cityName=o.getNameByCode(s.city),s.townName=o.getNameByCode(s.town),e.wareDetail=s,e.dialogVisible=!0;case 13:case"end":return n.stop()}},n,e)}))()},handleClose:function(){this.dialogVisible=!1},getEmit:function(){this.printShow=!1,this.printShowInto=!1,this.mainShow=!0,1==this.disType?this.setOrderDetail(this.outDetails,1):this.setOrderDetail(this.enterList[this.selIndex],2),this.$store.commit("setPageTools",this.btnArr)},getDetailObj:function(t){this.showCom=t.showCom},tabClick:function(t){var e=event.target;if("span"==e.tagName.toLocaleLowerCase()){var i=e.getAttribute("data-type"),a=e.getAttribute("data-index");if(1==i)this.selIndex=-1,this.setOrderDetail(this.outDetails,i);else if(2==i){this.selIndex=a;var n=this.enterList[a];this.setOrderDetail(n,i)}}},setOrderDetail:function(t,e){if(1==e){this.outGoods=this.setGoodsList(t.itemDetail.goodsDetail),this.outMaterial=this.setMaterialList(t.itemDetail.materialDetail);var i={goods:this.outGoods,material:this.outMaterial};this.detailObj=i,this.disType=e}if(2==e){this.enterGoods=this.setGoodsListInto(t.itemDetail.goodsDetail),this.enterMaterial=this.setMaterialListInto(t.itemDetail.materialDetail);var a={goods:this.enterGoods,material:this.enterMaterial};this.detailObjInto=a,this.disType=e}this.operate.name=t.operateUname,this.operate.time=this.timeConversion(t.operateTime,1),this.$set(this.details,"operate",this.operate)},init:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i,n,s,r,o,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.getDispatchRecordDetailList({data:{id:t.detailId,shopType:t.isBrand}});case 2:for(i=e.sent,t.details=i,t.details.isBrand=t.isBrand,t.details.operate={},t.dynamic=t.details.dynamic,n=!0,s=!1,r=void 0,e.prev=10,o=i.invoiceList[Symbol.iterator]();!(n=(u=o.next()).done);n=!0)1==(l=u.value).type?(t.dispatchId=l.id,t.setOrderDetail(l,l.type),t.outDetails=l):2==l.type&&t.enterList.push(l);e.next=18;break;case 14:e.prev=14,e.t0=e.catch(10),s=!0,r=e.t0;case 18:e.prev=18,e.prev=19,!n&&o.return&&o.return();case 21:if(e.prev=21,!s){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:t.setInitBtn();case 27:case"end":return e.stop()}},e,t,[[10,14,18,26],[19,,21,25]])}))()},cancelMethod:function(){var t=this;this.$store.commit("setWin",{title:"操作提示",winType:"confirm",content:"是否取消调度？",ok:{content:"是"},cancel:{content:"否"},callback:function(e){"ok"==e&&t.cancelShipment()}})},confirmMethod:function(){var t=this;this.$store.commit("setWin",{title:"操作提示",winType:"confirm",content:"是否确认出货？",ok:{content:"是"},cancel:{content:"否"},callback:function(e){"ok"==e&&t.confirmShipment()}})},cancelShipment:function(){var t=this;return r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.DispatchrecordCancelShipment({data:{id:t.detailId,dispatchId:t.dispatchId}});case 2:e.sent&&t.init();case 4:case"end":return e.stop()}},e,t)}))()},confirmShipment:function(){var t=this;return r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.DispatchrecordConfirmShipment({data:{id:t.detailId,uid:t.uid,type:t.details.applyId>0?1:0}});case 2:e.sent&&t.init();case 4:case"end":return e.stop()}},e,t)}))()},myAlert:function(t){this.$store.commit("setWin",{title:"操作提示",content:t})},setGoodsList:function(t){var e=s.a.deepCopy(t);for(var i in e){var a=e[i];a.serialNumCus=Number(i)+1,a.typeNameCus=0==a.type?"普通商品":"称重商品",a.outGoodsNumCus=a.num+a.unit;var n=0;for(var r in a.batchInfo){var o=a.batchInfo[r];o.serialNumCus="批次 "+(Number(r)+1),o.timeCus=this.timeConversion(o.productionTime),o.priceAndName=o.purchasePrice+"元/"+a.unit,o.outGoodsNumCus=o.num+a.unit,n+=o.purchasePrice*o.num}a.costTotal=this.setNumfloat(n)+"元"}return e},setMaterialList:function(t){var e=s.a.deepCopy(t);for(var i in e){var a=e[i],n=[],r=!0,o=!1,u=void 0;try{for(var l,c=a.cateData[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var m=l.value;n.push(m.name)}}catch(t){o=!0,u=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw u}}a.serialNumCus=Number(i)+1,a.cateCus=n.join(","),a.outMatNumCus=this.setUnit(a.unitData,a.num,a.selectUnitName),a.matType=this.matTypeHash[a.type];var d=0;for(var h in a.batchInfo){var p=a.batchInfo[h];p.serialNumCus="批次 "+(Number(h)+1),p.timeCus=this.timeConversion(p.productionTime),p.priceAndName=p.purchasePrice+"元/"+this.getUnitName(a.unitData,p.purchaseUnit),p.outMatNumCus=this.setUnit(a.unitData,p.num,a.selectUnitName),this.isBrand&&(p.distributionStr=p.distributionPrice+"元/"+this.getUnitName(a.unitData,p.distributionUnit)),d+=p.num/this.getUnitName(a.unitData,p.purchaseUnit,!0)*p.purchasePrice}a.costTotal=this.setNumfloat(d)+"元"}return e},getUnitName:function(t,e,i){var a=!0,n=!1,s=void 0;try{for(var r,o=t[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var u=r.value;if(u.muId==e)return i?u.value:u.name}}catch(t){n=!0,s=t}finally{try{!a&&o.return&&o.return()}finally{if(n)throw s}}},spliceArr:function(t){for(var e=0;e<t.length;e++){var i=t[e],a=0,n=0;for(var s in i.batchInfo){var r=i.batchInfo[s];a+=Number(r.intoNum),n+=Number(r.consumeNum)}a<=0&&n<=0&&t.splice(e,1)}},setGoodsListInto:function(t){var e=s.a.deepCopy(t);this.spliceArr(e);for(var i=0;i<e.length;i++){var a=e[i];a.serialNumCus=Number(i)+1,a.num=a.num+a.unit;var n=0,r=0,o=0;for(var u in a.batchInfo){var l=a.batchInfo[u];l.serialNumCus="批次 "+(Number(u)+1),l.timeCus=this.timeConversion(l.productionTime),l.priceAndName=l.purchasePrice+"元/"+a.unit,l.outGoodsNumCus=l.num+a.unit,l.intoNumDetail=l.intoNum+a.unit,l.consumeNumDetail=l.consumeNum+a.unit,n+=Number(l.intoNum),r+=Number(l.consumeNum),o+=l.intoNum*l.purchasePrice}a.intoNum=n+a.unit,a.consumeNum=r+a.unit,a.wName=a.newWname;var c=!0,m=!1,d=void 0;try{for(var h,p=a.newArea[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=h.value;v.id==a.areaId&&(a.aName=v.areaName)}}catch(t){m=!0,d=t}finally{try{!c&&p.return&&p.return()}finally{if(m)throw d}}a.costTotal=this.setNumfloat(o)+"元"}return e},setMaterialListInto:function(t){var e=s.a.deepCopy(t);this.spliceArr(e);for(var i=0;i<e.length;i++){var a=e[i];a.serialNumCus=Number(i)+1,a.num=this.setUnit(a.unitData,a.num,a.unit);var n=0,r=0,o=0;for(var u in a.batchInfo){var l=a.batchInfo[u];l.serialNumCus="批次 "+(Number(u)+1),l.timeCus=this.timeConversion(l.productionTime),l.priceAndName=l.purchasePrice+"元/"+this.getUnitName(a.unitData,l.purchaseUnit),l.outMatNumCus=this.setUnit(a.unitData,l.num,a.selectUnitName),l.intoNumDetail=this.setUnit(a.unitData,l.intoNum,a.unit),l.consumeNumDetail=this.setUnit(a.unitData,l.consumeNum,a.unit),n+=Number(this.setUnitNum(a.unitData,l.intoNum,a.unit)),r+=Number(this.setUnitNum(a.unitData,l.consumeNum,a.unit)),o+=l.intoNum/this.getUnitName(a.unitData,l.purchaseUnit,!0)*l.purchasePrice}a.intoNum=n+a.unit,a.consumeNum=r+a.unit,a.wName=a.newWname;var c=!0,m=!1,d=void 0;try{for(var h,p=a.newArea[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=h.value;v.id==a.areaId&&(a.aName=v.areaName)}}catch(t){m=!0,d=t}finally{try{!c&&p.return&&p.return()}finally{if(m)throw d}}a.costTotal=this.setNumfloat(o)+"元"}return e},setUnitNum:function(t,e,i){var a=0,n=!0,s=!1,r=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value;l.name==i&&(a=Number(e)/Number(l.value))}}catch(t){s=!0,r=t}finally{try{!n&&u.return&&u.return()}finally{if(s)throw r}}return a},setUnit:function(t,e,i){var a=0,n=!0,s=!1,r=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value;l.name==i&&(a=Number(e)/Number(l.value)+i)}}catch(t){s=!0,r=t}finally{try{!n&&u.return&&u.return()}finally{if(s)throw r}}return a},setNumfloat:function(t){var e=t+"";if(/\.\d{4,}/.test(e)){var i=e.substr(e.indexOf(".")+3,1);e=i>0?e.replace(/(\d+\.\d{2})(\d*)/,"$1"+i):e.replace(/(\d+\.\d{2})(\d*)/,"$11")}return e},timeConversion:function(t,e){return e?s.a.format(new Date(1e3*t),"yyyy-MM-dd hh:mm:ss"):s.a.format(new Date(1e3*t),"yyyy-MM-dd")}}},u=(i("98d7"),i("d801")),l=Object(u.a)(o,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"output-shipper"}},[i("div",{staticClass:"scroll-box"},[t.mainShow?[i("div",{staticClass:"head"},[t._v("调度单详情")]),t._v(" "),i("div",{staticClass:"detail"},[i("div",{staticClass:"block"},[i("div",{staticClass:"item"},[i("span",[t._v("调度单号：")]),t._v(t._s(t.details.receiptNumber)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"item"},[i("span",[t._v("调度状态：")]),t._v(t._s(t.allStatus[t.details.dynamic])+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"item ware"},[i("span",[t._v("入货仓库：")]),t._v(" "),i("p",[t._v(t._s(t.details.intoWname)),i("em",{staticClass:"el-icon-document",on:{click:function(e){t.openWareWin(t.details.intoWarehouse)}}})])]),t._v(" "),i("div",{staticClass:"item ware"},[i("span",[t._v("出货仓库：")]),t._v(" "),i("p",[t._v(t._s(t.details.outWname)),i("em",{staticClass:"el-icon-document",on:{click:function(e){t.openWareWin(t.details.outWarehouse)}}})])])]),t._v(" "),i("div",{staticClass:"block"},[i("div",{staticClass:"item"},[i("span",[t._v("创建时间：")]),t._v(t._s(t.timeConversion(t.details.createTime,1))+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"item"},[i("span",[t._v("创建人：")]),t._v(t._s(t.details.createName)+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"item narrow"},[i("span",[t._v("原因：")]),t._v(t._s(t.details.cause||"--")+"\n\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"item narrow"},[i("span",[t._v("备注：")]),t._v(t._s(t.details.remark||"--")+"\n\t\t\t\t\t\t\t")])]),t._v(" "),i("div",{staticClass:"block"},[2==t.dynamic||5==t.dynamic||6==t.dynamic?[i("div",{staticClass:"item"},[1==t.disType?i("span",[t._v("出货时间：")]):t._e(),t._v(" "),2==t.disType?i("span",[t._v("入货时间：")]):t._e(),t._v("\n\t\t\t\t\t\t\t\t\t"+t._s(t.operate.time)+"\n\t\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"item"},[1==t.disType?i("span",[t._v("出货人：")]):t._e(),t._v(" "),2==t.disType?i("span",[t._v("入货人：")]):t._e(),t._v("\n\t\t\t\t\t\t\t\t\t"+t._s(t.operate.name)+"\n\t\t\t\t\t\t\t\t")])]:t._e(),t._v(" "),4==t.dynamic?[i("div",{staticClass:"item"},[i("span",[t._v("取消时间：")]),t._v(t._s(t.operate.time)+"\n\t\t\t\t\t\t\t\t")]),t._v(" "),i("div",{staticClass:"item"},[i("span",[t._v("取消人：")]),t._v(t._s(t.operate.name)+"\n\t\t\t\t\t\t\t\t")])]:t._e()],2)]),t._v(" "),t.enterList.length?i("div",{staticClass:"tab-box",on:{click:t.tabClick}},[i("span",{class:{active:-1==t.selIndex},attrs:{"data-type":"1"}},[t._v("出货单")]),t._v(" "),t._l(t.enterList,function(e,a){return i("span",{key:a,class:{active:t.selIndex==a},attrs:{"data-type":"2","data-index":a}},[t._v("\n\t\t\t\t\t\t入货单"+t._s(a+1)+"\n\t\t\t\t\t")])})],2):t._e(),t._v(" "),i("div",[i("el-dialog",{attrs:{title:"仓库信息",visible:t.dialogVisible,width:"600px",close:t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"ware-detail"},[i("span",[t._v("仓库名称："+t._s(this.wareDetail.name))]),t._v(" "),i("span",[t._v("仓库所属："+t._s(this.wareDetail.ownerName))]),t._v(" "),i("span",[t._v("仓库地址："+t._s(this.wareDetail.provinceName)+" "+t._s(this.wareDetail.cityName)+" "+t._s(this.wareDetail.townName))])]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("确 定")])],1)])],1),t._v(" "),i("detail-list",{attrs:{detail:t.detailObj,detailInto:t.detailObjInto,type:t.disType,tabIndex:t.logObj.type},on:{emit:t.getDetailObj}})]:t._e(),t._v(" "),t.printShow?i("output-print",{attrs:{detail:t.details,goods:t.outGoods,material:t.outMaterial,isOpen:t.showCom},on:{emit:t.getEmit}}):t._e(),t._v(" "),t.printShowInto?i("output-print-into",{attrs:{detail:t.details,goods:t.enterGoods,material:t.enterMaterial,isOpen:t.showCom},on:{emit:t.getEmit}}):t._e()],2)])},[],!1,null,"439618a7",null);e.default=l.exports},"82d9":function(t,e,i){},"98d7":function(t,e,i){"use strict";var a=i("82d9");i.n(a).a}}]);