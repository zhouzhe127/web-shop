(window.webpackJsonp=window.webpackJsonp||[]).push([["sweepcode_pay"],{"024c":function(t,e,n){},"6f66":function(t,e,n){t.exports=n.p+"images/shuaxin.07162dcd.png"},"89b3":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"sweepCode"}},[t._m(0),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("下载快捷支付二维码")]),t._v(" "),s("a",{staticClass:"fl add_btn qRcode",attrs:{href:t.downloadUrl,download:t.shopName}},[t._v("下载二维码")]),t._v(" "),s("img",{staticClass:"upload",attrs:{src:n("6f66")},on:{click:t.updateShortUrl}})]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("门店折扣")]),t._v(" "),s("onOff",{key:1,staticClass:"fl",attrs:{status:t.payDiscount},on:{statusChange:t.openpayDiscount}}),t._v(" "),t._m(1)],1),t._v(" "),t.payDiscount?s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("span",{staticClass:"discount"},[t._v("折扣率")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.discounts,expression:"discounts"}],staticClass:"discountinp",attrs:{type:"text",maxlength:"3",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.discounts},on:{input:function(e){e.target.composing||(t.discounts=e.target.value)}}}),t._v(" "),s("span",{staticClass:"discount"},[t._v("%")])]):t._e(),t._v(" "),t.payDiscount?s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("div",{staticClass:"businessHours"},[s("div",{class:{active:t.isMember},on:{click:t.selectBusinessHours}}),t._v(" "),s("span",[t._v("仅有会员享有门店折扣")])])]):t._e(),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("支付方式")]),t._v(" "),s("mulSelect",{key:"id",staticClass:"fl",attrs:{list:t.goodsType,selects:t.goodsSelect,styles:{width:"80px",backgroundColor:"#fff",marginRight:"8px"},name:"name"},on:{"update:list":function(e){t.goodsType=e},"update:selects":function(e){t.goodsSelect=e}}}),t._v(" "),t._m(2)],1),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("开启会员支付")]),t._v(" "),s("onOff",{key:1,attrs:{status:t.paySwitch},on:{statusChange:t.openpaySwitch}})],1),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("开启优惠券使用")]),t._v(" "),s("onOff",{key:1,attrs:{status:t.couponSwitch},on:{statusChange:t.opencouponSwitch}})],1),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("开启积分抵扣使用")]),t._v(" "),s("onOff",{key:1,attrs:{status:t.pointSwitch},on:{statusChange:t.openpointSwitch}})],1),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl",staticStyle:{"line-height":"16px"}},[t._v("会员折扣与优惠券是否共享")]),t._v(" "),s("onOff",{key:1,attrs:{status:t.shareSwitch},on:{statusChange:t.openshareSwitch}})],1),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("开启用餐人数")]),t._v(" "),s("onOff",{key:1,attrs:{status:t.payMeals},on:{statusChange:t.openpayMeals}})],1),t._v(" "),t.payMeals?s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub required fl"}),t._v(" "),s("span",{staticClass:"discount"},[t._v("用餐")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.diningnums,expression:"diningnums"}],staticClass:"discountinp",attrs:{type:"text",maxlength:"2",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.diningnums},on:{input:function(e){e.target.composing||(t.diningnums=e.target.value)}}}),t._v(" "),s("span",{staticClass:"discount"},[t._v("人")])]):t._e(),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("开启优惠规则")]),t._v(" "),s("onOff",{key:1,attrs:{status:t.preferentialSwitch},on:{statusChange:t.openpreferentialSwitch}})],1),t._v(" "),t.preferentialSwitch?s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("section",{staticClass:"fl therules"},[t.configure.length<=9?s("section",{staticClass:"clearfix"},[s("div",{staticClass:"rulebox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"fl",attrs:{type:"text",placeholder:"请输入规则",maxlength:"30"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}}),t._v(" "),s("div",{staticClass:"bg",on:{click:t.saveConcont}})]),t._v(" "),t._m(3)]):t._e(),t._v(" "),t._l(t.configure,function(e,n){return t.configure.length>=1?s("div",{key:n,staticClass:"rlues"},[t._v(t._s(e)+"\n\t\t\t\t"),s("i",{staticClass:"del",on:{click:function(e){t.delConcont(n)}}})]):t._e()})],2)]):t._e(),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"},[t._v("绑定门店管理人员")]),t._v(" "),s("a",{staticClass:"blue employees",attrs:{href:"javascript:;"},on:{click:t.chooseuser}},[t._v("选择微信粉丝")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.userSelect.length>0,expression:"userSelect.length > 0"}],staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("section",{staticClass:"clearfix fl",staticStyle:{width:"639px"}},t._l(t.userSelect,function(e,n){return s("div",{key:n,staticClass:"fans"},[s("img",{attrs:{src:e.imageUrl}}),t._v(" "),s("span",[t._v(t._s(e.name))]),t._v(" "),s("i",{staticClass:"del",on:{click:function(e){t.deluser(n)}}})])}))]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("a",{staticClass:"blue",staticStyle:{width:"200px"},attrs:{href:"javascript:;"},on:{click:t.addconfig}},[t._v("保存")])]),t._v(" "),t.isShowSelector?s("select-user-win",{attrs:{selectedList:t.userSelect},on:{closeWin:t.closeUserWin}}):t._e()],1)};s._withStripped=!0;var i=n("81a2"),a=n("f6ce"),o=n("bbb9");function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function s(i,a){try{var o=e[i](a),c=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(c).then(function(t){s("next",t)},function(t){s("throw",t)});t(c)}("next")})}}var r=null,l={data:function(){return{payDiscount:!1,discount:"",paySwitch:!1,couponSwitch:!1,pointSwitch:!1,shareSwitch:!1,payMeals:!1,diningnum:"1",preferentialSwitch:!1,configure:[],content:"",isShowSelector:!1,userSelect:[],downloadUrl:"javascript:;",shopName:"",qrcode:"",goodsType:[{name:"微信",id:0},{name:"支付宝",id:1}],goodsSelect:[],isMember:!1}},methods:{openpayDiscount:function(t){this.payDiscount=t},openpaySwitch:function(t){this.paySwitch=t},opencouponSwitch:function(t){this.couponSwitch=t},openpointSwitch:function(t){this.pointSwitch=t},openshareSwitch:function(t){this.shareSwitch=t},openpayMeals:function(t){this.payMeals=t},openpreferentialSwitch:function(t){this.preferentialSwitch=t},delConcont:function(t){this.configure.splice(t,1),this.content=""},saveConcont:function(){return""==this.content.trim()?(this.$store.commit("setWin",{content:"请填写规则内容！",time:1e3}),!1):10==this.configure.length?(this.$store.commit("setWin",{content:"最多添加十条！",time:1e3}),!1):(this.configure.push(this.content),void(this.content=""))},closeUserWin:function(t){this.isShowSelector=!1,t&&(this.userSelect=t)},chooseuser:function(){this.isShowSelector=!0},deluser:function(t){this.userSelect.splice(t,1)},checkFormData:function(){return 0==this.goodsSelect.length?(this.$store.commit("setWin",{content:"请至少选择一种支付方式",title:"操作提示",winType:"alert"}),!1):this.payDiscount&&""==this.discount?(this.$store.commit("setWin",{content:"请填写门店折扣",title:"操作提示",winType:"alert"}),!1):this.payDiscount&&(Number(this.discount)>100||Number(this.discount)<1)?(this.$store.commit("setWin",{content:"门店折扣范围1～100",title:"操作提示",winType:"alert"}),!1):this.payMeals&&""==this.diningnum?(this.$store.commit("setWin",{content:"请填写门用餐人数",title:"操作提示",winType:"alert"}),!1):this.payMeals&&(Number(this.diningnum)>20||Number(this.diningnum)<1)?(this.$store.commit("setWin",{content:"用餐人数范围1-20",title:"操作提示",winType:"alert"}),!1):!this.preferentialSwitch||""!=this.configure||(this.$store.commit("setWin",{content:"请至少添加一条规则",title:"操作提示",winType:"alert"}),!1)},addconfig:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var n,s,a,c,r,l,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.checkFormData()){e.next=2;break}return e.abrupt("return");case 2:if(n="",o.a.isEmptyObject(t.userSelect)){e.next=24;break}for(s=!0,a=!1,c=void 0,e.prev=7,r=t.userSelect[Symbol.iterator]();!(s=(l=r.next()).done);s=!0)u=l.value,n+=u.id+",";e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),a=!0,c=e.t0;case 15:e.prev=15,e.prev=16,!s&&r.return&&r.return();case 18:if(e.prev=18,!a){e.next=21;break}throw c;case 21:return e.finish(18);case 22:return e.finish(15);case 23:n=n.substring(0,n.length-1);case 24:return e.next=26,i.a.addScanPayConfig({data:{isMemberPay:Number(t.paySwitch),isCouponPay:Number(t.couponSwitch),isPointsPay:Number(t.pointSwitch),isMemberCoupon:Number(t.shareSwitch),onlyMember:Number(t.isMember),rules:1==t.preferentialSwitch?t.configure.join("!#!"):"",fansIds:n,payMode:t.goodsSelect.join(","),shopDiscount:t.payDiscount?t.discount:0,person:t.payMeals?t.diningnum:0}});case 26:e.sent&&(t.$store.commit("setWin",{content:"保存成功",title:"操作提示",winType:"alert"}),t.getsweepcodeConfig());case 28:case"end":return e.stop()}},e,t,[[7,11,15,23],[16,,18,22]])}))()},getsweepcodeConfig:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var n,s,a,o,c,l,u,p,f,h,d,v,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getScanPayInfo({data:{}});case 2:if(!(n=e.sent)){e.next=56;break}if(""==n.payMode){e.next=26;break}for(s=n.payMode.split(","),t.goodsSelect=[],a=!0,o=!1,c=void 0,e.prev=10,l=s[Symbol.iterator]();!(a=(u=l.next()).done);a=!0)p=u.value,t.goodsSelect.push(Number(p));e.next=18;break;case 14:e.prev=14,e.t0=e.catch(10),o=!0,c=e.t0;case 18:e.prev=18,e.prev=19,!a&&l.return&&l.return();case 21:if(e.prev=21,!o){e.next=24;break}throw c;case 24:return e.finish(21);case 25:return e.finish(18);case 26:if("0"==n.shopDiscount?(t.payDiscount=!1,t.discount=""):(t.payDiscount=!0,t.discount=n.shopDiscount),"0"==n.person?(t.payMeals=!1,t.diningnum="1"):(t.payMeals=!0,t.diningnum=n.person),t.isMember=Boolean(Number(n.onlyMember)),t.paySwitch=Boolean(Number(n.isMemberPay)),t.couponSwitch=Boolean(Number(n.isCouponPay)),t.pointSwitch=Boolean(Number(n.isPointsPay)),t.shareSwitch=Boolean(Number(n.isMemberCoupon)),""!=n.rules&&(t.configure=n.rules.split("!#!"),t.preferentialSwitch=!0),!n.fansInfo){e.next=55;break}for(f=!0,h=!1,d=void 0,e.prev=38,v=n.fansInfo[Symbol.iterator]();!(f=(m=v.next()).done);f=!0)m.value.selected=!0;e.next=46;break;case 42:e.prev=42,e.t1=e.catch(38),h=!0,d=e.t1;case 46:e.prev=46,e.prev=47,!f&&v.return&&v.return();case 49:if(e.prev=49,!h){e.next=52;break}throw d;case 52:return e.finish(49);case 53:return e.finish(46);case 54:t.userSelect=n.fansInfo;case 55:t.downloadUrl=t.qrcode.getQrBase64(n.shortUrl,{padding:15,width:300,height:300,correctLevel:r.L});case 56:case"end":return e.stop()}},e,t,[[10,14,18,26],[19,,21,25],[38,42,46,54],[47,,49,53]])}))()},updateShortUrl:function(){var t=this;return c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.updateShortUrl({data:{}});case 2:e.sent&&(t.$store.commit("setWin",{content:"刷新成功",title:"操作提示",winType:"alert"}),t.getsweepcodeConfig());case 4:case"end":return e.stop()}},e,t)}))()},selectBusinessHours:function(){this.isMember=!this.isMember}},computed:{discounts:{get:function(){return this.discount},set:function(t){this.discount=t.replace(/[^\d]/g,"")}},diningnums:{get:function(){return this.diningnum},set:function(t){this.diningnum=t.replace(/[^\d]/g,"")}}},components:{onOff:function(){return n.e("on_off").then(n.bind(null,"034b"))},"select-user-win":function(){return n.e("select_user_win").then(n.bind(null,"393e"))},mulSelect:function(){return n.e("mul_select").then(n.bind(null,"7d09"))}},mounted:function(){var t=this;return c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.shopName=a.a.session("userShop").currentShop.name,e.next=3,n.e("qrcode").then(function(){var t=n("d741");return"object"==typeof t&&t&&t.__esModule?t:Object.assign({},"object"==typeof t&&t,{default:t})});case 3:t.qrcode=e.sent,r=t.qrcode.QRErrorCorrectLevel,t.getsweepcodeConfig();case 6:case"end":return e.stop()}},e,t)}))()}},u=(n("ce44"),n("6ceb")),p=Object(u.a)(l,s,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("快捷支付基本配置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips",staticStyle:{"margin-left":"20px"}},[e("i"),this._v(" 门店折扣与会员折扣不共享,开启后直接享受门店折扣,不参与会员折扣\n\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 使用时需在支付门店支付方式内开启微信或支付宝\n\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 最多输入10条,每条限制30字符\n\t\t\t\t")])}],!1,null,"4bffdd7e",null);p.options.__file="src\\module\\marketing_tools\\sweepcode_pay.vue";e.default=p.exports},ce44:function(t,e,n){"use strict";var s=n("024c");n.n(s).a}}]);