(window.webpackJsonp=window.webpackJsonp||[]).push([["picking"],{5621:function(t,e,a){},"8af8":function(t,e,a){"use strict";a.r(e);var i=a("81a2"),n=a("05dd"),r=a("f6ce");function s(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function i(n,r){try{var s=e[n](r),l=s.value}catch(t){return void a(t)}if(!s.done)return Promise.resolve(l).then(function(t){i("next",t)},function(t){i("throw",t)});t(l)}("next")})}}var l={data:function(){return{dialogVisible:!1,pickerList:[],matterList:[1,2,3],showBatch:!1,pickData:{reason:"",owner:"",ownerName:"",remarks:"",materialInfo:[],creatorName:""},pickerId:0,isMatter:!1,matterType:{0:"成品",1:"半成品",2:"普通物料"},info:"",item:{},isOneName:!0,sleSupplies:""}},mounted:function(){this.initBtn(),this.$store.commit("setHeaderTil",{type:"push",params:[{title:"领料"}]}),this.getPicker(),this.pickData.creatorName=r.a.session("userShop").user.name},components:{selectbtn:function(){return a.e("select_btn").then(a.bind(null,"3d41"))},batchwin:function(){return a.e("batch_win").then(a.bind(null,"c3ef"))},matter:function(){return a.e("output_select_supplies").then(a.bind(null,"0c3f"))}},methods:{initBtn:function(){var t=this,e=[{name:"确定",className:"primary",type:4,fn:function(){t.enter()}},{name:"继续添加",className:"primary",type:5,fn:function(){t.again()}},{name:"取消",className:"info",type:4,fn:function(){t.cancel()}}];this.$store.commit("setPageTools",e)},getPicker:function(){var t=this;return s(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getPickerList();case 2:a=e.sent,t.pickerList=a;case 4:case"end":return e.stop()}},e,t)}))()},selPicker:function(){this.dialogVisible=!0},pickerConfirm:function(){this.dialogVisible=!1;var t=!0,e=!1,a=void 0;try{for(var i,n=this.pickerList[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var r=i.value;if(r.id==this.pickerId){this.pickData.ownerName=r.name;break}}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}this.pickData.owner=this.pickerId},handleClose:function(){this.dialogVisible=!1,this.pickerId=this.pickData.owner},addMatter:function(){this.isMatter=!0},getMatter:function(t){if(this.isMatter=!1,this.initBtn(),t.length){this.sleSupplies=t;for(var e=0;e<t.length;e++){var a=!1,i=!0,n=!1,r=void 0;try{for(var s,l=this.pickData.materialInfo[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){s.value.materialId==t[e].id&&(a=!0)}}catch(t){n=!0,r=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw r}}if(!a){var o={materialBC:"",materialId:"",materialName:"",materialType:"",materialCategory:"",materialCategoryName:"",unitData:"",unit:"",batch:[],validity:"",validityType:"",number:"",num:"",unitList:[],index:0,minName:"",defaultName:"",defaultValue:"",oneNum:"",twoNum:"",oneName:"",twoName:"",showName:"",showValue:"",minNumber:""};o.materialBC=t[e].BC,o.materialId=t[e].id,o.materialName=t[e].name,o.materialType=t[e].type,o.validity=t[e].validity,o.validityType=t[e].validityType,o.batchNum=t[e].goodsNum.batch;var c=!0,m=!1,u=void 0;try{for(var v,p=t[e].cate[Symbol.iterator]();!(c=(v=p.next()).done);c=!0){var h=v.value;o.materialCategory+=h.cid+",",o.materialCategoryName+=h.name+","}}catch(t){m=!0,u=t}finally{try{!c&&p.return&&p.return()}finally{if(m)throw u}}o.materialCategory=o.materialCategory.slice(0,o.materialCategory.length-1),o.materialCategoryName=o.materialCategoryName.slice(0,o.materialCategoryName.length-1);var f=!0,d=!1,_=void 0;try{for(var N,k=t[e].unit[Symbol.iterator]();!(f=(N=k.next()).done);f=!0){var y=N.value,b={value:y.muId,label:y.name};o.unitList.push(b)}}catch(t){d=!0,_=t}finally{try{!f&&k.return&&k.return()}finally{if(d)throw _}}o.unitData=t[e].unit,o.number=t[e].goodsNum.surplus,o.num=t[e].goodsNum.surplus,this.pickData.materialInfo.push(o)}}this.unitConversion(this.pickData.materialInfo)}},unitConversion:function(t){var e=!0,a=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var l=r.value,o=!0,c=!1,m=void 0;try{for(var u,v=l.unitData[Symbol.iterator]();!(o=(u=v.next()).done);o=!0){var p=u.value;1==p.isDefault&&(l.defaultName=p.name,l.showName=p.name,l.oneName=p.name,l.showValue=p.value,l.defaultValue=p.value,this.$set(l,"selUnit",p),this.$set(l,"index",p.muId)),1==p.isMin&&(l.minName=p.name,l.twoName=p.name)}}catch(t){c=!0,m=t}finally{try{!o&&v.return&&v.return()}finally{if(c)throw m}}l.comNum=l.num,0!=l.num&&(l.number=n.a.comUnit(l.num,l.showValue,l.showName,l.minName))}}catch(t){a=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(a)throw i}}},getMatterNuit:function(t,e){this.backItem(t,e)},getmin:function(t){""!=t.oneNum?t.oneNum=(t.oneNum+"").replace(/[^\d\.]/g,""):t.oneNum="",""!=t.twoNum?t.twoNum=(t.twoNum+"").replace(/[^\d\.]/g,""):t.twoNum="";var e=Number(t.oneNum)*Number(t.showValue)+Number(t.twoNum);t.minNumber=e},backItem:function(t,e){var a="",i=!0,r=!1,s=void 0;try{for(var l,o=t.unitData[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=l.value;if(c.muId==e){t.showValue=c.value,t.selUnit=c,a=c.name;break}}}catch(t){r=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(r)throw s}}if(t.index=e,t.oneName=a,t.number=n.a.comUnit(t.comNum,t.showValue,a,t.minName),Number(t.minNumber)){var m=n.a.comUnit(Number(t.minNumber),t.showValue,a,t.minName,!0);t.oneNum=m.oNull,t.twoNum=m.tNull}},checkDetail:function(t){this.showBatch=!0,this.info=t,this.item=t},delStaff:function(t){this.pickData.materialInfo.splice(t,1),this.sleSupplies.splice(t,1)},getWin:function(t,e,a){if(this.showBatch=!1,"ok"==t)for(var i=this.pickData.materialInfo,n=0;n<i.length;n++){i[n].minNumber=0;for(var r=0;r<e.length;r++)e[r].materialId=e[r].itemId,e[r].number=e[r].minNumber,i[n].materialId==e[r].itemId&&(0==r&&(i[n].batch=[]),i[n].minNumber+=1*e[r].minNumber,e[r].minNumber&&i[n].batch.push(e[r]),this.backItem(i[n],i[n].selUnit.muId))}},cancel:function(){this.$router.push({path:"../pickingList",query:this.$route.query})},again:function(){if(this.isOk()&&this.enter(!0))for(var t in this.pickData)this.pickData[t]="",this.pickData.creatorName=r.a.session("userShop").user.name,"materialInfo"==t&&(this.pickData[t]=[]),this.index=0},invoicingReceive:function(t,e){var a=this;return s(regeneratorRuntime.mark(function n(){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.invoicingReceive({data:t});case 2:s=n.sent,a.$message({message:"添加成功",type:"success"}),!0!==e&&(a.$message({message:"领料成功",type:"success"}),r.a.session("info",{id:a.pickData.owner,name:a.pickData.ownerName}),r.a.session("listDetail",s),a.$router.push({path:"checkDetails"}));case 5:case"end":return n.stop()}},n,a)}))()},enter:function(t){if(this.isOk()){var e={};for(var a in this.pickData)e[a]=this.pickData[a];for(var i=[],n=0;n<this.pickData.materialInfo.length;n++){var r={materialId:"",materialName:"",materialType:"",materialBC:"",materialCategory:"",validity:"",validityType:"",materialCategoryName:"",unit:"",number:"",batch:[]};for(var s in r)r[s]=this.pickData.materialInfo[n][s];r.batch=[],r.unit=this.pickData.materialInfo[n].minName,r.number=this.pickData.materialInfo[n].minNumber;for(var l=0,o=0;o<this.pickData.materialInfo[n].batch.length;o++){var c={batchId:"",wid:"",areaId:"",number:""};for(var m in c)c[m]=this.pickData.materialInfo[n].batch[o][m];c.number=this.pickData.materialInfo[n].batch[o].minNumber,l+=1*c.number,r.batch.push(c)}if(r.number!=l&&(r.batch=[]),i.push(r),r.number>this.pickData.materialInfo[n].comNum)return this.$message({message:"物料: "+r.materialName+" 领料数量不能大于当前数量",type:"error"}),!1;if(!r.number)return this.$message({message:"物料: "+r.materialName+" 请填写领料数量",type:"error"}),!1}return 0==i.length?(this.errorShow("请添加物料"),!1):(e.materialInfo=i,this.invoicingReceive(e,t),!0)}},isOk:function(){return this.pickData.reason?!!this.pickData.owner||(this.errorShow("请选择领料人"),!1):(this.errorShow("请输入领料原因"),!1)},errorShow:function(t){this.$message({message:t,type:"error"})}}},o=(a("9148"),a("d801")),c=Object(o.a)(l,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"picking"}},[t.isMatter?a("matter",{attrs:{sleSupplies:t.sleSupplies,addBtn:!0},on:{select:t.getMatter}}):a("div",[a("div",{staticClass:"row"},[a("span",{staticClass:"left required"},[t._v("领料原因")]),t._v(" "),a("div",{staticClass:"right"},[a("el-input",{staticClass:"el-input",attrs:{placeholder:"请输入领料原因",maxlength:"20"},model:{value:t.pickData.reason,callback:function(e){t.$set(t.pickData,"reason",e)},expression:"pickData.reason"}}),t._v(" "),t._m(0)],1)]),t._v(" "),a("div",{staticClass:"row"},[a("span",{staticClass:"left required"},[t._v("领料人")]),t._v(" "),a("div",{staticClass:"right"},[a("el-button",{staticClass:"el-input",attrs:{icon:"el-icon-plus",type:"primary"},on:{click:t.selPicker}},[t._v("选择领料人")]),t._v(" "),a("span",{staticClass:"picker-name"},[t._v(t._s(t.pickData.ownerName?"已选择：":"")+t._s(t.pickData.ownerName))])],1)]),t._v(" "),a("div",{staticClass:"row"},[a("span",{staticClass:"left required"},[t._v("操作人")]),t._v(" "),a("div",{staticClass:"right"},[a("span",{staticClass:"operator"},[t._v(t._s(t.pickData.creatorName))])])]),t._v(" "),a("div",{staticClass:"row"},[a("span",{staticClass:"left"},[t._v("备注")]),t._v(" "),a("div",{staticClass:"right"},[a("el-input",{staticClass:"el-input",attrs:{type:"textarea",placeholder:"请输入备注",rows:"4",maxlength:"40"},model:{value:t.pickData.remarks,callback:function(e){t.$set(t.pickData,"remarks",e)},expression:"pickData.remarks"}}),t._v(" "),t._m(1)],1)]),t._v(" "),a("div",{staticClass:"row"},[a("span",{staticClass:"left required"},[t._v("所领物料")]),t._v(" "),a("div",{staticClass:"right"},[a("el-button",{staticClass:"el-input",attrs:{icon:"el-icon-plus",type:"primary"},on:{click:t.addMatter}},[t._v("添加物料")])],1)]),t._v(" "),0!=t.pickData.materialInfo.length?a("div",{staticClass:"list"},[a("div",{staticClass:"head"},[a("span",[t._v("物料列表 · 共"),a("em",[t._v(t._s(t.pickData.materialInfo.length))]),t._v("个条目")])]),t._v(" "),a("div",{staticClass:"scroll-box"},[a("div",{staticClass:"list-box"},[t._m(2),t._v(" "),a("ul",{staticClass:"title content"},t._l(t.pickData.materialInfo,function(e,i){return a("li",{key:i},[a("span",[a("em",{staticClass:"under-line del",on:{click:function(e){t.delStaff(i)}}},[t._v("删除")]),t._v(" "),a("em",{staticClass:"line"}),t._v(" "),a("em",{staticClass:"under-line edit",on:{click:function(a){t.checkDetail(e)}}},[t._v("批次选择")])]),t._v(" "),a("span",{staticClass:"sel-cell"},[a("el-select",{staticClass:"el-sel",on:{change:function(a){t.getMatterNuit(e,a)}},model:{value:e.index,callback:function(a){t.$set(e,"index",a)},expression:"item.index"}},t._l(e.unitList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("span",{staticClass:"end"},[e.selUnit.name!=e.minName?[a("div",{staticClass:"input-cell"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.oneNum,expression:"item.oneNum"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin(e)},domProps:{value:e.oneNum},on:{input:function(a){a.target.composing||t.$set(e,"oneNum",a.target.value)}}}),t._v(" "),a("i",{attrs:{title:e.oneName}},[t._v(t._s(e.oneName))])]),t._v(" "),a("div",{staticClass:"add-icon"},[t._v("+")])]:t._e(),t._v(" "),a("div",{staticClass:"input-cell"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.twoNum,expression:"item.twoNum"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin(e)},domProps:{value:e.twoNum},on:{input:function(a){a.target.composing||t.$set(e,"twoNum",a.target.value)}}}),t._v(" "),a("i",{attrs:{title:e.twoName}},[t._v(t._s(e.twoName))])])],2),t._v(" "),a("span",{attrs:{title:e.materialName}},[t._v(t._s(e.materialName))]),t._v(" "),a("span",{attrs:{title:e.number}},[t._v(t._s(e.number))]),t._v(" "),a("span",[t._v(t._s(e.batchNum))]),t._v(" "),a("span",[t._v(t._s(t.matterType[e.materialType]))])])}))])])]):t._e(),t._v(" "),t.showBatch?a("batchwin",{attrs:{batchInfo:t.info,type:!1},on:{getWin:t.getWin}}):t._e()],1),t._v(" "),a("div",[a("el-dialog",{attrs:{title:"选择领料人",visible:t.dialogVisible,width:"600px",close:t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[t._l(t.pickerList,function(e,i){return a("div",{key:i,staticClass:"radio-box"},[a("el-radio",{attrs:{label:e.id,border:""},model:{value:t.pickerId,callback:function(e){t.pickerId=e},expression:"pickerId"}},[t._v(t._s(e.name))])],1)}),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.pickerConfirm}},[t._v("确 定")])],1)],2)],1)],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tips"},[e("i",{staticClass:"icon"}),e("i",[this._v("限20字以内")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tips"},[e("i",{staticClass:"icon"}),e("i",[this._v("限40字以内")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("span",[t._v("操作")]),t._v(" "),a("span",[t._v("领料单位选择")]),t._v(" "),a("span",[t._v("领料数量/重量")]),t._v(" "),a("span",[t._v("物料名称")]),t._v(" "),a("span",[t._v("库存数量/重量")]),t._v(" "),a("span",[t._v("领料批次数")]),t._v(" "),a("span",[t._v("类型")])])}],!1,null,"670a8e86",null);e.default=c.exports},9148:function(t,e,a){"use strict";var i=a("5621");a.n(i).a}}]);