(window.webpackJsonp=window.webpackJsonp||[]).push([["picking"],{"8af8":function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"picking"}},[t.isMatter?e("matter",{attrs:{sleSupplies:t.sleSupplies,addBtn:!0},on:{select:t.getMatter}}):e("div",[e("div",{staticClass:"row"},[e("span",{staticClass:"left required"},[t._v("领料原因")]),t._v(" "),e("div",{staticClass:"right"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.pickData.reason,expression:"pickData.reason"}],attrs:{type:"text",placeholder:"请输入领料原因",maxlength:"20"},domProps:{value:t.pickData.reason},on:{input:function(a){a.target.composing||t.$set(t.pickData,"reason",a.target.value)}}}),t._v(" "),t._m(0)])]),t._v(" "),e("div",{staticClass:"row"},[e("span",{staticClass:"left required"},[t._v("领料人")]),t._v(" "),e("div",{staticClass:"right"},[e("selectbtn",{attrs:{sorts:t.picker,width:210,index:t.index},on:{selOn:t.selOn}})],1)]),t._v(" "),e("div",{staticClass:"row"},[e("span",{staticClass:"left required"},[t._v("操作人")]),t._v(" "),e("div",{staticClass:"right"},[e("span",{staticClass:"operator"},[t._v(t._s(t.pickData.creatorName))])])]),t._v(" "),e("div",{staticClass:"row"},[e("span",{staticClass:"left"},[t._v("备注")]),t._v(" "),e("div",{staticClass:"right"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.pickData.remarks,expression:"pickData.remarks"}],staticStyle:{"padding-left":"17px"},attrs:{type:"text",placeholder:"请输入备注",maxlength:"40"},domProps:{value:t.pickData.remarks},on:{input:function(a){a.target.composing||t.$set(t.pickData,"remarks",a.target.value)}}}),t._v(" "),t._m(1)])]),t._v(" "),e("div",{staticClass:"row"},[e("span",{staticClass:"left required"},[t._v("所领物料")]),t._v(" "),e("div",{staticClass:"right",staticStyle:{cursor:"pointer"},on:{click:t.addMatter}},[t._m(2)])]),t._v(" "),0!=t.pickData.materialInfo.length?e("div",{staticClass:"list"},[e("div",{staticClass:"head"},[e("span",[t._v("物料列表 · 共"),e("em",[t._v(t._s(t.pickData.materialInfo.length))]),t._v("个条目")])]),t._v(" "),t._m(3),t._v(" "),e("ul",{staticClass:"title content"},t._l(t.pickData.materialInfo,function(a,i){return e("li",{key:i},[e("span",[e("em",{staticClass:"under-line del",on:{click:function(a){t.delStaff(i)}}},[t._v("删除")]),t._v(" "),e("em",{staticClass:"line"}),t._v(" "),e("em",{staticClass:"under-line edit",on:{click:function(e){t.checkDetail(a)}}},[t._v("批次选择")])]),t._v(" "),e("span",{staticStyle:{overflow:"visible"},on:{click:function(e){t.backItem(a,a.index)}}},[e("selectbtn",{attrs:{sorts:a.unitList,width:80,index:a.index},on:{selOn:t.getMatterNuit}})],1),t._v(" "),e("span",{staticClass:"end"},[a.unitList[a.index]!=a.minName?[e("input",{directives:[{name:"model",rawName:"v-model",value:a.oneNum,expression:"item.oneNum"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin(a)},domProps:{value:a.oneNum},on:{input:function(e){e.target.composing||t.$set(a,"oneNum",e.target.value)}}}),e("i",{attrs:{title:a.oneName}},[t._v(t._s(a.oneName))]),t._v("\n\t\t\t\t\t\t\t+\n\t\t\t\t\t\t")]:t._e(),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:a.twoNum,expression:"item.twoNum"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin(a)},domProps:{value:a.twoNum},on:{input:function(e){e.target.composing||t.$set(a,"twoNum",e.target.value)}}}),e("i",{attrs:{title:a.twoName}},[t._v(t._s(a.twoName))])],2),t._v(" "),e("span",{attrs:{title:a.materialName}},[t._v(t._s(a.materialName))]),t._v(" "),e("span",{attrs:{title:a.number}},[t._v(t._s(a.number))]),t._v(" "),e("span",[t._v(t._s(a.batchNum))]),t._v(" "),e("span",[t._v(t._s(t.matterType[a.materialType]))])])}))]):t._e(),t._v(" "),e("div",{staticClass:"row"},[e("span",{staticClass:"left"}),t._v(" "),e("div",{staticClass:"right"},[e("span",{staticClass:"btn gray",on:{click:t.cancel}},[t._v("取消")]),t._v(" "),e("span",{staticClass:"continue btn",on:{click:t.again}},[t._v("继续添加")]),t._v(" "),e("span",{staticClass:"btn yellow",on:{click:t.enter}},[t._v("确定")])])]),t._v(" "),t.showBatch?e("batchwin",{attrs:{batchInfo:t.info,winIndex:t.winIndex,type:!1},on:{getWin:t.getWin}}):t._e()],1)],1)};i._withStripped=!0;var n=e("81a2"),r=e("05dd"),s=e("f6ce");function o(t){return function(){var a=t.apply(this,arguments);return new Promise(function(t,e){return function i(n,r){try{var s=a[n](r),o=s.value}catch(t){return void e(t)}if(!s.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}("next")})}}var c={data:function(){return{picker:["请选择领料人"],pickerList:[],matterList:[1,2,3],showBatch:!1,pickData:{reason:"",owner:"",ownerName:"",remarks:"",materialInfo:[],creatorName:""},index:0,isMatter:!1,matterType:{0:"物料"},info:"",item:{},isOneName:!0,winIndex:0,sleSupplies:""}},mounted:function(){this.$store.commit("setHeaderTil",{type:"push",params:[{title:"领料"}]}),this.getPicker(),this.pickData.creatorName=s.a.session("userShop").user.name},components:{selectbtn:function(){return e.e("select_btn").then(e.bind(null,"3d41"))},batchwin:function(){return e.e("batch_win").then(e.bind(null,"c3ef"))},matter:function(){return e.e("output_select_supplies").then(e.bind(null,"0c3f"))}},methods:{getPicker:function(){var t=this;return o(regeneratorRuntime.mark(function a(){var e,i,r,s,o,c,m;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.getPickerList();case 2:for(e=a.sent,i=!0,r=!1,s=void 0,a.prev=6,o=e[Symbol.iterator]();!(i=(c=o.next()).done);i=!0)m=c.value,t.picker.push(m.name);a.next=14;break;case 10:a.prev=10,a.t0=a.catch(6),r=!0,s=a.t0;case 14:a.prev=14,a.prev=15,!i&&o.return&&o.return();case 17:if(a.prev=17,!r){a.next=20;break}throw s;case 20:return a.finish(17);case 21:return a.finish(14);case 22:t.pickerList=e;case 23:case"end":return a.stop()}},a,t,[[6,10,14,22],[15,,17,21]])}))()},addMatter:function(){this.isMatter=!0},getMatter:function(t){t&&(this.sleSupplies=t);for(var a=0;a<t.length;a++){var e=!1,i=!0,n=!1,r=void 0;try{for(var s,o=this.pickData.materialInfo[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){s.value.materialId==t[a].id&&(e=!0)}}catch(t){n=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw r}}if(!e){var c={materialBC:"",materialId:"",materialName:"",materialType:"",materialCategory:"",materialCategoryName:"",unitData:"",unit:"",batch:[],validity:"",validityType:"",number:"",num:"",unitList:[],index:0,minName:"",defaultName:"",defaultValue:"",oneNum:"",twoNum:"",oneName:"",twoName:"",showName:"",showValue:"",minNumber:""};c.materialBC=t[a].BC,c.materialId=t[a].id,c.materialName=t[a].name,c.materialType=t[a].type,c.validity=t[a].validity,c.validityType=t[a].validityType,c.batchNum=t[a].goodsNum.batch;var m=!0,l=!1,u=void 0;try{for(var p,h=t[a].cate[Symbol.iterator]();!(m=(p=h.next()).done);m=!0){var v=p.value;c.materialCategory+=v.cid+",",c.materialCategoryName+=v.name+","}}catch(t){l=!0,u=t}finally{try{!m&&h.return&&h.return()}finally{if(l)throw u}}c.materialCategory=c.materialCategory.slice(0,c.materialCategory.length-1),c.materialCategoryName=c.materialCategoryName.slice(0,c.materialCategoryName.length-1);var f=!0,d=!1,k=void 0;try{for(var _,N=t[a].unit[Symbol.iterator]();!(f=(_=N.next()).done);f=!0){var w=_.value;c.unitList.push(w.name)}}catch(t){d=!0,k=t}finally{try{!f&&N.return&&N.return()}finally{if(d)throw k}}c.unitData=t[a].unit,c.number=t[a].goodsNum.surplus,c.num=t[a].goodsNum.surplus,this.pickData.materialInfo.push(c)}}this.isMatter=!1,this.unitConversion(this.pickData.materialInfo)},unitConversion:function(t){for(var a=0;a<t.length;a++){for(var e=[],i=0;i<t[a].unitData.length;i++){1==t[a].unitData[i].isDefault&&(this.pickData.materialInfo[a].defaultName=t[a].unitData[i].name,this.pickData.materialInfo[a].showName=t[a].unitData[i].name,this.pickData.materialInfo[a].oneName=t[a].unitData[i].name,this.pickData.materialInfo[a].showValue=t[a].unitData[i].value,this.pickData.materialInfo[a].defaultValue=t[a].unitData[i].value),1==t[a].unitData[i].isMin&&(this.pickData.materialInfo[a].minName=t[a].unitData[i].name,this.pickData.materialInfo[a].twoName=t[a].unitData[i].name),e=e.concat(t[a].unitData[i].name);for(var n=0;n<e.length;n++)if(e[n]==t[a].showName){var s=e.splice(n,1);e.unshift(s[0])}this.pickData.materialInfo[a].unitList=e}this.pickData.materialInfo[a].comNum=t[a].num,0!=t[a].num&&(this.pickData.materialInfo[a].number=r.a.comUnit(t[a].num,this.pickData.materialInfo[a].showValue,this.pickData.materialInfo[a].showName,this.pickData.materialInfo[a].minName))}},getMatterNuit:function(t){this.backItem(this.item,t)},getmin:function(t){""!=t.oneNum?t.oneNum=(t.oneNum+"").replace(/[^\d\.]/g,""):t.oneNum="",""!=t.twoNum?t.twoNum=(t.twoNum+"").replace(/[^\d\.]/g,""):t.twoNum="";var a=Number(t.oneNum)*Number(t.showValue)+Number(t.twoNum);t.minNumber=a},backItem:function(t,a){this.item=t,t.index=a;var e=t.unitList[a];t.oneName=e;for(var i=0;i<t.unitData.length;i++)t.unitData[i].name==e&&(t.showValue=t.unitData[i].value);if(t.number=r.a.comUnit(t.comNum,t.showValue,e,t.minName),Number(t.minNumber)){var n=r.a.comUnit(Number(t.minNumber),t.showValue,e,t.minName,!0);t.oneNum=n.oNull,t.twoNum=n.tNull}},selOn:function(t){this.index=t,0!=t?(this.pickData.owner=this.pickerList[this.index-1].id,this.pickData.ownerName=this.pickerList[this.index-1].name):(this.pickData.owner="",this.pickData.ownerName="")},checkDetail:function(t){this.showBatch=!0,this.info=t,this.item=t},delStaff:function(t){this.pickData.materialInfo.splice(t,1),this.sleSupplies.splice(t,1)},getWin:function(t,a,e){if(this.showBatch=!1,"ok"==t){this.winIndex=e;for(var i=this.pickData.materialInfo,n=0;n<i.length;n++){i[n].minNumber=0;for(var r=0;r<a.length;r++)a[r].materialId=a[r].itemId,a[r].number=a[r].minNumber,i[n].materialId==a[r].itemId&&(0==r&&(i[n].batch=[]),i[n].minNumber+=1*a[r].minNumber,a[r].minNumber&&i[n].batch.push(a[r]),this.backItem(i[n],e))}this.backItem(this.item,e)}},cancel:function(){this.$router.push({path:"../pickingList",query:this.$route.query})},again:function(){if(this.isOk()&&this.enter(!0))for(var t in this.pickData)this.pickData[t]="",this.pickData.creatorName=s.a.session("userShop").user.name,"materialInfo"==t&&(this.pickData[t]=[]),this.index=0},invoicingReceive:function(t,a){var e=this;return o(regeneratorRuntime.mark(function i(){var r;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.a.invoicingReceive({data:t});case 2:r=i.sent,e.$store.commit("setWin",{winType:"alert",content:"添加成功"}),!0!==a&&(s.a.session("listDetail",r),e.$router.push({path:"checkDetails",query:e.$route.query}));case 5:case"end":return i.stop()}},i,e)}))()},enter:function(t){if(this.isOk()){var a={};for(var e in this.pickData)a[e]=this.pickData[e];for(var i=[],n=0;n<this.pickData.materialInfo.length;n++){var r={materialId:"",materialName:"",materialType:"",materialBC:"",materialCategory:"",validity:"",validityType:"",materialCategoryName:"",unit:"",number:"",batch:[]};for(var s in r)r[s]=this.pickData.materialInfo[n][s];r.batch=[],r.unit=this.pickData.materialInfo[n].minName,r.number=this.pickData.materialInfo[n].minNumber;for(var o=0,c=0;c<this.pickData.materialInfo[n].batch.length;c++){var m={batchId:"",wid:"",areaId:"",number:""};for(var l in m)m[l]=this.pickData.materialInfo[n].batch[c][l];m.number=this.pickData.materialInfo[n].batch[c].minNumber,o+=1*m.number,r.batch.push(m)}if(r.number!=o&&(r.batch=[]),i.push(r),r.number>this.pickData.materialInfo[n].comNum)return this.$store.commit("setWin",{winType:"alert",content:"物料："+r.materialName+"领料数量不能大于当前数量"}),!1;if(!r.number)return this.$store.commit("setWin",{winType:"alert",content:"物料："+r.materialName+"请填写领料数量"}),!1}return 0==i.length?(this.errorShow("请添加物料"),!1):(a.materialInfo=i,this.invoicingReceive(a,t),!0)}},isOk:function(){return this.pickData.reason?!!this.pickData.owner||(this.errorShow("请选择领料人"),!1):(this.errorShow("请输入领料原因"),!1)},errorShow:function(t){this.$store.commit("setWin",{winType:"alert",content:t})}}},m=(e("8d19"),e("7610")),l=Object(m.a)(c,i,[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"tips"},[a("i",{staticClass:"icon"}),a("i",[this._v("限20字以内")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"tips"},[a("i",{staticClass:"icon"}),a("i",[this._v("限40字以内")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("span",{staticClass:"matter"},[a("i",{staticClass:"add"}),a("i",[this._v("添加物料")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"title",staticStyle:{height:"60px"}},[e("span",[t._v("操作")]),t._v(" "),e("span",[t._v("领料单位选择")]),t._v(" "),e("span",[t._v("领料数量/重量")]),t._v(" "),e("span",[t._v("物料名称")]),t._v(" "),e("span",[t._v("库存数量/重量")]),t._v(" "),e("span",[t._v("领料批次数")]),t._v(" "),e("span",[t._v("类型")])])}],!1,null,"011fb84f",null);l.options.__file="src\\module\\invoicing_system\\picking_list\\picking.vue";a.default=l.exports},"8d19":function(t,a,e){"use strict";var i=e("cdd8");e.n(i).a},cdd8:function(t,a,e){}}]);