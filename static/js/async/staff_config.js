(window.webpackJsonp=window.webpackJsonp||[]).push([["staff_config"],{a536:function(t,e,s){"use strict";s.r(e);var i=s("f6ce"),o=s("81a2"),n=s("bbb9");function a(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function i(o,n){try{var a=e[o](n),r=a.value}catch(t){return void s(t)}if(!a.done)return Promise.resolve(r).then(function(t){i("next",t)},function(t){i("throw",t)});t(r)}("next")})}}var r={data:function(){return{optionsJob:[],selectedJob:"全部职位",optionsShop:[],selectedShop:"全部门店",activityList:[],activityPageList:[],isStaff:!1,showJob:!1,brandType:"brand",jobList:[],showJobList:[],allJob:!1,edit:!1,info:null,jobIds:{brand:[],shop:[]},shopIds:[],shopList:[],showShopList:"",allShop:!1,isBatch:!1,total:0,num:10,page:1,showBatch:!1,staffOrJob:"",newList:[]}},mounted:function(){this.initBtn(),this.getUserList(),this.getShopList(),this.newGetJobInfoList()},destroyed:function(){this.$store.commit("setPageTools",{})},methods:{selallJob:function(t){for(var e=[],s=0;s<this.showJobList.length;s++)e.push(this.showJobList[s].id);"brand"==t?this.jobIds.brand.length==this.showJobList.length?this.jobIds.brand=[]:this.jobIds.brand=e:this.jobIds.shop.length==this.showJobList.length?this.jobIds.shop=[]:this.jobIds.shop=e},renderHeader:function(t,e){var s=e.column;e.$index;return this.isBatch?t("span",{},[t("span",{class:"under-line edit",style:"margin-right: 30px; color:#F8931F;cursor:pointer",on:{click:this.editBatch}},"编辑"),t("span",{class:"under-line del",style:"color: #FD3E1F;cursor:pointer",on:{click:this.delBatch}},"删除")]):t("span",s.label)},initBtn:function(){var t=this,e={addStaff:function(){t.isStaff=!0,t.edit=!1},batchOperation:function(){t.isBatch=!0,t.completeBtn();for(var e=0;e<t.activityPageList.length;e++)t.activityPageList[e].selected=!1}};this.$store.commit("setPageTools",e)},completeBtn:function(){var t=this,e={completeBatchOperation:function(){t.isBatch=!1,t.initBtn()}};this.$store.commit("setPageTools",e)},selected:function(t){t.selected=!t.selected},numChange:function(t){this.num=t,this.pageChange(1)},pageChange:function(t){this.page=t,0!=this.newList.length?this.activityPageList=this.newList.slice((t-1)*this.num,(t-1)*this.num+this.num):this.activityPageList=this.activityList.slice((t-1)*this.num,(t-1)*this.num+this.num)},userDel:function(t){var e=this;return a(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,o.a.userDel({data:{userId:t}});case 2:e.getUserList();case 3:case"end":return s.stop()}},s,e)}))()},getUserList:function(){var t=this;return a(regeneratorRuntime.mark(function e(){var s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.getUserList({data:{}});case 2:for(s=e.sent,i=0;i<s.length;i++)s[i].selected=!1;t.total=s.length,t.activityList=s,t.activityPageList=s.slice((t.page-1)*t.num,(t.page-1)*t.num+t.num),t.search();case 8:case"end":return e.stop()}},e,t)}))()},getShopList:function(){for(var t=i.a.session("shopList"),e=0;e<t.length;e++)t[e].selected=!1;this.shopList=t,this.showShopList=t},newGetJobInfoList:function(){var t=this;return a(regeneratorRuntime.mark(function e(){var s,i,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.newGetJobInfoList();case 2:for(s=e.sent,i=[],n=[],a=0;a<s.length;a++)t.$set(s[a],"selected",!1),"1"===s[a].type?n.push(s[a]):i.push(s[a]);n.unshift({id:"0",name:"超级管理员",type:"1",selected:!1}),i.unshift({id:"0",name:"超级管理员",type:"0",selected:!1}),i.push({id:"-1",name:"门店自建",type:"0",selected:!1}),t.showJobList=n,t.jobList=n.concat(i);case 11:case"end":return e.stop()}},e,t)}))()},userEditBrandUsers:function(t,e){var s=this;return a(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,o.a.userEditBrandUsers({data:{userIds:s.userIds,brandRole:t,shopRole:e}});case 2:s.getUserList();case 3:case"end":return i.stop()}},i,s)}))()},showNames:function(t){console.log(t)},delStaff:function(t){var e=this;this.$store.commit("setWin",{title:"提示信息",winType:"confirm",content:"确认删除？",callback:function(s){"ok"==s&&e.userDel(t)}})},chooseJob:function(t){console.log(t),this.brandType=t,this.showJobList=[];for(var e=0;e<this.jobList.length;e++)"brand"==t&&"1"===this.jobList[e].type?this.showJobList.push(this.jobList[e]):"shop"==t&&"0"===this.jobList[e].type&&this.showJobList.push(this.jobList[e])},backShopId:function(t){console.log(t),this.shopIds=t},ensure:function(t){if(this.showJob=!1,"all"==t){this.selectedJob="";for(var e=0;e<this.jobList.length;e++)-1!=this.jobIds.brand.indexOf(this.jobList[e].id)?this.selectedJob+=this.jobList[e].name+",":-1!=this.jobIds.shop.indexOf(this.jobList[e].id)&&(this.selectedJob+=this.jobList[e].name+",");this.selectedJob||(this.selectedJob="全部职位")}},checkDetail:function(t){this.isStaff=!0,this.edit=!0,this.info=t},staff:function(){this.userIds="";for(var t=0;t<this.activityPageList.length;t++)this.activityPageList[t].selected&&(this.userIds+=this.activityPageList[t].userId+",")},editBatch:function(){if(this.staff(),""==this.userIds)return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请选择员工"}),!1;this.userIds=this.userIds.slice(0,this.userIds.length-1),this.showBatch=!0},delBatch:function(){var t=this;if(this.staff(),""==this.userIds)return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请选择员工"}),!1;this.userIds=this.userIds.slice(0,this.userIds.length-1),this.$store.commit("setWin",{title:"提示信息",winType:"confirm",content:"确认删除？",callback:function(e){"ok"==e&&t.userDel(t.userIds)}})},getJob:function(t,e,s){if(e&&"ok"==t){var i={},o=[];"admin"==e?(this.showBatch=!1,1===s?(i.roleId="0",i.name="超级管理员",i.shopIds=[]):o.push({roleId:"0",name:"超级管理员",shopIds:[]})):(this.showBatch=!1,1===s?i=e.jobInfo:o.push(e.jobInfo)),this.userEditBrandUsers(i,o)}"cancel"==t&&(this.showBatch=!1)},getStaff:function(t){"ok"==t?(this.isStaff=!1,this.getUserList()):"closeMask"!=t&&(this.isStaff=!1)},isTrue:function(t,e){for(var s=0;s<t.length;s++)if(t[s]==e)return!0;return!1},search:function(){var t=this,e=[];this.selectedJob="";for(var s=0;s<this.jobList.length;s++)-1!=this.jobIds.brand.indexOf(this.jobList[s].id)?this.selectedJob+=this.jobList[s].name+",":-1!=this.jobIds.shop.indexOf(this.jobList[s].id)&&(this.selectedJob+=this.jobList[s].name+",");if(""==this.selectedJob&&(this.selectedJob="全部职位"),e=""!=this.staffOrJob?this.activityList.filter(function(e){return!(!e.userName||!e.mobile)&&(e.userName.indexOf(t.staffOrJob)>=0||e.mobile.indexOf(t.staffOrJob)>=0)}):n.a.deepCopy(this.activityList),0!=this.shopIds.length)for(var i=0;i<e.length;i++){var o=!1;if(e[i].brandRole.shopIds)for(var a=0;a<e[i].brandRole.shopIds.length;a++)if(-1!=this.shopIds.indexOf(e[i].brandRole.shopIds[a])){o=!0;break}if(!o)for(var r=0;r<e[i].shopRole.length;r++)if(e[i].shopRole[r].shopIds)for(var l=0;l<e[i].shopRole[r].shopIds.length;l++)if(-1!=this.shopIds.indexOf(e[i].shopRole[r].shopIds[l])){o=!0;break}o||(e.splice(i,1),i--)}var h=this.jobIds.brand,c=this.jobIds.shop;if(console.log(h),console.log(c),0!=h.length||0!=c.length)for(var d=0;d<e.length;d++){var u=!1;if(-1!=h.indexOf(e[d].brandRole.roleId)&&(u=!0),!u){for(var f=0;f<e[d].shopRole.length;f++)if(-1!=c.indexOf(e[d].shopRole[f].roleId)){u=!0;break}if(!u&&-1!=c.indexOf("-1"))for(var p=0;p<e[d].shopRole.length;p++)if(e[d].shopRole[p].roleId<1e5){u=!0;break}}u||(e.splice(d,1),d--)}this.newList=e,this.total=e.length,this.activityPageList=e.slice(0*this.num,0*this.num+this.num)},reset:function(){for(var t=0;t<this.jobList.length;t++)this.jobList[t].selected=!1;for(var e=0;e<this.shopList.length;e++)this.shopList[e].selected=!1;this.selectedJob="全部职位",this.selectedShop="全部门店",this.shopIds=[],this.jobIds.brand=[],this.jobIds.shop=[],this.staffOrJob="",this.search()}},components:{addstaffWin:function(){return s.e("addstaff_win").then(s.bind(null,"3af0"))},page:function(){return s.e("page_element").then(s.bind(null,"5921"))},addjob:function(){return s.e("addjob_win").then(s.bind(null,"f431"))},comTable:function(){return s.e("table").then(s.bind(null,"4360"))},elShopList:function(){return s.e("el_shopList").then(s.bind(null,"60ff"))}}},l=(s("f3e6"),s("d801")),h=Object(l.a)(r,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{attrs:{id:"employlist"}},[s("section",{directives:[{name:"show",rawName:"v-show",value:!t.isBatch,expression:"!isBatch"}],staticClass:"top"},[s("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click"},model:{value:t.showJob,callback:function(e){t.showJob=e},expression:"showJob"}},[s("section",[s("el-radio-group",{attrs:{size:"small"},on:{change:t.chooseJob},model:{value:t.brandType,callback:function(e){t.brandType=e},expression:"brandType"}},[s("el-radio-button",{attrs:{label:"brand"}},[t._v("品牌职位")]),t._v(" "),s("el-radio-button",{attrs:{label:"shop"}},[t._v("门店职位")])],1),t._v(" "),"brand"==t.brandType?s("div",{staticStyle:{"max-height":"170px","overflow-y":"auto","margin-top":"15px"}},[s("el-button",{staticClass:"labItem",staticStyle:{height:"28px"},attrs:{border:"",size:"mini"},on:{click:function(e){t.selallJob("brand")}}},[t._v("全部")]),t._v(" "),t._l(t.showJobList,function(e){return s("el-checkbox",{key:e.id,staticClass:"labItem",attrs:{label:e.id,border:"",size:"mini"},model:{value:t.jobIds.brand,callback:function(e){t.$set(t.jobIds,"brand",e)},expression:"jobIds.brand"}},[t._v(t._s(e.name))])})],2):t._e(),t._v(" "),"shop"==t.brandType?s("div",{staticStyle:{"max-height":"170px","overflow-y":"auto","margin-top":"15px"}},[s("el-button",{staticClass:"labItem",attrs:{size:"mini"},on:{click:function(e){t.selallJob("shop")}}},[t._v("全部")]),t._v(" "),t._l(t.showJobList,function(e){return s("el-checkbox",{key:e.id,staticClass:"labItem",attrs:{label:e.id,border:"",size:"mini"},model:{value:t.jobIds.shop,callback:function(e){t.$set(t.jobIds,"shop",e)},expression:"jobIds.shop"}},[t._v(t._s(e.name))])})],2):t._e(),t._v(" "),s("div",{staticStyle:{"margin-top":"5px"}},[s("el-button",{attrs:{size:"small"},on:{click:function(e){t.ensure("none")}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.ensure("all")}}},[t._v("确定")])],1)],1),t._v(" "),s("el-button",{staticStyle:{width:"200px",overflow:"hidden",position:"relative","text-overflow":"ellipsis","white-space":"nowrap","padding-right":"30px"},attrs:{slot:"reference",plain:""},slot:"reference"},[s("span",[t._v(t._s(t.selectedJob))]),t._v(" "),s("i",{staticClass:"el-icon-arrow-down",staticStyle:{position:"absolute",right:"0px",width:"37px"}})])],1),t._v(" "),s("elShopList",{attrs:{shopIds:t.shopIds},on:{chooseShop:t.backShopId}}),t._v(" "),s("el-input",{staticStyle:{width:"210px"},attrs:{clearable:"",placeholder:"请输入员工名称/手机号码"},model:{value:t.staffOrJob,callback:function(e){t.staffOrJob=e},expression:"staffOrJob"}}),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),s("el-button",{attrs:{type:"info"},on:{click:t.reset}},[t._v("重置")])],1),t._v(" "),s("section",{staticClass:"list",staticStyle:{width:"100%",border:"1px solid #ebeef5","border-bottom":"none"}},[s("div",{staticClass:"head"},[s("span",{directives:[{name:"show",rawName:"v-show",value:!t.isBatch,expression:"!isBatch"}]},[t._v("员工管理列表 · 共"),s("em",[t._v(t._s(t.activityList.length))]),t._v("个条目")]),t._v(" "),t._m(0),t._v(" "),t._m(1)])]),t._v(" "),s("el-table",{staticClass:"list",staticStyle:{width:"100%"},attrs:{data:t.activityPageList,border:"",stripe:"","header-cell-style":{"background-color":"#f5f7fa"}}},[s("el-table-column",{staticStyle:{"text-aline":"center"},attrs:{fixed:"",align:"center","min-width":"120","render-header":t.renderHeader,label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isBatch?s("span",{staticStyle:{cursor:"pointer"}},[s("em",{staticClass:"circle",class:{on:e.row.selected},on:{click:function(s){t.selected(e.row,e.$index)}}})]):s("span",[s("em",{staticClass:"under-line edit",on:{click:function(s){t.checkDetail(e.row)}}},[t._v("编辑")]),t._v(" "),s("em",{staticClass:"line"}),t._v(" "),s("em",{staticClass:"under-line del",on:{click:function(s){t.delStaff(e.row.userId)}}},[t._v("删除")])])]}}])}),t._v(" "),s("el-table-column",{attrs:{width:"80",align:"center",label:"序号"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.$index+1+10*(t.page-1)))])]}}])}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",label:"员工名称",prop:"userName"}}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",label:"品牌职位"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.brandRole.roleId?s("span",[t._v(t._s(e.row.brandRole.roleName))]):s("span",[t._v("--")])]}}])}),t._v(" "),s("el-table-column",{attrs:{align:"center",label:"适用门店"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.brandRole.shopCount?s("span",[t._v(t._s(e.row.brandRole.shopCount)+"家门店")]):s("span",[t._v("0家门店")])]}}])}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",label:"门店职位",prop:"shopRole"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.row.shopRole.length?s("span",{staticStyle:{cursor:"pointer"}},[s("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[s("div",t._l(e.row.shopRole,function(i,o){return s("i",{key:o+"-"},[s("i",{class:{brand:i.roleId>=1e5,shop:i.roleId<1e5}},[t._v(t._s(i.roleName))]),t._v(" "),o!=e.row.shopRole.length-1?s("i",[t._v("、")]):t._e()])})),t._v(" "),s("span",{staticStyle:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},attrs:{slot:"reference"},slot:"reference"},t._l(e.row.shopRole,function(i,o){return s("i",{key:o+"-"},[s("i",{class:{brand:i.roleId>=1e5,shop:i.roleId<1e5}},[t._v(t._s(i.roleName))]),t._v(" "),o!=e.row.shopRole.length-1?s("i",[t._v("、")]):t._e()])}))])],1):s("span",[t._v("--")])]}}])}),t._v(" "),s("el-table-column",{attrs:{align:"center",label:"适用门店",prop:"shopCount"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\t\t\t\t"+t._s(e.row.shopCount)+"家门店\n\t\t\t")]}}])})],1),t._v(" "),s("div",{staticClass:"page-box"},[s("el-pagination",{attrs:{background:"","current-page":t.page,layout:"sizes, prev, pager, next","page-sizes":[10,20,30],total:t.total},on:{"size-change":t.numChange,"current-change":t.pageChange}})],1),t._v(" "),t.isStaff?s("addstaffWin",{attrs:{edit:t.edit,jobInfo:t.info},on:{getStaff:t.getStaff}}):t._e(),t._v(" "),t.showBatch?s("addjob",{attrs:{batch:!0},on:{addJob:t.getJob}}):t._e()],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("i"),this._v("品牌指派")])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("i"),this._v("门店自建")])}],!1,null,"24e1094d",null);e.default=h.exports},f3e6:function(t,e,s){"use strict";var i=s("f9ac");s.n(i).a},f9ac:function(t,e,s){}}]);