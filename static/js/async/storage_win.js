(window.webpackJsonp=window.webpackJsonp||[]).push([["storage_win"],{1737:function(t,i,e){"use strict";e.r(i);var s=e("bbb9"),a=e("81a2"),n=e("05dd"),r=function(){return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var e=[],s=!0,a=!1,n=void 0;try{for(var r,l=t[Symbol.iterator]();!(s=(r=l.next()).done)&&(e.push(r.value),!i||e.length!==i);s=!0);}catch(t){a=!0,n=t}finally{try{!s&&l.return&&l.return()}finally{if(a)throw n}}return e}(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function l(t){return function(){var i=t.apply(this,arguments);return new Promise(function(t,e){return function s(a,n){try{var r=i[a](n),l=r.value}catch(t){return void e(t)}if(!r.done)return Promise.resolve(l).then(function(t){s("next",t)},function(t){s("throw",t)});t(l)}("next")})}}var o={data:function(){return{title:"",okstyle:{style:{background:"#F7931E"},content:"确定"},isShowCa:!1,startObj:{time:s.a.getTime({time:new Date}).start,show:!1,detail:!1,width:150},endObj:{time:s.a.getTime({time:new Date}).end,show:!1,detail:!1,width:150},unitList:[],infoList:[],batchNum:"",supplyer:"",batchList:[],list:[],options:[],minUnit:"",selUnit:"",materName:"",validityType:{0:"月",1:"日",2:"年"},isSurplus:!0}},props:["batchInfo"],mounted:function(){this.title="批次分配",this.infoList=s.a.deepCopy(this.batchInfo),this.batchList=this.infoList.batch,this.list=s.a.deepCopy(this.infoList.batch),this.options=this.infoList.options.map(function(t){return t.label}),this.selUnit=this.infoList.selUnit;var t=!0,i=!1,e=void 0;try{for(var a,n=this.infoList.materialUnit[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){var r=a.value;1==r.isMin&&(this.infoList.isMin=r.name,this.minUnit=r),1==r.isDefault&&(this.infoList.isDefault=r.name)}}catch(t){i=!0,e=t}finally{try{!t&&n.return&&n.return()}finally{if(i)throw e}}this.selOn()},components:{win:function(){return e.e("win").then(e.bind(null,"f60a"))},selectbtn:function(){return e.e("select_btn").then(e.bind(null,"3d41"))},calendar:function(){return e.e("calendar_result").then(e.bind(null,"9265"))}},methods:{getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},getMaterialBatch:function(){var t=this;return l(regeneratorRuntime.mark(function i(){var e,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.a.getMaterialBatch({data:{mid:371}});case 2:for(e=i.sent,s=0;s<e.list.length;s++)e.list[s].useNum="",e.list[s].useWeight="";t.batchList=e.list,t.infoList=e,t.getMaterialDetail();case 7:case"end":return i.stop()}},i,t)}))()},getMaterialDetail:function(){var t=this;return l(regeneratorRuntime.mark(function i(){var e,s,n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.a.getMaterialDetail({data:{mid:t.batchInfo.materialId}});case 2:for(e=i.sent,t.infoList.materialName=e.name,s=0;s<e.category.length;s++)t.infoList.materialCategoryName+=e.category[s].name+",";for(n=0;n<e.uintData.length;n++)1==e.unitData[n].isDefault&&(t.infoList.isDefault=e.unitData[n].name),1==e.unitData[n].isMin&&(t.infoList.isMin=e.unitData[n].name);case 6:case"end":return i.stop()}},i,t)}))()},getData:function(t){if(this.infoList.batch=this.batchList,this.infoList.selUnit=this.selUnit,"ok"==t)for(var i=0;i<this.batchList.length;i++){if(this.batchList[i].usemin>this.batchList[i].surplus)return this.$store.commit("setWin",{winType:"alert",content:"批次编号"+this.batchList[i].batchCode+"剩余数量不能大于领料数量"}),!1;if(this.batchList[i].backmin>1*this.batchList[i].usemin)return this.$store.commit("setWin",{winType:"alert",content:"批次编号"+this.batchList[i].batchCode+"回库数量不足"}),!1}this.$emit("getWin",t,this.infoList,this.batchList)},getTime:function(t){this.startTime=t.startTime,this.endTime=t.endTime,this.isShowCa=!1},showCalendar:function(){this.isShowCa=!this.isShowCa},transFormDate:function(t){return s.a.format(new Date(t),"yyyy-MM-dd")},getmin:function(t){for(var i=0;i<this.batchList.length;i++)"1"==t?(""!==this.batchList[i].backNum?this.batchList[i].backNum=(this.batchList[i].backNum+"").replace(/[^\d\.]/g,""):this.batchList[i].backNum="",""!==this.batchList[i].backWeight?this.batchList[i].backWeight=(this.batchList[i].backWeight+"").replace(/[^\d\.]/g,""):this.batchList[i].backWeight="",this.batchList[i].backmin=this.batchList[i].backNum*this.selUnit.value+1*this.batchList[i].backWeight):(""!==this.batchList[i].useNum?this.batchList[i].useNum=(this.batchList[i].useNum+"").replace(/[^\d\.]/g,""):this.batchList[i].useNum="",""!==this.batchList[i].useWeight?this.batchList[i].useWeight=(this.batchList[i].useWeight+"").replace(/[^\d\.]/g,""):this.batchList[i].useWeight="",this.batchList[i].usemin=this.batchList[i].useNum*this.selUnit.value+1*this.batchList[i].useWeight)},setDefaultItem:function(t){var i=this.comUnit(t.surplus,this.selUnit.value,this.selUnit.name,this.minUnit.name,!0);1==this.selUnit.isMin?t.useNum=i.tNull:(t.useNum=i.oNull,t.useWeight=i.tNull),t.usemin=0},selOn:function(){var t=!0,i=!1,e=void 0;try{for(var s,a=this.batchList[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var n=s.value;if(this.infoList.batchDetail&&this.infoList.batchDetail.length){var r=!0,l=!1,o=void 0;try{for(var u,h=this.infoList.batchDetail[Symbol.iterator]();!(r=(u=h.next()).done);r=!0){var c=u.value;if(c.id==n.id){var m=this.comUnit(c.consumeNum,this.selUnit.value,this.selUnit.name,this.minUnit.name,!0);1==this.selUnit.isMin?c.useNum=m.tNull:(c.useNum=m.oNull,c.useWeight=m.tNull);var v=this.comUnit(c.returnNum,this.selUnit.value,this.selUnit.name,this.minUnit.name,!0);1==this.selUnit.isMin?c.backNum=v.tNull:(c.backNum=v.oNull,c.backWeight=v.tNull)}}}catch(t){l=!0,o=t}finally{try{!r&&h.return&&h.return()}finally{if(l)throw o}}}else this.setDefaultItem(n),n.backNum="",n.backWeight=""}}catch(t){i=!0,e=t}finally{try{!t&&a.return&&a.return()}finally{if(i)throw e}}},comUnit:function(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];var s=r(i,5),a=s[0],l=s[1],o=s[2],u=s[3],h=s[4];return n.a.comUnit(a,l,o,u,h)},allUse:function(){if(this.isSurplus){var t=!0,i=!1,e=void 0;try{for(var s,a=this.batchList[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var n=s.value;n.useNum=0,n.useWeight=0,n.backNum="",n.backWeight="",n.usemin=n.surplus*this.selUnit.value+1*n.useWeight,n.backmin=0}}catch(t){i=!0,e=t}finally{try{!t&&a.return&&a.return()}finally{if(i)throw e}}}else{var r=!0,l=!1,o=void 0;try{for(var u,h=this.batchList[Symbol.iterator]();!(r=(u=h.next()).done);r=!0){var c=u.value;this.setDefaultItem(c)}}catch(t){l=!0,o=t}finally{try{!r&&h.return&&h.return()}finally{if(l)throw o}}}this.isSurplus=!this.isSurplus},allBack:function(){var t=!0,i=!1,e=void 0;try{for(var s,a=this.batchList[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var n=s.value;n.backNum=n.useNum?n.useNum:"",n.backWeight=n.useWeight?n.useWeight:"",n.backmin=n.backNum*n.selUnit.value+1*n.backWeight}}catch(t){i=!0,e=t}finally{try{!t&&a.return&&a.return()}finally{if(i)throw e}}},search:function(){if(this.batchList=[],this.startObj.time>this.endObj.time)return this.$store.commit("setWin",{winType:"alert",content:"开始时间不能大于结束时间"}),!1;for(var t=0;t<this.list.length;t++)1e3*this.list[t].productionTime<=this.endObj.time&&1e3*this.list[t].productionTime>=this.startObj.time&&this.batchList.push(this.list[t]);for(var i=0;i<this.batchList.length;i++)-1==this.batchList[i].supplier.indexOf(this.supplyer)&&(this.batchList.splice(i,1),i--);for(var e=0;e<this.batchList.length;e++)-1==this.batchList[e].batchCode.indexOf(this.batchNum)&&(this.batchList.splice(e,1),e--)},reset:function(){this.batchNum="",this.supplyer="",this.startObj.time=s.a.getTime({time:new Date}).start,this.endObj.time=s.a.getTime({time:new Date}).end,this.batchList=s.a.deepCopy(this.list)}}},u=(e("8409"),e("d801")),h=Object(u.a)(o,function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("win",{attrs:{align:"center",width:1300,height:600,ok:t.okstyle},on:{winEvent:t.getData}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),t._v(" "),e("div",{attrs:{slot:"content",id:"tan"},slot:"content"},[e("section",{staticClass:"title"},[e("div",[e("span",[t._v("物料名称："+t._s(t.infoList.materialName))]),t._v(" "),e("span",[t._v("保质期："+t._s(t.infoList.validity)+t._s(t.validityType[t.infoList.validityType]))])]),t._v(" "),e("div",[e("span",[t._v("物料单位："+t._s(t.options.join(",")))]),t._v(" "),e("span",[t._v("分类："+t._s(t.infoList.materialCategoryName))])]),t._v(" "),e("div",[e("span",[t._v("默认单位："+t._s(t.infoList.isDefault))]),t._v(" "),e("span",[t._v("最小单位："+t._s(t.infoList.isMin))])])]),t._v(" "),e("section",{staticClass:"menu"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.batchNum,expression:"batchNum"}],attrs:{type:"text",placeholder:"请输入批次编号"},domProps:{value:t.batchNum},on:{input:function(i){i.target.composing||(t.batchNum=i.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.supplyer,expression:"supplyer"}],attrs:{type:"text",placeholder:"请输入供应商"},domProps:{value:t.supplyer},on:{input:function(i){i.target.composing||(t.supplyer=i.target.value)}}}),t._v(" "),e("div",{staticClass:"canMulti"},[e("calendar",{staticClass:"fl",attrs:{pObj:t.startObj},on:{throwTime:t.getStartTime}}),t._v(" "),e("div",{staticClass:"time",staticStyle:{width:"25px"}},[t._v("---")]),t._v(" "),e("calendar",{staticClass:"fl",attrs:{pObj:t.endObj},on:{throwTime:t.getEndTime}})],1),t._v(" "),e("span",{staticClass:"blue btn",on:{click:t.search}},[t._v("筛选")]),t._v(" "),e("span",{staticClass:"gray btn",on:{click:t.reset}},[t._v("重置")])]),t._v(" "),e("section",{staticClass:"content"},[e("div",{staticClass:"top"},[e("ul",[e("li",[t._v("序号")]),t._v(" "),e("li",[t._v("批次编号")]),t._v(" "),e("li",[t._v("生产日期")]),t._v(" "),e("li",[t._v("供应商")]),t._v(" "),e("li",[t._v("所属仓库")]),t._v(" "),e("li",[t._v("领料数量/重量")]),t._v(" "),e("li",[t._v("剩余数量/重量"),e("i",{class:{warning:t.isSurplus},on:{click:t.allUse}},[t._v(t._s(t.isSurplus?"全部消耗":"全部剩余"))])]),t._v(" "),e("li",[t._v("回库数量/重量"),e("i",{staticStyle:{color:"#27A8E0"},on:{click:t.allBack}},[t._v("剩余回库")])])])]),t._v(" "),t.batchList&&0!=t.batchList.length?e("section",t._l(t.batchList,function(i,s){return e("div",{key:s,staticClass:"list clearfix"},[e("ul",[e("li",[t._v(t._s(s+1))]),t._v(" "),e("li",{attrs:{title:i.batchCode}},[t._v(t._s(i.batchCode))]),t._v(" "),e("li",[t._v(t._s(t.transFormDate(1e3*i.productionTime)))]),t._v(" "),e("li",{attrs:{title:i.supplier}},[i.supplier?e("i",[t._v(t._s(i.supplier))]):e("i",[t._v("--")])]),t._v(" "),e("li",{attrs:{title:i.warehouseName}},[i.warehouseName?e("i",[t._v(t._s(i.warehouseName))]):e("i",[t._v("--")])]),t._v(" "),e("li",{attrs:{title:t.comUnit(i.surplus,t.selUnit.value,t.selUnit.name,t.minUnit.name)}},[t._v(t._s(t.comUnit(i.surplus,t.selUnit.value,t.selUnit.name,t.minUnit.name)))]),t._v(" "),e("li",{staticClass:"end"},[e("div",{staticClass:"input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.useNum,expression:"item.useNum"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin()},domProps:{value:i.useNum},on:{input:function(e){e.target.composing||t.$set(i,"useNum",e.target.value)}}}),t._v(" "),t.selUnit.name?e("span",{attrs:{title:t.selUnit.name}},[t._v(t._s(t.selUnit.name))]):e("span",{attrs:{title:t.infoList.isDefault}},[t._v(t._s(t.infoList.isDefault))])]),t._v(" "),1!=t.selUnit.isMin?[e("i",[t._v("+")]),t._v(" "),e("div",{staticClass:"input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.useWeight,expression:"item.useWeight"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin()},domProps:{value:i.useWeight},on:{input:function(e){e.target.composing||t.$set(i,"useWeight",e.target.value)}}}),t._v(" "),e("span",{attrs:{title:t.infoList.isMin}},[t._v(t._s(t.infoList.isMin))])])]:t._e()],2),t._v(" "),e("li",{staticClass:"end"},[e("div",{staticClass:"input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.backNum,expression:"item.backNum"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin("1")},domProps:{value:i.backNum},on:{input:function(e){e.target.composing||t.$set(i,"backNum",e.target.value)}}}),t._v(" "),t.selUnit.name?e("span",{attrs:{title:t.selUnit.name}},[t._v(t._s(t.selUnit.name))]):e("span",{attrs:{title:t.infoList.isDefault}},[t._v(t._s(t.infoList.isDefault))])]),t._v(" "),1!=t.selUnit.isMin?[e("i",[t._v("+")]),t._v(" "),e("div",{staticClass:"input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.backWeight,expression:"item.backWeight"}],attrs:{type:"text",placeholder:"输入数字",onkeyup:t.getmin("1")},domProps:{value:i.backWeight},on:{input:function(e){e.target.composing||t.$set(i,"backWeight",e.target.value)}}}),t._v(" "),e("span",{attrs:{title:t.infoList.isMin}},[t._v(t._s(t.infoList.isMin))])])]:t._e()],2)])])})):e("section",{attrs:{id:"emptyData"}},[t._v("\n\t\t\t\t\t暂无数据\n\t\t\t\t")])])])])],1)},[],!1,null,"1bde61e6",null);i.default=h.exports},8409:function(t,i,e){"use strict";var s=e("d061");e.n(s).a},d061:function(t,i,e){}}]);