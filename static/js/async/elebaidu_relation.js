(window.webpackJsonp=window.webpackJsonp||[]).push([["elebaidu_relation"],{a10a:function(t,e,o){},b478:function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"shopList",attrs:{id:"conBox"}},[o("div",{staticClass:"shopList"},[o("p",[t._v("请关联商品")]),t._v(" "),t._m(0),t._v(" "),o("div",{staticClass:"contentBox"},t._l(t.eleGoods,function(e,s){return o("div",{key:s,staticClass:"content"},[o("div",{staticClass:"category"},[t._v(t._s(e.categoryName))]),t._v(" "),o("div",{staticClass:"sdgoods"},t._l(e.list,function(e,s){return o("ul",{key:s},[o("li",{staticStyle:{"border-left":"5px solid #F7F7F7"}},[t._v(t._s(e.specName))]),t._v(" "),e.goodsId?o("li",[o("span",{staticClass:"goodsName"},[t._v(t._s(t.getGoodsName(e.goodsId,e.isPackage)))]),t._v(" "),o("i",{staticClass:"edit",on:{click:function(o){t.editGoods(e)}}}),t._v(" "),o("i",{staticClass:"delete",on:{click:function(o){t.deleteGoods(e)}}})]):o("li",[o("span",{staticClass:"goodsicon"}),t._v(" "),o("a",{attrs:{href:"javascript:void(0)"},on:{click:function(o){t.showGoods(e)}}},[t._v("选择关联菜品")])])])}))])}))]),t._v(" "),t._m(1),t._v(" "),o("div",[o("a",{staticClass:"gray",staticStyle:{"margin-top":"20px"},attrs:{href:"javascript:void(0);"},on:{click:t.previous}},[t._v("上一步")]),t._v(" "),o("a",{staticClass:"yellow",staticStyle:{"margin-top":"20px"},attrs:{href:"javascript:void(0);"},on:{click:t.success}},[t._v("完成")])]),t._v(" "),t.relationWin.winshow?o("elerelation",{ref:"relationwin",attrs:{width:t.relationWin.width,height:t.relationWin.height,title:t.relationWin.title},on:{relationEvent:t.relationevn}}):t._e()],1)};s._withStripped=!0;var i=o("81a2"),n=o("f6ce");function a(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,o){return function s(i,n){try{var a=e[i](n),r=a.value}catch(t){return void o(t)}if(!a.done)return Promise.resolve(r).then(function(t){s("next",t)},function(t){s("throw",t)});t(r)}("next")})}}var r=n.a.session("goodList"),l=n.a.session("packageList"),d={data:function(){return{boxList:[],urlData:"",showMt:!1,goods:r,packageGoods:l,fixed:[],category:"",eleShopList:[],relation:!0,eleShopid:"",eleGoods:[],edit:!1,bandtype:"",userData:"",brandId:"",relationWin:{width:920,height:600,title:"关联商品",winshow:!1}}},mounted:function(){this.eleShopid=this.$route.query.id,this.bandtype=n.a.session("waimai"),console.log(this.bandtype),this.userData=n.a.session("userShop"),this.brandId=0==this.userData.currentShop.ischain?0:this.userData.currentShop.brandId;for(var t=0;t<l.length;t++)0==l[t].type&&2!=l[t].status&&this.fixed.push(l[t]);this.init()},methods:{init:function(){var t=this;return a(regeneratorRuntime.mark(function e(){var o,s,n,a,r,l,d,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=t.bandtype){e.next=10;break}return e.next=3,i.a.takeoutGetCategoryList({data:{eleShopId:t.eleShopid}});case 3:o=e.sent,t.category=o,t.eleGoods=[],console.log(o),t.reqList(t.category.length-1),e.next=17;break;case 10:if(3!=t.bandtype){e.next=17;break}return e.next=13,i.a.getBaiduGoods({data:{brandId:t.brandId,shopId:t.eleShopid,type:2}});case 13:for(s=e.sent,t.eleGoods=s,n=0;n<t.eleGoods.length;n++)for(a=0;a<t.eleGoods[n].list.length;a++)""!==t.eleGoods[n].list[a].goodsId&&(t.edit=!0);if(!t.edit)for(r=0;r<t.eleGoods.length;r++)for(l=0;l<t.eleGoods[r].list.length;l++)for(d=0;d<t.goods.length;d++)c=t.eleGoods[r].list[l].specName.split("("),t.goods[d].goodsName.split("(")[0]==c[0]&&(t.eleGoods[r].list[l].goodsId=")"==c[1]?t.goods[d].id:"",t.eleGoods[r].list[l].isPackage=0);case 17:case"end":return e.stop()}},e,t)}))()},reqList:function(t){var e=this;return a(regeneratorRuntime.mark(function o(){var s,a,r,l,d,c,h,u;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(t<0)){o.next=5;break}return n.a.session("waimaiGoods",e.eleGoods),o.abrupt("return");case 5:return o.next=7,i.a.getGoodsByCategoryId({data:{categoryId:e.category[t].categoryId,page:1,num:9999,type:2}});case 7:if(s=o.sent,(a=s)[0].list.length>0){for(r=0;r<e.category.length;r++)for(l=0;l<a.length;l++)e.category[r].categoryId==a[l].categoryId&&(a[l].categoryName=e.category[r].categoryName);for(d=0;d<a[0].list.length;d++)""!==a[0].list[d].goodsId&&(e.edit=!0);if(!e.edit)for(c=0;c<a[0].list.length;c++)for(h=0;h<e.goods.length;h++)u=a[0].list[c].specName.split("("),e.goods[h].goodsName.split("(")[0]==u[0]&&(a[0].list[c].goodsId=")"==u[1]?e.goods[h].id:"",a[0].list[c].isPackage=0);e.eleGoods.unshift(a[0])}e.reqList(t-1);case 11:case"end":return o.stop()}},o,e)}))()},showGoods:function(t){this.item=t,this.relationWin.winshow=!0},editGoods:function(t){this.item=t,this.relationWin.winshow=!0},deleteGoods:function(t){var e,o=this;this.$store.commit("setWin",{title:"提示",content:"是否取消关联?",winType:"confirm",callback:(e=a(regeneratorRuntime.mark(function e(s){var i,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("ok"==s)for(i=0;i<o.eleGoods.length;i++)for(n=0;n<o.eleGoods[i].list.length;n++)t.goodsId==o.eleGoods[i].list[n].goodsId&&(o.eleGoods[i].list[n].goodsId="");case 1:case"end":return e.stop()}},e,o)})),function(t){return e.apply(this,arguments)})})},previous:function(){window.history.go(-1)},success:function(){var t=this;return a(regeneratorRuntime.mark(function e(){var o,s,n,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o=[],s=0;s<t.eleGoods.length;s++)for(n=0;n<t.eleGoods[s].list.length;n++)""!==t.eleGoods[s].list[n].goodsId&&o.push(t.eleGoods[s].list[n]);for(a=0;a<o.length;a++)o[a].goodsId=parseInt(o[a].goodsId);if(0!=o.length){e.next=6;break}return t.alert("提示","请关联菜品！"),e.abrupt("return",!1);case 6:return r=t.edit?"editGoodsRelation":"addGoodsRelation",e.next=9,i.a[r]({data:{type:t.bandtype,relation:JSON.stringify(o)}});case 9:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:t.init(),window.close();case 14:case"end":return e.stop()}},e,t)}))()},relationevn:function(t){this.relationWin.winshow=!1,"ok"==t&&this.relationClose()},relationClose:function(){var t=this.$refs.relationwin;if(console.log(t.fixedIndex),0==t.goodsIndex.length&&0==t.fixedIndex.length)return this.alert("提示","请选择菜品！"),this.relationWin.winshow=!0,!1;for(var e=0;e<this.eleGoods.length;e++)for(var o=0;o<this.eleGoods[e].list.length;o++)if(t.ispack){if(1==this.eleGoods[e].list[o].isPackage&&this.eleGoods[e].list[o].goodsId==t.fixedIndex[0])return this.relationWin.winshow=!0,this.alert("提示","该菜品已关联外卖菜品，请重新选择！"),!1}else if(0==this.eleGoods[e].list[o].isPackage&&this.eleGoods[e].list[o].goodsId==t.goodsIndex[0])return this.relationWin.winshow=!0,this.alert("提示","该菜品已关联外卖菜品，请重新选择！"),!1;for(var s=0;s<this.eleGoods.length;s++)for(var i=0;i<this.eleGoods[s].list.length;i++)this.item.specId==this.eleGoods[s].list[i].specId&&(t.ispack?(this.eleGoods[s].list[i].goodsId=t.fixedIndex[0],this.eleGoods[s].list[i].isPackage=1):(this.eleGoods[s].list[i].goodsId=t.goodsIndex[0],this.eleGoods[s].list[i].isPackage=0))},alert:function(t,e){this.$store.commit("setWin",{title:t,content:e})},getGoodsName:function(t,e){if(0==e){for(var o=0;o<this.goods.length;o++)if(t==this.goods[o].id)return this.goods[o].goodsName}else for(var s=0;s<this.fixed.length;s++)if(t==this.fixed[s].id)return this.fixed[s].packageName}},components:{elerelation:function(){return o.e("elerelation_win").then(o.bind(null,"30af"))}}},c=(o("dab2"),o("7610")),h=Object(c.a)(d,s,[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"shopTitle title"},[e("li",{staticStyle:{width:"230px"}}),this._v(" "),e("li",{staticStyle:{width:"560px"}},[this._v("外卖商品")]),this._v(" "),e("li",{staticStyle:{width:"600px"}},[this._v("闪店系统")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip-icon"},[e("i"),this._v(" "),e("span",{staticStyle:{color:"#999999","font-size":"16px"}},[this._v("请确保关联所有商品，否则在外卖渠道统计中未关联部分数据将不显示")])])}],!1,null,"ad63d172",null);h.options.__file="src\\module\\outfood\\accredit\\elebaidu_relation.vue";e.default=h.exports},dab2:function(t,e,o){"use strict";var s=o("a10a");o.n(s).a}}]);