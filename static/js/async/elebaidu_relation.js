(window.webpackJsonp=window.webpackJsonp||[]).push([["elebaidu_relation"],{"18bd":function(t,e,i){"use strict";var s=i("75c1");i.n(s).a},"75c1":function(t,e,i){},b478:function(t,e,i){"use strict";i.r(e);var s=i("81a2"),o=i("f6ce");function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function s(o,n){try{var r=e[o](n),a=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(a).then(function(t){s("next",t)},function(t){s("throw",t)});t(a)}("next")})}}var r=o.a.session("goodList"),a=o.a.session("packageList"),l={data:function(){return{boxList:[],urlData:"",showMt:!1,goods:r,packageGoods:a,fixed:[],category:"",eleShopList:[],relation:!0,eleShopid:"",eleGoods:[],edit:!1,bandtype:"",userData:"",brandId:"",relationWin:{width:920,height:600,title:"关联商品",winshow:!1}}},mounted:function(){this.eleShopid=this.$route.query.id,this.bandtype=o.a.session("waimai"),console.log(this.bandtype),this.userData=o.a.session("userShop"),document.querySelector("#warrant").style.height="100%",this.brandId=0==this.userData.currentShop.ischain?0:this.userData.currentShop.brandId;for(var t=0;t<a.length;t++)0==a[t].type&&2!=a[t].status&&this.fixed.push(a[t]);this.init()},methods:{init:function(){var t=this;return n(regeneratorRuntime.mark(function e(){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=t.bandtype){e.next=10;break}return e.next=3,s.a.takeoutGetCategoryList({data:{eleShopId:t.eleShopid}});case 3:i=e.sent,t.category=i,t.eleGoods=[],console.log(i),t.reqList(t.category.length-1),e.next=15;break;case 10:if(3!=t.bandtype){e.next=15;break}return e.next=13,s.a.getBaiduGoods({data:{brandId:t.brandId,shopId:t.eleShopid,type:2}});case 13:o=e.sent,t.eleGoods=o;case 15:case"end":return e.stop()}},e,t)}))()},reqList:function(t){var e=this;return n(regeneratorRuntime.mark(function i(){var n,r,a,l;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(t<0)){i.next=5;break}return o.a.session("waimaiGoods",e.eleGoods),i.abrupt("return");case 5:return i.next=7,s.a.getGoodsByCategoryId({data:{categoryId:e.category[t].categoryId,page:1,num:9999,type:2}});case 7:if(n=i.sent,(r=n)[0].list.length>0){for(a=0;a<e.category.length;a++)for(l=0;l<r.length;l++)e.category[a].categoryId==r[l].categoryId&&(r[l].categoryName=e.category[a].categoryName);e.eleGoods.unshift(r[0])}e.reqList(t-1);case 11:case"end":return i.stop()}},i,e)}))()},showGoods:function(t){this.item=t,this.relationWin.winshow=!0},editGoods:function(t){this.item=t,this.relationWin.winshow=!0},deleteGoods:function(t){var e,i=this;this.$store.commit("setWin",{title:"提示",content:"是否取消关联?",winType:"confirm",callback:(e=n(regeneratorRuntime.mark(function e(s){var o,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("ok"==s)for(o=0;o<i.eleGoods.length;o++)for(n=0;n<i.eleGoods[o].list.length;n++)t.goodsId==i.eleGoods[o].list[n].goodsId&&(i.eleGoods[o].list[n].goodsId="");case 1:case"end":return e.stop()}},e,i)})),function(t){return e.apply(this,arguments)})})},previous:function(){window.history.go(-1)},success:function(){var t=this;return n(regeneratorRuntime.mark(function e(){var i,o,n,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],o=0;o<t.eleGoods.length;o++)for(n=0;n<t.eleGoods[o].list.length;n++)""!==t.eleGoods[o].list[n].goodsId&&i.push(t.eleGoods[o].list[n]);for(r=0;r<i.length;r++)i[r].goodsId=parseInt(i[r].goodsId);if(0!=i.length){e.next=6;break}return t.alert("提示","请关联菜品！"),e.abrupt("return",!1);case 6:return a=t.edit?"editGoodsRelation":"addGoodsRelation",e.next=9,s.a[a]({data:{type:t.bandtype,relation:JSON.stringify(i)}});case 9:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:t.init(),window.close();case 14:case"end":return e.stop()}},e,t)}))()},relationevn:function(t){this.relationWin.winshow=!1,"ok"==t&&this.relationClose()},relationClose:function(){var t=this.$refs.relationwin;if(console.log(t.fixedIndex),0==t.goodsIndex.length&&0==t.fixedIndex.length)return this.alert("提示","请选择菜品！"),this.relationWin.winshow=!0,!1;for(var e=0;e<this.eleGoods.length;e++)for(var i=0;i<this.eleGoods[e].list.length;i++)if(t.ispack){if(1==this.eleGoods[e].list[i].isPackage&&this.eleGoods[e].list[i].goodsId==t.fixedIndex[0])return this.relationWin.winshow=!0,this.alert("提示","该菜品已关联外卖菜品，请重新选择！"),!1}else if(0==this.eleGoods[e].list[i].isPackage&&this.eleGoods[e].list[i].goodsId==t.goodsIndex[0])return this.relationWin.winshow=!0,this.alert("提示","该菜品已关联外卖菜品，请重新选择！"),!1;for(var s=0;s<this.eleGoods.length;s++)for(var o=0;o<this.eleGoods[s].list.length;o++)this.item.specId==this.eleGoods[s].list[o].specId&&(t.ispack?(this.eleGoods[s].list[o].goodsId=t.fixedIndex[0],this.eleGoods[s].list[o].isPackage=1):(this.eleGoods[s].list[o].goodsId=t.goodsIndex[0],this.eleGoods[s].list[o].isPackage=0))},alert:function(t,e){this.$store.commit("setWin",{title:t,content:e})},getGoodsName:function(t,e){if(0==e){for(var i=0;i<this.goods.length;i++)if(t==this.goods[i].id)return this.goods[i].goodsName}else for(var s=0;s<this.fixed.length;s++)if(t==this.fixed[s].id)return this.fixed[s].packageName}},components:{elerelation:function(){return i.e("elerelation_win").then(i.bind(null,"30af"))}}},d=(i("18bd"),i("d801")),c=Object(d.a)(l,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopList",attrs:{id:"conBox"}},[i("div",{staticClass:"shopList"},[i("p",[t._v("请关联商品")]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"contentBox"},t._l(t.eleGoods,function(e,s){return i("div",{key:s,staticClass:"content"},[i("div",{staticClass:"category"},[t._v(t._s(e.categoryName))]),t._v(" "),i("div",{staticClass:"sdgoods"},t._l(e.list,function(e,s){return i("ul",{key:s},[i("li",{staticStyle:{"border-left":"5px solid #F7F7F7"}},[t._v(t._s(e.specName))]),t._v(" "),e.goodsId?i("li",[i("span",{staticClass:"goodsName"},[t._v(t._s(t.getGoodsName(e.goodsId,e.isPackage)))]),t._v(" "),i("i",{staticClass:"edit",on:{click:function(i){t.editGoods(e)}}}),t._v(" "),i("i",{staticClass:"delete",on:{click:function(i){t.deleteGoods(e)}}})]):i("li",[i("span",{staticClass:"goodsicon"}),t._v(" "),i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(i){t.showGoods(e)}}},[t._v("选择关联菜品")])])])}))])}))]),t._v(" "),t._m(1),t._v(" "),i("div",[i("a",{staticClass:"gray",staticStyle:{"margin-top":"20px"},attrs:{href:"javascript:void(0);"},on:{click:t.previous}},[t._v("上一步")]),t._v(" "),i("a",{staticClass:"yellow",staticStyle:{"margin-top":"20px"},attrs:{href:"javascript:void(0);"},on:{click:t.success}},[t._v("完成")])]),t._v(" "),t.relationWin.winshow?i("elerelation",{ref:"relationwin",attrs:{width:t.relationWin.width,height:t.relationWin.height,title:t.relationWin.title},on:{relationEvent:t.relationevn}}):t._e()],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"shopTitle title"},[e("li",{staticStyle:{width:"230px"}}),this._v(" "),e("li",{staticStyle:{width:"560px"}},[this._v("外卖商品")]),this._v(" "),e("li",{staticStyle:{width:"600px"}},[this._v("闪店系统")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip-icon"},[e("i"),this._v(" "),e("span",{staticStyle:{color:"#999999","font-size":"16px"}},[this._v("请确保关联所有商品，否则在外卖渠道统计中未关联部分数据将不显示")])])}],!1,null,"2c967c2c",null);e.default=c.exports}}]);