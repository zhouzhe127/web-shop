(window.webpackJsonp=window.webpackJsonp||[]).push([["employee_manage"],{"04fb":function(e,t,n){"use strict";n.r(t);var s=n("81a2"),i=n("f6ce");function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function s(i,a){try{var o=t[i](a),c=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(c).then(function(e){s("next",e)},function(e){s("throw",e)});e(c)}("next")})}}var o={data:function(){return{isAdd:!0,orginList:[],list:[],showWin:!1,employeeId:"",employeeIndex:"",info:"",assignmentTypes:[{name:"全部",type:"0"},{name:"品牌指派",type:"1"},{name:"门店自建",type:"2"}],selectAssignmentType:"",jobList:[],selectJob:{},seachValue:"",seachCacheObj:{seachValue:"",selectAssignmentType:"",selectJob:{}},recType:"",page:1,pagenum:10,pagenumArr:[10,20,50],batch:!1,batchIndexs:{},showBatchJobs:!1,ischain:0}},computed:{totalPage:function(){return Math.ceil(this.list.length/this.pagenum)},pagedList:function(){var e=this.selectAssignmentType,t=this.selectJob,n=this.seachValue,s=this.orginList;return"1"===e?s=s.filter(function(e){return e.roleId>=1e5||e.roleId+""=="0"}):"2"===e&&(s=s.filter(function(e){return e.roleId<=1e5&&e.roleId+""!="0"})),!t.id&&"0"!==t.id||t.id+""=="-1"||(s=s.filter(function(e){return e.roleId===t.id})),""!==n&&(this.page=1,s=s.filter(function(e){return!(!e.userName||!e.mobile)&&(e.userName.indexOf(n)>=0||e.mobile.indexOf(n)>=0)})),this.list=s,this.list.slice((this.page-1)*this.pagenum,this.page*this.pagenum)},reduceJobList:function(){return"2"==this.selectAssignmentType?this.jobList.filter(function(e){return e.id<1e5&&e.id+""!="0"||"全部"==e.name}):"1"==this.selectAssignmentType?this.jobList.filter(function(e){return e.id>=1e5||e.id+""=="0"||"全部"==e.name}):this.jobList}},created:function(){var e=i.a.session("userShop");this.ischain=e.currentShop.ischain,this.$store.commit("setPageTools",[{name:"新建员工",className:["addStaff","export-btn"],fn:this.add,type:2},{name:"批量操作",className:["addStaff","export-btn"],fn:this.changeBatchBtn}]),this.init()},methods:{renderHeader:function(e,t){var n=t.column;return this.batch?e("span",{},[e("span",{class:"edit",style:"color:#F8931F;cursor:pointer;margin-right:20px;",on:{click:this.batchEdit}},"编辑"),e("span",{class:"del",style:"color: #FD3E1F;cursor:pointer",on:{click:this.batchDel}},"删除")]):e("span",n.label)},init:function(){this.getUserList(),this.getJobList()},getUserList:function(){var e=this;return a(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.getUserList();case 2:n=t.sent,e.orginList=n,e.list=n;case 5:case"end":return t.stop()}},t,e)}))()},getJobList:function(){var e=this;return a(regeneratorRuntime.mark(function t(){var n,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.getUserRoleList();case 2:n=t.sent,i={id:"-1",name:"全部",nodeIds:"",nodeNum:"0",personNum:"0",type:"0",sort:"1"},a={id:"0",name:"超级管理员",nodeIds:"3051",nodeNum:"1",personNum:"0",type:"1",sort:"2"},n&&(e.selectJob={id:"",name:"请选择职位"},n.unshift(a),n.unshift(i),e.jobList=n);case 6:case"end":return t.stop()}},t,e)}))()},selectJobFilte:function(e){this.page=1,this.selectJob=this.reduceJobList[e]},selectAssignmentTypeFilte:function(){this.recType="",this.page=1,this.selectJob={id:"-1",name:"全部",nodeIds:"",nodeNum:"0",personNum:"0",type:"0",sort:"1"}},seachFn:function(){this.page=1,this.seachCacheObj={seachValue:this.seachValue,selectAssignmentType:this.selectAssignmentType,selectJob:this.selectJob}},resetFn:function(){this.seachValue="",this.selectAssignmentType="",this.recType="",this.page=1},handleSizeChange:function(e){this.pagenum=e,this.page=1},pageChange:function(e){this.page=e},add:function(){this.isAdd=!0,this.showWin=!0},changeBatchBtn:function(){this.batch?(this.batch=!1,this.batchIndexs={},this.$store.commit("setPageTools",[{name:"新建员工",className:["addStaff","export-btn"],fn:this.add,type:2},{name:"批量操作",className:["addStaff","export-btn"],fn:this.changeBatchBtn}])):(this.batch=!0,this.batchIndexs={},this.$store.commit("setPageTools",[{name:"完成操作",className:["addStaff","export-btn"],fn:this.changeBatchBtn}]))},selectItemInBatch:function(e,t){var n={},s=0;for(var i in this.batchIndexs)n[i]=this.batchIndexs[i],s++;if(e in n)delete n[e];else{if(s>=10)return void this.$store.commit("setWin",{content:"批量管理最多选择十人"});n[e]=t}this.batchIndexs=n},edit:function(e,t){this.isAdd=!1,this.employeeId=e,this.employeeIndex=t,this.showWin=!0},delEmployeeFn:function(e,t){var n=this;this.$store.commit("setWin",{title:"操作提示",winType:"confirm",content:"确认删除员工 "+(this.pagedList[t].userName||"")+"？",callback:function(s){"ok"==s&&n.delEmployee(e,t)}})},delEmployee:function(e,t){var n=this;return a(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.userDel({data:{userId:e}});case 2:i.sent?(n.getUserList(),n.batch&&n.changeBatchBtn(),n.$store.commit("setWin",{content:"删除员工"+n.pagedList[t].name+"成功",autoHideTime:1e3})):n.$store.commit("setWin",{title:"错误提示",winType:"alter",content:"数据返回为空"});case 4:case"end":return i.stop()}},i,n)}))()},doThrowWinResult:function(e,t){"ok"==e&&(this.isAdd?(this.orginList.unshift(t),this.showWin=!1,this.$store.commit("setWin",{content:"新增员工成功",autoHideTime:1e3}),this.getUserList()):this.isAdd||(this.getUserList(),this.$store.commit("setWin",{content:"修改员工信息成功",autoHideTime:1e3}),this.showWin=!1)),"cancel"==e&&(this.showWin=!1),"close"==e&&(this.showWin=!1)},batchEdit:function(){0==Object.keys(this.batchIndexs).length?this.$store.commit("setWin",{content:"请先选择员工"}):this.showBatchJobs=!0},batchDel:function(){var e=this;if(0==Object.keys(this.batchIndexs).length)this.$store.commit("setWin",{content:"请先选择员工"});else{var t=Object.values(this.batchIndexs),n=Object.keys(this.batchIndexs),s=n.map(function(t){return e.list[t].name||""});this.$store.commit("setWin",{title:"操作提示",winType:"confirm",content:"确认批量删除员工 "+s.join(" ")+"？",callback:function(s){"ok"==s&&e.delEmployee(t.join(","),n)}})}},editShopUser:function(e,t){var n=this;return a(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.editShopUsers({data:{userIds:e.join(","),roleId:t.id}});case 2:i.sent?(n.changeBatchBtn(),n.getUserList(),n.batchIndexs={},n.$store.commit("setWin",{content:"批量修改员工信息成功",autoHideTime:1e3})):n.$store.commit("setWin",{title:"错误提示",winType:"alter",content:"数据返回为空"});case 4:case"end":return i.stop()}},i,n)}))()},batchJobWinFn:function(e,t){"ok"==e&&this.editShopUser(Object.values(this.batchIndexs),this.jobList[t+1]),this.showBatchJobs=!1}},components:{employeeWin:function(){return n.e("employee_manage_win").then(n.bind(null,"adf5"))},SelectJob:function(){return n.e("select_job").then(n.bind(null,"96e4"))}}},c=(n("cc32"),n("d801")),r=Object(c.a)(o,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{width:"100%"},attrs:{id:"employlist"}},[n("nav",{directives:[{name:"show",rawName:"v-show",value:!e.batch,expression:"!batch"}],class:{sdHidden:e.batch}},[0!=e.ischain?n("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择指派类型"},on:{change:e.selectAssignmentTypeFilte},model:{value:e.selectAssignmentType,callback:function(t){e.selectAssignmentType=t},expression:"selectAssignmentType"}},e._l(e.assignmentTypes,function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.type}})})):e._e(),e._v(" "),0!=e.ischain?n("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择职位"},on:{change:e.selectJobFilte},model:{value:e.recType,callback:function(t){e.recType=t},expression:"recType"}},e._l(e.reduceJobList,function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:t}})})):e._e(),e._v(" "),n("el-input",{staticStyle:{width:"225px"},attrs:{clearable:"",maxlength:"11",placeholder:"请输入员工名称/手机号码"},model:{value:e.seachValue,callback:function(t){e.seachValue=t},expression:"seachValue"}}),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.seachFn}},[e._v("搜索")]),e._v(" "),n("el-button",{attrs:{type:"info"},on:{click:e.resetFn}},[e._v("重置")])],1),e._v(" "),n("div",{staticClass:"aBox"},[n("div",{staticClass:"boxTop"},[n("span",{staticStyle:{"font-size":"16px","margin-right":"20px"}},[e._v("员工列表 · 共\n\t\t\t\t"),n("span",{staticStyle:{color:"#ff3c04","font-size":"inherit"}},[e._v(e._s(e.orginList.length))]),e._v("个条目")]),e._v(" "),"1"==e.ischain||"2"==e.ischain?n("span",{staticClass:"aSpan"},[n("i",{staticClass:"aI"}),e._v("品牌指派\n\t\t\t")]):e._e(),e._v(" "),"1"==e.ischain||"2"==e.ischain?n("span",{staticClass:"aSpan",staticStyle:{color:"#2ea7e0"}},[n("i",{staticClass:"aI",staticStyle:{background:"#2ea7e0"}}),e._v("门店自建\n\t\t\t")]):e._e()]),e._v(" "),n("el-table",{staticClass:"list",staticStyle:{width:"100%"},attrs:{data:e.pagedList,border:"",stripe:"","header-cell-style":{"background-color":"#f5f7fa"}}},[n("el-table-column",{attrs:{fixed:"",align:"center","min-width":"120","render-header":e.renderHeader,label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.batch?e._e():[n("span",{staticStyle:{color:"#FE8D2C",cursor:"pointer"},on:{click:function(n){e.edit(t.row.userId,t.$index)}}},[e._v("编辑")]),e._v(" "),n("span",{staticStyle:{padding:"0 5px",color:"#D2D2D2"}},[e._v("|")]),e._v(" "),n("span",{staticStyle:{color:"#FD3F1F",cursor:"pointer"},on:{click:function(n){e.delEmployeeFn(t.row.userId,t.$index)}}},[e._v("删除")])],e._v(" "),e.batch?n("div",{staticClass:"oBox",on:{click:function(n){e.selectItemInBatch(t.$index,t.row.userId)}}},[n("i",{class:{select:t.$index in e.batchIndexs}})]):e._e()]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center","min-width":"120",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.$index+1))])]}}])}),e._v(" "),n("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",label:"员工名称",prop:"name"}}),e._v(" "),n("el-table-column",{attrs:{align:"center","min-width":"120",label:"职位名称",prop:"roleName"},scopedSlots:e._u([{key:"default",fn:function(t){return[1*t.row.roleId>=1e5||1*t.row.roleId==0?n("span",{style:{color:"1"==e.ischain||"2"==e.ischain?"#fe9200":"#333"}},[e._v(e._s(t.row.roleName))]):e._e(),e._v(" "),1*t.row.roleId>0&&1*t.row.roleId<1e5?n("span",{style:{color:"1"==e.ischain||"2"==e.ischain?"#29abe2":"#333"}},[e._v(e._s(t.row.roleName))]):e._e()]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center","min-width":"120",label:"手机号码",prop:"mobile"}})],1)],1),e._v(" "),e.batch?e._e():n("div",[n("el-pagination",{attrs:{background:"","current-page":e.page,"page-size":e.pagenum,layout:"sizes, prev, pager, next","page-count":e.totalPage,"page-sizes":[10,20,30]},on:{"size-change":e.handleSizeChange,"current-change":e.pageChange}})],1),e._v(" "),e.showWin?n("employee-win",{attrs:{isAdd:e.isAdd,employeeId:e.employeeId,employeeIndex:e.employeeIndex,list:e.pagedList,jobList:e.jobList.slice(1),ischain:+e.ischain},on:{throwWinResult:e.doThrowWinResult}}):e._e(),e._v(" "),e.showBatchJobs?n("select-job",{attrs:{ischain:+e.ischain,jobList:e.jobList.slice(1),title:"批量选择员工职位",index:-1},on:{winEvent:e.batchJobWinFn}}):e._e()],1)},[],!1,null,"b902fb7e",null);t.default=r.exports},"59e1":function(e,t,n){},cc32:function(e,t,n){"use strict";var s=n("59e1");n.n(s).a}}]);