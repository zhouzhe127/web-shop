(window.webpackJsonp=window.webpackJsonp||[]).push([["employee_manage"],{"04fb":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"employlist"}},[n("nav",{directives:[{name:"show",rawName:"v-show",value:!t.batch,expression:"!batch"}],class:{sdHidden:t.batch}},[0!=t.ischain?n("select-btn",{attrs:{name:t.selectAssignmentType,sorts:t.assignmentTypes,width:158},on:{emit:t.selectAssignmentTypeFilte}}):t._e(),t._v(" "),n("select-btn",{attrs:{name:t.selectJob.name,sorts:t.reduceJobList.map(function(t){return t.name}),width:138},on:{emit:t.selectJobFilte}}),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.seachValue,expression:"seachValue"}],attrs:{type:"text",maxlength:"11",placeholder:"请输入员工名称/手机号码"},domProps:{value:t.seachValue},on:{input:function(e){e.target.composing||(t.seachValue=e.target.value)}}}),t._v(" "),n("a",{staticClass:"blue",attrs:{href:"javascript:;"},on:{click:t.seachFn}},[t._v("筛选")]),t._v(" "),n("a",{staticClass:"gray",attrs:{href:"javascript:;"},on:{click:t.resetFn}},[t._v("重置")])],1),t._v(" "),n("div",{staticStyle:{background:"#fff"}},[n("com-table",{attrs:{listHeight:50,listName:"员工管理列表",fixed:1,listWidth:770,showTitle:1,introData:t.pagedList,titleData:t.titleList,allTotal:t.list.length},scopedSlots:t._u([{key:"con-0",fn:function(e){return n("div",{staticClass:"optionWrap"},[t.batch?t._e():[n("span",{on:{click:function(n){t.edit(e.data.userId,e.index)}}},[t._v("编辑")]),t._v(" "),n("span",[t._v("|")]),t._v(" "),n("span",{on:{click:function(n){t.delEmployeeFn(e.data.userId,e.index)}}},[t._v("删除")])],t._v(" "),t.batch?n("div",{staticClass:"oBox",on:{click:function(n){t.selectItemInBatch(e.index,e.data.userId)}}},[n("i",{class:{select:e.index in t.batchIndexs}})]):t._e()],2)}},{key:"con-1",fn:function(e){return n("div",{},[t._v(t._s(e.index+1))])}},{key:"con-2",fn:function(e){return n("div",{},[1==e.data.roleType?n("span",{staticStyle:{color:"#fe9200"}},[t._v(t._s(e.data.name))]):t._e(),t._v(" "),0==e.data.roleType?n("span",{style:{color:"1"==t.ischain||"2"==t.ischain?"#29abe2":"#333"}},[t._v(t._s(e.data.name))]):t._e()])}}])},["1"==t.ischain||"2"==t.ischain?n("div",{attrs:{slot:"title"},slot:"title"},[n("span",{staticStyle:{"font-size":"16px","margin-right":"20px"}},[t._v("员工管理列表 · 共"+t._s(t.list.length)+"个条目")]),t._v(" "),n("span",{staticClass:"aSpan"},[n("i",{staticClass:"aI"}),t._v("品牌指派\n\t\t\t\t")]),t._v(" "),n("span",{staticClass:"aSpan",staticStyle:{color:"#2ea7e0"}},[n("i",{staticClass:"aI",staticStyle:{background:"#2ea7e0"}}),t._v("门店自建\n\t\t\t\t")])]):t._e(),t._v(" "),t.batch?n("div",{staticClass:"optionWrap",attrs:{slot:"title-0"},slot:"title-0"},[n("span",{on:{click:t.batchEdit}},[t._v("编辑")]),t._v(" "),n("span",[t._v("|")]),t._v(" "),n("span",{on:{click:t.batchDel}},[t._v("删除")])]):t._e()])],1),t._v(" "),!t.batch&&t.orginList.length>10?n("div",{staticClass:"pageWrap"},[n("div",{},[n("pageElement",{attrs:{page:t.page,total:t.totalPage,isNoJump:!0},on:{pageNum:t.pageChange}})],1)]):t._e(),t._v(" "),t.showWin?n("employee-win",{attrs:{isAdd:t.isAdd,employeeId:t.employeeId,employeeIndex:t.employeeIndex,list:t.pagedList,jobList:t.jobList.slice(1),ischain:+t.ischain},on:{throwWinResult:t.doThrowWinResult}}):t._e(),t._v(" "),t.showBatchJobs?n("select-job",{attrs:{ischain:+t.ischain,jobList:t.jobList.slice(1),title:"批量选择员工职位",index:-1},on:{winEvent:t.batchJobWinFn}}):t._e()],1)};s._withStripped=!0;var i=n("81a2"),a=n("f6ce");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function s(i,a){try{var o=e[i](a),c=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(c).then(function(t){s("next",t)},function(t){s("throw",t)});t(c)}("next")})}}var c={data:function(){return{titleList:[{titleName:"操作",titleStyle:{width:"20%"}},{titleName:"序号",titleStyle:{width:"10%"}},{titleName:"员工名称",titleStyle:{width:"30%"},dataName:"userName"},{titleName:"职位名称",titleStyle:{width:"20%"},dataName:"roleName"},{titleName:"手机号码",titleStyle:{width:"20%"},dataName:"mobile"}],isAdd:!0,orginList:[],list:[],showWin:!1,employeeId:"",employeeIndex:"",info:"",assignmentTypes:["全部","品牌指派","门店自建"],selectAssignmentType:"请选择指派类型",jobList:[],selectJob:{},seachValue:"",seachCacheObj:{seachValue:"",selectAssignmentType:"全部",selectJob:{}},page:1,pagenum:10,pagenumArr:[10,20,50],batch:!1,batchIndexs:{},showBatchJobs:!1,ischain:0}},computed:{totalPage:function(){return Math.ceil(this.list.length/this.pagenum)},pagedList:function(){var t=this.seachCacheObj.selectAssignmentType,e=this.seachCacheObj.selectJob,n=this.seachCacheObj.seachValue,s=this.orginList;return"品牌指派"===t?s=s.filter(function(t){return t.roleId>=1e5||t.roleId+""=="0"}):"门店自建"===t&&(s=s.filter(function(t){return t.roleId<=1e5&&t.roleId+""!="0"})),!e.id&&"0"!==e.id||e.id+""=="-1"||(s=s.filter(function(t){return t.roleId===e.id})),""!==n&&(s=s.filter(function(t){return!(!t.userName||!t.mobile)&&(t.userName.indexOf(n)>=0||t.mobile.indexOf(n)>=0)})),this.list=s,this.list.slice((this.page-1)*this.pagenum,this.page*this.pagenum)},reduceJobList:function(){return"门店自建"==this.selectAssignmentType?this.jobList.filter(function(t){return t.id<1e5&&t.id+""!="0"||"全部"==t.name}):"品牌指派"==this.selectAssignmentType?this.jobList.filter(function(t){return t.id>=1e5||t.id+""=="0"||"全部"==t.name}):this.jobList}},created:function(){var t=a.a.session("userShop");this.ischain=t.currentShop.ischain,this.$store.commit("setPageTools",[{name:"新建员工",className:["addStaff","export-btn"],fn:this.add,type:2},{name:"批量操作",className:["addStaff","export-btn"],fn:this.changeBatchBtn}]),this.init()},methods:{init:function(){this.getUserList(),this.getJobList()},getUserList:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getUserList();case 2:n=e.sent,t.orginList=n,t.list=n;case 5:case"end":return e.stop()}},e,t)}))()},getJobList:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var n,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getUserRoleList();case 2:n=e.sent,s={id:"-1",name:"全部",nodeIds:"",nodeNum:"0",personNum:"0",type:"0",sort:"1"},a={id:"0",name:"超级管理员",nodeIds:"3051",nodeNum:"1",personNum:"0",type:"1",sort:"2"},n&&(t.selectJob={id:-1,name:"请选择职位"},n.unshift(a),n.unshift(s),t.jobList=n);case 6:case"end":return e.stop()}},e,t)}))()},selectJobFilte:function(t){this.selectJob=this.reduceJobList[t]},selectAssignmentTypeFilte:function(t){this.selectAssignmentType=this.assignmentTypes[t],this.selectJob={id:"-1",name:"全部",nodeIds:"",nodeNum:"0",personNum:"0",type:"0",sort:"1"}},seachFn:function(){this.page=1,this.seachCacheObj={seachValue:this.seachValue,selectAssignmentType:this.selectAssignmentType,selectJob:this.selectJob}},resetFn:function(){this.seachValue="",this.selectAssignmentType="全部",this.selectJob={},this.seachCacheObj={seachValue:"",selectAssignmentType:"全部",selectJob:{}}},pageChange:function(t){this.page=t.page,this.pagenum=t.num},editPageNum:function(t){this.pagenum=this.pagenumArr[t],this.page=1},add:function(){this.isAdd=!0,this.showWin=!0},changeBatchBtn:function(){this.batch?(this.batch=!1,this.batchIndexs={},this.$store.commit("setPageTools",[{name:"新建员工",className:["addStaff","export-btn"],fn:this.add,type:2},{name:"批量操作",className:["addStaff","export-btn"],fn:this.changeBatchBtn}])):(this.batch=!0,this.batchIndexs={},this.$store.commit("setPageTools",[{name:"完成操作",className:["addStaff","export-btn"],fn:this.changeBatchBtn}]))},selectItemInBatch:function(t,e){var n={},s=0;for(var i in this.batchIndexs)n[i]=this.batchIndexs[i],s++;if(t in n)delete n[t];else{if(s>=10)return void this.$store.commit("setWin",{content:"批量管理最多选择十人"});n[t]=e}this.batchIndexs=n},edit:function(t,e){this.isAdd=!1,this.employeeId=t,this.employeeIndex=e,this.showWin=!0},delEmployeeFn:function(t,e){var n=this;this.$store.commit("setWin",{title:"操作提示",winType:"confirm",content:"确认删除员工 "+(this.pagedList[e].userName||"")+"？",callback:function(s){"ok"==s&&n.delEmployee(t,e)}})},delEmployee:function(t,e){var n=this;return o(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,i.a.userDel({data:{userId:t}});case 2:s.sent?(n.getUserList(),n.batch&&n.changeBatchBtn(),n.$store.commit("setWin",{content:"删除员工"+n.pagedList[e].name+"成功",autoHideTime:1e3})):n.$store.commit("setWin",{title:"错误提示",winType:"alter",content:"数据返回为空"});case 4:case"end":return s.stop()}},s,n)}))()},doThrowWinResult:function(t,e){"ok"==t&&(this.isAdd?(this.orginList.unshift(e),this.showWin=!1,this.$store.commit("setWin",{content:"新增员工成功",autoHideTime:1e3})):this.isAdd||(this.getUserList(),this.$store.commit("setWin",{content:"修改员工信息成功",autoHideTime:1e3}),this.showWin=!1)),"cancel"==t&&(this.showWin=!1),"close"==t&&(this.showWin=!1)},batchEdit:function(){0==Object.keys(this.batchIndexs).length?this.$store.commit("setWin",{content:"请先选择员工"}):this.showBatchJobs=!0},batchDel:function(){var t=this;if(0==Object.keys(this.batchIndexs).length)this.$store.commit("setWin",{content:"请先选择员工"});else{var e=Object.values(this.batchIndexs),n=Object.keys(this.batchIndexs),s=n.map(function(e){return t.list[e].name||""});this.$store.commit("setWin",{title:"操作提示",winType:"confirm",content:"确认批量删除员工 "+s.join(" ")+"？",callback:function(s){"ok"==s&&t.delEmployee(e.join(","),n)}})}},editShopUser:function(t,e){var n=this;return o(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,i.a.editShopUsers({data:{userIds:t.join(","),roleId:e.id}});case 2:s.sent?(n.changeBatchBtn(),n.getUserList(),n.batchIndexs={},n.$store.commit("setWin",{content:"批量修改员工信息成功",autoHideTime:1e3})):n.$store.commit("setWin",{title:"错误提示",winType:"alter",content:"数据返回为空"});case 4:case"end":return s.stop()}},s,n)}))()},batchJobWinFn:function(t,e){"ok"==t&&this.editShopUser(Object.values(this.batchIndexs),this.jobList[e+1]),this.showBatchJobs=!1}},components:{employeeWin:function(){return n.e("employee_manage_win").then(n.bind(null,"adf5"))},pageElement:function(){return n.e("page_element").then(n.bind(null,"5921"))},selectBtn:function(){return n.e("select_btn").then(n.bind(null,"3d41"))},comTable:function(){return n.e("table").then(n.bind(null,"4360"))},SelectJob:function(){return n.e("select_job").then(n.bind(null,"96e4"))}}},r=(n("dd64"),n("7610")),l=Object(r.a)(c,s,[],!1,null,"689a420a",null);l.options.__file="src\\module\\shop_config\\employee_manage.vue";e.default=l.exports},a5da:function(t,e,n){},dd64:function(t,e,n){"use strict";var s=n("a5da");n.n(s).a}}]);