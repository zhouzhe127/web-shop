(window.webpackJsonp=window.webpackJsonp||[]).push([["addnew_mission"],{"0b78":function(t,e,s){},"2a85":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"addmision"}},[s("div",{staticClass:"set-line"},[s("div",{staticClass:"titles"},[t._v(t._s(t.taskTypename))]),t._v(" "),s("div",{staticClass:"line"})]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("任务名称")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.taskname,expression:"taskname"}],staticClass:"txt fl",attrs:{type:"text",name:"",placeholder:"请输入任务名称",maxlength:"20"},domProps:{value:t.taskname},on:{input:function(e){e.target.composing||(t.taskname=e.target.value)}}}),t._v(" "),t._m(0)]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("任务时间")]),t._v(" "),s("div",{staticClass:"input-box input-start"},[s("calendar",{staticClass:"data-box",attrs:{time:t.startTime,format:"yyyy年MM月dd日"},on:{emit:t.startTimeChange}})],1),t._v(" "),s("span",[t._v("-")]),t._v(" "),s("div",{staticClass:"input-box input-start"},[s("calendar",{staticClass:"data-box",attrs:{time:t.endTime,format:"yyyy年MM月dd日"},on:{emit:t.endTimeChange}})],1)]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("持续时间")]),t._v(" "),s("div",{staticClass:"rightHalf"},[s("section",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.minutes,expression:"minutes"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入正整数",maxlength:"4",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.minutes},on:{input:function(e){e.target.composing||(t.minutes=e.target.value)}}}),t._v(" "),s("span",[t._v("分钟")])]),t._v(" "),t._m(1)])]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("任务类型")]),t._v(" "),s("select-btn",{attrs:{name:t.taskType,sorts:t.taskTypeList.map(function(t){return t.name}),width:157},on:{selOn:t.seltaskType}})],1),t._v(" "),"1"==t.taskTypeId?s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("span",{staticClass:"fl",staticStyle:{"margin-right":"13px"}},[t._v("消费满")]),t._v(" "),s("div",{staticClass:"rightHalf fl"},[s("section",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.consumption,expression:"consumption"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入正整数",maxlength:"6"},domProps:{value:t.consumption},on:{blur:function(e){t.changeCount(t.consumption)},input:function(e){e.target.composing||(t.consumption=e.target.value)}}}),t._v(" "),s("span",{staticClass:"fl"},[t._v("元")])])]),t._v(" "),s("span",[t._v("达成任务")])]):t._e(),t._v(" "),"2"==t.taskTypeId?s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("span",{staticStyle:{"margin-right":"13px"}},[t._v("进入该页面")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.shareUrl,expression:"shareUrl"}],staticClass:"txt",attrs:{type:"text",name:"",placeholder:"请输入网址"},domProps:{value:t.shareUrl},on:{input:function(e){e.target.composing||(t.shareUrl=e.target.value)}}}),t._v(" "),s("span",{staticStyle:{"margin-right":"13px"}},[t._v("点击右上角分享至")]),t._v(" "),s("select-btn",{attrs:{name:t.share,sorts:t.shareList.map(function(t){return t.name}),width:157},on:{selOn:t.selshare}})],1):t._e(),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("任务介绍")]),t._v(" "),s("div",{ref:"editor",staticClass:"fl toolbar",staticStyle:{"text-align":"left"},attrs:{id:"div1"}})]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("任务店铺")]),t._v(" "),s("a",{staticClass:"addclassify fl",attrs:{href:"javascript:void(0);"},on:{click:function(e){t.choiceShop()}}},[t._v("增加任务量")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.shopstock.length>0,expression:"shopstock.length > 0"}],staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("div",{staticClass:"stocklist fl"},[t._m(2),t._v(" "),t._l(t.shopstock,function(e,n){return""!=e.spareStock?s("ul",{key:n,staticClass:"contents"},[s("li",[s("a",{attrs:{href:"javascript:void(0);"},on:{click:function(s){t.delstockList(e,n)}}},[t._v("删除")])]),t._v(" "),s("li",[t._v(t._s(t.getShopname(e.shopId)))]),t._v(" "),s("li",[t._v(t._s(e.spareStock))])]):t._e()})],2)]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("任务奖励")]),t._v(" "),s("a",{staticClass:"addclassify fl",attrs:{href:"javascript:void(0);"},on:{click:t.addCustom}},[t._v("选择奖励")]),t._v(" "),t.couponCount.length>0?s("span",{staticClass:"rewardname"},[t._v("已选:"+t._s(t.couponCount))]):t._e()]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl required"},[t._v("人均领取次数")]),t._v(" "),s("div",{staticClass:"rightHalf"},[s("section",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.getnumber,expression:"getnumber"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入正整数",maxlength:"4",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.getnumber},on:{input:function(e){e.target.composing||(t.getnumber=e.target.value)}}}),t._v(" "),s("span",[t._v("次")])])])]),t._v(" "),s("div",{staticClass:"online-box clearfix"},[s("span",{staticClass:"online-sub fl"}),t._v(" "),s("a",{staticClass:"blue fl",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:t.addTask}},[t._v("保存")])]),t._v(" "),t.showWin?s(t.ass,{tag:"component",attrs:{shopList:t.shopList,selectshopIds:t.selectshopId},on:{getAppliedWin:t.getResults}}):t._e(),t._v(" "),t.showCoupon?s("birthCoupon",{attrs:{selectCoupon:t.selectCoupon,couponList:t.couponList,selectIntegral:t.selectIntegral,selectIntegralgoods:t.selectIntegralgoods},on:{winEvent:t.winEventCoupon}}):t._e()],1)};n._withStripped=!0;var i=s("81a2"),a=s("f6ce"),o=s("05dd"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Win",{attrs:{width:740,height:"auto",align:"center"},on:{winEvent:t.getAppliedWin}},[s("span",{attrs:{slot:"title"},slot:"title"},[t._v("增加任务量")]),t._v(" "),s("div",{attrs:{slot:"content",id:"tan"},slot:"content"},[s("ul",t._l(t.shopList,function(e,n){return s("li",{key:n},[s("div",{staticClass:"fl shopname"},[t._v("\n\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t")]),t._v(" "),s("div",{staticClass:"fl shopstock"},[t._v("\n\t\t\t\t\t任务量\n\t\t\t\t\t"),s("input",{directives:[{name:"model",rawName:"v-model",value:e.quota,expression:"item.quota"}],attrs:{type:"text",name:"",maxlength:"6"},domProps:{value:e.quota},on:{input:function(s){s.target.composing||t.$set(e,"quota",s.target.value)}}})])])}))])])};r._withStripped=!0;var l=/^\d*[0-9]{1,}\d*$/,c={props:{shopList:Array},data:function(){return{}},methods:{getAppliedWin:function(t){if("ok"==t){var e=0,s=!0,n=!1,i=void 0;try{for(var a,o=this.shopList[Symbol.iterator]();!(s=(a=o.next()).done);s=!0){var r=a.value;if(this.isEmpty(r.quota)||e++,!this.isEmpty(r.quota)&&!l.test(r.quota))return this.$store.commit("setWin",{content:r.name+"任务量只能是正整数",winType:"alert",title:"操作提示"}),!1}}catch(t){n=!0,i=t}finally{try{!s&&o.return&&o.return()}finally{if(n)throw i}}if(e<1)return this.$store.commit("setWin",{content:"至少增加一家门店任务量并且只能是正整数",winType:"alert",title:"操作提示"}),!1;this.$emit("getAppliedWin",t,this.shopList)}else{var c=!0,u=!1,p=void 0;try{for(var h,d=this.shopList[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){h.value.quota=""}}catch(t){u=!0,p=t}finally{try{!c&&d.return&&d.return()}finally{if(u)throw p}}this.$emit("getAppliedWin",t)}},isEmpty:function(t){return""==t.replace(/(^\s*)|(\s*$)/g,"")}},components:{Win:function(){return s.e("win").then(s.bind(null,"f60a"))}}},u=(s("aaf7"),s("6ceb")),p=Object(u.a)(c,r,[],!1,null,"08fda3be",null);function h(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function d(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function n(i,a){try{var o=e[i](a),r=o.value}catch(t){return void s(t)}if(!o.done)return Promise.resolve(r).then(function(t){n("next",t)},function(t){n("throw",t)});t(r)}("next")})}}p.options.__file="src\\module\\seller_assistant\\mission_choiceshop.vue";var m={data:function(){return{userDate:"",taskTypename:"新建任务",ischain:"",startTime:"",endTime:"",taskType:"店内任务",taskTypeList:[{name:"店内任务",id:0},{name:"消费任务",id:1},{name:"分享任务",id:2}],taskTypeId:0,share:"微信好友",shareList:[{name:"微信好友",id:0},{name:"朋友圈",id:1}],shopList:[],shareId:0,showWin:!1,ass:"",couponList:[],showCoupon:!1,miCount:[],micsel:[],selectCoupon:[],selectIntegral:[],selectIntegralgoods:[],couponCount:"",taskname:"",minutes:"",consumption:"",shareUrl:"",introduce:"",getnumber:"",selectshopId:"",taskId:"",shopstock:[],shopStock:"",editorContent:""}},methods:{returnType:function(){this.$router.push("/admin/Task")},startTimeChange:function(t){this.startTime=t},endTimeChange:function(t){this.endTime=new Date(t).setHours(23,59,59,999)},seltaskType:function(t){this.taskType=this.taskTypeList[t].name,this.taskTypeId=this.taskTypeList[t].id},selshare:function(t){this.share=this.shareList[t].name,this.shareId=this.shareList[t].id},getResults:function(t,e){if("ok"==t)for(var s=0;s<e.length;s++){var n=e[s].id,i=e[s].quota,a=e[s].status;this.shopstock[s]={shopId:n,spareStock:i,status:a}}this.showWin=!1},choiceShop:function(){this.showWin=!0,this.ass="getAppliedWin";for(var t=0;t<this.shopstock.length;t++)for(var e=0;e<this.shopList.length;e++)this.shopList[e].id==this.shopstock[t].shopId&&(this.shopList[e].quota=this.shopstock[t].spareStock)},addCustom:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getTaskcoupon({data:{}});case 2:s=e.sent,t.goodsCom=s,t.goodsCom.forEach(function(t){t.num=1}),t.couponList=t.goodsCom,t.showCoupon=!0;case 7:case"end":return e.stop()}},e,t)}))()},winEventCoupon:function(t){this.showCoupon=!1,"ok"==t.status&&(this.selectCoupon=t.data.couponselect,this.selectIntegral=t.data.integralCardselect,this.selectIntegralgoods=t.data.creditCardselect,this.couponList=t.data.list,this.getrewardname())},getrewardname:function(){var t="",e=!0,s=!1,n=void 0;try{for(var i,a=this.selectCoupon[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){t+=i.value.name+","}}catch(t){s=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(s)throw n}}var o=!0,r=!1,l=void 0;try{for(var c,u=this.selectIntegral[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){t+=c.value.name+","}}catch(t){r=!0,l=t}finally{try{!o&&u.return&&u.return()}finally{if(r)throw l}}var p=!0,h=!1,d=void 0;try{for(var m,v=this.selectIntegralgoods[Symbol.iterator]();!(p=(m=v.next()).done);p=!0){t+=m.value.name+","}}catch(t){h=!0,d=t}finally{try{!p&&v.return&&v.return()}finally{if(h)throw d}}this.couponCount=t.substring(0,t.length-1)},checkForm:function(){if(!o.a.checkData({taskname:{cond:"$$.length>0",pro:"请输入任务名称"},minutes:{cond:"$$.length > 0 && ((/^[1-9]\\d*$/).test($$))",pro:"请输入持续时间(非零正整数)"},editorContent:{cond:"$$.length>0",pro:"请填写任务介绍(1-200字)"},shopStock:{cond:"Object.keys($$).length > 0",pro:"请增加任务量"}},this))return!1;if(this.startTime<(new Date).setHours(0,0,0,0)||this.endTime<this.startTime)return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"任务开始时间应大于当前时间,任务的结束时间应该大于任务的开始时间"}),!1;if(""==this.selectCoupon&&""==this.selectIntegral&&""==this.selectIntegralgoods)return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请选择任务奖励"}),!1;if(""==this.getnumber||!/^[1-9]\d*$/.test(this.getnumber))return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请输入人均领取次数(1-9999)"}),!1;if("1"==this.taskTypeId){if(!/^([0-9])+(\.[0-9]+)?$/.test(this.consumption))return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"消费金额为非负数"}),!1;if(""==this.consumption)return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请输入消费金额"}),!1}if("2"==this.taskTypeId){if(""==this.shareUrl)return this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"请输入网址"}),!1;if(this.isURL(this.shareUrl))return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"url地址格式错误！"}),!1}return!0},addTask:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.mergeObject(),t.checkForm()){e.next=3;break}return e.abrupt("return");case 3:return s={coupon:t.selectCoupon,pointCard:t.selectIntegral,pointGoods:t.selectIntegralgoods},e.next=6,i.a.addTaskSystem({data:{taskId:t.taskId,taskName:t.taskname,startTime:parseInt(t.startTime/1e3),endTime:parseInt(t.endTime/1e3),durationTime:t.minutes,type:t.taskTypeId,describe:t.editorContent,amount:t.consumption,perLimit:t.getnumber,shareUrl:t.shareUrl,shareAddress:t.shareId,couponIds:s,shopTasks:t.shopStock}});case 6:e.sent&&(t.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"保存成功"}),t.returnType());case 8:case"end":return e.stop()}},e,t)}))()},delstockList:function(t,e){if(t.status)return this.$store.commit("setWin",{content:"已领取过的任务量无法删除只可以修改",winType:"alert",title:"操作提示"}),!1;for(var s=0,n=0;n<this.shopstock.length;n++)""!=this.shopstock[n].spareStock&&s++;if(s<=1)return this.$store.commit("setWin",{content:"请保持至少有一家门店有任务",winType:"alert",title:"操作提示"}),!1;if(this.shopstock.splice(e,1),t)for(var i=0;i<this.shopList.length;i++)t.shopId==this.shopList[i].id&&(this.shopList[i].quota="")},getShopname:function(t){var e="",s=!0,n=!1,i=void 0;try{for(var a,o=this.shopList[Symbol.iterator]();!(s=(a=o.next()).done);s=!0){var r=a.value;r.id==t&&(e=r.shopName||r.name)}}catch(t){n=!0,i=t}finally{try{!s&&o.return&&o.return()}finally{if(n)throw i}}return e},isURL:function(t){return!/^((https|http|ftp|rtsp|mms)?:\/\/)+[A-Za-z0-9]+\.[A-Za-z0-9]+[/=?%\-&_~`@[\]':+!]*([^<>"'])*$/.test(t)},changeCount:function(t){var e=(Math.round(100*t)/100).toString();isNaN(e)&&(e=""),this.consumption=e},mergeObject:function(){for(var t={},e=0;e<this.shopstock.length;e++)if(""!=this.shopstock[e].spareStock){var s=this.shopstock[e].shopId,n=this.shopstock[e].spareStock;this.shopStock=Object.assign(t,h({},s,n))}},shopTaskList:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var s,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.shopTaskList({data:{taskId:t.taskId}});case 2:for(s=e.sent,t.shopstock=s,n=0;n<t.shopstock.length;n++)for(t.shopstock[n].status=!0,a=0;a<t.shopList.length;a++)t.shopList[a].id==t.shopstock[n].shopId?(t.shopList[a].quota=t.shopstock[n].spareStock,t.shopList[a].status=t.shopstock[n].status):t.shopList[a].quota="";case 5:case"end":return e.stop()}},e,t)}))()},random:function(t,e){return Math.floor(Math.random()*(e-t))+t}},components:{getAppliedWin:p.exports,calendar:function(){return s.e("calendar_type").then(s.bind(null,"f2dd"))},selectBtn:function(){return s.e("select_btn").then(s.bind(null,"3d41"))},birthCoupon:function(){return s.e("activity_birth_coupon").then(s.bind(null,"beac"))}},mounted:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var n,i,r,l,c,u,p,h,d,m,v,f,g;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.a.session("token"),i=a.a.session("shopId"),r=t.random(1,100).toString(),l=a.a.session("userShop").uploadUrl,e.next=6,s.e("wang_editor").then(function(){var t=s("00e8");return"object"==typeof t&&t&&t.__esModule?t:Object.assign({},"object"==typeof t&&t,{default:t})});case 6:for(c=e.sent,(u=new c.default("#div1")).customConfig.uploadImgServer=o.a.host.shop+"image/uploadImage?oid="+r+"&format=script&token="+n+"&type=8&shopId="+i,u.customConfig.uploadFileName="image",u.customConfig.onchange=function(e){t.editorContent=e},u.customConfig.uploadImgHooks={customInsert:function(t,e,s){!s&&t(l+e.data)}},u.create(),t.$store.commit("setPageTools",{back:function(){t.returnType()}}),t.userDate=a.a.session("userShop"),t.ischain=a.a.session("userShop").currentShop.ischain,t.startTime=(new Date).setHours(0,0,0,0),t.endTime=(new Date).setHours(23,59,59,999),"3"==t.ischain?t.shopList=a.a.session("shopList"):"0"==t.ischain&&t.shopList.push(a.a.session("userShop").currentShop),p=!0,h=!1,d=void 0,e.prev=22,m=t.shopList[Symbol.iterator]();!(p=(v=m.next()).done);p=!0)(f=v.value).name=f.shopName?f.shopName:f.name,f.quota="",f.status=!1;e.next=30;break;case 26:e.prev=26,e.t0=e.catch(22),h=!0,d=e.t0;case 30:e.prev=30,e.prev=31,!p&&m.return&&m.return();case 33:if(e.prev=33,!h){e.next=36;break}throw d;case 36:return e.finish(33);case 37:return e.finish(30);case 38:"edi"==a.a.session("type")&&(t.taskTypename="编辑任务",g=a.a.session("taskdetail"),t.taskId=g.id,t.taskname=g.taskName,t.startTime=1e3*g.startTime,t.endTime=1e3*g.endTime,t.minutes=g.durationTime,t.taskTypeId=Number(g.type),t.taskType=t.taskTypeList[t.taskTypeId].name,t.consumption=g.amount,t.shareUrl=g.shareUrl,t.shareId=Number(g.shareAddress),t.share=t.shareList[t.shareId].name,t.quota=g.taskNum,t.getnumber=g.perLimit,t.selectCoupon=g.couponIds.coupon,t.selectIntegral=g.couponIds.pointCard,t.selectIntegralgoods=g.couponIds.pointGoods,t.getrewardname(),t.editorContent=g.describe,u.txt.html(t.editorContent),console.log(t.editorContent),console.log(u.txt.html(t.editorContent)),t.shopTaskList());case 39:case"end":return e.stop()}},e,t,[[22,26,30,38],[31,,33,37]])}))()}},v=(s("c06f"),Object(u.a)(m,n,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 限20字内\n\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 领取任务后,在持续时间内未达成会显示任务失败\n\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"heads"},[e("li",[this._v("操作")]),this._v(" "),e("li",[this._v("门店名称")]),this._v(" "),e("li",[this._v("库存数量")])])}],!1,null,"6f22f280",null));v.options.__file="src\\module\\seller_assistant\\addnew_mission.vue";e.default=v.exports},a59f:function(t,e,s){},aaf7:function(t,e,s){"use strict";var n=s("0b78");s.n(n).a},c06f:function(t,e,s){"use strict";var n=s("a59f");s.n(n).a}}]);