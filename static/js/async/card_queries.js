(window.webpackJsonp=window.webpackJsonp||[]).push([["card_queries"],{"515d":function(t,e,i){"use strict";var s=i("65cd");i.n(s).a},"65cd":function(t,e,i){},"7c6e":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"card-queries"}},[t.detailStatus?t._e():i("section",[i("div",{staticClass:"timeSearch"},[i("div",{staticClass:"activation fl"},[t._v("\n\t\t\t\t激活时间\n\t\t\t")]),t._v(" "),i("div",{staticClass:"date"},[i("section",{staticClass:"fl"},[i("section",[i("calendar",{attrs:{pObj:{time:t.startTime}},on:{throwTime:t.getStartTime}})],1)]),t._v(" "),i("span",{staticClass:"data-center"},[t._v("至")]),t._v(" "),i("section",{staticClass:"fl"},[i("section",[i("calendar",{attrs:{pObj:{time:t.endTime}},on:{throwTime:t.getEndTime}})],1)]),t._v(" "),i("span",{staticClass:"order-order-searchA"},[i("span",{staticClass:"order-order-search",attrs:{href:"javascript:void(0)"},on:{click:function(e){t.searchList()}}})])])]),t._v(" "),i("div",{staticClass:"enquiries"},[i("div",{staticClass:"activation fl"},[t._v("\n\t\t\t\t卡号查询\n\t\t\t")]),t._v(" "),i("select-btn",{attrs:{name:t.cardhigh,sorts:t.cardList.map(function(t){return t.name}),width:180},on:{selOn:t.selectCard}}),t._v(" "),i("span",{staticClass:"line"},[t._v(" - ")]),t._v(" "),i("section",{staticClass:"statisticsLists"},[i("section",{staticClass:"tableListInp chairFix",on:{click:function(e){t.showhighList(2,e)}}},[i("span",{staticClass:"spanSty"},[t._v(t._s(t.shophigh))]),t._v(" "),t._m(0)]),t._v(" "),t.shopLimit?i("ul",t._l(t.shopList,function(e,s){return i("li",{key:s,on:{click:function(e){t.costhighShow(s,2,e)}}},[t._v(t._s(e.name))])})):t._e()]),t._v(" "),i("span",{staticClass:"line"},[t._v(" - ")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.number,expression:"number"}],staticClass:"numbering",staticStyle:{"margin-right":"10px"},attrs:{type:"text",placeholder:"卡号",maxlength:"8"},domProps:{value:t.number},on:{input:function(e){e.target.composing||(t.number=e.target.value)}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mobile,expression:"mobile"}],staticClass:"numbering",staticStyle:{"margin-right":"10px"},attrs:{type:"text",placeholder:"请输入手机号",maxlength:"11"},domProps:{value:t.mobile},on:{input:function(e){e.target.composing||(t.mobile=e.target.value)}}}),t._v(" "),i("section",{staticClass:"statisticsLists"},[i("section",{staticClass:"tableListInp chairFix",on:{click:function(e){t.showhighList(3,e)}}},[i("span",{staticClass:"spanSty"},[t._v(t._s(t.cardstahigh))]),t._v(" "),t._m(1)]),t._v(" "),t.cardstaLimit?i("ul",t._l(t.cardstaList,function(e,s){return i("li",{key:s,on:{click:function(e){t.costhighShow(s,3,e)}}},[t._v(t._s(e.name))])})):t._e()]),t._v(" "),i("a",{staticStyle:{background:"#2EA8DC"},attrs:{href:"javascript:;"},on:{click:function(e){t.searchList()}}},[t._v("筛选")]),t._v(" "),i("a",{staticStyle:{background:"#B3B3B3"},attrs:{href:"javascript:;"},on:{click:t.filterReset}},[t._v("重置")])],1),t._v(" "),i("div",{staticClass:"clAll"}),t._v(" "),i("div",{staticClass:"list"}),t._v(" "),i("comTable",{attrs:{listName:"卡列表",titleData:t.titleData,introData:t.list,allTotal:t.count,bannerStyle:t.bannerStyle,contentStyle:t.contentStyle,titleHeight:50,listHeight:50,listWidth:1300,fixed:0},scopedSlots:t._u([{key:"title-0",fn:function(e){return i("span",{staticStyle:{color:"#2EA8DC",width:"50px",cursor:"pointer"},on:{click:t.allSelectedOne}},[t._v("全选")])}},{key:"con-0",fn:function(e){return i("span",{staticStyle:{cursor:"pointer"},on:{click:function(i){t.ocSelOne(e.data)}}},[i("span",{class:{active:e.data.selected},staticStyle:{display:"inline-block",width:"20px",height:"20px","border-radius":"10px",border:"1px solid #919191","margin-top":"15px"}})])}},{key:"con-1",fn:function(e){return i("span",{staticStyle:{color:"#2EA8DC",cursor:"pointer"},on:{click:function(i){t.getDetail(e.data)}}},[t._v("查看详情")])}},{key:"con-2",fn:function(e){return i("span",{},[t._v(t._s(""==e.data.name?"--":e.data.name))])}},{key:"con-3",fn:function(e){return i("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(e.data.abbr)+"-"+t._s(t.addPreZero(e.data.shopNumber,4))+"-"+t._s(t.addPreZero(e.data.number,8)))])}},{key:"con-4",fn:function(e){return i("span",{},[t._v(t._s("0"==e.data.cardTypeId?"--":t.getcardName(e.data.cardTypeId)))])}},{key:"con-5",fn:function(e){return i("span",{},[t._v(t._s(""==e.data.mobile?"--":e.data.mobile))])}},{key:"con-6",fn:function(e){return i("span",{},[t._v(t._s(t.transformTime(e.data.createTime)))])}},{key:"con-7",fn:function(e){return i("span",{},[t._v(t._s("0"==e.data.lastConsumeTime?"--":t.transformTime(e.data.lastConsumeTime)))])}},{key:"con-8",fn:function(e){return i("span",{},[t._v(t._s(t.getValidity(e.data.endCardTime)))])}},{key:"con-9",fn:function(e){return i("span",{},[t._v(t._s(t.getState(e.data)))])}}])}),t._v(" "),i("section",{staticClass:"turn-page"},[i("pageElement",{attrs:{page:Number(t.pageDetial.page),total:Number(t.pageDetial.pageNum),numArr:[10,20,30,40,50],isNoJump:!0},on:{pageNum:t.pageChange}})],1)],1),t._v(" "),t.detailStatus?i("cardDetail",{attrs:{cardNumber:t.cardNumber},on:{throwWinResult:t.getDetailShow}}):t._e(),t._v(" "),t.isRecharge?i("cardRecharge",{attrs:{userData:t.userData,selectedList:t.selectedList,cardTypeList:t.cardTypeList},on:{throwWinResult:t.rechargeBack}}):t._e()],1)};s._withStripped=!0;var a=i("81a2"),n=i("f6ce"),r=i("bbb9");function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function s(a,n){try{var r=e[a](n),c=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(c).then(function(t){s("next",t)},function(t){s("throw",t)});t(c)}("next")})}}var o={data:function(){return{userData:Object,isRecharge:!1,isBrand:!1,detailStatus:!1,detaiList:{},startTime:(new Date).setHours(0,0,0,0),endTime:(new Date).setHours(23,59,59,999),allselect:!1,selectedList:[],list:[],cardhigh:"选择卡类型",cardList:[],cardId:"",cardLimit:!1,shopList:[],choicehopId:"",shopLimit:!1,shophigh:"选择门店编号",cardstaList:[{name:"全部",id:0},{name:"未开始",id:1},{name:"使用中",id:2},{name:"已过期",id:3},{name:"已停用",id:4}],cardstaId:"0",cardstaLimit:!1,cardstahigh:"全部",storesId:"",storesLimit:!1,storeshigh:"选择操作门店",trantypeId:"",trantypeLimit:!1,trantypehigh:"全部",count:"0",number:"",mobile:"",pageDetial:{page:1,num:10,pageNum:1},deShopList:[],storesList:[],cardTypeList:[],titleData:[],bannerStyle:null,contentStyle:null,cardNumber:"",cardStatus:{0:"未使用",1:"使用中",2:"已写入",3:"已激活",4:"停用"}}},created:function(){this.titleData=[{titleName:"全选",titleStyle:{width:"50px"}},{titleName:"操作",titleStyle:{width:"100px"}},{titleName:"姓名",dataName:"name"},{titleName:"卡号"},{titleName:"卡类型"},{titleName:"绑定手机"},{titleName:"激活时间"},{titleName:"最后交易时间"},{titleName:"有效期"},{titleName:"当前状态"}],this.bannerStyle={backgroundColor:"#F2F2F2",color:"#434149",fontSize:"16px"},this.contentStyle={color:"#666666",fontSize:"14px"}},mounted:function(){var t=this;this.userData=n.a.session("userShop"),this.userData.currentShop&&3==this.userData.currentShop.ischain?this.isBrand=!0:this.isBrand=!1;var e=[],i=[],s=[];if(this.isBrand)for(var a in s=n.a.session("shopList")){var r={name:s[a].shopNumber+"-"+s[a].shopName,id:s[a].id},c={name:s[a].shopName,id:s[a].id};i.push(r),e.push(c)}else{s.push(this.userData.currentShop);var o={name:this.userData.currentShop.shopNumber+"-"+this.userData.currentShop.name,id:this.userData.currentShop.id},l={name:this.userData.currentShop.name,id:this.userData.currentShop.id};i.push(o),e.push(l)}this.shopList=i,this.storesList=e,this.deShopList=s,this.getcardType(),this.searchList(),document.onclick=function(){t.cardLimit=!1,t.shopLimit=!1,t.cardstaLimit=!1},this.initBtn()},destroyed:function(){this.$store.commit("setPageTools",[])},methods:{initBtn:function(){var t=this,e=[{name:"导出",className:"userLabel",fn:function(){t.filterExport()}},{name:"批量修改余额",className:"userLabel",fn:function(){t.recharge()}}];this.$store.commit("setPageTools",e)},pageChange:function(t){this.pageDetial.page=t.page,this.pageDetial.num=t.num,this.getList()},selectCard:function(t){this.cardhigh=this.cardList[t].name,this.cardId=this.cardList[t].id},getStartTime:function(t){this.startTime=new Date(t).getTime()},getEndTime:function(t){this.endTime=new Date(t).getTime()},filterExport:function(){if(0==this.list.length)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"没有数据可以导出"}),!1;a.a.memberCardExportCardList({data:{format:"csv",startTime:parseInt(this.startTime/1e3),endTime:parseInt(this.endTime/1e3),cardTypeId:this.cardId,subShopId:this.choicehopId,page:this.pageDetial.page+1,num:10,number:""==this.number?"":Number(this.number),mobile:this.mobile,cardStatus:this.cardstaId}})},recharge:function(){if(0==this.selectedList.length)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"请选择要修改的数据"}),!1;this.isRecharge=!0},filterReset:function(){this.number="",this.mobile="",this.cardhigh="选择卡类型",this.cardId="",this.shophigh="选择门店编号",this.storesId="",this.cardstahigh="全部",this.cardstaId="",this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(23,59,59,999),this.searchList(),this.enpty()},searchList:function(){this.pageDetial.pageNum="",this.pageDetial.page=1,this.getList()},getList:function(t){var e=this;return c(regeneratorRuntime.mark(function i(){var s,n,r,c,o,l;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e.startTime>e.endTime)){i.next=3;break}return e.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"请选择正确的时间进行筛选"}),i.abrupt("return",!1);case 3:if(s=/^1\d{10}$/,n=/^\d{8}$/,""==e.mobile||s.test(e.mobile)){i.next=8;break}return e.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"手机号码格式有误"}),i.abrupt("return",!1);case 8:if(""==e.number||n.test(e.number)){i.next=11;break}return e.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"卡号必须是8位数字"}),i.abrupt("return",!1);case 11:return i.next=13,a.a.memberCardGetCardList({data:{startTime:parseInt(e.startTime/1e3),endTime:parseInt(e.endTime/1e3),page:e.pageDetial.page,num:e.pageDetial.num,cardTypeId:e.cardId,subShopId:e.choicehopId,number:""==e.number?"":Number(e.number),mobile:e.mobile,cardStatus:e.cardstaId}});case 13:if(!(r=i.sent)){i.next=41;break}c=0;case 16:if(!(c<r.cardList.length)){i.next=36;break}if(r.cardList[c].num=1,0!=e.selectedList.length){i.next=22;break}r.cardList[c].selected=!1,i.next=33;break;case 22:o=0;case 23:if(!(o<e.selectedList.length)){i.next=33;break}if(e.selectedList[o].id!=r.cardList[c].id){i.next=29;break}return r.cardList[c].selected=e.selectedList[o].selected,i.abrupt("break",33);case 29:r.cardList[c].selected=!1;case 30:o++,i.next=23;break;case 33:c++,i.next=16;break;case 36:if(e.list=r.cardList,"ok"==t)for(l=0;l<e.list.length;l++)e.detaiList.id==e.list[l].id&&(e.detaiList=e.list[l]);e.list.every(function(t){return 1==t.selected})?e.allselect=!0:e.allselect=!1,1==e.pageDetial.page&&r.total&&(e.pageDetial.pageNum=r.total),1==e.pageDetial.page&&r.count&&(e.count=r.count);case 41:case"end":return i.stop()}},i,e)}))()},enpty:function(){this.selectedList.splice(0,this.selectedList.length);for(var t=0;t<this.list.length;t++)this.list[t].selected=!1;this.allselect=!1},allSelectedOne:function(){if(1==this.allselect)for(var t=0;t<this.list.length;t++){this.list[t].selected=!1;for(var e=0;e<this.selectedList.length;e++)this.selectedList[e].id==this.list[t].id&&this.selectedList.splice(e,1)}else for(var i=0;i<this.list.length;i++){if(this.selectedList.length>=50)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"最多可选50条数据"}),!1;this.list[i].selected=!0,-1==JSON.stringify(this.selectedList).indexOf(JSON.stringify(this.list[i]))&&this.selectedList.push(this.list[i])}this.allselect=!this.allselect},ocSelOne:function(t){if(this.selectedList.length>=49)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"最多可选50条数据"}),!1;if(t.selected=!t.selected,t.selected){this.selectedList.push(t);for(var e=0;e<this.list.length;e++)if(1!=this.list[e].selected)return;this.allselect=!0}else{this.allselect=!1;for(var i=0;i<this.selectedList.length;i++)this.selectedList[i].id==t.id&&this.selectedList.splice(i,1)}},getDetail:function(t){this.detailStatus=!this.detailStatus,this.detaiList=t,this.cardNumber=t.abbr+"-"+this.addPreZero(t.shopNumber,4)+"-"+this.addPreZero(t.number,8)},addPreZero:function(t,e){for(var i=(t+"").length,s="",a=0;a<e-i;a++)s+="0";return s+t},getcardName:function(t){for(var e=void 0,i=0;i<this.cardTypeList.length;i++)t==this.cardTypeList[i].id&&(e=this.cardTypeList[i].name);return e},transformTime:function(t){return r.a.format(new Date(1e3*Number(t)),"yyyy-MM-dd hh:mm")},getValidity:function(t){return 0==t?"无限期":this.transFormDates(t)},transFormDates:function(t){10==(t+="").length?(t-=0,t*=1e3):t-=0;var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+":"+this.changeFormat(e.getMinutes())},changeFormat:function(t){return(t-=0)<10?"0"+t:t+""},getState:function(t){var e=(new Date).getTime()/1e3;return 0==t.startCardTime&&e<t.createTime||0!=t.startCardTime&&e<t.startCardTime?"未开始":0==t.startCardTime&&e>t.createTime&&0==t.endCardTime&&4!=t.status||0!=t.startCardTime&&e>t.startCardTime&&0!=t.endCardTime&&e<t.endCardTime&&4!=t.status?"使用中":0!=t.endCardTime&&e>t.endCardTime?"已过期":4==t.status?"已停用":void 0},showhighList:function(t,e){switch(t){case 1:e.stopPropagation(),this.cardLimit=!this.cardLimit;break;case 2:e.stopPropagation(),this.shopLimit=!this.shopLimit;break;case 3:e.stopPropagation(),this.cardstaLimit=!this.cardstaLimit}},getcardType:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var i,s,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.cardtypeGetList({data:{}});case 2:if(i=e.sent)for(s in t.cardTypeList=i,t.cardTypeList)n={name:t.cardTypeList[s].name,id:t.cardTypeList[s].id},t.cardList.push(n);case 4:case"end":return e.stop()}},e,t)}))()},costhighShow:function(t,e,i){switch(e){case 1:i.stopPropagation(),this.cardhigh=this.cardList[t].name,this.cardId=this.cardList[t].id,this.cardLimit=!1;break;case 2:i.stopPropagation(),this.shophigh=this.shopList[t].name,this.choicehopId=this.shopList[t].id,this.shopLimit=!1;break;case 3:i.stopPropagation(),this.cardstahigh=this.cardstaList[t].name,this.cardstaId=this.cardstaList[t].id,this.cardstaLimit=!1}},getDetailShow:function(t){this.detailStatus=t,this.getList(),this.initBtn()},rechargeBack:function(t){"ok"==t?(this.enpty(),this.getList(),this.isRecharge=!1):this.isRecharge=!1}},components:{cardDetail:function(){return i.e("card_queries_detail").then(i.bind(null,"1a010"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))},cardRecharge:function(){return i.e("card_queries_recharge").then(i.bind(null,"5ebd"))},pageElement:function(){return i.e("page_element").then(i.bind(null,"5921"))},comTable:function(){return i.e("table").then(i.bind(null,"4360"))},selectBtn:function(){return i.e("select_btn").then(i.bind(null,"3d41"))}}},l=(i("515d"),i("6ceb")),d=Object(l.a)(o,s,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl calendar-ctr"},[e("i")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl calendar-ctr"},[e("i")])}],!1,null,"0cf3f80e",null);d.options.__file="src\\module\\member_system\\card_queries.vue";e.default=d.exports}}]);