(window.webpackJsonp=window.webpackJsonp||[]).push([["warrant_relation"],{"0fad":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"shopList"},[n("p",[e._v("请选择\n\t\t\t"),1==e.bandtype?n("span",{staticStyle:{"font-size":"22px"}},[e._v("饿了么")]):e._e(),e._v(" "),2==e.bandtype?n("span",{staticStyle:{"font-size":"22px"}},[e._v("美团")]):e._e(),e._v(" "),3==e.bandtype?n("span",{staticStyle:{"font-size":"22px"}},[e._v("百度")]):e._e(),e._v("\n\t\t\t关联店铺\n\t\t")]),e._v(" "),e._m(0),e._v(" "),e._l(e.shopList,function(t,i){return n("ul",{key:i,staticClass:"eleShop",on:{click:function(n){e.shopSelect(t.TakeoutShopId)}}},[n("li",[e._v("0"+e._s(i+1))]),e._v(" "),n("li",[e._v(e._s(t.TakeoutShopName))]),e._v(" "),n("li",{staticStyle:{cursor:"pointer"}},[n("div",{staticClass:"circle active",class:{"ele-active":e.selShopid==t.TakeoutShopId}})])])})],2),e._v(" "),n("div",{staticClass:"buttenall"},[n("a",{staticClass:"gray",attrs:{href:"javascript:void(0);"},on:{click:e.relieve}},[e._v("解除授权")]),e._v(" "),1==e.bandtype?n("a",{staticClass:"border",attrs:{href:"javascript:void(0);"},on:{click:function(t){e.outerVisible=!0}}},[e._v("补单")]):e._e(),e._v(" "),n("a",{staticClass:"yellow",attrs:{href:"javascript:void(0);"},on:{click:e.next}},[e._v("下一步")])]),e._v(" "),e.showdel?n("meiTuan-warrant",{attrs:{urlData:e.urlData},on:{show:e.hidden}}):e._e(),e._v(" "),n("el-dialog",{attrs:{title:"补单",visible:e.outerVisible,width:"60%"},on:{"update:visible":function(t){e.outerVisible=t}}},[n("el-dialog",{attrs:{width:"40%",title:"",visible:e.innerVisible,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[n("div",{staticClass:"waring"},[n("i",{staticClass:"el-icon-warning"}),e._v(" "),n("span",[e._v("请注意，补单功能只用于补录未录入的已完成的订单。")]),e._v(" "),n("p",[e._v("确定要补录"+e._s(e.getTime(Date.parse(e.replenTime)))+"的订单吗")])]),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.innerVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.dialogconif}},[e._v("确定")])],1)]),e._v(" "),n("div",[n("span",[e._v("请选择补单日期：")]),e._v(" "),n("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},on:{change:e.replenTimechenge},model:{value:e.replenTime,callback:function(t){e.replenTime=t},expression:"replenTime"}})],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.outerVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.replenishment}},[e._v("确定")])],1)],1)],1)};i._withStripped=!0;var a=n("81a2"),s=n("f6ce"),r=n("44e7"),o=n("bbb9");function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function i(a,s){try{var r=t[a](s),o=r.value}catch(e){return void n(e)}if(!r.done)return Promise.resolve(o).then(function(e){i("next",e)},function(e){i("throw",e)});e(o)}("next")})}}var l={data:function(){return{bandtype:"",shopList:[],brandId:"",userData:"",selShopid:"",showdel:!1,urlData:"",timer:"",outerVisible:!1,innerVisible:!1,replenTime:""}},methods:{init:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.getTakeoutShop({data:{type:e.bandtype,brandId:e.brandId}});case 2:n=t.sent,e.shopList.push(n);case 4:case"end":return t.stop()}},t,e)}))()},shopSelect:function(e){this.selShopid=e},replenishment:function(){this.replenTime?this.innerVisible=!0:this.$message({message:"请选择日期",type:"warning"})},replenTimechenge:function(){var e=new Date;console.log(Date.parse(this.replenTime));this.replenTime<e-7776e6&&(this.$message({message:"请选择90天内的日期",type:"warning"}),this.replenTime="")},getTime:function(e){return o.a.format(parseInt(e),"yyyy-MM-dd")},dialogconif:function(){var e=this;return c(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.outfoodmakeUpOrder({data:{date:Date.parse(e.replenTime)/1e3}});case 2:t.sent&&(e.$message({message:"补单成功！",type:"success"}),e.innerVisible=!1,e.outerVisible=!1);case 4:case"end":return t.stop()}},t,e)}))()},relieve:function(){var e,t=this;if(""==this.selShopid)return this.$store.commit("setWin",{title:"提示",content:"请选择店铺！"}),!1;this.$store.commit("setWin",{title:"提示",content:"是否解除授权",winType:"confirm",callback:(e=c(regeneratorRuntime.mark(function e(n){var i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("ok"!=n){e.next=18;break}if(i=void 0,1!=t.bandtype){e.next=11;break}return e.next=5,a.a.releaseAuth({data:{type:t.bandtype}});case 5:i=e.sent,t.$store.commit("setWin",{title:"提示",content:"解除授权成功！"}),window.opener.location.reload(),setTimeout(function(){window.close()},1e3),e.next=18;break;case 11:return e.next=13,a.a.getReleaseAuthUrl({data:{type:t.bandtype,brandId:t.brandId}});case 13:i=e.sent,t.showdel=!0,s=window.location.href,t.urlData=i+"&eOrigin="+s,t.timer=r.a.add(t.getReturn(t.bandtype,0),1500);case 18:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)})})},next:function(){if(""===this.selShopid)return this.$message({message:"请选择店铺！",type:"warning"}),!1;if(2==this.bandtype)this.$router.push({path:"relation/config"});else{if(!s.a.session("goodList"))return this.$store.commit("setWin",{title:"提示",content:"菜品加载中请稍后"}),!1;this.$router.push({path:"relation/relationele",query:{id:this.selShopid}})}},getGoods:function(){a.a.getAllGoods({data:{page:1,num:9999,shopIds:this.userData.currentShop.id}}).then(function(e){console.log(e),s.a.session("goodList",e)}),a.a.getAllPackage({data:{page:1,num:9999,shopIds:this.userData.currentShop.id}}).then(function(e){console.log(e),s.a.session("packageList",e)})},hidden:function(e){this.showdel=e},getReturn:function(e,t,n){var i=this;return function(){a.a.getReturnInfo({data:{type:e}}).then(function(e){0==e&&(r.a.clear(i.timer),window.opener.location.reload(),i.$store.commit("setWin",{title:"提示",content:"解除授权成功！"}),window.close())},function(e){r.a.clear(i.timer),i.$store.commit("setWin",{title:"提示",content:e})}),(t+=1)>180&&(n.close(),r.a.clear(i.timer))}}},mounted:function(){this.bandtype=s.a.session("waimai"),this.userData=s.a.session("userShop"),document.querySelector("#warrant").style.height="100%",this.getGoods(),this.brandId=0==this.userData.currentShop.ischain?0:this.userData.currentShop.brandId,this.init()},components:{meiTuanWarrant:function(){return n.e("iframe_warrant").then(n.bind(null,"6d65"))}},destroyed:function(){r.a.clear(this.timer)}},u=(n("7e02"),n("6ceb")),d=Object(u.a)(l,i,[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",{staticClass:"title"},[t("li",[this._v("序号")]),this._v(" "),t("li",[this._v("店铺名称")]),this._v(" "),t("li",[this._v("选择")])])}],!1,null,"48f9c336",null);d.options.__file="src\\module\\outfood\\accredit\\warrant_relation.vue";t.default=d.exports},"4ef6":function(e,t,n){},"7e02":function(e,t,n){"use strict";var i=n("4ef6");n.n(i).a}}]);