(window.webpackJsonp=window.webpackJsonp||[]).push([["warrant_relation","iframe_warrant"],{"0fad":function(t,e,n){"use strict";n.r(e);var i=n("81a2"),r=n("f6ce"),s=n("44e7"),a=n("bbb9");function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function i(r,s){try{var a=e[r](s),o=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}("next")})}}var l=[],u=1,d={data:function(){return{bandtype:"",shopList:[],brandId:"",userData:"",selShopid:"",showdel:!1,urlData:"",timer:"",outerVisible:!1,innerVisible:!1,replenTime:""}},methods:{init:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getTakeoutShop({data:{type:t.bandtype,brandId:t.brandId}});case 2:n=e.sent,t.shopList.push(n);case 4:case"end":return e.stop()}},e,t)}))()},shopSelect:function(t){this.selShopid=t},replenishment:function(){this.replenTime?this.innerVisible=!0:this.$message({message:"请选择日期",type:"warning"})},replenTimechenge:function(){var t=new Date;console.log(Date.parse(this.replenTime));this.replenTime<t-7776e6&&(this.$message({message:"请选择90天内的日期",type:"warning"}),this.replenTime="")},getTime:function(t){return a.a.format(parseInt(t),"yyyy-MM-dd")},dialogconif:function(){var t=this;return c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.outfoodmakeUpOrder({data:{date:Date.parse(t.replenTime)/1e3}});case 2:e.sent&&(t.$message({message:"补单成功！",type:"success"}),t.innerVisible=!1,t.outerVisible=!1);case 4:case"end":return e.stop()}},e,t)}))()},relieve:function(){var t,e=this;if(""==this.selShopid)return this.$store.commit("setWin",{title:"提示",content:"请选择店铺！"}),!1;this.$store.commit("setWin",{title:"提示",content:"是否解除授权",winType:"confirm",callback:(t=c(regeneratorRuntime.mark(function t(n){var r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("ok"!=n){t.next=18;break}if(r=void 0,1!=e.bandtype){t.next=11;break}return t.next=5,i.a.releaseAuth({data:{type:e.bandtype}});case 5:r=t.sent,e.$store.commit("setWin",{title:"提示",content:"解除授权成功！"}),window.opener.location.reload(),setTimeout(function(){window.close()},1e3),t.next=18;break;case 11:return t.next=13,i.a.getReleaseAuthUrl({data:{type:e.bandtype,brandId:e.brandId}});case 13:r=t.sent,e.showdel=!0,a=window.location.href,e.urlData=r+"&eOrigin="+a,e.timer=s.a.add(e.getReturn(e.bandtype,0),1500);case 18:case"end":return t.stop()}},t,e)})),function(e){return t.apply(this,arguments)})})},next:function(){if(""===this.selShopid)return this.$message({message:"请选择店铺！",type:"warning"}),!1;if(2==this.bandtype)this.$router.push({path:"relation/config"});else{if(!r.a.session("goodList"))return this.$store.commit("setWin",{title:"提示",content:"菜品加载中请稍后"}),!1;this.$router.push({path:"relation/relationele",query:{id:this.selShopid}})}},getAllGoods:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getAllGoods({data:{page:u,num:1e3,shopIds:t.userData.currentShop.id}});case 2:n=e.sent,l=[].concat(o(l),o(n)),n.length>=1e3&&(u++,t.getAllGoods()),r.a.session("goodList",n);case 6:case"end":return e.stop()}},e,t)}))()},getGoods:function(){this.getAllGoods(),i.a.getAllPackage({data:{page:1,num:9999,shopIds:this.userData.currentShop.id}}).then(function(t){console.log(t),r.a.session("packageList",t)})},hidden:function(t){this.showdel=t},getReturn:function(t,e,n){var r=this;return function(){i.a.getReturnInfo({data:{type:t}}).then(function(t){0==t&&(s.a.clear(r.timer),window.opener.location.reload(),r.$store.commit("setWin",{title:"提示",content:"解除授权成功！"}),window.close())},function(t){s.a.clear(r.timer),r.$store.commit("setWin",{title:"提示",content:t})}),(e+=1)>180&&(n.close(),s.a.clear(r.timer))}}},mounted:function(){this.bandtype=r.a.session("waimai"),this.userData=r.a.session("userShop"),document.querySelector("#warrant").style.height="100%",this.getGoods(),this.brandId=0==this.userData.currentShop.ischain?0:this.userData.currentShop.brandId,this.init()},components:{meiTuanWarrant:n("6d65").default},destroyed:function(){s.a.clear(this.timer)}},p=(n("f6ce9"),n("d801")),h=Object(p.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"shopList"},[n("p",[t._v("请选择\n\t\t\t"),1==t.bandtype?n("span",{staticStyle:{"font-size":"22px"}},[t._v("饿了么")]):t._e(),t._v(" "),2==t.bandtype?n("span",{staticStyle:{"font-size":"22px"}},[t._v("美团")]):t._e(),t._v(" "),3==t.bandtype?n("span",{staticStyle:{"font-size":"22px"}},[t._v("百度")]):t._e(),t._v("\n\t\t\t关联店铺\n\t\t")]),t._v(" "),t._m(0),t._v(" "),t._l(t.shopList,function(e,i){return n("ul",{key:i,staticClass:"eleShop",on:{click:function(n){t.shopSelect(e.TakeoutShopId)}}},[n("li",[t._v("0"+t._s(i+1))]),t._v(" "),n("li",[t._v(t._s(e.TakeoutShopName))]),t._v(" "),n("li",{staticStyle:{cursor:"pointer"}},[n("div",{staticClass:"circle active",class:{"ele-active":t.selShopid==e.TakeoutShopId}})])])})],2),t._v(" "),n("div",{staticClass:"buttenall"},[n("a",{staticClass:"gray",attrs:{href:"javascript:void(0);"},on:{click:t.relieve}},[t._v("解除授权")]),t._v(" "),1==t.bandtype?n("a",{staticClass:"border",attrs:{href:"javascript:void(0);"},on:{click:function(e){t.outerVisible=!0}}},[t._v("补单")]):t._e(),t._v(" "),n("a",{staticClass:"yellow",attrs:{href:"javascript:void(0);"},on:{click:t.next}},[t._v("下一步")])]),t._v(" "),t.showdel?n("meiTuan-warrant",{attrs:{urlData:t.urlData},on:{show:t.hidden}}):t._e(),t._v(" "),n("el-dialog",{attrs:{title:"补单",visible:t.outerVisible,width:"60%"},on:{"update:visible":function(e){t.outerVisible=e}}},[n("el-dialog",{attrs:{width:"40%",title:"",visible:t.innerVisible,"append-to-body":""},on:{"update:visible":function(e){t.innerVisible=e}}},[n("div",{staticClass:"waring"},[n("i",{staticClass:"el-icon-warning"}),t._v(" "),n("span",[t._v("请注意，补单功能只用于补录未录入的已完成的订单。")]),t._v(" "),n("p",[t._v("确定要补录"+t._s(t.getTime(Date.parse(t.replenTime)))+"的订单吗")])]),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.innerVisible=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.dialogconif}},[t._v("确定")])],1)]),t._v(" "),n("div",[n("span",[t._v("请选择补单日期：")]),t._v(" "),n("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},on:{change:t.replenTimechenge},model:{value:t.replenTime,callback:function(e){t.replenTime=e},expression:"replenTime"}})],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.outerVisible=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.replenishment}},[t._v("确定")])],1)],1)],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"title"},[e("li",[this._v("序号")]),this._v(" "),e("li",[this._v("店铺名称")]),this._v(" "),e("li",[this._v("选择")])])}],!1,null,"27c71d6a",null);e.default=h.exports},"26f0":function(t,e,n){"use strict";var i=n("eb3f");n.n(i).a},"29d6":function(t,e,n){},"6d65":function(t,e,n){"use strict";n.r(e);var i={data:function(){return{url:"",show:!0}},props:["urlData"],methods:{cancel:function(t){t.stopPropagation()}},mounted:function(){var t=this;document.onclick=function(){t.show=!1,t.$emit("show",t.show)},this.url=this.urlData}},r=(n("26f0"),n("d801")),s=Object(r.a)(i,function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"iframeBox"},[e("div",{staticClass:"win-mask",attrs:{id:"mask_14981027179151314207"}}),this._v(" "),e("div",{staticClass:"win center",staticStyle:{width:"1000px",height:"800px"},on:{click:this.cancel}},[e("iframe",{staticStyle:{width:"1000px",height:"800px"},attrs:{id:"child",src:this.url}})])])},[],!1,null,"2d4d51f7",null);e.default=s.exports},eb3f:function(t,e,n){},f6ce9:function(t,e,n){"use strict";var i=n("29d6");n.n(i).a}}]);