(window.webpackJsonp=window.webpackJsonp||[]).push([["coupon_statistics"],{"5b4b":function(t,e,i){"use strict";var s=i("e3a4");i.n(s).a},b910:function(t,e,i){"use strict";i.r(e);var s=i("81a2"),a=i("f6ce"),n=i("bbb9"),r=i("05dd");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function s(a,n){try{var r=e[a](n),o=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(o).then(function(t){s("next",t)},function(t){s("throw",t)});t(o)}("next")})}}var c={data:function(){return{startTime:{time:n.a.getTime({time:(new Date).setDate(1)}).start},endTime:{time:n.a.getTime({time:new Date}).end},currstartTime:{time:""},currendTime:{time:""},list:[],page:1,listLen:0,pageTotal:0,card:[{name:"单品减免",selected:!0,id:1},{name:"整单减免",selected:!0,id:2},{name:"单品折扣",selected:!0,id:3},{name:"整单折扣",selected:!0,id:4},{name:"赠品",selected:!0,id:5},{name:"代金券",selected:!0,id:6}],selectName:["单品减免","整单减免","单品折扣","整单折扣","赠品","代金券"],shopListBtn:!1,fiterCards:[1,2,3,4,5,6],fiterId:[],changePage:!0,couponType:0,couponStatus:0,couponId:0,shopIds:0,couponName:"",ischain:"",currentName:[],currentTotal:0,currentList:[],FilterName:[],isShow0:!1,isShow1:!0,isShow2:!0,isShow3:!0,exportUrl:"javascript:void(0);",isBrand:"",isClick:!1,userData:"",titleList:[{titleName:"优惠券名称",dataName:"name"},{titleName:"状态",dataName:"status"},{titleName:"类型",dataName:"type"},{titleName:"创建时间",dataName:"createTime"},{titleName:"结束时间",dataName:"endTime"},{titleName:"领券量",dataName:"send"},{titleName:"券核销量",dataName:"use",conStyle:{color:"#27a8e0",cursor:"pointer"}},{titleName:"券核销率",dataName:"cancelAfterVerification"},{titleName:"券面额"},{titleName:"实收金额"},{titleName:"结算金额"}],coupontitleList:[{titleName:"店铺名称",dataName:"shopName"},{titleName:"核销量",dataName:"useCoupon"},{titleName:"券总额"},{titleName:"入账金额"},{titleName:"结算金额"}]}},methods:{tableEvent:function(t){console.log(t,"")},selectShopType:function(t){this.FilterName=t,this.currentName=[],this.fiterId=[];var e=!0,i=!1,s=void 0;try{for(var a,n=this.FilterName[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value;r.selected&&(this.currentName.push(r.name),this.fiterId.push(r.id))}}catch(t){i=!0,s=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw s}}},selectCouponType:function(t){this.card=t,this.fiterCards=[];var e=!0,i=!1,s=void 0;try{for(var a,n=this.card[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value;r.selected&&this.fiterCards.push(r.id)}}catch(t){i=!0,s=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw s}}},pageNum:function(t){if(0==this.fiterCards.length)return this.$store.commit("setWin",{title:"提示信息",content:"请选择优惠券类型",winType:"alert"}),!1;this.page=t.page;var e={start:this.startTime,end:this.endTime,type:this.fiterCards.join(),status:this.couponStatus,page:this.page};this.getCouponData(e)},getStartTime:function(t){this.startTime={time:t}},getEndTime:function(t){this.endTime={time:t}},getCurrStartTime:function(t){this.currstartTime={time:t}},getCurrEndTime:function(t){this.currendTime={time:t}},getCouponData:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var a,o,c,u,l,h;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=t.start,o=t.end,c=t.type,u=t.status,l=t.page,a=a.time||a,!((o=o.time||o)-a<0)){i.next=10;break}return e.$store.commit("setWin",{title:"提示信息",content:"开始日期不能大于结束日期",winType:"alert"}),i.abrupt("return",!1);case 10:if(!(o-a>=7776e6)){i.next=13;break}return e.$store.commit("setWin",{title:"提示信息",content:"时间间隔不能大于三个月",winType:"alert"}),i.abrupt("return",!1);case 13:if(r.a.checkData({fiterCards:{cond:"$$.length != 0",pro:"请选择优惠券类型"}},e)){i.next=15;break}return i.abrupt("return",!1);case 15:return i.next=17,s.a.getCouponStatisticsData({data:{startTime:a/1e3|0,endTime:o/1e3|0,couponType:c,couponStatus:u,page:l,num:10,ischain:e.ischain,brandId:""}});case 17:h=i.sent,e.list=n.a.sortByAll(h.list,"createTime"),e.listLen=h.count,e.pageTotal=h.total;case 21:case"end":return i.stop()}},i,e)}))()},getOneCoupon:function(t,e,i){var a=this;return o(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t.time||t,e=e.time||e,i){n.next=5;break}return a.$store.commit("setWin",{title:"提示信息",content:"请选择门店类型",winType:"alert"}),n.abrupt("return",!1);case 5:if(!(e-t<0)){n.next=8;break}return a.$store.commit("setWin",{title:"提示信息",content:"开始日期不能大于结束日期",winType:"alert"}),n.abrupt("return",!1);case 8:if(!(e-t>=7776e6)){n.next=11;break}return a.$store.commit("setWin",{title:"提示信息",content:"时间间隔不能大于三个月",winType:"alert"}),n.abrupt("return",!1);case 11:return n.next=13,s.a.getOneCoupon({data:{startTime:t/1e3|0,endTime:e/1e3|0,couponId:a.couponId,shopIds:i,ischain:a.ischain,brandId:""}});case 13:r=n.sent,a.currentList=r,a.currentTotal=r.length;case 16:case"end":return n.stop()}},n,a)}))()},getToOut:function(){var t=this;return o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.list.length<=0)){e.next=3;break}return t.$store.commit("setWin",{title:"提示信息",content:"当前没有数据可以导出！",winType:"alert"}),e.abrupt("return",!1);case 3:s.a.exportCouponStatics({data:{startTime:parseInt(t.startTime.time/1e3),endTime:parseInt(t.endTime.time/1e3),couponType:t.fiterCards.join(),couponStatus:t.couponStatus,page:t.page,num:10,format:"csv"}});case 4:case"end":return e.stop()}},e,t)}))()},searchInDate:function(){this.isClick=!0;var t=this.startTime.time||this.startTime,e=this.endTime.time||this.endTime;this.page=1;var i={start:t,end:e,type:"1,2,3,4,5,6",status:0,page:this.page};this.getCouponData(i)},getSelect:function(t){if(!this.isClick)return!1;0===t?(this.isShow0=!1,this.isShow1=this.isShow2=this.isShow3=!0):1===t?(this.isShow1=!1,this.isShow0=this.isShow2=this.isShow3=!0):2===t?(this.isShow2=!1,this.isShow0=this.isShow1=this.isShow3=!0):(this.isShow3=!1,this.isShow0=this.isShow1=this.isShow2=!0),this.couponStatus=t,this.page=1;var e={start:this.startTime,end:this.endTime,type:this.fiterCards.join(),status:t,page:this.page};this.getCouponData(e)},handleToCount:function(t,e,i){var s=this;if(0==i)return this.$store.commit("setWin",{title:"提示信息",content:"该优惠券暂未领券",winType:"alert"}),!1;if(this.$store.commit("setPageTools",{back:function(){s.handleToBack()}}),this.currentName=[],this.couponId=t,this.couponName=e,this.shopListBtn=!1,this.changePage=!this.changePage,this.currentList=[],this.currentTotal=0,this.isBrand){if(this.isBrand){this.currentName=[],this.fiterId=[];for(var a=0;a<this.shopList.length;a++)this.FilterName.push({name:this.shopList[a].name,selected:!0,id:this.shopList[a].id}),this.currentName.push(this.shopList[a].name),this.fiterId.push(this.shopList[a].id)}}else this.currentName.push(this.userData.currentShop.name);this.currstartTime.time=this.startTime.time||this.startTime,this.currendTime.time=this.endTime.time||this.endTime;var n=this.currstartTime.time||this.currstartTime,r=this.currendTime.time||this.currendTime;this.isBrand?this.isBrand&&this.getOneCoupon(n,r,this.fiterId.join()):this.getOneCoupon(n,r,this.userData.currentShop.id)},handleToBack:function(){var t=this;this.$store.commit("setPageTools",{getToOut:function(){t.getToOut()}}),this.changePage=!this.changePage,this.FilterName=[]},handleSearchInDate:function(){this.isClick=!0;var t={start:this.startTime,end:this.endTime,type:this.fiterCards.join(),status:this.couponStatus,page:1};this.getCouponData(t)},initResert:function(){this.startTime={time:n.a.getTime({time:new Date,type:!0}).start},this.endTime={time:n.a.getTime({time:new Date,type:!0}).end},this.list=[],this.page=1,this.shopListBtn=!1,this.selectName=["请选择优惠券类型"],this.fiterCards=[],this.listLen=0,this.pageTotal=0,this.isShow0=!1,this.isShow1=this.isShow2=this.isShow3=!0,this.couponStatus=0,this.isClick=!1;for(var t=0;t<this.card.length;t++)this.card[t].selected=!1;this.$refs.selectStore.init()},onSelectNuclearSales:function(){var t=this.currstartTime.time||this.currstartTime,e=this.currendTime.time||this.currendTime;if(this.isBrand){if(0==this.fiterId.length)return this.$store.commit("setWin",{title:"提示信息",content:"请选择门店类型",winType:"alert"}),!1;this.getOneCoupon(t,e,this.fiterId.join())}else this.getOneCoupon(t,e,this.userData.currentShop.id)},searchCurrentDate:function(){var t=this.currstartTime.time||this.currstartTime,e=this.currendTime.time||this.currendTime;this.isBrand?this.getOneCoupon(t,e,this.fiterId.join()):this.getOneCoupon(t,e,this.userData.currentShop.id)},handleToResert:function(){if(this.currstartTime={time:n.a.getTime({time:new Date,type:!0}).start},this.currendTime={time:n.a.getTime({time:new Date,type:!0}).end},this.currentList=[],this.currentName=[],this.fiterId=[],this.FilterName=[],this.currentTotal=0,this.isBrand){for(var t=0;t<this.shopList.length;t++)this.FilterName.push({name:this.shopList[t].name,selected:!1,id:this.shopList[t].id});this.$refs.selectStore1.init()}else this.currentName.push(this.userData.currentShop.name);this.$refs.selectStore1.init()},handleClose:function(){this.shopListBtn=!1},selecToOut:function(){this.getToOut()}},filters:{filterStatus:function(t){switch(t){case 0:return"全部";case 1:return"已关联";case 2:return"未关联";case 3:return"过期";default:return""}},filterType:function(t){switch(Number(t)){case 0:return"全部";case 1:return"单品减免";case 2:return"整单减免";case 3:return"单品打折";case 4:return"整单折扣";case 5:return"赠品";case 6:return"代金券";default:return""}},filterCurrentName:function(t){return"请选择门店类型"===t[0]?"":t.join("、")}},mounted:function(){var t=this;this.$store.commit("setPageTools",{getToOut:function(){t.getToOut()}}),this.userData=a.a.session("userShop"),this.ischain=this.userData.currentShop.ischain,this.userData.currentShop&&3==this.ischain?this.isBrand=!0:this.isBrand=!1,this.isBrand&&(this.shopList=this.userData.currentShop.direct.concat(this.userData.currentShop.franchise)),this.searchInDate()},components:{page:function(){return i.e("page_element").then(i.bind(null,"5921"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))},"select-store":function(){return i.e("select_store").then(i.bind(null,"cb83"))},comTable:function(){return i.e("table").then(i.bind(null,"4360"))}}},u=(i("5b4b"),i("d801")),l=Object(u.a)(c,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"online-configuration"}},[t.changePage?i("section",[i("div",{staticClass:"cupon-time-select clearfix"},[i("span",{staticClass:"fl cupon-type"},[t._v("时间选择")]),t._v(" "),i("calendar",{staticClass:"fl",attrs:{pObj:t.startTime},on:{throwTime:t.getStartTime}}),t._v(" "),i("span",{staticClass:"fl line"},[t._v("--")]),t._v(" "),i("calendar",{staticClass:"fl",attrs:{pObj:t.endTime},on:{throwTime:t.getEndTime}}),t._v(" "),i("span",{staticClass:"fl order-order-searchA",on:{click:t.searchInDate}},[i("span",{staticClass:"order-order-search"})]),t._v(" "),i("span",{staticClass:"fl cupon-type"},[t._v("优惠券类型")]),t._v(" "),i("section",{staticClass:"staList fl detLi"},[i("select-store",{ref:"selectStore",attrs:{sorts:t.card,tipName:"请选择优惠券类型"},on:{emit:t.selectCouponType}})],1),t._v(" "),i("div",{staticClass:"fl buttonbox"},[i("button",{staticClass:"fl cupon-scret",on:{click:t.handleSearchInDate}},[t._v("筛选")]),t._v(" "),i("button",{staticClass:"fl cupon-reset cupon-reset-btn",on:{click:t.initResert}},[t._v("重置")])])],1),t._v(" "),i("div",{staticClass:"cupon-type-list"},[i("ul",[i("li",[i("button",{staticClass:"cupon-scret",class:{"cupon-list-btn":t.isShow0},on:{click:function(e){t.getSelect(0)}}},[t._v("全部")])]),t._v(" "),i("li",[i("button",{staticClass:"cupon-scret",class:{"cupon-list-btn":t.isShow2},on:{click:function(e){t.getSelect(2)}}},[t._v("未关联")])]),t._v(" "),i("li",[i("button",{staticClass:"cupon-scret",class:{"cupon-list-btn":t.isShow1},on:{click:function(e){t.getSelect(1)}}},[t._v("已关联")])]),t._v(" "),i("li",[i("button",{staticClass:"cupon-scret",class:{"cupon-list-btn":t.isShow3},on:{click:function(e){t.getSelect(3)}}},[t._v("已过期")])])])]),t._v(" "),i("div",[i("section",[i("com-table",{attrs:{listHeight:80,listName:"优惠券统计",showTitle:1,listWidth:1400,introData:t.list,titleData:t.titleList,allTotal:t.listLen},on:{tableEvent:t.tableEvent},scopedSlots:t._u([{key:"con-1",fn:function(e){return i("div",{},[t._v("\n\t\t\t\t\t\t"+t._s(t._f("filterStatus")(e.data.status))+"\n\t\t\t\t\t")])}},{key:"con-2",fn:function(e){return i("div",{},[t._v("\n\t\t\t\t\t\t"+t._s(t._f("filterType")(e.data.type))+"\n\t\t\t\t\t")])}},{key:"con-6",fn:function(e){return i("div",{on:{click:function(i){t.handleToCount(e.data.id,e.data.name,e.data.use)}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.data.use)+"\n\t\t\t\t\t")])}},{key:"con-8",fn:function(e){return i("div",{},["6"==e.data.type?i("span",[t._v(t._s((e.data.couponPrice*e.data.use).toFixed(2)))]):i("span",[t._v("--")])])}},{key:"con-9",fn:function(e){return i("div",{},["6"==e.data.type?i("span",[t._v(t._s((e.data.billPrice*e.data.use).toFixed(2)))]):i("span",[t._v("--")])])}},{key:"con-10",fn:function(e){return i("div",{},["6"==e.data.type?i("span",[t._v(t._s((e.data.reckoningPrice*e.data.use).toFixed(2)))]):i("span",[t._v(t._s(e.data.reckoningPrice))])])}}])})],1),t._v(" "),t.pageTotal>1?i("page",{staticStyle:{float:"left",margin:"20px 10px 0 50px"},attrs:{page:t.page,total:t.pageTotal,len:10},on:{pageNum:t.pageNum}}):t._e()],1)]):i("section",[i("section",{staticClass:"cupon-time-select clearfix"},[i("span",{staticClass:"fl cupon-type"},[t._v("时间筛选")]),t._v(" "),i("section",{staticClass:"statisticsList fl"},[i("section",{staticClass:"tableListInp"},[i("calendar",{ref:"triggerStartTime",staticClass:"fl",staticStyle:{width:"187px",height:"39px"},attrs:{pObj:t.currstartTime,only:!1,format:"yyyy年MM月dd日"},on:{throwTime:t.getCurrStartTime}})],1)]),t._v(" "),i("span",{staticClass:"fl",staticStyle:{margin:"0 4px 0 13px"}},[t._v("--")]),t._v(" "),i("section",{staticClass:"statisticsList fl"},[i("section",{staticClass:"tableListInp",staticStyle:{width:"282px"}},[i("calendar",{ref:"triggerEndTime",staticClass:"fl",staticStyle:{width:"187px",height:"39px"},attrs:{pObj:t.currendTime,only:!1,format:"yyyy年MM月dd日"},on:{throwTime:t.getCurrEndTime}}),t._v(" "),i("span",{staticClass:"order-order-searchA",staticStyle:{"margin-left":"53px"},on:{click:t.searchCurrentDate}},[i("span",{staticClass:"order-order-search"})])],1)]),t._v(" "),i("div",{staticClass:"fl",staticStyle:{height:"42px"}},[i("span",{staticClass:"fl cupon-type"},[t._v("选择门店")]),t._v(" "),i("section",{staticClass:"staList fl detLi"},[3!=t.ischain?i("section",{staticClass:"tableList"},[i("span",{staticClass:"oSpan"},[t._v(t._s(t.currentName.join(" ")))]),t._v(" "),t._m(0)]):t._e(),t._v(" "),3==t.ischain?i("select-store",{ref:"selectStore1",attrs:{sorts:t.FilterName,tipName:"请选择门店"},on:{emit:t.selectShopType}}):t._e()],1)]),t._v(" "),i("div",{staticClass:"fl"},[i("button",{staticClass:"fl cupon-scret",on:{click:t.onSelectNuclearSales}},[t._v("筛选")]),t._v(" "),i("button",{staticClass:"fl cupon-reset cupon-reset-btn",on:{click:t.handleToResert}},[t._v("重置")])])]),t._v(" "),i("section",{staticClass:"current-name"},[i("div",{staticClass:"current-list-name"},[i("span",[t._v("优惠券名称")]),t._v("：\n\t\t\t\t"),i("span",[t._v(t._s(t.couponName))])]),t._v(" "),i("div",{staticClass:"current-list-store"},[i("span",[t._v("选择门店")]),t._v(":\n\t\t\t\t"),i("span",[t._v(t._s(t._f("filterCurrentName")(t.currentName)))])])]),t._v(" "),i("section",[i("com-table",{attrs:{listHeight:80,listName:t.couponName,showTitle:1,listWidth:1400,introData:t.currentList,titleData:t.coupontitleList,allTotal:t.currentTotal},scopedSlots:t._u([{key:"con-2",fn:function(e){return i("div",{},["-"!=e.data.reckoningPrice&&"-"!=e.data.reckoningPrice?i("span",[t._v(t._s((e.data.couponPrice*e.data.useCoupon).toFixed(2)))]):i("span",[t._v("-")])])}},{key:"con-3",fn:function(e){return i("div",{},["-"!=e.data.billPrice?i("span",[t._v(t._s((e.data.billPrice*e.data.useCoupon).toFixed(2)))]):i("span",[t._v(t._s(e.data.billPrice))])])}},{key:"con-4",fn:function(e){return i("div",{},["-"!=e.data.reckoningPrice?i("span",[t._v(t._s((e.data.reckoningPrice*e.data.useCoupon).toFixed(2)))]):i("span",[t._v(t._s(e.data.reckoningPrice))])])}}])})],1)])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl"},[e("i")])}],!1,null,"e54ffe2c",null);e.default=l.exports},e3a4:function(t,e,i){}}]);