(window.webpackJsonp=window.webpackJsonp||[]).push([["check_material"],{"10ce":function(t,e,a){},"788d":function(t,e,a){"use strict";var i=a("10ce");a.n(i).a},"86d8":function(t,e,a){"use strict";a.r(e);var i=a("81a2"),n=a("05dd"),s=a("bbb9");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function i(n,s){try{var r=e[n](s),o=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}("next")})}}var o={data:function(){return{addShow:!1,list:[],selObj:{list:[],search:{},storeAll:!1},selMatItem:[],selMatSearch:null,listLength:0,batchShow:!1,pageTotal:0,page:1,pageShow:10,batchObj:{mid:"",wid:"",areaId:"",unitId:""},batchList:[],checkList:[],openIndex:0,useList:[],isUse:!1,pageSaveList:[],matTypeHash:{0:"成品",1:"半成品",2:"普通物料"}}},components:{addMaterial:function(){return a.e("add_material").then(a.bind(null,"c4ba"))},batchWin:function(){return a.e("material_batch_win").then(a.bind(null,"1859"))},pageBtn:function(){return a.e("page_element").then(a.bind(null,"5921"))},dropDown:function(){return a.e("drop_down").then(a.bind(null,"7e31"))}},mounted:function(){var t=this.$route.query.id;this.isUse=!!t,this.initBtn(),this.isUse?(this.initBtn(),this.setDefault(t)):this.addShow=!0},methods:{initBtn:function(){var t=this,e=[{name:"确定盘库",style:"background: #fe8d01;border: 1px solid #fe8d01;color: #fff;",fn:function(){t.checkMaterial()}},{name:"添加物料",style:"background: #29a7e1;border: 1px solid #29a7e1;color: #fff;",fn:function(){t.addShow=!0}},{name:"取消盘库",style:"background: #b3b3b3;border: 1px solid #b3b3b3;color: #fff;",fn:function(){window.history.go(-1)}}];this.$store.commit("setPageTools",e)},setDefault:function(t){var e=this;return r(regeneratorRuntime.mark(function a(){var n,s,r,o,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.getInventoryMaterialTemplate({data:{id:t}});case 2:for(l in n=a.sent,s=n.content.wids,r=n.content.aids,e.wid=s?s.join(","):"",e.areaId=r?r.join(","):"",e.cid=n.content.c2?n.content.c2:n.content.c1,e.selObj.search={cid:e.cid,sortOneId:n.content.c1,sortTwoId:n.content.c2,wid:e.wid,areaId:e.areaId},e.selObj.name=n.name,o=0,["cid","wid","areaId"])e[l]||o++;n.content.items.length&&3==o&&(e.useList=n.content.items.map(function(t){return{mid:t.mid,areaId:t.aid}}),e.getUseList(),e.selObj.storeAll=!1),!n.content.items.length&&o>0&&(e.getMatList(),e.selObj.storeAll=!0);case 14:case"end":return a.stop()}},a,e)}))()},getUseList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getListByMidsAndAreaId({data:{param:t.useList}});case 2:a=e.sent,t.pageTotal=Math.floor(a.length/t.pageShow),t.listLength=a.length,t.selObj.list=a,t.setListData(a);case 7:case"end":return e.stop()}},e,t)}))()},unitSel:function(t,e){var a=this.list[e],i=a.unit[t.value];a.oneNum="",a.twoNum="",a.selBatchList=[],a.haveBatch=!1,a.unitIndex=t.value,1==i.isMin?(a.oneName="",a.unitValue=1):(a.oneName=i.name,a.unitValue=i.value),a.unitId=i.muId},matClose:function(t){if(this.initBtn(),t)if(this.page=1,this.selObj=t,this.pageSaveList=[],this.checkList=[],t.list.length)this.pageTotal=Math.ceil(t.list.length/this.pageShow),this.listLength=t.list.length,this.webPage();else{for(var e in this.selMatSearch=t.search,this.selMatSearch)this[e]=this.selMatSearch[e];this.getMatList()}this.addShow=!1},webPage:function(){var t=(this.page-1)*this.pageShow,e=this.page*this.pageShow,a=this.selObj.list.slice(t,e),i=s.a.deepCopy(a);this.setListData(i)},setSuprlus:function(t,e){var a="",i="",s=1,r=!0,o=!1,l=void 0;try{for(var u,c=e[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var h=u.value;1==h.isMin?(i=h.name,1==h.isDefault&&(a=h.name,s=h.value)):1==h.isDefault&&(a=h.name,s=h.value)}}catch(t){o=!0,l=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw l}}return n.a.comUnit(t,s,a,i)},clearItem:function(t){var e=this.list[t];e.oneNum="",e.twoNum="",e.selBatchList=[],e.haveBatch=!1;for(var a=0;a++;a<this.pageSaveList.length){var i=this.pageSaveList[a];i.id==e.id&&i.areaId==e.areaId&&(this.pageSaveList.splice(a,1),a--)}},openBatchWin:function(t){var e=this.list[t];this.batchShow=!0,this.openIndex=t,this.batchObj={mid:e.id,wid:e.wid,areaId:e.areaId,unitId:e.unitId},this.batchList=e.selBatchList?e.selBatchList:[]},batchClose:function(t){if(t){var e=this.list[this.openIndex];if(t.list.length){var a;e.selBatchList=t.list,e.haveBatch=!0;var i=t.allNum,s=e.unitValue,r=e.oneName?e.oneName:e.twoName,o=e.twoName,l=n.a.comUnit(i,s,r,o,!0);e.oneNum=l.oNull,e.twoNum=l.tNull;var u=[],c=!0,h=!1,d=void 0;try{for(var v,m=e.selBatchList[Symbol.iterator]();!(c=(v=m.next()).done);c=!0){var f=v.value,p={batchId:f.batchId,wid:f.wid,areaId:f.areaId,surplus:f.totalItem,itemId:e.id,unitId:e.unitId};u.push(p)}}catch(t){h=!0,d=t}finally{try{!c&&m.return&&m.return()}finally{if(h)throw d}}this.spliceArr(this.checkList,e),(a=this.checkList).push.apply(a,u)}else e.haveBatch=!1}this.batchShow=!1},spliceArr:function(t,e){for(var a=0;a<t.length;a++){var i=t[a];i.itemId==e.id&&i.areaId==e.areaId&&(t.splice(a,1),a--)}},setSendList:function(){var t=[];t=this.pageSaveList.length?this.pageSaveList:this.list;var e=!0,a=!1,i=void 0;try{for(var n,s=t[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value,o=Number(r.oneNum)*Number(r.unitValue)+Number(r.twoNum);if(!r.haveBatch&&""!==r.oneNum||""!==r.twoNum){var l={batchId:0,wid:r.wid,areaId:r.areaId,surplus:o,itemId:r.id,unitId:r.unitId};this.spliceArr(this.checkList,r),this.checkList.push(l)}}}catch(t){a=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(a)throw i}}},veriList:function(){var t=!0,e=!1,a=void 0;try{for(var i,n=this.list[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;if(""!==s.oneNum||""!==s.twoNum){var r=Number(s.oneNum)*Number(s.unitValue)+Number(s.twoNum);if(isNaN(s.oneNum)||isNaN(s.twoNum))return this.myAlert("物料:"+s.name+"("+s.wName+"/"+s.aName+"),盘库数量必须为数字"),!1;if(r<0)return this.myAlert("物料:"+s.name+"("+s.wName+"/"+s.aName+"),盘库数量不能小于0"),!1;if(r>999999999)return this.myAlert("物料:"+s.name+"("+s.wName+"/"+s.aName+"),盘库数量过大!"),!1}}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}return!0},checkMaterial:function(){var t=this;this.setSendList(),this.checkList.length?this.veriList()&&this.$store.commit("setWin",{winType:"confirm",title:"操作提示",content:"确认盘库？",callback:function(e){"ok"==e&&setTimeout(function(){t.checkMatSubmit()})}}):this.myAlert("请填写盘库数量")},checkMatSubmit:function(){var t=this;return r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.GoodsinventoryBatchSetMaterialInventory({data:{type:1,data:t.checkList}});case 2:e.sent.result?(t.myAlert("物料盘库成功！"),delete t.$route.query.id,t.$router.push({path:"/admin/materialCountHistory",query:t.$route.query})):t.myAlert("物料盘库失败！");case 4:case"end":return e.stop()}},e,t)}))()},getMatList:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.materialGetListByArea({data:{page:t.page,num:t.pageShow,name:"",cid:t.cid,wid:t.wid,areaId:t.areaId}});case 2:a=e.sent,t.pageTotal=a.total,t.listLength=a.count,t.setListData(a.list);case 6:case"end":return e.stop()}},e,t)}))()},myAlert:function(t){this.$store.commit("setWin",{title:"操作提示",content:t})},setListData:function(t){var e=!0,a=!1,i=void 0;try{for(var n,s=t[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){for(var r=n.value,o=[],l=0,u="",c="",h=1,d="",v=0;v<r.unit.length;v++){var m=r.unit[v];o.push({value:v,label:m.name}),1==m.isMin?c=m.name:1==m.isDefault&&(u=m.name,h=m.value),1==m.isDefault&&(l=v,d=m.muId)}r.unitArr=o,r.unitIndex=l,r.unitId=d,r.oneNum="",r.twoNum="",r.oneName=u,r.twoName=c,r.unitValue=h}}catch(t){a=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(a)throw i}}this.eachSaveList(t)},eachSaveList:function(t){if(this.pageSaveList.length){var e=!0,a=!1,i=void 0;try{for(var n,s=this.pageSaveList[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value,o=!0,l=!1,u=void 0;try{for(var c,h=t[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var d=c.value;if(d.id==r.id&&d.areaId==r.areaId){for(var v in r)this.$set(d,v,r[v]);break}}}catch(t){l=!0,u=t}finally{try{!o&&h.return&&h.return()}finally{if(l)throw u}}}}catch(t){a=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(a)throw i}}}this.list=t},setPageSave:function(){var t=!0,e=!1,a=void 0;try{for(var i,n=this.list[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;""===s.oneNum&&""===s.twoNum||(this.checkListRepeat(s),this.pageSaveList.push(s))}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}},checkListRepeat:function(t){for(var e=0;e<this.pageSaveList.length;e++){var a=this.pageSaveList[e];a.id==t.id&&a.areaId==t.areaId&&(this.pageSaveList.splice(e,1),e--)}},pageChange:function(t){this.page=t.page,this.pageShow=t.num,this.setPageSave(),this.selObj.list.length?this.webPage():this.getMatList()}}},l=(a("788d"),a("d801")),u=Object(l.a)(o,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"check-material"}},[t.addShow?t._e():[a("div",{staticClass:"main"},[a("div",{staticClass:"head"},[t._v("\n\t\t\t\t盘库物料列表 · 共"),a("em",[t._v(t._s(t.listLength))]),t._v("个条目\n\t\t\t")]),t._v(" "),a("div",{staticClass:"scroll-box"},[t._m(0),t._v(" "),t._l(t.list,function(e,i){return a("div",{key:i,staticClass:"list-item"},[a("div",{staticClass:"cell select-ban"},[a("em",{staticClass:"clear",on:{click:function(e){t.clearItem(i)}}},[t._v("清空输入")]),t._v(" "),a("em",{on:{click:function(e){t.openBatchWin(i)}}},[t._v("批量盘库")])]),t._v(" "),a("div",{staticClass:"cell"},[a("drop-down",{staticClass:"sel-box",attrs:{list:e.unitArr,value:e.unitIndex,width:90,noRepeat:!0},on:{emit:function(e){t.unitSel(e,i)}}})],1),t._v(" "),a("div",{staticClass:"cell wide"},[e.oneName?[a("div",{staticClass:"input-box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.oneNum,expression:"item.oneNum"}],attrs:{type:"text",maxlength:"10",placeholder:"请输入数量",disabled:e.haveBatch},domProps:{value:e.oneNum},on:{input:function(a){a.target.composing||t.$set(e,"oneNum",a.target.value)}}}),t._v(" "),a("div",{staticClass:"word"},[t._v(t._s(e.oneName))])]),t._v("\n\t\t\t\t\t\t\t+\n\t\t\t\t\t\t")]:t._e(),t._v(" "),a("div",{staticClass:"input-box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.twoNum,expression:"item.twoNum"}],attrs:{type:"text",maxlength:"10",placeholder:"请输入数量",disabled:e.haveBatch},domProps:{value:e.twoNum},on:{input:function(a){a.target.composing||t.$set(e,"twoNum",a.target.value)}}}),t._v(" "),a("div",{staticClass:"word"},[t._v(t._s(e.twoName))])])],2),t._v(" "),a("div",{staticClass:"cell text-ellipsis",attrs:{title:e.name}},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t")]),t._v(" "),a("div",{staticClass:"cell text-ellipsis",attrs:{title:t.setSuprlus(e.surplus,e.unit)}},[t._v("\n\t\t\t\t\t\t"+t._s(t.setSuprlus(e.surplus,e.unit))+"\n\t\t\t\t\t")]),t._v(" "),a("div",{staticClass:"cell text-ellipsis",attrs:{title:e.wName+(e.aName?" / "+e.aName:"")}},[t._v("\n\t\t\t\t\t\t"+t._s(e.wName)+t._s(e.aName?" / "+e.aName:"")+"\n\t\t\t\t\t")]),t._v(" "),a("div",{staticClass:"cell"},[t._v(t._s(e.batch))]),t._v(" "),a("div",{staticClass:"cell"},[t._v(t._s(t.matTypeHash[e.type]))])])}),t._v(" "),t.list.length?t._e():a("div",{staticClass:"empty"},[t._v("- 暂无条目 -")])],2)]),t._v(" "),a("div",{staticClass:"page-box"},[a("pageBtn",{attrs:{total:t.pageTotal,page:t.page,isNoJump:!0},on:{pageNum:t.pageChange}})],1)],t._v(" "),t.addShow?a("add-material",{attrs:{selObj:t.selObj},on:{emit:t.matClose}}):t._e(),t._v(" "),t.batchShow?a("batch-win",{attrs:{material:t.batchObj,selItem:t.batchList},on:{emit:t.batchClose}}):t._e()],2)},[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title"},[a("span",[t._v("操作")]),t._v(" "),a("span",[t._v("单位选择")]),t._v(" "),a("span",{staticClass:"wide"},[t._v("盘库数量")]),t._v(" "),a("span",[t._v("物料名称")]),t._v(" "),a("span",[t._v("库存数量")]),t._v(" "),a("span",[t._v("所属仓库")]),t._v(" "),a("span",[t._v("批次数量")]),t._v(" "),a("span",[t._v("类型")])])}],!1,null,"00351d8a",null);e.default=u.exports}}]);