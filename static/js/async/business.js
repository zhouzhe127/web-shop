(window.webpackJsonp=window.webpackJsonp||[]).push([["business"],{"62a5":function(t,e,s){"use strict";s.r(e);var i=s("f6ce"),n=s("bbb9"),r=s("44e7"),a=s("81a2");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function i(n,r){try{var a=e[n](r),o=a.value}catch(t){return void s(t)}if(!a.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}("next")})}}var h={data:function(){return{options:["日","周","月","季度","年"],selectedType:0,selectedName:"日",startTime:"",endTime:"",reqStartTime:"",reqEndTime:"",openTime:1,shopList:[],shopIdArr:"",shopIds:"",shopId:"",shopSelectStr:"",storeName:"",isBrand:"",isBrandSend:0,isOneStore:"",isOneShow:"",coverShow:!1,storeListShow:!1,allSelected:!0,sales:[],pie:[],bar:[],line:[],tipsContent:{business:"该时间段内所有堂吃商品原价+堂吃服务费+外卖商品原价 = 营业总额（不计入退品）",discount:"活动优惠券、店内优惠（整单减免、整单折扣、整单强折、单品减免、单品折扣、赠菜金额、积分抵扣）以及外卖活动优惠金额",amount:"入账总额 = 营业总额 - 优惠总额（不计入未入账的支付方式的金额）",pieGoods:"不计入外卖服务费",pieDiscount:"外卖优惠、活动等都计入外卖活动补贴"},tipsText:"",tipShow:!1,posiTips:"",helpIconDom:null,echarts:null,userData:"",dropList:[],dropName:"请选择店铺",repeat:!0,taskId:"",timerId:"",isShowStore:!1,storeShowH:"20px"}},components:{selectBtn:function(){return s.e("select_btn").then(s.bind(null,"3d41"))},calendar:function(){return s.e("calendar_type").then(s.bind(null,"f2dd"))},selectStore:function(){return s.e("el_shopList").then(s.bind(null,"60ff"))},specific:function(){return s.e("business_specific").then(s.bind(null,"848a"))},pieChart:function(){return s.e("business_pie").then(s.bind(null,"a792"))},barChart:function(){return s.e("business_bar").then(s.bind(null,"f2f2"))},lineChart:function(){return s.e("business_line").then(s.bind(null,"c307"))}},created:function(){this.userData=i.a.session("userShop"),this.shopId=this.userData.currentShop.id;var t=[];if("3"==this.userData.currentShop.ischain){this.shopList=i.a.session("shopList");var e=!0,s=!1,n=void 0;try{for(var r,a=this.shopList[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=r.value;t.push(o.id),this.$set(o,"selected",!0)}}catch(t){s=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(s)throw n}}this.shopIdArr=t}else this.shopIdArr=[this.userData.currentShop.id]},mounted:function(){for(var t in this.isBrand="3"==this.userData.currentShop.ischain?1:0,this.shopIds=this.shopIdArr,this.shopList)this.shopList[t].selected=!0;this.storeName=this.shopList.length>0?this.shopList[0].name:"选择店铺",this.isOneStore=this.shopList.length<=1,this.isOneShow=this.shopList.length<=1,this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(0,0,0,0),(0==this.isBrand||this.shopList.length>0)&&this.search(),this.getEcharts()},destroyed:function(){r.a.clear(this.timerId)},methods:{openStore:function(){1==this.isShowStore?this.storeShowH="20px":this.storeShowH="auto",this.isShowStore=!this.isShowStore},selectType:function(t){this.selectedType=t},timeCheck:function(){this.openTime=0==this.openTime?1:0},startTimeChange:function(t){this.startTime=t},endTimeChange:function(t){this.endTime=t},setIsOneStore:function(t){this.isOneStore=1==t},getDrop:function(t){this.shopIds=t;var e=0,s=!0,i=!1,n=void 0;try{for(var r,a=this.shopList[Symbol.iterator]();!(s=(r=a.next()).done);s=!0){var o=r.value,h=!0,c=!1,p=void 0;try{for(var d,u=this.shopIds[Symbol.iterator]();!(h=(d=u.next()).done);h=!0){var l=d.value;if(o.id==l){e++,o.selected=!0;break}o.selected=!1}}catch(t){c=!0,p=t}finally{try{!h&&u.return&&u.return()}finally{if(c)throw p}}}}catch(t){i=!0,n=t}finally{try{!s&&a.return&&a.return()}finally{if(i)throw n}}this.setIsOneStore(e)},getEcharts:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e("echarts").then(function(){var t=s("375c");return"object"==typeof t&&t&&t.__esModule?t:Object.assign({},"object"==typeof t&&t,{default:t})});case 2:i=e.sent,t.echarts=i;case 4:case"end":return e.stop()}},e,t)}))()},getData:function(t){var e=this;return o(regeneratorRuntime.mark(function s(){var i;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e.coverShow=!0,s.next=3,a.a.statisticsBusiness({data:{startTime:e.reqStartTime,endTime:e.reqEndTime,dateType:e.selectedType+1,isOpenTime:e.openTime,shopId:t}});case 3:i=s.sent,e.sales=i.sales,e.pie=i.proportion,e.line=i.list,e.coverShow=!1;case 8:case"end":return s.stop()}},s,e)}))()},getDataBrand:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.statisticsBrandBusiness({data:{startTime:t.reqStartTime,endTime:t.reqEndTime,dateType:t.selectedType+1,shopIds:t.shopIds.join("-"),isOpenTime:t.openTime}});case 2:s=e.sent,r.a.clear(t.timerId),t.repeat=!0,t.coverShow=!1,s?(t.sales=s.sales,t.bar=s.columnar,t.line=s.list,t.coverShow=!1):t.$store.commit("setWin",{title:"提示信息",content:"请求失败，请重试..."});case 7:case"end":return e.stop()}},e,t)}))()},getTaskId:function(){var t=this;return o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.repeat){e.next=3;break}return t.$store.commit("setWin",{title:"提示信息",content:"当前查询尚未结束，请结束后再进行查询或刷新浏览器重新查询！"}),e.abrupt("return");case 3:a.a.createBusinessTask({data:{startTime:t.reqStartTime,endTime:t.reqEndTime,dateType:t.selectedType+1,shopIds:t.shopIds.join("-"),isOpenTime:t.openTime}}).then(function(e){t.taskId=e,t.repeat=!1,t.coverShow=!0,t.timerId=r.a.add(function(){a.a.taskInfo({data:{taskId:t.taskId}}).then(function(e){3==e.status?t.getDataBrand():2==e.status&&(t.stopRepeat(),t.$store.commit("setWin",{title:"提示信息",content:"请求失败，请重试！"}))})},1e3,600,!1,function(){t.stopRepeat(),t.$store.commit("setWin",{title:"提示信息",content:"请求超时，请重试！"})})});case 4:case"end":return e.stop()}},e,t)}))()},validate:function(){var t=!0;return parseInt(this.startTime/1e3/3600/24)>parseInt(this.endTime/1e3/3600/24)&&(this.$store.commit("setWin",{title:"提示信息",content:"开始时间不能大于结束时间"}),t=!1),this.isBrand&&!this.shopIds.length&&(this.$store.commit("setWin",{title:"提示信息",content:"没有可选店铺"}),t=!1),t},search:function(){if(this.validate()){this.reqStartTime=n.a.format(new Date(this.startTime),"yyyyMMdd");var t=void 0,e=void 0,s=void 0;switch(this.selectedType){case 0:this.reqEndTime=n.a.format(new Date(this.endTime),"yyyyMMdd");break;case 1:t=new Date(this.endTime).setHours(0,0,0,0),this.reqEndTime=n.a.format(new Date(t+5184e5),"yyyyMMdd");break;case 2:case 3:e=(t=new Date(this.endTime)).getMonth(),s=t.getFullYear(),e<11&&2==this.selectedType?e+=1:e<9&&3==this.selectedType?e+=3:(e=0,s+=1),t.setYear(s),t.setMonth(e,1),t=new Date(Date.parse(t)-864e5),this.reqEndTime=n.a.format(t,"yyyyMMdd");break;case 4:(t=new Date(this.endTime)).setYear(t.getFullYear()+1,1),t=new Date(Date.parse(t)-864e5),this.reqEndTime=n.a.format(t,"yyyyMMdd")}this.isOneShow=this.isOneStore,this.isOneStore?(this.isBrandSend=0,1==this.isBrand?(r.a.clear(this.timerId),this.getData(this.shopIds.join("-"))):this.getData(this.shopId)):(this.isBrandSend=1,this.getTaskId())}},stopRepeat:function(){r.a.clear(this.timerId),this.coverShow=!1,this.repeat=!0},resetInput:function(){if(this.stopRepeat(),this.openTime=1,this.selectedType=0,this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(0,0,0,0),this.isBrand){var t=[],e=!0,s=!1,i=void 0;try{for(var n,r=this.shopList[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var a=n.value;a.selected=!0,t.push(a.id)}}catch(t){s=!0,i=t}finally{try{!e&&r.return&&r.return()}finally{if(s)throw i}}this.shopIds=t,this.setIsOneStore(this.shopList.length)}this.search()},tips:function(t){var e=t.target;if("help-icon"==e.className)if(this.tipShow&&e==this.helpIconDom)this.tipShow=!1,this.posiTips="",document.removeEventListener("click",this.tipsClose);else{var s=e.getAttribute("data-name"),i=e.offsetTop-15,n=e.offsetLeft+30;this.tipsText=this.tipsContent[s],this.posiTips="top:"+i+"px;left:"+n+"px",this.tipShow=!0,this.helpIconDom=e,document.addEventListener("click",this.tipsClose)}},tipsClose:function(t){t.target.className.includes("help-icon")||(this.tipShow=!1,this.posiTips="",document.removeEventListener("click",this.tipsClose))}}},c=(s("ace2"),s("d801")),p=Object(c.a)(h,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"business",on:{click:t.tips}},[s("div",{staticClass:"filter"},[s("div",{staticClass:"block"},[s("span",[t._v("时间类型：")]),t._v(" "),s("selectBtn",{staticClass:"select-btn",attrs:{sorts:t.options,index:t.selectedType,width:150},on:{emit:t.selectType}}),t._v(" "),s("div",{staticClass:"input-box input-start"},[s("calendar",{attrs:{time:t.startTime,type:t.selectedType,format:"yyyy年MM月dd日"},on:{emit:t.startTimeChange}})],1),t._v(" "),s("div",{staticClass:"input-box input-start"},[s("calendar",{attrs:{time:t.endTime,type:t.selectedType,format:"yyyy年MM月dd日"},on:{emit:t.endTimeChange}})],1)],1),t._v(" "),s("div",{staticClass:"block"},[s("div",{staticClass:"input-check select-ban"},[s("i",{class:{active:1==this.openTime},on:{click:t.timeCheck}}),t._v("\n\t\t\t\t按营业时间统计\n\t\t\t")]),t._v(" "),s("div",{staticClass:"input-box input-start"},[t.isBrand?s("select-store",{attrs:{shopIds:t.shopIds},on:{chooseShop:t.getDrop}}):t._e()],1),t._v(" "),s("div",{staticClass:"search-box"},[s("el-button",{attrs:{type:"success"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),s("el-button",{attrs:{type:"info"},on:{click:t.resetInput}},[t._v("重置")])],1)]),t._v(" "),t.isBrand?s("div",{staticClass:"store-show",style:{height:t.storeShowH}},[s("i",[t._v("已选择店铺：")]),t._v(" "),s("div",{ref:"storeBlock",staticClass:"store-block"},[s("em",{staticClass:"select-ban",on:{click:t.openStore}},[t._v(t._s(t.isShowStore?"收起":"展开"))]),t._v(" "),t._l(t.shopList,function(e,i){return e.selected?s("span",{key:i,attrs:{"data-id":e.id}},[t._v(t._s(e.shopName)+"，")]):t._e()})],2)]):t._e()]),t._v(" "),s("specific",{attrs:{specific:t.sales}}),t._v(" "),t.isOneShow?s("pieChart",{attrs:{pie:t.pie,cover:t.coverShow,echarts:t.echarts}}):t._e(),t._v(" "),t.isBrand&&!t.isOneShow?s("barChart",{attrs:{bar:t.bar,cover:t.coverShow,echarts:t.echarts,shopList:t.shopList}}):t._e(),t._v(" "),s("lineChart",{attrs:{line:t.line,cover:t.coverShow,echarts:t.echarts}}),t._v(" "),t.tipShow?s("div",{staticClass:"busi-tips",style:t.posiTips},[s("em"),t._v(t._s(t.tipsText))]):t._e()],1)},[],!1,null,"73223f38",null);e.default=p.exports},6605:function(t,e,s){},ace2:function(t,e,s){"use strict";var i=s("6605");s.n(i).a}}]);