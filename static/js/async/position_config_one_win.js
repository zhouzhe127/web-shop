(window.webpackJsonp=window.webpackJsonp||[]).push([["position_config_one_win"],{"40f0":function(t,i,n){"use strict";n.r(i);var e=function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",[n("win",{attrs:{align:"right",width:480,height:"auto",ok:t.okStyle,cancel:t.cancelStyle},on:{winEvent:t.clickResult}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),t._v(" "),n("div",{staticStyle:{"background-color":"#F2F2F2"},attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"jobWin",attrs:{id:"jobWin"}},[n("h2",{staticClass:"required tag"},[t._v("职位名称")]),t._v(" "),n("div",{staticClass:"mes"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.info.name,expression:"info.name"}],staticClass:"input",staticStyle:{width:"100%"},attrs:{type:"text",maxlength:"10",placeholder:"请输入职位名字"},domProps:{value:t.info.name},on:{input:function(i){i.target.composing||t.$set(t.info,"name",i.target.value)}}})]),t._v(" "),n("div",{staticClass:"clear"}),t._v(" "),n("h2",{staticClass:"required tag"},[t._v("排序")]),t._v(" "),n("div",{staticClass:"mes"},[n("subadd",{attrs:{bindnum:t.info.sort,maxnum:255,minnum:1,sign:!1},on:{toClick:t.change}})],1),t._v(" "),n("div",{staticClass:"clear"}),t._v(" "),n("h2",{staticClass:"required tag"},[t._v("职位权限")]),t._v(" "),n("div",{staticClass:"mes"},[n("a",{staticClass:"addclassify",staticStyle:{width:"220px"},attrs:{href:"javascript:void(0);"},on:{click:t.edit}},[t._v("分配职位权限")])]),t._v(" "),n("div",{staticClass:"clear"}),t._v(" "),n("h2",{staticClass:"tag"}),t._v(" "),n("div",{staticClass:"mes",staticStyle:{color:"#999"}},[t._v("\n\t\t\t\t\t已分配职位权限："+t._s(t.info.nodeIds&&t.info.nodeIds.length)+" 个\n\t\t\t\t")]),t._v(" "),n("div",{staticClass:"clear"}),t._v(" "),n("h2",{staticClass:"tag"}),t._v(" "),n("div",{staticClass:"fl copy",on:{click:function(i){t.toCopy()}}},[t._v("\n\t\t\t\t\t复制已有职位权限\n\t\t\t\t")]),t._v(" "),n("div",{staticClass:"mes copyDiv"},[n("i"),t._v(" "),n("p",[t._v("复制职位权限后会将当前权限覆盖")])]),t._v(" "),n("div",{staticClass:"clear",staticStyle:{height:"120px"}})])])]),t._v(" "),t.showTan?n("positionTan",{attrs:{info:t.info},on:{throwTanResult:t.doThrowTanResult}}):t._e(),t._v(" "),t.isCopyWin?n("selectRadioWin",{attrs:{userData:t.userData,list:t.copyPositionList,title:"请选择需要复制的已有权限",name:"name",selectIndex:t.index},on:{selectRadioWin:t.doThrowCopy}}):t._e()],1)};e._withStripped=!0;var s=n("81a2");function o(t){return function(){var i=t.apply(this,arguments);return new Promise(function(t,n){return function e(s,o){try{var r=i[s](o),a=r.value}catch(t){return void n(t)}if(!r.done)return Promise.resolve(a).then(function(t){e("next",t)},function(t){e("throw",t)});t(a)}("next")})}}var r={data:function(){return{title:"",cancelStyle:null,okStyle:null,info:{},oldName:"",showTan:!1,isCopyWin:!1,shopPositionList:[],brandPositionList:[],copyPositionList:[],index:-1}},props:{item:Object,userData:Object,list:Array,isAdd:null,isShop:null,jobIndex:"",currentList:Array,newrecordList:Array},mounted:function(){this.isShop&&this.isAdd?(this.title="添加门店职位",this.cancelStyle=null,this.okStyle={content:"保存",style:{backgroundColor:"#29ABE2",color:"#fff"}}):!this.isShop&&this.isAdd?(this.title="添加品牌职位",this.cancelStyle=null,this.okStyle={content:"保存",style:{backgroundColor:"#29ABE2",color:"#fff"}}):(this.title="编辑职位",this.cancelStyle=null,this.okStyle={content:"保存",style:{backgroundColor:"#29ABE2",color:"#fff"}}),this.getJobInfo();for(var t=0;t<this.list.length;t++)0==this.list[t].type?this.shopPositionList.push(this.list[t]):this.brandPositionList.push(this.list[t]);this.isShop&&this.isAdd?this.copyPositionList=this.shopPositionList:!this.isShop&&this.isAdd?this.copyPositionList=this.brandPositionList:0==this.item.type?this.copyPositionList=this.shopPositionList:this.copyPositionList=this.brandPositionList},methods:{change:function(t){this.info.sort=t},getJobInfo:function(){var t=this;return o(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(t.isAdd){i.next=7;break}return i.next=3,s.a.roleGet({data:{shopId:t.userData.currentShop.id,id:t.item.id}});case 3:(n=i.sent)&&(t.oldName=n.name,n.nodeIds=n.nodeIds.split(","),t.info=n),i.next=8;break;case 7:t.isAdd&&(t.info.nodeIds=[],t.info={name:"",shopId:t.userData.currentShop.id,sort:"255",nodeNum:"",type:t.isShop?0:1,personNum:0,nodeIds:[]});case 8:case"end":return i.stop()}},i,t)}))()},addJob:function(t){var i=this;return o(regeneratorRuntime.mark(function n(){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.roleAddPosition({data:{name:i.info.name,sort:i.info.sort,nodeIds:i.info.nodeIds.join(","),type:i.info.type}});case 2:(e=n.sent)&&(e.personNum=0,i.newrecordList.push(e)),i.$emit("throwWinResult",t,!0);case 5:case"end":return n.stop()}},n,i)}))()},editJob:function(t){var i=this;return o(regeneratorRuntime.mark(function n(){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.RoleEditPosition({data:{id:i.item.id,name:i.info.name,sort:i.info.sort,nodeIds:i.info.nodeIds.join(","),type:i.info.type}});case 2:(e=n.sent)&&i.newrecordList.splice(i.jobIndex,1,e),i.$emit("throwWinResult",t);case 5:case"end":return n.stop()}},n,i)}))()},clickResult:function(t){if("ok"==t){var i=this.info;if(!i)return!0;var n=i.name+"";if(/^[\s]*$/.test(n))return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"职位名称不能为空"}),!1;if(n.replace(/['"&]/g,"").length!==n.length)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"姓职位名称中不能包含英文的单引号和双引号"}),!1;if(0==i.nodeIds.length)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"必须分配至少一项职位权限"}),!1;for(var e=0;e<this.copyPositionList.length;e++)if(this.copyPositionList[e].name===n&&this.isAdd||!this.isAdd&&this.oldName!==n&&this.copyPositionList[e].name===n)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"该职位已经存在"}),!1;this.info.shopId=this.userData.currentShop.id,this.info.sort=parseInt(this.info.sort),this.isAdd?this.addJob(t):this.isAdd||this.editJob(t)}else"cancel"==t?this.$emit("throwWinResult",t):"close"==t&&this.$emit("throwWinResult",t)},edit:function(){this.showTan=!0},doThrowTanResult:function(){this.showTan=!1},toCopy:function(){this.isCopyWin=!0},doThrowCopy:function(t,i){"ok"==t?(this.isCopyWin=!1,this.info.nodeIds=i.nodeIds.split(","),this.index=i.index):this.isCopyWin=!1}},components:{win:function(){return n.e("win").then(n.bind(null,"f60a"))},subadd:function(){return n.e("subadd").then(n.bind(null,"e7ea"))},positionTan:function(){return n.e("job_manage_two").then(n.bind(null,"2377"))},selectRadioWin:function(){return n.e("select_radio_win").then(n.bind(null,"4e06"))}}},a=(n("41cc"),n("7610")),c=Object(a.a)(r,e,[],!1,null,"7660f454",null);c.options.__file="src\\module\\brand_configuration\\position_config_one_win.vue";i.default=c.exports},"41cc":function(t,i,n){"use strict";var e=n("d5e8");n.n(e).a},d5e8:function(t,i,n){}}]);