(window.webpackJsonp=window.webpackJsonp||[]).push([["make_card_win"],{1143:function(t,e,i){},"67ee":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"create-card"}},[i("div",{staticClass:"content-box"},[t._m(0),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("关联卡类型")]),t._v(" "),i("a",{staticClass:"fl blue concent-width",attrs:{href:"javascript:void(0)"},on:{click:t.choseCardType}},[t._v("选择卡类型")]),t._v(" "),-1!=t.cradTypeIndex?i("span",{staticClass:"fl sub-heading"},[t._v("已选择"+t._s(t.cradTypeList[t.cradTypeIndex].name))]):t._e()]),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("卡属门店")]),t._v(" "),"0"==t.ischain?i("span",{staticClass:"fl sub-heading",staticStyle:{width:"auto"}},[t._v(t._s(t.currentShop.name))]):t._e(),t._v(" "),"3"==t.ischain?i("a",{staticClass:"fl blue concent-width",attrs:{href:"javascript:void(0)"},on:{click:t.choseShop}},[t._v("选择门店")]):t._e(),t._v(" "),""!=t.shopInfo?i("span",{staticClass:"fl sub-heading"},[t._v("已选择"+t._s(t.shopInfo))]):t._e()]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.shopList.length>=1,expression:"shopList.length >= 1"}],staticClass:"content-box",staticStyle:{overflow:"initial"}},[i("span",{staticClass:"fl sub-heading"}),t._v(" "),i("div",{staticClass:"shopInfoList"},[i("div",{staticClass:"shop-head"},["0"==t.ischain?i("span",{staticClass:"fl pitchOn"},[t._v(t._s(t.currentShop.name))]):t._e(),t._v(" "),t._l(t.shopList,function(e,s){return"3"==t.ischain?i("span",{key:s,staticClass:"fl",class:t.shopInfoIndex==s?"pitchOn":"shopNames",on:{click:function(i){t.getShopDetail(e,s)}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t\t"),i("i",{on:{click:function(i){t.delItem(s,e)}}})]):t._e()})],2),t._v(" "),i("div",{staticClass:"shop-content"},[i("div",{staticClass:"fl",staticStyle:{height:"80px","line-height":"80px"}},[i("span",{staticClass:"fl",staticStyle:{height:"80px",width:"120px","text-indent":"15px","text-align":"center"}},[t._v("卡属门店编号")]),t._v(" "),i("span",{staticClass:"fl",staticStyle:{height:"80px"}},[t._v(t._s(t.currentShop.shopNumber))])]),t._v(" "),i("div",{staticClass:"fl",staticStyle:{"margin-bottom":"20px",position:"relative"}},[i("span",{staticClass:"fl sub-heading required"},[t._v("初始卡编号")]),t._v(" "),i("div",{staticClass:"content-input concent-width fl",staticStyle:{width:"200px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentShop.initCardNumber,expression:"currentShop.initCardNumber"}],staticClass:"fl",attrs:{type:"text",placeholder:"0000 0000",maxlength:"8"},domProps:{value:t.currentShop.initCardNumber},on:{input:function(e){e.target.composing||t.$set(t.currentShop,"initCardNumber",e.target.value)}}})]),t._v(" "),i("span",{staticClass:"fl clickTip",attrs:{id:"tips1"},on:{click:[function(t){t.stopPropagation()},function(e){t.showTips("tip1")}]}}),t._v(" "),t.isNo?i("span",{staticClass:"fl tipContent"},[t._v("默认从 0000 0001 开始至制卡数量为止")]):t._e()]),t._v(" "),i("div",{staticClass:"fl",staticStyle:{"margin-bottom":"20px",position:"relative"}},[i("span",{staticClass:"fl sub-heading required"},[t._v("制卡数量")]),t._v(" "),i("div",{staticClass:"content-input concent-width fl",staticStyle:{width:"200px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentShop.num,expression:"currentShop.num"}],staticClass:"fl",attrs:{type:"text",placeholder:"0000 0000",maxlength:"8"},domProps:{value:t.currentShop.num},on:{input:function(e){e.target.composing||t.$set(t.currentShop,"num",e.target.value)}}})]),t._v(" "),i("span",{staticClass:"fl clickTip",attrs:{id:"tips2"},on:{click:[function(t){t.stopPropagation()},function(e){t.showTips("tip2")}]}}),t._v(" "),t.isNum?i("span",{staticClass:"fl tipContent"},[t._v("制卡时，卡号连贯，根据制卡数量计算初始和末位卡号")]):t._e()]),t._v(" "),i("div",{staticClass:"fl",staticStyle:{"margin-bottom":"20px",position:"relative"}},[i("span",{staticClass:"fl sub-heading required"},[t._v("是否允许门店激活")]),t._v(" "),t._l(t.goodlist,function(e,s){return"3"!==t.ischain?[e.type?i("span",{key:s,class:t.type==e.isActivate?"signa":"",staticStyle:{float:"left",display:"block",width:"98px",height:"38px",border:"1px solid #999","margin-right":"15px","text-align":"center","line-height":"38px",cursor:"pointer",background:"#fff"},on:{click:function(i){t.tabTypes(s,e)}}},[t._v(t._s(e.name))]):t._e()]:t._e()}),t._v(" "),t._l(t.goodlist,function(e,s){return"3"==t.ischain?[e.type?i("span",{key:s,class:t.shopList[t.shopInfoIndex]&&t.shopList[t.shopInfoIndex].isActivate==e.isActivate?"signa":"",staticStyle:{float:"left",display:"block",width:"98px",height:"38px",border:"1px solid #999","margin-right":"15px","text-align":"center","line-height":"38px",cursor:"pointer",background:"#fff"},on:{click:function(i){t.tabTypes(s,e)}}},[t._v(t._s(e.name))]):t._e()]:t._e()})],2),t._v(" "),"-1"!=t.cradTypeIndex?i("div",{staticClass:"fl",staticStyle:{height:"80px","line-height":"80px"}},[i("span",{staticClass:"fl",staticStyle:{height:"80px",width:"120px","text-indent":"15px","text-align":"center"}},[t._v("最终展示")]),t._v(" "),i("span",{staticClass:"fl",staticStyle:{height:"80px"}},[t._v(t._s(t.returnCard()))])]):t._e()])])])]),t._v(" "),i("div",{staticClass:"content-box"},[t._m(1),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("购卡金额")]),t._v(" "),i("div",{staticClass:"content-input concent-width fl"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.cardObj.price,expression:"cardObj.price"}],staticClass:"fl",attrs:{type:"number",placeholder:"0.00",oninput:"if(value.length>7)value=value.slice(0,7)"},domProps:{value:t.cardObj.price},on:{input:function(e){e.target.composing||t.$set(t.cardObj,"price",e.target.value)}}}),t._v(" "),i("span",{staticClass:"fl"},[t._v("元")])])]),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("卡内余额")]),t._v(" "),i("div",{staticClass:"content-input concent-width fl"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.cardObj.cardAmount,expression:"cardObj.cardAmount"}],staticClass:"fl",attrs:{type:"number",placeholder:"0.00",oninput:"if(value.length>7)value=value.slice(0,7)"},domProps:{value:t.cardObj.cardAmount},on:{input:function(e){e.target.composing||t.$set(t.cardObj,"cardAmount",e.target.value)}}}),t._v(" "),i("span",{staticClass:"fl"},[t._v("元")])])]),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("卡内积分")]),t._v(" "),i("div",{staticClass:"content-input concent-width fl"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.cardObj.cardPoint,expression:"cardObj.cardPoint"}],staticClass:"fl",attrs:{type:"number",placeholder:"0",oninput:"if(value.length>7)value=value.slice(0,7)"},domProps:{value:t.cardObj.cardPoint},on:{input:function(e){e.target.composing||t.$set(t.cardObj,"cardPoint",e.target.value)}}}),t._v(" "),i("span",{staticClass:"fl"},[t._v("分")])])]),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("卡内优惠券")]),t._v(" "),i("a",{staticClass:"fl concent-width addclassify",staticStyle:{border:"none","background-position":"35px center"},attrs:{href:"javascript:void(0)"},on:{click:t.openCouponWin}},[t._v("选择关联优惠卷")]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.selects&&t.selects.length>=1,expression:"selects && selects.length >= 1"}],staticClass:"fl sub-heading"},[t._v("已关联"+t._s(t.selects.length)+"张优惠券")])]),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("享有折扣")]),t._v(" "),i("div",{staticClass:"content-input concent-width fl"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.cardObj.discount,expression:"cardObj.discount"}],staticClass:"fl",attrs:{type:"text",oninput:"if(value.length>1)value=value.slice(0,2)"},domProps:{value:t.cardObj.discount},on:{input:function(e){e.target.composing||t.$set(t.cardObj,"discount",e.target.value)}}}),t._v(" "),i("span",{staticClass:"fl"},[t._v("折")])])]),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"},[t._v("实体卡有效期")]),t._v(" "),i("div",{staticClass:"checkList"},t._l(t.cardValidity,function(e,s){return i("span",{key:s,class:t.cardTimeIndex==s?"checkOn":"",on:{click:function(e){t.choseCardTimeType(s)}}},[t._v(t._s(e.name))])}))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:1==t.cardTimeIndex,expression:"cardTimeIndex == 1"}],staticClass:"content-box",staticStyle:{height:"50px"}},[i("span",{staticClass:"fl sub-heading"}),t._v(" "),i("div",{staticClass:"concent-width fl",staticStyle:{width:"240px","margin-right":"15px",cursor:"pointer"}},[i("calendar",{staticStyle:{width:"200px","text-align":"center",height:"38px","line-height":"38px","border-left":"none",float:"left"},attrs:{time:t.startCardTime,only:!1,readonly:""},on:{throwTime:t.thisStartTime,"update:time":function(e){t.startCardTime=e}}})],1),t._v(" "),i("div",{staticClass:"concent-width fl",staticStyle:{width:"240px",cursor:"pointer"}},[i("calendar",{staticStyle:{width:"200px","text-align":"center",height:"38px","line-height":"38px","border-left":"none",float:"left"},attrs:{time:t.endCardTime,only:!1,uid:"mycalendar2",readonly:""},on:{throwTime:t.thisEndTime,"update:time":function(e){t.endCardTime=e}}})],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:2==t.cardTimeIndex,expression:"cardTimeIndex == 2"}],staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"}),t._v(" "),i("span",{staticClass:"fl items"},[t._v("发卡日起")]),t._v(" "),i("div",{staticClass:"content-input concent-width fl",staticStyle:{width:"110px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.cardObj.startCardTime,expression:"cardObj.startCardTime"}],staticClass:"fl",staticStyle:{width:"70px"},attrs:{type:"number",placeholder:"0",oninput:"if(value.length>3)value=value.slice(0,3)"},domProps:{value:t.cardObj.startCardTime},on:{input:function(e){e.target.composing||t.$set(t.cardObj,"startCardTime",e.target.value)}}}),t._v(" "),i("span",{staticClass:"fl"},[t._v("天")])]),t._v(" "),i("span",{staticClass:"fl items"},[t._v("内有效")])]),t._v(" "),i("div",{staticClass:"content-box"},[i("span",{staticClass:"fl sub-heading"}),t._v(" "),i("a",{staticClass:"fl gray",staticStyle:{width:"200px","margin-right":"15px"},attrs:{href:"javascript:void(0)"},on:{click:t.closePage}},[t._v("返回")]),t._v(" "),i("a",{staticClass:"fl yellow",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0)"},on:{click:t.addCard}},[t._v("开始制卡")])])]),t._v(" "),t.couponShow?i("couponwin",{attrs:{select:t.selects},on:{getCoupon:t.getCouponList}}):t._e(),t._v(" "),t.typeShow?i("typewin",{attrs:{cradTypeList:t.cradTypeList,cradTypeIndex:t.cradTypeIndex},on:{getType:t.getType}}):t._e(),t._v(" "),t.shopShow?i("shopwin",{attrs:{shop:t.shopList,ondirectSalet:t.directSaletOn,onnapaStores:t.napaStoresOn,IshopId:t.IshopId},on:{getShop:t.getShop}}):t._e()],1)};s._withStripped=!0;var n=i("f6ce"),a=i("81a2"),r=i("bbb9");var o={data:function(){return{ischain:null,cradTypeIndex:-1,cradTypeList:[],shopList:[],selects:[],shopInfo:"",directSaletOn:[],napaStoresOn:[],currentShop:{},shopInfoIndex:0,cardObj:{cardTypeId:"",shopCardConfig:"",price:"",cardAmount:"",cardPoint:"",cardCoupon:this.selects,discount:"",cardTimeType:0,startCardTime:"",endCardTime:""},cardValidity:[{name:"无"},{name:"指定时间"},{name:"相对时间"}],cardTimeIndex:0,startCardTime:(new Date).getTime(),endCardTime:(new Date).getTime(),goodlist:[{type:"1",name:"允许",isActivate:"1"},{type:"0",name:"不允许",isActivate:"0"}],type:"1",IshopId:"",isNo:!1,isNum:!1,couponShow:!1,typeShow:!1,shopShow:!1}},props:{},components:{win:function(){return i.e("win").then(i.bind(null,"f60a"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))},couponwin:function(){return i.e("make_card_couponwin").then(i.bind(null,"f668"))},typewin:function(){return i.e("make_card_typewin").then(i.bind(null,"926b"))},shopwin:function(){return i.e("make_card_shopwin").then(i.bind(null,"f93e"))}},mounted:function(){var t=this,e=n.a.session("userShop");this.ischain=e.currentShop.ischain;var i=[],s={shopId:e.currentShop.id,name:e.currentShop.name,shopNumber:e.currentShop.shopNumber,initCardNumber:0,num:0};i.push(s),this.shopList="0"==this.ischain?i:[],this.currentShop="0"==this.ischain?s:{},document.addEventListener("click",function(){t.isNo=!1,t.isNum=!1})},methods:{tabTypes:function(t,e){this.shopList[this.shopInfoIndex].isActivate=e.isActivate,this.type=e.type},choseShop:function(){this.shopShow=!0},getShop:function(t,e){if("ok"==t){for(var i in e)this[i]=e[i];this.shopInfoIndex=this.shopList.length-1;this.directSaletOn=e.directSaletOn,this.napaStoresOn=e.napaStoresOn,this.currentShop=this.shopList.length>=1?this.shopList[this.shopInfoIndex]:{shopNumber:"",num:"",initCardNumber:""}}this.shopShow=!1},choseCardType:function(){this.typeShow=!0},getType:function(t,e,i,s){this.typeShow=!1,"ok"==t&&(this.cradTypeIndex=e,this.cradTypeList=i,this.IshopId=s.split(","))},openCouponWin:function(){this.couponShow=!0},showTips:function(t){"tip1"==t?(this.isNo=!0,this.isNum=!1):(this.isNum=!0,this.isNo=!1)},getShopDetail:function(t,e){this.currentShop=r.a.deepCopy(t),this.shopInfoIndex=e,this.shopList.splice(e,1,this.currentShop)},delItem:function(t,e){this.shopList.splice(t,1),this.currentShop=r.a.deepCopy(this.shopList[this.shopList.length-1]),this.shopInfoIndex=this.shopList.length-1;var i=e.shopId,s="";if("1"==e.type)for(var n=0;n<this.directSaletOn.length;n++)this.directSaletOn[n].indexOf(i)>=0&&(this.directSaletOn.splice(n,1),n--);else for(var a=0;a<this.napaStoresOn.length;a++)this.napaStoresOn[a].indexOf(i)>=0&&(this.napaStoresOn.splice(a,1),a--);for(var o=0;o<this.shopList.length;o++)s+=this.shopList[o].name+",";this.shopInfo=s.substring(0,s.length-1)},choseCardTimeType:function(t){this.cardTimeIndex=t},judgeCardTime:function(t){return"1"==this.cardTimeIndex?(t.startCardTime=this.startCardTime,t.endCardTime=this.endCardTime):"2"==this.cardTimeIndex?t.endCardTime=0:(t.startCardTime=0,t.endCardTime=0),t},returnCard:function(){var t=this.currentShop.initCardNumber;return this.currentShop.name+" "+this.cradTypeList[this.cradTypeIndex].abbr+"-"+Number(this.currentShop.shopNumber)+"-"+Number(t)+"-"+(Number(this.currentShop.initCardNumber)+Number(this.currentShop.num)-1)},getCouponList:function(t,e){this.couponShow=!1,"ok"==t&&(this.selects=e)},closePage:function(){this.$emit("makeCardWin")},newAddCard:function(t){var e,i=this;return(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.newAddCard({data:{cardTypeId:i.cradTypeList[i.cradTypeIndex].id,shopCardConfig:JSON.stringify(t),price:i.cardObj.price,cardAmount:i.cardObj.cardAmount,cardPoint:i.cardObj.cardPoint,cardCoupon:JSON.stringify(i.selects),discount:1==i.cardObj.discount.length?i.cardObj.discount+"0":i.cardObj.discount,cardTimeType:i.cardTimeIndex,startCardTime:2==i.cardTimeIndex?i.cardObj.startCardTime:Math.round(i.cardObj.startCardTime/1e3),endCardTime:Math.round(i.cardObj.endCardTime/1e3)}});case 2:e.sent&&i.closePage(),i.errorShow("制卡成功");case 5:case"end":return e.stop()}},e,i)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function s(n,a){try{var r=t[n](a),o=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(o).then(function(t){s("next",t)},function(t){s("throw",t)});e(o)}("next")})})()},thisStartTime:function(t){this.startCardTime=t},thisEndTime:function(t){this.endCardTime=t},errorShow:function(t){this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:t})},addCard:function(){if("-1"==this.cradTypeIndex)return this.errorShow("请选择卡类型"),!1;if("3"==this.ischain&&""==this.shopInfo)return this.errorShow("请选择卡属门店"),!1;if(this.cardObj.price&&this.cardObj.price<0||isNaN(this.cardObj.price))return this.errorShow("购卡金额必须为正整数"),!1;if(this.cardObj.cardAmount&&this.cardObj.cardAmount<0||isNaN(this.cardObj.cardAmount))return this.errorShow("卡内余额必须为正整数"),!1;if(this.cardObj.cardPoint&&this.cardObj.cardPoint<0||isNaN(this.cardObj.cardPoint))return this.errorShow("卡内积分必须为正整数"),!1;if(this.cardObj.discount&&this.cardObj.discount<0||isNaN(this.cardObj.discount))return this.errorShow("折扣率必须为正整数"),!1;if("1"==this.cardTimeIndex){var t=(new Date).getTime();if(this.endCardTime<t)return this.errorShow("结束时间不能小于当前时间"),!1;if(this.startCardTime>this.endCardTime)return this.errorShow("开始时间必须大于结束时间"),!1}if("2"==this.cardTimeIndex&&(this.cardObj.startCardTime&&this.cardObj.startCardTime<0||isNaN(this.cardObj.startCardTime)))return this.errorShow("相对时间必须为正整数"),!1;var e=this.currentShop;this.cardObj=this.judgeCardTime(this.cardObj);var i=[];if("0"==this.ischain){if(""==e.shopNumber)return this.errorShow("请去店铺配置-基本信息,填写门店编号。"),!1;var s=/^[1-9]\d*$/;if(""==e.initCardNumber||0==e.initCardNumber||!s.test(e.initCardNumber))return this.errorShow("初始卡编号不能为空、其他字符或只为0,请修改。"),!1;if(""==e.num||0==e.num||!s.test(e.num))return this.errorShow("制卡数量不能为空、其他字符或只为0,请修改"),!1;if(e.initCardNumber.length>8)return this.errorShow("初始卡编号最多只能输入八位数,请修改"),!1;if(e.num.length>8)return this.errorShow("制卡数量最多只能输入八位数,请修改"),!1;delete e.name,delete e.type,e.initCardNumber=Number(e.initCardNumber),e.num=Number(e.num),i.push(e)}else{i=this.shopList;for(var n=0;n<i.length;n++){if(""==i[n].shopNumber)return this.errorShow(i[n].name+",尚未配置门店编号"),!1;if(""==i[n].initCardNumber||0==i[n].initCardNumber)return this.errorShow(i[n].name+",初始卡编号不能为空或0,请修改。"),!1;if(""==i[n].num||0==i[n].num)return this.errorShow(i[n].name+",制卡数量不能为空或0,请修改"),!1;if(i[n].initCardNumber.length>8)return this.errorShow("初始卡编号最多只能输入八位数,请修改"),!1;if(i[n].num.length>8)return this.errorShow("制卡数量最多只能输入八位数,请修改"),!1;i[n].initCardNumber=Number(i[n].initCardNumber),i[n].num=Number(i[n].num)}}this.newAddCard(i)}}},c=(i("ae37"),i("7610")),d=Object(c.a)(o,s,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content-title"},[e("span",{staticClass:"titles"},[this._v("制卡填写")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content-title"},[e("span",{staticClass:"titles"},[this._v("发卡设置")])])}],!1,null,"b6485ae8",null);d.options.__file="src\\module\\member_system\\make_card_win.vue";e.default=d.exports},ae37:function(t,e,i){"use strict";var s=i("1143");i.n(s).a}}]);