(window.webpackJsonp=window.webpackJsonp||[]).push([["plate_storage"],{"163e":function(t,i,s){"use strict";var e=s("c8bc");s.n(e).a},c8bc:function(t,i,s){},f7567:function(t,i,s){"use strict";s.r(i);var e=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",[t._m(0),t._v(" "),s("section",{staticClass:"ic-contern"},[s("span",{staticClass:"span_contern"},[t._v("领料人："+t._s(t.info.name))]),t._v(" "),s("span",{staticClass:"span_contern"},[t._v("操作人："+t._s(t.creatName))]),t._v(" "),s("span",{staticClass:"span_contern"},[t._v("备注"),s("input",{directives:[{name:"model",rawName:"v-model",value:t.remark,expression:"remark"}],staticClass:"remenber",attrs:{maxlength:"40",type:"text",placeholder:"请填写备注信息，限四十字以内"},domProps:{value:t.remark},on:{input:function(i){i.target.composing||(t.remark=i.target.value)}}})])]),t._v(" "),s("div",{staticClass:"list_num"},[s("section",{staticClass:"totle"},[s("div",{staticClass:"head"},[t._v("\n\t\t\t\t盘库列表 · 共"),s("span",{staticStyle:{color:"#F8931F",padding:"0 3px","font-size":"inherit"}},[t._v(t._s(t.storageInfo.length))]),t._v("个条目\n\t\t\t")]),t._v(" "),s("ul",{staticClass:"oUl oulFirst"},[s("li",[t._v("操作")]),t._v(" "),s("li",[t._v("物料名称")]),t._v(" "),s("li",[t._v("领料单位选择")]),t._v(" "),s("li",{staticStyle:{width:"15%"}},[t._v("领料数量/重量")]),t._v(" "),s("li",{staticStyle:{width:"20%"}},[t._v("消耗数量/重量 "),s("span",{staticStyle:{color:"#FF3D04",cursor:"pointer"},on:{click:t.allUse}},[t._v("全部消耗")])]),t._v(" "),s("li",{staticStyle:{width:"20%"}},[t._v("回库数量/重量 "),s("span",{staticStyle:{color:"#27A8E0",cursor:"pointer"},on:{click:t.allBack}},[t._v("剩余回库")])]),t._v(" "),s("li",[t._v("分类")]),t._v(" "),s("li",[t._v("类型")])]),t._v(" "),t._l(t.infoList,function(i,e){return s("ul",{key:e,staticClass:"oUl oulSecond"},[s("li",{staticStyle:{cursor:"pointer",color:"#27A8E0","font-size":"16px"},on:{click:function(s){t.doThing(i)}}},[t._v("\n\t\t\t\t\t批次处理\n\t\t\t\t")]),t._v(" "),s("li",{staticClass:"hide",attrs:{title:i.materialName}},[t._v(t._s(i.materialName))]),t._v(" "),s("li",{on:{click:function(s){t.select(i,i.index)}}},[s("selectBtn",{attrs:{sorts:i.options,width:"80",index:i.index,name:i.selUnit.name},on:{emit:t.selectType}})],1),t._v(" "),s("li",{staticClass:"hide",staticStyle:{width:"15%"},attrs:{title:i.unit}},[t._v("\n\t\t\t\t\t"+t._s(i.unit)+"\n\t\t\t\t")]),t._v(" "),s("li",{staticStyle:{width:"20%"}},[s("div",{staticClass:"div_float defaultFloat",class:{defaultFloat:1==i.selUnit.isMin}},[s("input",{directives:[{name:"model",rawName:"v-model",value:i.useNum,expression:"item.useNum"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(i),placeholder:"请输入数字"},domProps:{value:i.useNum},on:{input:function(s){s.target.composing||t.$set(i,"useNum",s.target.value)}}}),t._v(" "),i.selUnit.name?s("span",{staticClass:"span_line",attrs:{title:i.selUnit.name}},[t._v(t._s(i.selUnit.name))]):t._e()]),t._v(" "),1!=i.selUnit.isMin?s("i",{staticStyle:{display:"inline-block","vertical-align":"top"}},[s("span",{staticClass:"defaultFloat",staticStyle:{float:"left","margin-right":"3px"}},[t._v("+")]),t._v(" "),s("div",{staticClass:"div_float"},[s("input",{directives:[{name:"model",rawName:"v-model",value:i.useWeight,expression:"item.useWeight"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(i),placeholder:"请输入数字"},domProps:{value:i.useWeight},on:{input:function(s){s.target.composing||t.$set(i,"useWeight",s.target.value)}}}),t._v(" "),s("span",{staticClass:"span_line",attrs:{title:i.isMin}},[t._v(t._s(i.isMin))])])]):t._e()]),t._v(" "),s("li",{staticStyle:{width:"20%"}},[s("div",{staticClass:"div_float defaultFloat",class:{defaultFloat:1==i.selUnit.isMin}},[s("input",{directives:[{name:"model",rawName:"v-model",value:i.backNum,expression:"item.backNum"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(i,"1"),placeholder:"请输入数字"},domProps:{value:i.backNum},on:{input:function(s){s.target.composing||t.$set(i,"backNum",s.target.value)}}}),t._v(" "),i.selUnit.name?s("span",{staticClass:"span_line",attrs:{title:i.selUnit.name}},[t._v(t._s(i.selUnit.name))]):t._e()]),t._v(" "),1!=i.selUnit.isMin?s("i",{staticStyle:{display:"inline-block","vertical-align":"top"}},[s("span",{staticClass:"defaultFloat",staticStyle:{float:"left","margin-right":"3px"}},[t._v("+")]),t._v(" "),s("div",{staticClass:"div_float"},[s("input",{directives:[{name:"model",rawName:"v-model",value:i.backWeight,expression:"item.backWeight"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(i,"1"),placeholder:"请输入数字"},domProps:{value:i.backWeight},on:{input:function(s){s.target.composing||t.$set(i,"backWeight",s.target.value)}}}),t._v(" "),s("span",{staticClass:"span_line",attrs:{title:i.isMin}},[t._v(t._s(i.isMin))])])]):t._e()]),t._v(" "),s("li",{staticClass:"hide",attrs:{title:i.materialCategoryName}},[t._v(t._s(i.materialCategoryName))]),t._v(" "),s("li",{staticClass:"hide",attrs:{title:t.materType[i.materialType]}},[t._v(t._s(t.materType[i.materialType]))])])})],2)]),t._v(" "),s("div",{staticClass:"right"},[s("span",{staticClass:"btn huiC",on:{click:t.cancel}},[t._v("返回")]),t._v(" "),s("span",{staticClass:"btn yellow",on:{click:t.enter}},[t._v("确定")])]),t._v(" "),t.showBatch?s("batchwin",{attrs:{batchInfo:t.batchInfo,unitData:t.unitData},on:{getWin:t.getWin}}):t._e()],1)};e._withStripped=!0;var n=s("81a2"),a=s("05dd"),o=s("f6ce"),l=s("bbb9"),r=function(){return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var s=[],e=!0,n=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(e=(o=l.next()).done)&&(s.push(o.value),!i||s.length!==i);e=!0);}catch(t){n=!0,a=t}finally{try{!e&&l.return&&l.return()}finally{if(n)throw a}}return s}(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var h={data:function(){return{selIndex:-1,currentList:[],showBatch:!1,storageList:[],batchInfo:[],infoList:[],winInfo:"",item:"",remark:"",unitData:[],creatName:o.a.session("userShop").user.name,storageInfo:"",info:"",materType:{0:"物料"}}},mounted:function(){this.storageInfo=o.a.session("plateStorage").storageInfo,this.info=o.a.session("plateStorage").info,this.$store.commit("setPageTools",{}),this.infoList=l.a.deepCopy(this.storageInfo);for(var t=0;t<this.infoList.length;t++){for(var i=[],s=0;s<this.infoList[t].materialUnit.length;s++)1==this.infoList[t].materialUnit[s].isDefault?(i.unshift(this.infoList[t].materialUnit[s].name),this.infoList[t].materialUnit.unshift(this.infoList[t].materialUnit[s]),this.infoList[t].materialUnit.splice(s+1,1)):i.push(this.infoList[t].materialUnit[s].name),1==this.infoList[t].materialUnit[s].isMin&&(this.infoList[t].isMin=this.infoList[t].materialUnit[s].name,this.infoList[t].minUnit=this.infoList[t].materialUnit[s]),1==this.infoList[t].materialUnit[s].isDefault&&(this.infoList[t].isDefault=this.infoList[t].materialUnit[s].name);this.infoList[t].options=i}for(var e=0;e<this.infoList.length;e++)for(var n=0;n<this.infoList[e].materialUnit.length;n++)0==n&&(this.infoList[e].selUnit=this.infoList[e].materialUnit[n],this.infoList[e].unit=this.comUnit(this.infoList[e].surplus,this.infoList[e].selUnit.value,this.infoList[e].selUnit.name,this.infoList[e].minUnit.name))},methods:{selectType:function(t){for(var i=0;i<this.infoList.length;i++)for(var s=0;s<this.infoList[i].materialUnit.length;s++)this.item.materialId==this.infoList[i].materialId&&(this.infoList[i].selUnit=this.infoList[i].materialUnit[t],this.infoList[i].unit=this.comUnit(this.infoList[i].surplus,this.infoList[i].selUnit.value,this.infoList[i].selUnit.name,this.infoList[i].minUnit.name));for(var e=0;e<this.infoList.length;e++)if(this.item.materialId==this.infoList[e].materialId){var n=this.comUnit(this.infoList[e].usemin,this.infoList[e].selUnit.value,this.infoList[e].selUnit.name,this.infoList[e].minUnit.name,!0),a=this.comUnit(this.infoList[e].backmin,this.infoList[e].selUnit.value,this.infoList[e].selUnit.name,this.infoList[e].minUnit.name,!0);1!=this.infoList[e].selUnit.isMin?(this.infoList[e].useNum=n.oNull,"0.000"!=n.tNull&&(this.infoList[e].useWeight=n.tNull),this.infoList[e].backNum=a.oNull,"0.000"!=a.tNull&&(this.infoList[e].backWeight=a.tNull)):(n.oNull?(this.infoList[e].useNum=n.oNull,"0.000"!=n.tNull&&(this.infoList[e].useWeight=n.tNull)):(0!=n.tNull&&(this.infoList[e].useNum=n.tNull),this.infoList[e].useWeight=""),a.oNull?(this.infoList[e].backNum=a.oNull,"0.000"!=a.tNull&&(this.infoList[e].backWeight=a.tNull)):(0!=a.tNull&&(this.infoList[e].backNum=a.tNull),this.infoList[e].backWeight=""))}this.select(this.item,t)},select:function(t,i){this.item=t,t.index=i,this.selIndex=i},getmin:function(t,i){"1"!=i?(""!=t.useNum?t.useNum=(t.useNum+"").replace(/[^\d.]/g,""):t.useNum="",""!=t.useWeight?t.useWeight=(t.useWeight+"").replace(/[^\d.]/g,""):t.useWeight="",t.usemin=t.useNum*t.selUnit.value+1*t.useWeight):(""!=t.backNum?t.backNum=(t.backNum+"").replace(/[^\d.]/g,""):t.backNum="",""!=t.backWeight?t.backWeight=(t.backWeight+"").replace(/[^\d.]/g,""):t.backWeight="",t.backmin=t.backNum*t.selUnit.value+1*t.backWeight)},comUnit:function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];var e=r(i,5),n=e[0],o=e[1],l=e[2],h=e[3],u=e[4];return a.a.comUnit(n,o,l,h,u)},doThing:function(t){this.showBatch=!0,this.batchInfo=t,this.item=t,this.unitData=t.materialUnit},allUse:function(){for(var t=0;t<this.infoList.length;t++){var i=this.comUnit(this.infoList[t].surplus,this.infoList[t].selUnit.value,this.infoList[t].selUnit.name,this.infoList[t].minUnit.name,!0);1!=this.infoList[t].selUnit.isMin?(this.infoList[t].useNum=i.oNull,this.infoList[t].useWeight=i.tNull):(this.infoList[t].useNum=i.tNull,this.infoList[t].useWeight=""),this.infoList[t].backNum="",this.infoList[t].backWeight="",this.infoList[t].usemin=this.infoList[t].useNum*this.infoList[t].selUnit.value+1*this.infoList[t].useWeight}},allBack:function(){for(var t=0;t<this.infoList.length;t++){var i=1*this.infoList[t].surplus-this.infoList[t].usemin,s=this.comUnit(i,this.infoList[t].selUnit.value,this.infoList[t].selUnit.name,this.infoList[t].minUnit.name,!0);1!=this.infoList[t].selUnit.isMin?(this.infoList[t].backNum=s.oNull,this.infoList[t].backWeight=s.tNull):(this.infoList[t].backNum=s.tNull,this.infoList[t].backWeight=""),this.infoList[t].backmin=this.infoList[t].backNum*this.infoList[t].selUnit.value+1*this.infoList[t].backWeight}},cancel:function(){this.$emit("storageReturn",!0),this.$router.push({path:"../pickingList/checkDetails",query:this.$route.query})},invoicingCheckMaterial:function(t){var i,s=this;return(i=regeneratorRuntime.mark(function i(){var e;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.a.invoicingCheckMaterial({data:t});case 2:0==(e=i.sent)?s.$store.commit("setWin",{winType:"alert",content:"盘库失败"}):(o.a.session("listDetail",e),s.$router.push({path:"plateDetails",query:s.$route.query}));case 4:case"end":return i.stop()}},i,s)}),function(){var t=i.apply(this,arguments);return new Promise(function(i,s){return function e(n,a){try{var o=t[n](a),l=o.value}catch(t){return void s(t)}if(!o.done)return Promise.resolve(l).then(function(t){e("next",t)},function(t){e("throw",t)});i(l)}("next")})})()},enter:function(){for(var t=0;t<this.infoList.length;t++){if(this.infoList[t].usemin>this.infoList[t].number)return this.$store.commit("setWin",{winType:"alert",content:"物料："+this.infoList[t].materialName+" 消耗数量不能大于领料数量"}),!1;if(this.infoList[t].backmin>1*this.infoList[t].number-1*this.infoList[t].usemin)return this.$store.commit("setWin",{winType:"alert",content:"物料："+this.infoList[t].materialName+" 回库数量不足"}),!1}for(var i={owner:this.info.id,ownerName:this.info.name,creatorName:this.creatName,remark:this.remark,materialDetail:[]},s=0;s<this.infoList.length;s++){var e={materialId:"",materialName:"",materialType:"",materialCategory:"",materialCategoryName:"",validity:"",validityType:"",consumeNum:"",returnNum:"",batchDetail:[]};for(var n in e)e[n]=this.infoList[s][n],"consumeNum"==n&&(e[n]=this.infoList[s].usemin),"returnNum"==n&&(e[n]=this.infoList[s].backmin);if(e.consumeNum||e.returnNum){e.batchDetail=[];var a=0,o=0;if(this.infoList[s].batchDetail)for(var l=0;l<this.infoList[s].batchDetail.length;l++){var r={id:"",materialId:"",recordId:"",batchId:"",wid:"",areaId:"",consumeNum:"",returnNum:""};for(var h in r)r[h]=this.infoList[s].batchDetail[l][h],"consumeNum"==h&&(r[h]=this.infoList[s].batchDetail[l].usemin),"returnNum"==h&&(r[h]=this.infoList[s].batchDetail[l].backmin);r.number=this.infoList[s].batchDetail[l].minNumber,a+=1*r.consumeNum,o+=1*r.returnNum,e.batchDetail.push(r)}e.consumeNum==a&&e.returnNum==o||(e.batchDetail=[]),i.materialDetail.push(e)}}if(0==i.materialDetail.length)return this.$store.commit("setWin",{winType:"alert",content:"请填写消耗数量或回库数量"}),!1;this.invoicingCheckMaterial(i)},getWin:function(t,i,s){if("ok"==t){this.winInfo=i;for(var e=0;e<this.infoList.length;e++){for(var n=0;n<this.infoList[e].materialUnit.length;n++)this.infoList[e].materialId==i.materialId&&this.infoList[e].materialUnit[n].name==i.selUnit.name&&this.selectType(n);if(this.infoList[e].materialId==i.materialId){this.infoList[e].useNum="",this.infoList[e].useWeight="",this.infoList[e].backNum="",this.infoList[e].backWeight="";for(var a=0;a<s.length;a++)this.infoList[e].useNum=1*this.infoList[e].useNum+1*s[a].useNum,this.infoList[e].useWeight=1*this.infoList[e].useWeight+1*s[a].useWeight,this.infoList[e].backNum=1*this.infoList[e].backNum+1*s[a].backNum,this.infoList[e].backWeight=1*this.infoList[e].backWeight+1*s[a].backWeight}}for(var o=0;o<this.infoList.length;o++){if(this.infoList[o].consumeNum=this.infoList[o].usemin,this.infoList[o].returnNum=this.infoList[o].backmin,this.infoList[o].initialNum=this.infoList[o].surplus,this.infoList[o].batchDetail=[],this.infoList[o].materialId==i.materialId)for(var l=0;l<this.infoList[o].batch.length;l++)for(var r in this.infoList[o].batch[l])this.infoList[o].batch[l][r]=s[l][r];for(var h=0;h<this.infoList[o].batch.length;h++)(this.infoList[o].batch[h].usemin||this.infoList[o].batch[h].backmin)&&(this.infoList[o].batch[h].consumeNum=this.infoList[o].batch[h].usemin,this.infoList[o].batch[h].returnNum=this.infoList[o].batch[h].backmin,this.infoList[o].batchDetail.push(this.infoList[o].batch[h]))}}this.showBatch=!1}},components:{selectBtn:function(){return s.e("select_btn").then(s.bind(null,"3d41"))},batchwin:function(){return s.e("storage_win").then(s.bind(null,"1737"))}}},u=(s("163e"),s("6ceb")),c=Object(u.a)(h,e,[function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"ic-title"},[i("div",{staticClass:"text"},[this._v("\n\t\t\t领料盘库\n\t\t")]),this._v(" "),i("div",{staticClass:"dashed"})])}],!1,null,"52f30580",null);c.options.__file="src\\module\\invoicing_system\\picking_list\\plate_storage.vue";i.default=c.exports}}]);