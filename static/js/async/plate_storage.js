(window.webpackJsonp=window.webpackJsonp||[]).push([["plate_storage"],{"29fb":function(t,e,a){"use strict";var i=a("bfbf");a.n(i).a},bfbf:function(t,e,a){},f756:function(t,e,a){"use strict";a.r(e);var i=a("81a2"),n=a("05dd"),s=a("f6ce"),r=a("bbb9"),l=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var a=[],i=!0,n=!1,s=void 0;try{for(var r,l=t[Symbol.iterator]();!(i=(r=l.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){n=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}return a}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var u={data:function(){return{selIndex:-1,currentList:[],showBatch:!1,storageList:[],batchInfo:[],infoList:[],winInfo:"",item:"",remark:"",selUnit:{},batchUnit:[],creatName:s.a.session("userShop").user.name,storageInfo:"",info:"",materType:{0:"成品",1:"半成品",2:"普通物料"},isSurplus:!0}},destroyed:function(){s.a.session("plateStorage",null)},mounted:function(){this.initBtn(),this.storageInfo=s.a.session("plateStorage").storageInfo,this.info=s.a.session("plateStorage").info,this.infoList=r.a.deepCopy(this.storageInfo),this.setInitData()},methods:{initBtn:function(){var t=this,e=[{name:"确认",className:"primary",type:4,fn:function(){t.enter()}},{name:"返回",className:"info",type:4,fn:function(){t.cancel()}}];this.$store.commit("setPageTools",e)},banClick:function(t){var e=t.target;e.className.includes("searchgoods")&&"disabled"==e.getAttribute("disabled")&&this.$message({message:"已选中批次的物料无法修改，请先重置",type:"error"})},resetItem:function(t){var e=this;this.$confirm("此操作会重置已选择的批次, 是否继续?","重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.setDefaultItem(t),t.haveBatch=!1,t.usemin=t.surplus*t.selUnit.value+1*t.useWeight,t.batchDetail=[],t.backNum="",t.backWeight="",t.backmin=0}).catch(function(){})},setInitData:function(){for(var t=0;t<this.infoList.length;t++){for(var e=this.infoList[t],a=[],i=0;i<e.materialUnit.length;i++){var n=e.materialUnit[i],s={value:n.muId,label:n.name};a.push(s),1==n.isMin&&(e.isMin=n.name,e.minUnit=n),1==n.isDefault&&(e.isDefault=n.name,this.$set(e,"index",n.muId))}this.$set(e,"options",a)}var r=!0,l=!1,u=void 0;try{for(var o,c=this.infoList[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var m=o.value,h=!0,v=!1,f=void 0;try{for(var d,b=m.materialUnit[Symbol.iterator]();!(h=(d=b.next()).done);h=!0){var p=d.value;this.$set(m,"selUnit",p),m.unit=this.comUnit(m.surplus,p.value,p.name,m.minUnit.name),this.setDefaultItem(m);break}}catch(t){v=!0,f=t}finally{try{!h&&b.return&&b.return()}finally{if(v)throw f}}var g=!0,y=!1,N=void 0;try{for(var _,k=m.materialUnit[Symbol.iterator]();!(g=(_=k.next()).done);g=!0){var U=_.value;if(1==U.isDefault){this.$set(m,"defUnit",U);break}}}catch(t){y=!0,N=t}finally{try{!g&&k.return&&k.return()}finally{if(y)throw N}}}}catch(t){l=!0,u=t}finally{try{!r&&c.return&&c.return()}finally{if(l)throw u}}},setDefaultItem:function(t){var e=this.comUnit(t.surplus,t.selUnit.value,t.selUnit.name,t.minUnit.name,!0);1==t.selUnit.isMin?t.useNum=e.tNull:(t.useNum=e.oNull,t.useWeight=e.tNull)},selectType:function(t,e){var a=t,i=!0,n=!1,s=void 0;try{for(var r,l=a.materialUnit[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;if(e==u.muId){a.selUnit=u,a.unit=this.comUnit(a.surplus,u.value,u.name,a.minUnit.name);break}}}catch(t){n=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}var o=this.comUnit(a.usemin,a.selUnit.value,a.selUnit.name,a.minUnit.name,!0),c=this.comUnit(a.backmin,a.selUnit.value,a.selUnit.name,a.minUnit.name,!0);1!=a.selUnit.isMin?(a.useNum=o.oNull,"0.000"!=o.tNull&&(a.useWeight=o.tNull),a.backNum=c.oNull,"0.000"!=c.tNull&&(a.backWeight=c.tNull)):(o.oNull?(a.useNum=o.oNull,"0.000"!=o.tNull&&(a.useWeight=o.tNull)):(0!=o.tNull&&(a.useNum=o.tNull),a.useWeight=""),c.oNull?(a.backNum=c.oNull,"0.000"!=c.tNull&&(a.backWeight=c.tNull)):(0!=c.tNull&&(a.backNum=c.tNull),a.backWeight="")),t.index=e},getmin:function(t,e){"1"!=e?(""!==t.useNum?t.useNum=(t.useNum+"").replace(/[^\d.]/g,""):t.useNum="",""!==t.useWeight?t.useWeight=(t.useWeight+"").replace(/[^\d.]/g,""):t.useWeight="",t.usemin=t.useNum*t.selUnit.value+1*t.useWeight):(""!==t.backNum?t.backNum=(t.backNum+"").replace(/[^\d.]/g,""):t.backNum="",""!==t.backWeight?t.backWeight=(t.backWeight+"").replace(/[^\d.]/g,""):t.backWeight="",t.backmin=t.backNum*t.selUnit.value+1*t.backWeight)},comUnit:function(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];var i=l(e,5),s=i[0],r=i[1],u=i[2],o=i[3],c=i[4];return n.a.comUnit(s,r,u,o,c)},doThing:function(t){this.showBatch=!0,this.batchInfo=t},allUse:function(){if(this.isSurplus){var t=!0,e=!1,a=void 0;try{for(var i,n=this.infoList[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;s.haveBatch||(s.useNum=0,s.useWeight=0,s.backNum="",s.backWeight="",s.usemin=s.surplus*s.selUnit.value+1*s.useWeight,s.backmin=0,s.haveBatch=!1,s.batchDetail=[])}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}}else{var r=!0,l=!1,u=void 0;try{for(var o,c=this.infoList[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var m=o.value;m.haveBatch||(this.setDefaultItem(m),m.usemin=0,m.haveBatch=!1,m.batchDetail=[])}}catch(t){l=!0,u=t}finally{try{!r&&c.return&&c.return()}finally{if(l)throw u}}}this.isSurplus=!this.isSurplus},allBack:function(){var t=!0,e=!1,a=void 0;try{for(var i,n=this.infoList[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;s.haveBatch||(s.backNum=s.useNum?s.useNum:"",s.backWeight=s.useWeight?s.useWeight:"",s.backmin=s.backNum*s.selUnit.value+1*s.backWeight,s.haveBatch=!1,s.batchDetail=[])}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}},cancel:function(){this.$emit("storageReturn",!0),this.$router.push({path:"../pickingList/checkDetails",query:this.$route.query})},invoicingCheckMaterial:function(t){var e,a=this;return(e=regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.invoicingCheckMaterial({data:t});case 2:0==(n=e.sent)?a.$message({message:"盘库失败",type:"error"}):(a.$route.query.id=n.id,a.$router.push({path:"plateDetails",query:a.$route.query}));case 4:case"end":return e.stop()}},e,a)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function i(n,s){try{var r=t[n](s),l=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(l).then(function(t){i("next",t)},function(t){i("throw",t)});e(l)}("next")})})()},enter:function(){var t=!0,e=!1,a=void 0;try{for(var i,n=this.infoList[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;if(s.usemin>s.surplus)return this.$message({message:"物料: "+s.materialName+" 剩余数量不能大于领料数量",type:"error"}),!1;if(s.backmin>s.usemin)return this.$message({message:"物料: "+s.materialName+" 回库数量不足",type:"error"}),!1}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}var r={owner:this.info.id,ownerName:this.info.name,creatorName:this.creatName,remark:this.remark,materialDetail:[]},l=!0,u=!1,o=void 0;try{for(var c,m=this.infoList[Symbol.iterator]();!(l=(c=m.next()).done);l=!0){var h=c.value,v={materialId:"",materialName:"",materialType:"",materialCategory:"",materialCategoryName:"",validity:"",validityType:"",consumeNum:"",returnNum:"",batchDetail:[]};for(var f in v)"consumeNum"!=f&&"returnNum"!=f&&(v[f]=h[f]);if(v.consumeNum=h.surplus-h.usemin,v.returnNum=h.backmin,v.consumeNum||v.returnNum){v.batchDetail=[];if(h.batchDetail&&h.batchDetail.length){var d=!0,b=!1,p=void 0;try{for(var g,y=h.batchDetail[Symbol.iterator]();!(d=(g=y.next()).done);d=!0){var N=g.value,_={id:"",materialId:"",recordId:"",batchId:"",wid:"",areaId:"",consumeNum:"",returnNum:""};for(var k in _)_[k]=N[k],"consumeNum"==k&&(_[k]=N.surplus-N.usemin),"returnNum"==k&&(_[k]=N.backmin);_.number=N.minNumber,1*_.consumeNum,1*_.returnNum,v.batchDetail.push(_)}}catch(t){b=!0,p=t}finally{try{!d&&y.return&&y.return()}finally{if(b)throw p}}}r.materialDetail.push(v)}}}catch(t){u=!0,o=t}finally{try{!l&&m.return&&m.return()}finally{if(u)throw o}}r.materialDetail.length?this.invoicingCheckMaterial(r):this.$message({message:"没有需要盘库或回库的物料",type:"error"})},getWin:function(t,e,a){if("ok"==t){this.winInfo=e;var i=!0,n=!1,s=void 0;try{for(var r,l=this.infoList[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){for(var u=r.value,o=0;o<u.materialUnit.length;o++)u.materialId==e.materialId&&u.materialUnit[o].name==e.selUnit.name&&this.selectType(u,u.index);if(u.materialId==e.materialId){u.useNum="",u.useWeight="",u.backNum="",u.backWeight="",u.consumeNum=u.usemin,u.returnNum=u.backmin,u.initialNum=u.surplus,u.batchDetail=[];for(var c=0;c<a.length;c++)u.useNum=1*u.useNum+1*a[c].useNum,u.useWeight=1*u.useWeight+1*a[c].useWeight,u.backNum=1*u.backNum+1*a[c].backNum,u.backWeight=1*u.backWeight+1*a[c].backWeight;for(var m=0;m<u.batch.length;m++)for(var h in u.batch[m])u.batch[m][h]=a[m][h];for(var v=0;v<u.batch.length;v++)(u.batch[v].usemin||u.batch[v].backmin)&&(u.batch[v].consumeNum=u.batch[v].usemin,u.batch[v].returnNum=u.batch[v].backmin,u.batchDetail.push(u.batch[v]));this.$set(u,"haveBatch",!0);break}}}catch(t){n=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}}this.showBatch=!1}},components:{selectBtn:function(){return a.e("select_btn").then(a.bind(null,"3d41"))},batchwin:function(){return a.e("storage_win").then(a.bind(null,"1737"))}}},o=(a("29fb"),a("d801")),c=Object(o.a)(u,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),t._v(" "),a("section",{staticClass:"ic-contern"},[a("span",{staticClass:"span_contern"},[t._v("领料人："+t._s(t.info.name))]),t._v(" "),a("span",{staticClass:"span_contern"},[t._v("操作人："+t._s(t.creatName))]),t._v(" "),a("span",{staticClass:"span_contern"},[t._v("备注：\n\t\t\t"),a("el-input",{staticStyle:{width:"300px"},attrs:{type:"text",maxlength:"14",placeholder:"请填写备注信息，限四十字以内"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1)]),t._v(" "),a("div",{staticClass:"list_num"},[a("section",{staticClass:"totle"},[a("div",{staticClass:"head"},[t._v("\n\t\t\t\t盘库列表 · 共"),a("span",{staticStyle:{color:"#F8931F",padding:"0 3px","font-size":"inherit"}},[t._v(t._s(t.storageInfo.length))]),t._v("个条目\n\t\t\t")]),t._v(" "),a("div",{staticClass:"scroll-box"},[a("div",{staticClass:"list-box",on:{click:t.banClick}},[a("ul",{staticClass:"oUl oulFirst"},[a("li",[t._v("操作")]),t._v(" "),a("li",[t._v("物料名称")]),t._v(" "),a("li",[t._v("领料单位选择")]),t._v(" "),a("li",{staticStyle:{width:"15%"}},[t._v("领料数量/重量")]),t._v(" "),a("li",{staticStyle:{width:"20%"}},[t._v("剩余数量/重量 "),a("span",{class:{warning:t.isSurplus},on:{click:t.allUse}},[t._v(t._s(t.isSurplus?"全部消耗":"全部剩余"))])]),t._v(" "),a("li",{staticStyle:{width:"20%"}},[t._v("回库数量/重量 "),a("span",{staticStyle:{color:"#E1BB4A"},on:{click:t.allBack}},[t._v("剩余回库")])]),t._v(" "),a("li",[t._v("分类")]),t._v(" "),a("li",[t._v("类型")])]),t._v(" "),t._l(t.infoList,function(e,i){return a("ul",{key:i,staticClass:"oUl oulSecond"},[a("li",[a("span",{staticClass:"handle-btn",on:{click:function(a){t.doThing(e)}}},[t._v("批次选择")]),t._v(" "),a("span",{staticClass:"handle-btn reset",on:{click:function(a){t.resetItem(e)}}},[t._v("重置")])]),t._v(" "),a("li",{staticClass:"hide",attrs:{title:e.materialName}},[t._v(t._s(e.materialName))]),t._v(" "),a("li",[a("el-select",{staticStyle:{width:"100px"},on:{change:function(a){t.selectType(e,a)}},model:{value:e.index,callback:function(a){t.$set(e,"index",a)},expression:"item.index"}},t._l(e.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("li",{staticClass:"hide",staticStyle:{width:"15%"},attrs:{title:e.unit}},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.unit)+"\n\t\t\t\t\t\t")]),t._v(" "),a("li",{staticStyle:{width:"20%"}},[a("div",{staticClass:"div_float"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.useNum,expression:"item.useNum"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(e),placeholder:"请输入",disabled:e.haveBatch},domProps:{value:e.useNum},on:{input:function(a){a.target.composing||t.$set(e,"useNum",a.target.value)}}}),t._v(" "),e.selUnit.name?a("span",{staticClass:"span_line",attrs:{title:e.selUnit.name}},[t._v(t._s(e.selUnit.name))]):t._e()]),t._v(" "),1!=e.selUnit.isMin?[a("span",{staticClass:"div_float add-sign"},[t._v("+")]),t._v(" "),a("div",{staticClass:"div_float"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.useWeight,expression:"item.useWeight"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(e),placeholder:"请输入",disabled:e.haveBatch},domProps:{value:e.useWeight},on:{input:function(a){a.target.composing||t.$set(e,"useWeight",a.target.value)}}}),t._v(" "),a("span",{staticClass:"span_line",attrs:{title:e.isMin}},[t._v(t._s(e.isMin))])])]:t._e()],2),t._v(" "),a("li",{staticStyle:{width:"20%"}},[a("div",{staticClass:"div_float"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.backNum,expression:"item.backNum"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(e,"1"),placeholder:"请输入",disabled:e.haveBatch},domProps:{value:e.backNum},on:{input:function(a){a.target.composing||t.$set(e,"backNum",a.target.value)}}}),t._v(" "),e.selUnit.name?a("span",{staticClass:"span_line",attrs:{title:e.selUnit.name}},[t._v(t._s(e.selUnit.name))]):t._e()]),t._v(" "),1!=e.selUnit.isMin?[a("span",{staticClass:"div_float add-sign"},[t._v("+")]),t._v(" "),a("div",{staticClass:"div_float"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.backWeight,expression:"item.backWeight"}],staticClass:"searchgoods",attrs:{type:"text",onkeyup:t.getmin(e,"1"),placeholder:"请输入",disabled:e.haveBatch},domProps:{value:e.backWeight},on:{input:function(a){a.target.composing||t.$set(e,"backWeight",a.target.value)}}}),t._v(" "),a("span",{staticClass:"span_line",attrs:{title:e.isMin}},[t._v(t._s(e.isMin))])])]:t._e()],2),t._v(" "),a("li",{staticClass:"hide",attrs:{title:e.materialCategoryName}},[t._v(t._s(e.materialCategoryName))]),t._v(" "),a("li",{staticClass:"hide",attrs:{title:t.materType[e.materialType]}},[t._v(t._s(t.materType[e.materialType]))])])})],2)])])]),t._v(" "),t.showBatch?a("batchwin",{attrs:{batchInfo:t.batchInfo},on:{getWin:t.getWin}}):t._e()],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ic-title"},[e("div",{staticClass:"text"},[this._v("\n\t\t\t领料盘库\n\t\t")]),this._v(" "),e("div",{staticClass:"dashed"})])}],!1,null,"1ae83eda",null);e.default=c.exports}}]);