(window.webpackJsonp=window.webpackJsonp||[]).push([["brand_order_bill"],{"0ce0":function(t,e,i){},"15e2":function(t,e,i){"use strict";i.r(e);var s=i("f6ce"),r=i("bbb9"),o=i("81a2");function a(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function s(r,o){try{var a=e[r](o),n=a.value}catch(t){return void i(t)}if(!a.done)return Promise.resolve(n).then(function(t){s("next",t)},function(t){s("throw",t)});t(n)}("next")})}}var n={data:function(){return{startTime:(new Date).setHours(0,0,0,0),endTime:(new Date).setHours(0,0,0,0),isOpenTime:1,shopList:[],dropName:"请选择品牌门店",orderStoreList:[],userShopList:[],timeTypeList:[{name:"挂账时间",id:0},{name:"结算时间",id:1}],operateTime:0,loadShow:!1,orderTotal:[{totalDay:1,orderNum:0,originalPrice:0,billPrice:0}],brand:!0,timer:null,shopName:"",sId:"",shopNameB:[]}},created:function(){this.userData=s.a.session("userShop"),3!=this.userData.currentShop.ischain&&(this.brand=!1);var t=[],e=[];"3"==this.userData.currentShop.ischain&&(this.userShopList=s.a.session("shopList"),this.userShopList.forEach(function(i,s){t[s]=i.id;var r={id:i.id,name:i.shopName};e.push(r)}),this.userShopIdStr=t.join(","),this.userShopList=e)},mounted:function(){for(var t in this.shopIds=this.userShopIdStr,this.userShopList)this.userShopList[t].selected=!0;this.shopNameB=r.a.deepCopy(this.userShopList),this.shopList=this.userShopList.map(function(t){return t.id}),this.storeName=this.userShopList.length>0?this.userShopList[0].name:"选择店铺",this.brand&&this.search()},methods:{timeCheck:function(){1==this.isOpenTime?this.isOpenTime=0:this.isOpenTime=1},getDrop:function(t){this.shopList=t,this.shopIds=this.shopList.join(","),this.shopNameB=r.a.deepCopy(this.userShopList);for(var e=0;e<this.shopNameB.length;e++)this.shopList.includes(this.shopNameB[e].id)||(this.shopNameB.splice(e,1),e--)},toDay:function(t){this.sId=t.shopId,this.shopName=t.shopName,this.brand=!1,s.a.session("brandBillList",this.orderStoreList)},search:function(){this.billOrderReport()},reset:function(){this.isOpenTime=1,this.operateTime=0,this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(0,0,0,0),this.shopList=this.userShopList.map(function(t){return t.id}),this.shopIds=this.shopList.join(","),this.shopNameB=r.a.deepCopy(this.userShopList),this.search()},getReturn:function(){this.brand=!0,this.orderStoreList=s.a.session("brandBillList")},billOrderReport:function(){var t=this;return a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.shopIds){e.next=3;break}return t.$store.commit("setWin",{title:"温馨提示",winType:"alert",content:"请选择店铺"}),e.abrupt("return",!1);case 3:t.loadShow=!0,o.a.billOrderReport({data:{startTime:t.startTime/1e3,endTime:t.endTime/1e3+86400-1,isOpenTime:t.isOpenTime,operateTime:t.operateTime,shopIds:t.shopIds,type:21}}).then(function(e){t.timer&&clearInterval(t.timer),t.taskInfo(e.taskId),t.timer=setInterval(function(){t.taskInfo(e.taskId)},2e3)});case 5:case"end":return e.stop()}},e,t)}))()},taskInfo:function(t){var e=this;return a(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:o.a.taskInfo({data:{taskId:t}}).then(function(i){3==i.status?(clearInterval(e.timer),e.ReportGet(t)):2==i.status&&(clearInterval(e.timer),e.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"请求失败，请重试"}),e.loadShow=!1)});case 1:case"end":return i.stop()}},i,e)}))()},ReportGet:function(t){var e=this;return a(regeneratorRuntime.mark(function i(){var s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,o.a.ReportGet({data:{taskId:t}});case 2:s=i.sent,e.loadShow=!1,s.total&&s.shops?(e.orderStoreList=s.shops,s.total.totalDay=(e.endTime-e.startTime)/864e5+1,e.orderTotal[0]=s.total):(e.orderStoreList=[],e.orderTotal[0]={billPrice:0,orderNum:0,originalPrice:0,totalDay:(e.endTime-e.startTime)/864e5+1});case 5:case"end":return i.stop()}},i,e)}))()}},destroyed:function(){clearInterval(this.timer)},components:{orderBill:function(){return i.e("order_bill_list").then(i.bind(null,"0da2"))},elShopList:function(){return i.e("el_shopList").then(i.bind(null,"60ff"))}}},l=(i("ae04"),i("d801")),c=Object(l.a)(n,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"brandBill"},[t.brand?s("div",{staticClass:"brand"},[s("div",{staticClass:"filter"},[s("div",{staticClass:"block"},[s("el-select",{staticStyle:{width:"150px"},model:{value:t.operateTime,callback:function(e){t.operateTime=e},expression:"operateTime"}},t._l(t.timeTypeList,function(t,e){return s("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),s("div",{staticClass:"block"},[s("el-date-picker",{staticStyle:{width:"150px",cursor:"pointer"},attrs:{clearable:!1,type:"date",format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}}),t._v(" "),s("span",{staticClass:"input-word"},[t._v("--")]),t._v(" "),s("el-date-picker",{staticStyle:{width:"150px",cursor:"pointer"},attrs:{clearable:!1,type:"date",format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1),t._v(" "),s("div",{staticClass:"block time"},[s("i",{class:{active:1==this.isOpenTime},on:{click:t.timeCheck}}),t._v(" "),s("span",[t._v("按营业时间")])]),t._v(" "),s("div",{staticClass:"block"},[s("elShopList",{attrs:{shopIds:t.shopList},on:{chooseShop:t.getDrop}})],1),t._v(" "),s("div",{staticClass:"search-box block"},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.search()}}},[t._v("搜索")]),t._v(" "),s("el-button",{attrs:{type:"info"},on:{click:function(e){t.reset()}}},[t._v("重置")])],1)]),t._v(" "),t.loadShow?s("div",{staticClass:"loading"},[s("img",{attrs:{src:i("b8bc")}})]):s("div",{staticClass:"main"},[s("div",[s("el-table",{attrs:{stripe:"","header-cell-style":{"background-color":"#f5f7fa"},data:t.orderTotal,border:""}},[s("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",prop:"totalDay",label:"天数"}}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",prop:"orderNum",label:"订单数"}}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",prop:"originalPrice",label:"消费总额"}}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",prop:"billPrice",label:"挂账总额"}})],1)],1),t._v(" "),s("div",{staticClass:"store-list"},[s("div",{staticClass:"length"},[t._v("\n\t\t\t\t\t挂账统计 · 共\n\t\t\t\t\t"),s("span",[t._v(" "+t._s(t.orderStoreList.length))]),t._v("条记录\n\t\t\t\t")]),t._v(" "),s("el-table",{attrs:{stripe:"","header-cell-style":{"background-color":"#f5f7fa"},data:t.orderStoreList,border:""}},[s("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",label:"店铺名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"light",on:{click:function(i){t.toDay(e.row)}}},[t._v(t._s(e.row.shopName))])]}}])}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",prop:"originalPrice",label:"消费金额"}}),t._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"","min-width":"120",align:"center",prop:"billPrice",label:"挂账金额"}})],1)],1)])]):s("orderBill",{attrs:{sId:t.sId,shopName:t.shopName,sTime:t.startTime,eTime:t.endTime,isOpen:t.isOpenTime,gType:t.operateTime},on:{return:t.getReturn}})],1)},[],!1,null,"6dc1d41c",null);e.default=c.exports},ae04:function(t,e,i){"use strict";var s=i("0ce0");i.n(s).a},b8bc:function(t,e,i){t.exports=i.p+"images/preloader.3e54c692.gif"}}]);