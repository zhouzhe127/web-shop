(window.webpackJsonp=window.webpackJsonp||[]).push([["package_add_edit_win"],{"987e":function(t,a,e){},a036:function(t,a,e){"use strict";var i=e("987e");e.n(i).a},e037:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",[i("win",{attrs:{height:590,width:680,ok:t.btnOk,cancel:t.btnCancel,align:"right"},on:{winEvent:t.closeSelfWin}},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),t._v(" "),i("div",{staticClass:"meal-set",attrs:{slot:"content",id:"bag-win"},slot:"content"},[i("div",{staticClass:"container"},[i("div",{staticClass:"line"},[i("label",{staticClass:"required fl",staticStyle:{width:"50px"}},[t._v("类型")]),t._v(" "),i("label",{staticClass:"radio fl",staticStyle:{width:"234px"}},[i("span",{class:{sign:0==t.bag.type},on:{click:function(a){t.changePackageType(0)}}},[t._v("固定套装")]),t._v(" "),i("span",{class:{sign:1==t.bag.type},on:{click:function(a){t.changePackageType(1)}}},[t._v("可选套餐")])]),t._v(" "),[i("label",{staticClass:"required fl",staticStyle:{width:"50px"}},[t._v("排序")]),t._v(" "),i("sub-add",{attrs:{minnum:1,bindnum:t.bag.sort,sign:!1},on:{toClick:t.getPackageSort}})]],2),t._v(" "),i("div",{staticStyle:{width:"100%",height:"182px","padding-top":"14px"}},[i("div",{staticStyle:{float:"left",width:"400px",height:"150px"}},[i("div",{staticClass:"line"},[i("label",{staticClass:"required fl",staticStyle:{width:"50px"}},[t._v("名称")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.bag.packageName,expression:"bag.packageName"}],staticClass:"input",staticStyle:{width:"335px",height:"40px"},attrs:{type:"text",maxlength:"20",placeholder:"输入名称"},domProps:{value:t.bag.packageName},on:{input:function(a){a.target.composing||t.$set(t.bag,"packageName",a.target.value)}}})])]),t._v(" "),i("div",{staticClass:"line",staticStyle:{"margin-top":"15px"}},[i("label",{staticClass:"fl",staticStyle:{width:"50px"}},[t._v("简码")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.bag.BC,expression:"bag.BC"}],staticClass:"input",staticStyle:{width:"335px",height:"40px"},attrs:{type:"text",maxlength:"20",placeholder:"输入简码"},domProps:{value:t.bag.BC},on:{input:function(a){a.target.composing||t.$set(t.bag,"BC",a.target.value)}}})])]),t._v(" "),i("div",{staticClass:"line",staticStyle:{"margin-top":"15px"}},[i("span",{staticClass:"required fl",staticStyle:{width:"50px"}},[t._v("售价")]),t._v(" "),i("label",{staticClass:"fl",staticStyle:{width:"143px",height:"40px",position:"relative",margin:"0",padding:"0"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.bag.price,expression:"bag.price"}],staticClass:"input",staticStyle:{width:"133px",height:"40px"},attrs:{type:"text",maxlength:"10",placeholder:"输入售价"},domProps:{value:t.bag.price},on:{input:function(a){a.target.composing||t.$set(t.bag,"price",a.target.value)}}}),t._v(" "),i("span",{staticStyle:{position:"absolute",right:"10px",top:"3px","z-index":"1"}},[t._v("元")])]),t._v(" "),i("span",{staticClass:"fl",staticStyle:{width:"60px",margin:"0",padding:"0","text-align":"center"}},[t._v("成本价")]),t._v(" "),i("label",{staticClass:"fl",staticStyle:{width:"132px",height:"40px",position:"relative"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.bag.cost,expression:"bag.cost"}],staticClass:"input",staticStyle:{width:"122px",height:"40px"},attrs:{type:"text",maxlength:"10",placeholder:"输入售价"},domProps:{value:t.bag.cost},on:{input:function(a){a.target.composing||t.$set(t.bag,"cost",a.target.value)}}}),t._v(" "),i("span",{staticStyle:{position:"absolute",right:"10px",top:"3px","z-index":"1"}},[t._v("元")])])])]),t._v(" "),i("div",{staticStyle:{float:"left",width:"225px",height:"150px"}},[i("div",{staticStyle:{position:"relative",width:"225px",height:"150px",background:"url(src/res/images/upload.png) center 40px no-repeat #ddd"}},[t.bag.imageName?i("img",{attrs:{src:t.imgHost+t.bag.imageName,width:"225",height:"150"}}):i("img",{attrs:{src:e("61ba"),width:"225",height:"150"}}),t._v(" "),i("a",{staticClass:"edit-photo"},[t._v("编辑图片")]),t._v(" "),i("form",{attrs:{method:"post",id:"imageUpForm",enctype:"multipart/form-data"}},[i("input",{staticStyle:{position:"absolute",bottom:"0",height:"40px",width:"225px",opacity:"0",cursor:"pointer"},attrs:{type:"file",accept:"image/jpeg,image/png,image/gif,image/tiff",id:"fileInput",name:"image"},on:{change:t.fileNameChange}})])])])]),t._v(" "),i("div",{staticStyle:{width:"100%",height:"auto",clear:"both"}},[i("div",{staticStyle:{width:"68px",height:"auto",float:"left"}},[i("span",{staticStyle:{"line-height":"40px",position:"relative"}},[t._v("套餐内容\n\t\t\t\t\t\t\t\t"),i("i",{staticStyle:{color:"red",position:"absolute",top:"-20px",right:"-10px"}},[t._v("*")])])]),t._v(" "),i("div",{staticClass:"seleted-center"},[t._l(t.packageTag,function(a,e){return[i("div",{key:e,class:{tab:!0,"tab-selected":e==t.selectTagIndex},on:{click:function(i){t.changeTag(e,a)}}},[t._v(t._s(a.tagName))])]}),t._v(" "),i("a",{staticClass:"addclassify",staticStyle:{width:"132px"},attrs:{href:"javascript:void(0);"},on:{click:t.openAddTagWin}},[t._v("添加标识")])],2),t._v(" "),i("div",{staticClass:"seleted-right"},[t.packageTag&&t.packageTag.length>0?i("div",{staticClass:"seleted-container",style:{height:46.5*t.packageTag.length+"px"}},[i("div",{staticStyle:{height:"5px","font-size":"0","line-height":"5px"}}),t._v(" "),t._l(t.packageTag[t.selectTagIndex].packageTagGoods,function(a,e){return i("span",{key:e},[t._v(t._s(a.goodsName)+" "+t._s(a.packageGoodsNum)+" "+t._s(a.unit)+";")])})],2):t._e(),t._v(" "),i("a",{staticClass:"addclassify",staticStyle:{width:"100%","background-position-x":"125px"},attrs:{href:"javascript:void(0);"},on:{click:t.openEditTagWin}},[t._v("编辑该标识可选内容")])]),t._v(" "),i("div",{staticStyle:{clear:"both","font-size":"0px",width:"100%"}})]),t._v(" "),i("div",{staticClass:"line",staticStyle:{"margin-top":"14px"}},[i("label",{staticClass:"fl",staticStyle:{width:"auto","vertical-align":"middle","margin-right":"15px"}},[t._v("参与优惠\n\t\t\t\t\t\t\t"),i("on-off",{staticStyle:{display:"inline-block","vertical-align":"middle","margin-left":"7px"},attrs:{status:1==t.bag.isDiscount},on:{statusChange:t.getIsDiscountToggle}})],1),t._v(" "),i("label",{staticClass:"fl",staticStyle:{width:"auto","vertical-align":"middle","margin-right":"15px"}},[t._v("服务费\n\t\t\t\t\t\t\t"),i("on-off",{staticStyle:{display:"inline-block","vertical-align":"middle","margin-left":"7px"},attrs:{status:1==t.bag.serviceCharge},on:{statusChange:t.getServiceChargeToggle}})],1),t._v(" "),i("label",{staticClass:"fl",staticStyle:{width:"auto","vertical-align":"middle","margin-right":"15px"}},[t._v("估清\n\t\t\t\t\t\t\t"),i("on-off",{staticStyle:{display:"inline-block","vertical-align":"middle","margin-left":"7px"},attrs:{status:1==t.bag.status},on:{statusChange:t.getStatusToggle}})],1),t._v(" "),i("label",{staticClass:"fl",staticStyle:{width:"auto","vertical-align":"middle"}},[t._v("推荐菜\n\t\t\t\t\t\t\t"),i("on-off",{staticStyle:{display:"inline-block","vertical-align":"middle","margin-left":"7px"},attrs:{status:1==t.bag.isRecommend},on:{statusChange:t.getIsRecommendToggle}})],1)]),t._v(" "),i("div",{staticClass:"line",staticStyle:{"margin-top":"14px"}},[i("label",{staticClass:"fl",staticStyle:{width:"auto"}},[t._v("会员专享\n\t\t\t\t\t\t\t"),i("on-off",{staticStyle:{display:"inline-block","vertical-align":"middle","margin-left":"7px"},attrs:{status:0!=t.bag.isVip},on:{statusChange:t.getIsVip}})],1),t._v(" "),0!=t.bag.isVip?i("label",{staticClass:"radio fl",staticStyle:{width:"auto","margin-left":"10px"}},[i("div",{staticStyle:{"background-color":"#fff",height:"40px"}},[i("radio-btn",{attrs:{list:t.vipPriceArr,index:1==t.bag.isVip?0:1},on:{selOn:t.getVipRadio}})],1)]):t._e(),t._v(" "),1==t.bag.isVip?[i("label",{staticClass:"fl",staticStyle:{width:"80px","text-align":"right","margin-right":"12px"}},[t._v("会员价格")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.bag.vipPrice,expression:"bag.vipPrice"}],staticClass:"input fl",staticStyle:{width:"158px",height:"40px","line-height":"40px",overflow:"hidden"},attrs:{maxlength:"10",type:"text",placeholder:"输入会员价"},domProps:{value:t.bag.vipPrice},on:{input:function(a){a.target.composing||t.$set(t.bag,"vipPrice",a.target.value)}}})]:t._e()],2),t._v(" "),i("div",{staticStyle:{width:"100%",height:"100px","margin-top":"14px",clear:"both"}},[i("div",{staticStyle:{width:"50px",height:"90px",float:"left"}},[i("span",{staticStyle:{"line-height":"40px"}},[t._v("描述")])]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bag.description,expression:"bag.description"}],staticClass:"describe",staticStyle:{width:"555px",height:"98px","font-size":"14px"},attrs:{maxlength:"100",placeholder:"输入描述"},domProps:{value:t.bag.description},on:{input:function(a){a.target.composing||t.$set(t.bag,"description",a.target.value)}}})]),t._v(" "),i("div",{staticStyle:{clear:"both",height:"20px","font-size":"0px",width:"100%"}})])])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i(t.showCom,{tag:"component",attrs:{pObj:t.comObj},on:{throwTagWin:t.closeTagWin}})],1)],1)};i._withStripped=!0;var s=e("f6ce"),n=e("81a2"),o=e("05dd");function c(t){return function(){var a=t.apply(this,arguments);return new Promise(function(t,e){return function i(s,n){try{var o=a[s](n),c=o.value}catch(t){return void e(t)}if(!o.done)return Promise.resolve(c).then(function(t){i("next",t)},function(t){i("throw",t)});t(c)}("next")})}}var g={data:function(){return{shopId:"",packageId:null,imgHost:"",showCom:"",comObj:{},title:"",packageTag:[],packageList:[],goodsList:[],bag:{id:"",packageName:"",BC:"",type:0,cost:"",price:"",isDiscount:"",isVip:"0",vipPrice:"",vipDiscount:"100",imageName:"",isRecommend:"",serviceCharge:"",sort:"1",description:"",status:"0"},btnOk:{content:"",style:""},btnCancel:{content:"",style:""},selectTagIndex:0,vipPriceArr:["会员价格","会员折扣"]}},props:{pObj:null},methods:{closeTagWin:function(t,a){var e=this,i=[];if("add"!=t&&"edit"!=t||a.goods.forEach(function(t){var a={gid:t.id,packageGoodsNum:t.packageGoodsNum,unit:t.unit,goodsName:t.goodsName};i.push(a)}),"add"==t){var s={tagName:a.tagName,totalNum:a.total,packageTagGoods:i};this.packageTag.push(s)}else"delete"==t?(this.packageTag.splice(this.selectTagIndex,1),this.changeTag(0)):"edit"==t&&(this.packageTag=this.packageTag.map(function(t,s){return s==e.selectTagIndex&&(t.totalNum=a.total,t.tagName=a.tagName,t.packageTagGoods=i),t}));this.showCom=""},openAddTagWin:function(){var t=[];this.goodsList.forEach(function(a){0!=a.status&&1!=a.status||0!=a.type||(!Number(a.groupId)&&!Number(a.isGroup)||Number(a.groupId)>0)&&t.push(a)}),this.comObj={goodsList:t,tagName:"",totalNum:0,title:"添加标识",packageType:this.bag.type,selGoods:[],packageTag:this.packageTag},this.showCom="addTag"},openEditTagWin:function(){if(0!=this.packageTag.length){var t=this.packageTag[this.selectTagIndex].tagName,a=0;0==this.bag.type?this.packageTag[this.selectTagIndex].packageTagGoods.forEach(function(t){a+=parseInt(t.packageGoodsNum)}):a=this.packageTag[this.selectTagIndex].totalNum;var e=[];this.goodsList.forEach(function(t){0!=t.status&&1!=t.status||0!=t.type||(!Number(t.groupId)&&!Number(t.isGroup)||Number(t.groupId)>0)&&e.push(t)}),this.comObj={goodsList:e,tagName:t,totalNum:a,title:"编辑该标识可选内容",packageType:this.bag.type,selGoods:this.packageTag[this.selectTagIndex].packageTagGoods,packageTag:this.packageTag},this.showCom="addTag"}else this.openAddTagWin()},closeSelfWin:function(t){var a=this;if("ok"==t){if(!this.checkForm())return;var e=this.formatData(),i=e.packageTag,s=e.newPackageTag;this.packageId?this.editPackage(i,s).then(function(){a.$emit("throwAddEditWin","update")}):this.addPackage(s).then(function(){a.$emit("throwAddEditWin","update")})}else if("cancel"==t&&this.packageId){var n,o=null;n=2==(o=2==this.bag.status?0:2)?"确定下架该商品?":"确定上架该商品?",this.$store.commit("setWin",{title:"提示信息",winType:"confirm",content:n,callback:function(t){"ok"==t&&a.upOrDownShelf(o).then(function(){a.$emit("throwAddEditWin","update")})}})}else this.$emit("throwAddEditWin","close")},changeTag:function(t){this.selectTagIndex=t},formatData:function(){var t=this,a={packageTag:[],newPackageTag:[]};return this.packageTag.forEach(function(e){if(e.id){var i=[];e.packageTagGoods.forEach(function(a){var e={shopId:t.shopId,packageId:t.packageId,gid:a.gid,packageGoodsNum:a.packageGoodsNum,unit:a.unit};i.push(e)});var s={id:e.id,shopId:t.shopId,packageId:t.packageId,tagName:e.tagName,totalNum:e.totalNum,packageGoods:i};a.packageTag.push(s)}else{var n=[];e.packageTagGoods.forEach(function(t){var a={gid:t.gid,packageGoodsNum:t.packageGoodsNum};n.push(a)});var o={tagName:e.tagName,totalNum:e.totalNum,packageGoods:n};a.newPackageTag.push(o)}}),a},checkForm:function(){if(o.a.checkData({packageName:{cond:"$$.length>0 && ((/^[^'’“\"&]*$/).test($$))",pro:"套餐名不能含有特殊符号,且不能为空!"},BC:{reg:/^[0-9A-Za-z]{0,20}$/g,pro:"简码由由1-20位数字,英文组成!"},price:{reg:/((^[1-9]\d{0,9})|^0)(\.\d{1,2})?$/,pro:"请输入正确的售价格式且价格不能大于10万!"},description:{cond:"$$.length<=100",pro:"描述内容不能超过50字哦!"},cost:{reg:/(((^[1-9]\d{0,9})|^0)(\.\d{1,2})?$)|(^((\s)*(\t)*)?$)/,pro:"请输入正确的成本格式!"}},this.bag))if(Number(this.bag.price>1e5))this.$store.commit("setWin",{title:"提示信息",content:"售价不能大于10万!"});else{if(!Number(this.bag.cost>1e5)){if(1==this.bag.isVip){if(!o.a.checkData({vipPrice:{reg:/((^[1-9]\d{0,9})|^0)(\.\d{1,2})?$/,pro:"请输入正确的会员价格!"}},this.bag))return;if(Number(this.bag.vipPrice>1e5))return void this.$store.commit("setWin",{title:"提示信息",content:"会员价格不能大于10万!"});if(Number(this.bag.price)<Number(this.bag.vipPrice))return void this.$store.commit("setWin",{title:"提示信息",content:"会员价格大于售价!"})}return this.packageTag||(this.packageTag=[]),0!=this.packageTag.length||(this.$store.commit("setWin",{title:"提示信息",content:"请添加标识!"}),!1)}this.$store.commit("setWin",{title:"提示信息",content:"成本不能大于10万!"})}},fileNameChange:function(){var t=this;return c(regeneratorRuntime.mark(function a(){var e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.uploadImg({data:{type:8,shopId:s.a.session("shopId")},formId:"imageUpForm"});case 2:e=a.sent,t.bag.imageName=e;case 4:case"end":return a.stop()}},a,t)}))()},getVipRadio:function(t){this.bag.isVip=t+1},getPackageSort:function(t){this.bag.sort=t},changePackageType:function(t){this.bag.type=t},getIsDiscountToggle:function(t){this.bag.isDiscount=t?1:0},getIsRecommendToggle:function(t){this.bag.isRecommend=t?1:0},getServiceChargeToggle:function(t){this.bag.serviceCharge=t?1:0},getStatusToggle:function(t){2!=this.bag.status?this.bag.status=t?1:0:this.$store.commit("setWin",{title:"温馨提示",content:"下架的套餐不能进行估清操作!"})},getIsVip:function(t){this.bag.isVip=t?1:0},initBtn:function(){this.packageId?(2==this.status?this.btnCancel={content:"上架",style:"background-color:#29abe2;"}:this.btnCancel={content:"下架",style:"background-color:#29abe2;"},this.btnOk={content:"保存",style:"background-color:#f8941f;"}):(this.btnOk.content="添加",this.btnOk.style="background-color:#f8941f",this.btnCancel.content="取消")},initData:function(){var t=s.a.session("userShop");for(var a in this.shopId=t.currentShop.id,this.imgHost=t.uploadUrl,this.pObj)this[a]=this.pObj[a]},addPackage:function(t){var a=this;return c(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.addPackage({data:{shopId:a.shopId,packageName:a.bag.packageName,BC:a.bag.BC,type:a.bag.type,cost:a.bag.cost,price:a.bag.price,isDiscount:a.bag.isDiscount,isVip:a.bag.isVip,vipPrice:a.bag.vipPrice,vipDiscount:a.bag.vipDiscount,isRecommend:a.bag.isRecommend,serviceCharge:a.bag.serviceCharge,sort:a.bag.sort,description:a.bag.description,status:a.bag.status,packageTag:t,imageName:a.bag.imageName?a.bag.imageName:""}});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}},e,a)}))()},editPackage:function(t,a){var e=this;return c(regeneratorRuntime.mark(function i(){var s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.a.editPackage({data:{packageId:e.packageId,shopId:e.shopId,packageName:e.bag.packageName,BC:e.bag.BC,type:e.bag.type,cost:e.bag.cost,price:e.bag.price,isDiscount:e.bag.isDiscount,isVip:e.bag.isVip,vipPrice:e.bag.vipPrice,vipDiscount:e.bag.vipDiscount,isRecommend:e.bag.isRecommend,serviceCharge:e.bag.serviceCharge,sort:e.bag.sort,description:e.bag.description,status:e.bag.status,packageTag:t,newPackageTag:a,imageName:e.bag.imageName?e.bag.imageName:""}});case 2:return s=i.sent,i.abrupt("return",s);case 4:case"end":return i.stop()}},i,e)}))()},upOrDownShelf:function(t){var a=this;return c(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.upOrDownShelf({data:{shopId:a.shopId,packageId:a.packageId,status:t}});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}},e,a)}))()},getPackageById:function(){var t=this;return c(regeneratorRuntime.mark(function a(){var e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.getPackageById({data:{packageId:t.packageId,shopId:t.shopId}});case 2:return e=a.sent,a.abrupt("return",e);case 4:case"end":return a.stop()}},a,t)}))()}},mounted:function(){var t=this;this.initData(),this.initBtn(),this.packageId&&this.getPackageById().then(function(a){t.bag=a.package,t.bag||(t.bag=[]),t.packageTag=a.packageTag,t.packageTag||(t.packageTag=[]);var e=a.packageGoods;e||(e=[]),e.forEach(function(a){for(var e=0,i=t.goodsList.length;e<i;e++){var s=t.goodsList[e];a.gid==s.id&&(a.unit=s.unit)}}),t.packageTag=t.packageTag.map(function(t){return t.packageTagGoods=[],e.forEach(function(a){a.packageTagId==t.id&&t.packageTagGoods.push(a)}),t}),t.changeTag(0)})},components:{win:function(){return e.e("win").then(e.bind(null,"f60a"))},subAdd:function(){return e.e("subadd").then(e.bind(null,"e7ea"))},onOff:function(){return e.e("on_off").then(e.bind(null,"034b"))},radioBtn:function(){return e.e("radio_btn").then(e.bind(null,"4dfe"))},addTag:function(){return e.e("package_add_tag_win").then(e.bind(null,"08e6"))}}},r=(e("a036"),e("7610")),p=Object(r.a)(g,i,[],!1,null,"d498848e",null);p.options.__file="src\\module\\goods_config\\package_com\\package_add_edit_win.vue";a.default=p.exports}}]);