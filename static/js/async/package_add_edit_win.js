(window.webpackJsonp=window.webpackJsonp||[]).push([["package_add_edit_win"],{a036:function(e,t,a){"use strict";var i=a("b492");a.n(i).a},b492:function(e,t,a){},e037:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("win",{attrs:{height:590,width:680,ok:e.btnOk,cancel:e.btnCancel,align:"right"},on:{winEvent:e.closeSelfWin}},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.title))]),e._v(" "),i("div",{staticClass:"meal-set",attrs:{slot:"content",id:"bag-win"},slot:"content"},[i("div",{staticClass:"container",staticStyle:{overflow:"hidden"}},[i("section",{staticStyle:{width:"400px",float:"left"}},[i("el-form",{ref:"bag",attrs:{model:e.bag,"label-width":"80px"}},[i("el-form-item",{attrs:{required:"",label:"类型",prop:"type"}},[e.pObj.isAddPack?[i("el-radio-group",{on:{change:e.changePackageType},model:{value:e.bag.type,callback:function(t){e.$set(e.bag,"type",t)},expression:"bag.type"}},[i("el-radio-button",{attrs:{label:"0"}},[e._v("固定套餐")]),e._v(" "),i("el-radio-button",{attrs:{label:"1"}},[e._v("可选套餐")]),e._v(" "),i("el-radio-button",{attrs:{label:"2"}},[e._v("自定义套餐")])],1)]:e._e(),e._v(" "),e.pObj.isAddPack?e._e():[i("el-radio-group",{model:{value:e.bag.type,callback:function(t){e.$set(e.bag,"type",t)},expression:"bag.type"}},[i("el-radio-button",{attrs:{label:e.bag.type}},[0==e.bag.type?i("span",[e._v("固定套餐")]):e._e(),e._v(" "),1==e.bag.type?i("span",[e._v("可选套餐")]):e._e(),e._v(" "),2==e.bag.type?i("span",[e._v("自定义套餐")]):e._e()])],1)]],2),e._v(" "),i("el-form-item",{attrs:{required:"",label:"名称"}},[i("el-input",{staticStyle:{width:"270px"},attrs:{maxlength:"20",placeholder:"请输入套餐名称"},model:{value:e.bag.packageName,callback:function(t){e.$set(e.bag,"packageName",t)},expression:"bag.packageName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"简码",prop:"BC"}},[i("el-input",{staticStyle:{width:"270px"},attrs:{maxlength:"20",placeholder:"请输入套餐简码"},model:{value:e.bag.BC,callback:function(t){e.$set(e.bag,"BC",t)},expression:"bag.BC"}})],1),e._v(" "),i("el-form-item",{attrs:{required:"",label:"排序"}},[i("el-input-number",{staticStyle:{width:"150px"},attrs:{min:1,max:255},on:{change:e.getPackageSort},model:{value:e.bag.sort,callback:function(t){e.$set(e.bag,"sort",t)},expression:"bag.sort"}})],1),e._v(" "),2!=e.bag.type?i("el-form-item",{attrs:{required:"",label:"售价"}},[i("el-input",{staticStyle:{width:"120px"},attrs:{maxlength:"10",placeholder:"请输入售价"},model:{value:e.bag.price,callback:function(t){e.$set(e.bag,"price",t)},expression:"bag.price"}}),e._v(" "),i("span",[e._v("元")]),e._v(" "),i("span",{staticStyle:{"margin-left":"10px"}},[e._v("成本价")]),e._v(" "),i("el-input",{staticStyle:{width:"120px"},attrs:{maxlength:"10",placeholder:"请输入成本价"},model:{value:e.bag.cost,callback:function(t){e.$set(e.bag,"cost",t)},expression:"bag.cost"}})],1):e._e()],1)],1),e._v(" "),i("section",{staticStyle:{width:"220px",float:"right","margin-top":"40px","margin-right":"25px"}},[i("div",{staticStyle:{position:"relative",width:"225px",height:"150px",background:"url(src/res/images/upload.png) center 40px no-repeat #ddd"}},[e.bag.imageName?i("img",{attrs:{src:e.imgHost+e.bag.imageName,width:"225",height:"150"}}):i("img",{attrs:{src:a("61ba"),width:"225",height:"150"}}),e._v(" "),i("a",{staticClass:"edit-photo"},[e._v("编辑图片")]),e._v(" "),i("form",{attrs:{method:"post",id:"imageUpForm",enctype:"multipart/form-data"}},[i("input",{staticStyle:{position:"absolute",bottom:"0",height:"40px",width:"225px",opacity:"0",cursor:"pointer"},attrs:{type:"file",accept:"image/jpeg,image/png,image/gif,image/tiff",id:"fileInput",name:"image"},on:{change:e.fileNameChange}})])])])]),e._v(" "),i("div",{staticClass:"container"},[i("el-form",{ref:"bag",attrs:{model:e.bag,"label-width":"80px"}},[i("el-form-item",{attrs:{required:"",label:"套餐内容"}},["2"==e.bag.type?[i("el-button",{staticStyle:{width:"150px"},attrs:{type:"primary"},on:{click:e.openEditTagWin}},[e._v("配置自定义套餐")]),e._v(" "),e.packageTag&&e.packageTag.length>0?i("span",[e._v("已配置"+e._s(e.packageTag[e.selectTagIndex].packageTagGoods.length)+"个商品,必选数量 "+e._s(e.packageTag[e.selectTagIndex].totalNum))]):e._e()]:[i("div",{staticClass:"seleted-center"},[e._l(e.packageTag,function(t,a){return[i("div",{key:a,class:{tab:!0,"tab-selected":a==e.selectTagIndex},on:{click:function(i){e.changeTag(a,t)}}},[e._v(e._s(t.tagName))])]}),e._v(" "),i("a",{staticClass:"addclassify",staticStyle:{width:"132px"},attrs:{href:"javascript:void(0);"},on:{click:e.openAddTagWin}},[e._v("添加标识")])],2),e._v(" "),i("div",{staticClass:"seleted-right"},[e.packageTag&&e.packageTag.length>0?i("div",{staticClass:"seleted-container",style:{height:46.5*e.packageTag.length+"px"}},[i("div",{staticStyle:{height:"5px","font-size":"0","line-height":"5px"}}),e._v(" "),e._l(e.packageTag[e.selectTagIndex].packageTagGoods,function(t,a){return i("span",{key:a},[e._v(e._s(t.goodsName)+" "+e._s(t.packageGoodsNum)+" "+e._s(t.unit)+";")])})],2):e._e(),e._v(" "),i("a",{staticClass:"addclassify",staticStyle:{width:"100%","background-position-x":"125px"},attrs:{href:"javascript:void(0);"},on:{click:e.openEditTagWin}},[e._v("编辑该标识可选内容")])]),e._v(" "),i("div",{staticStyle:{clear:"both","font-size":"0px",width:"100%"}})]],2),e._v(" "),i("el-form-item",{attrs:{label:"参与优惠 "}},[i("el-switch",{attrs:{"active-color":"#E1BB4A","inactive-color":"#e6e6e6"},model:{value:e.bag.isDiscount,callback:function(t){e.$set(e.bag,"isDiscount",t)},expression:"bag.isDiscount"}}),e._v(" "),"2"!=e.bag.type?[i("span",{staticStyle:{color:"#606266",margin:"0 20px"}},[e._v("服务费")]),e._v(" "),i("el-switch",{attrs:{"active-color":"#E1BB4A","inactive-color":"#e6e6e6"},on:{change:e.getServiceChargeToggle},model:{value:e.bag.serviceCharge,callback:function(t){e.$set(e.bag,"serviceCharge",t)},expression:"bag.serviceCharge"}}),e._v(" "),1*e.bag.status<2?i("span",{staticStyle:{color:"#606266",margin:"0 20px"}},[e._v("估清")]):e._e(),e._v(" "),1*e.bag.status<2?i("el-switch",{attrs:{"active-color":"#E1BB4A","inactive-color":"#e6e6e6"},on:{change:e.getStatusToggle},model:{value:e.isStatus,callback:function(t){e.isStatus=t},expression:"isStatus"}}):e._e(),e._v(" "),i("span",{staticStyle:{color:"#606266",margin:"0 20px"}},[e._v("推荐菜 ")]),e._v(" "),i("el-switch",{attrs:{"active-color":"#E1BB4A","inactive-color":"#e6e6e6"},on:{change:e.getIsRecommendToggle},model:{value:e.bag.isRecommend,callback:function(t){e.$set(e.bag,"isRecommend",t)},expression:"bag.isRecommend"}})]:e._e()],2),e._v(" "),"2"!=e.bag.type?i("el-form-item",{attrs:{label:"会员专享 "}},[i("el-switch",{attrs:{"active-color":"#E1BB4A","inactive-color":"#e6e6e6"},on:{change:e.openVipRadio},model:{value:e.isVipShow,callback:function(t){e.isVipShow=t},expression:"isVipShow"}}),e._v(" "),e.isVipShow?[i("el-radio",{attrs:{label:"1",border:""},on:{click:function(t){e.getVipRadio(1)}},model:{value:e.bag.isVip,callback:function(t){e.$set(e.bag,"isVip",t)},expression:"bag.isVip"}},[e._v("会员价格")]),e._v(" "),i("el-radio",{attrs:{label:"2",border:""},on:{click:function(t){e.getVipRadio(2)}},model:{value:e.bag.isVip,callback:function(t){e.$set(e.bag,"isVip",t)},expression:"bag.isVip"}},[e._v("会员折扣")])]:e._e(),e._v(" "),1==e.bag.isVip?[i("span",{staticStyle:{color:"#606266",margin:"0 20px"}},[e._v("会员价格")]),e._v(" "),i("el-input",{staticStyle:{width:"120px"},attrs:{maxlength:"10",placeholder:"输入会员价"},model:{value:e.bag.vipPrice,callback:function(t){e.$set(e.bag,"vipPrice",t)},expression:"bag.vipPrice"}})]:e._e()],2):e._e(),e._v(" "),i("el-form-item",{staticStyle:{width:"550px"},attrs:{label:"描述",prop:"description"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:6}},model:{value:e.bag.description,callback:function(t){e.$set(e.bag,"description",t)},expression:"bag.description"}})],1)],1)],1)])]),e._v(" "),i("transition",{attrs:{name:"fade"}},[i(e.showCom,{tag:"component",attrs:{pObj:e.comObj},on:{throwTagWin:e.closeTagWin}})],1)],1)};i._withStripped=!0;var s=a("f6ce"),o=a("81a2"),n=a("05dd");function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function i(s,o){try{var n=t[s](o),c=n.value}catch(e){return void a(e)}if(!n.done)return Promise.resolve(c).then(function(e){i("next",e)},function(e){i("throw",e)});e(c)}("next")})}}var r={data:function(){return{shopId:"",packageId:null,imgHost:"",showCom:"",comObj:{},title:"",packageTag:[],packageList:[],goodsList:[],bag:{id:"",packageName:"",BC:"",type:0,cost:"",price:"",isDiscount:"0",isVip:"0",vipPrice:"",vipDiscount:"100",imageName:"",isRecommend:"0",serviceCharge:"0",sort:"1",description:"",status:"0"},btnOk:{content:"",style:""},btnCancel:{content:"",style:""},selectTagIndex:0,vipPriceArr:["会员价格","会员折扣"],isVipShow:!1,isStatus:!1}},props:{pObj:null},methods:{closeTagWin:function(e,t){var a=this,i=[];if("add"!=e&&"edit"!=e||t.goods.forEach(function(e){var t={gid:e.id,packageGoodsNum:e.packageGoodsNum,unit:e.unit,goodsName:e.goodsName};i.push(t)}),"add"==e){var s={tagName:t.tagName,totalNum:t.total,packageTagGoods:i};this.packageTag.push(s)}else"delete"==e?(this.packageTag.splice(this.selectTagIndex,1),this.changeTag(0)):"edit"==e&&(this.packageTag=this.packageTag.map(function(e,s){return s==a.selectTagIndex&&(e.totalNum=t.total,e.tagName=t.tagName,e.packageTagGoods=i),e}));this.showCom=""},openAddTagWin:function(){var e=[];this.goodsList.forEach(function(t){0!=t.status&&1!=t.status||0!=t.type||(!Number(t.groupId)&&!Number(t.isGroup)||Number(t.groupId)>0)&&e.push(t)}),this.comObj={goodsList:e,tagName:"",totalNum:0,title:"添加标识",packageType:this.bag.type,selGoods:[],goodsIds:[],packageTag:this.packageTag},this.showCom="addTag"},openEditTagWin:function(){if(0!=this.packageTag.length){var e=this.packageTag[this.selectTagIndex].tagName,t=0;0==this.bag.type?this.packageTag[this.selectTagIndex].packageTagGoods.forEach(function(e){t+=parseInt(e.packageGoodsNum)}):t=this.packageTag[this.selectTagIndex].totalNum;var a=[];this.goodsList.forEach(function(e){0!=e.status&&1!=e.status||0!=e.type||(!Number(e.groupId)&&!Number(e.isGroup)||Number(e.groupId)>0)&&a.push(e)});for(var i=this.packageTag[this.selectTagIndex].packageTagGoods,s=[],o=0;o<i.length;o++)s.push(i[o].gid);this.comObj={goodsList:a,tagName:e,totalNum:t,title:"编辑该标识可选内容",packageType:this.bag.type,selGoods:this.packageTag[this.selectTagIndex].packageTagGoods,goodsIds:s,packageTag:this.packageTag},this.showCom="addTag"}else this.openAddTagWin()},closeSelfWin:function(e){var t=this;if("ok"==e){if(!this.checkForm())return;var a=this.formatData(),i=a.packageTag,s=a.newPackageTag;this.packageId?this.editPackage(i,s).then(function(){t.$emit("throwAddEditWin","update")}):this.addPackage(s).then(function(){t.$emit("throwAddEditWin","update")})}else if("cancel"==e&&this.packageId){var o,n=null;o=2==(n=2==this.bag.status?0:2)?"确定下架该商品?":"确定上架该商品?",this.$store.commit("setWin",{title:"提示信息",winType:"confirm",content:o,callback:function(e){"ok"==e&&t.upOrDownShelf(n).then(function(){t.$emit("throwAddEditWin","update")})}})}else this.$emit("throwAddEditWin","close")},changeTag:function(e){this.selectTagIndex=e},formatData:function(){var e=this,t={packageTag:[],newPackageTag:[]};return this.packageTag.forEach(function(a){if(a.id){var i=[];a.packageTagGoods.forEach(function(t){var a={shopId:e.shopId,packageId:e.packageId,gid:t.gid,packageGoodsNum:t.packageGoodsNum,unit:t.unit};i.push(a)});var s={id:a.id,shopId:e.shopId,packageId:e.packageId,tagName:a.tagName,totalNum:a.totalNum,packageGoods:i};t.packageTag.push(s)}else{var o=[];a.packageTagGoods.forEach(function(e){var t={gid:e.gid,packageGoodsNum:e.packageGoodsNum};o.push(t)});var n={tagName:a.tagName,totalNum:a.totalNum,packageGoods:o};t.newPackageTag.push(n)}}),t},checkForm:function(){if(n.a.checkData({packageName:{cond:"$$.length>0 && ((/^[^'’“\"&]*$/).test($$))",pro:"套餐名不能含有特殊符号,且不能为空!"},BC:{reg:/^[0-9A-Za-z]{0,20}$/g,pro:"简码由由1-20位数字,英文组成!"},description:{cond:"$$.length<=100",pro:"描述内容不能超过50字哦!"},cost:{reg:/(((^[1-9]\d{0,9})|^0)(\.\d{1,2})?$)|(^((\s)*(\t)*)?$)/,pro:"请输入正确的成本格式!"}},this.bag)){if(/((^[1-9]\d{0,9})|^0)(\.\d{1,2})?$/.test(this.bag.price)||"2"==this.bag.type)if(Number(this.bag.price>1e5))this.$store.commit("setWin",{title:"提示信息",content:"售价不能大于10万!"});else{if(!Number(this.bag.cost>1e5)){if(1==this.bag.isVip){if(!n.a.checkData({vipPrice:{reg:/((^[1-9]\d{0,9})|^0)(\.\d{1,2})?$/,pro:"请输入正确的会员价格!"}},this.bag))return;if(Number(this.bag.vipPrice>1e5))return void this.$store.commit("setWin",{title:"提示信息",content:"会员价格不能大于10万!"});if(Number(this.bag.price)<Number(this.bag.vipPrice))return void this.$store.commit("setWin",{title:"提示信息",content:"会员价格大于售价!"})}return this.packageTag||(this.packageTag=[]),0!=this.packageTag.length||(this.$store.commit("setWin",{title:"提示信息",content:"请添加标识!"}),!1)}this.$store.commit("setWin",{title:"提示信息",content:"成本不能大于10万!"})}else this.$store.commit("setWin",{content:"请输入正确的售价格式且价格不能大于10万!!"})}},fileNameChange:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.uploadImg({data:{type:8,shopId:s.a.session("shopId")},formId:"imageUpForm"});case 2:a=t.sent,e.bag.imageName=a;case 4:case"end":return t.stop()}},t,e)}))()},openVipRadio:function(e){console.log(e),this.isVipShow=e,this.isVipShow?this.bag.isVip="1":this.bag.isVip="0"},getVipRadio:function(e){this.bag.isVip=e},getPackageSort:function(e){this.bag.sort=e},changePackageType:function(e){this.packageTag=[],this.bag.isDiscount="0",this.bag.isVip="0",this.bag.serviceCharge="0",this.bag.isRecommend="0",this.bag.price="",this.bag.cost="",this.bag.status="0",this.isVipShow=!1,this.isStatus=!1,this.bag.type=e},getIsDiscountToggle:function(e){this.bag.isDiscount=e},getIsRecommendToggle:function(e){this.bag.isRecommend=e},getServiceChargeToggle:function(e){this.bag.serviceCharge=e},getStatusToggle:function(e){this.bag.status=Number(e),this.isStatus=e},getIsVip:function(e){this.bag.isVip=e},initBtn:function(){this.packageId?(2==this.status?this.btnCancel={content:"上架",style:"background-color:#29abe2;"}:this.btnCancel={content:"下架",style:"background-color:#29abe2;"},this.btnOk={content:"保存",style:"background-color:#f8941f;"}):(this.btnOk.content="添加",this.btnOk.style="background-color:#f8941f",this.btnCancel.content="取消")},initData:function(){var e=s.a.session("userShop");for(var t in this.shopId=e.currentShop.id,this.imgHost=e.uploadUrl,this.pObj)this[t]=this.pObj[t]},addPackage:function(e){var t=this;return c(regeneratorRuntime.mark(function a(){var i,s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i=[],"2"==t.bag.type?i.push(e[t.selectTagIndex]):i=e,a.next=4,o.a.addPackage({data:{shopId:t.shopId,packageName:t.bag.packageName,BC:t.bag.BC,type:t.bag.type,cost:t.bag.cost,price:t.bag.price,isDiscount:Number(t.bag.isDiscount),isVip:Number(t.bag.isVip),vipPrice:t.bag.vipPrice,vipDiscount:t.bag.vipDiscount,isRecommend:Number(t.bag.isRecommend),serviceCharge:Number(t.bag.serviceCharge),sort:t.bag.sort,description:t.bag.description,status:Number(t.bag.status),packageTag:i,imageName:t.bag.imageName?t.bag.imageName:""}});case 4:return s=a.sent,a.abrupt("return",s);case 6:case"end":return a.stop()}},a,t)}))()},editPackage:function(e,t){var a=this;return c(regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.editPackage({data:{packageId:a.packageId,shopId:a.shopId,packageName:a.bag.packageName,BC:a.bag.BC,type:a.bag.type,cost:a.bag.cost,price:a.bag.price,isDiscount:Number(a.bag.isDiscount),isVip:Number(a.bag.isVip),vipPrice:a.bag.vipPrice,vipDiscount:a.bag.vipDiscount,isRecommend:Number(a.bag.isRecommend),serviceCharge:Number(a.bag.serviceCharge),sort:a.bag.sort,description:a.bag.description,status:Number(a.bag.status),packageTag:e,imageName:a.bag.imageName?a.bag.imageName:""}});case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},t,a)}))()},upOrDownShelf:function(e){var t=this;return c(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,o.a.upOrDownShelf({data:{shopId:t.shopId,packageId:t.packageId,status:e}});case 2:return i=a.sent,a.abrupt("return",i);case 4:case"end":return a.stop()}},a,t)}))()},getPackageById:function(){var e=this;return c(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.getPackageById({data:{packageId:e.packageId,shopId:e.shopId}});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,e)}))()}},mounted:function(){var e=this;this.initData(),this.initBtn(),this.packageId&&this.getPackageById().then(function(t){e.bag=t.package,e.bag||(e.bag=[]),e.bag.isDiscount=Boolean(1*e.bag.isDiscount),e.bag.serviceCharge=Boolean(1*e.bag.serviceCharge),1*e.bag.status>0&&(e.isStatus=!0),e.bag.isRecommend=Boolean(1*e.bag.isRecommend),1*e.bag.isVip>0&&(e.isVipShow=!0),e.packageTag=t.packageTag,e.packageTag||(e.packageTag=[]);var a=t.packageGoods;a||(a=[]),a.forEach(function(t){for(var a=0,i=e.goodsList.length;a<i;a++){var s=e.goodsList[a];t.gid==s.id&&(t.unit=s.unit)}}),e.packageTag=e.packageTag.map(function(e){return e.packageTagGoods=[],a.forEach(function(t){t.packageTagId==e.id&&e.packageTagGoods.push(t)}),e}),e.changeTag(0)})},components:{win:function(){return a.e("win").then(a.bind(null,"f60a"))},subAdd:function(){return a.e("subadd").then(a.bind(null,"e7ea"))},addTag:function(){return a.e("package_add_tag_win").then(a.bind(null,"08e6"))}}},g=(a("a036"),a("6ceb")),p=Object(g.a)(r,i,[],!1,null,"d498848e",null);p.options.__file="src\\module\\goods_config\\package_com\\package_add_edit_win.vue";t.default=p.exports}}]);