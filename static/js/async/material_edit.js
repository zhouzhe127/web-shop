(window.webpackJsonp=window.webpackJsonp||[]).push([["material_edit"],{"4c94":function(t,e,i){"use strict";var a=i("688d");i.n(a).a},"688d":function(t,e,i){},"8e35":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAyRTk3N0U3NjkwOTExRTY4MzI2OEU1NkY3Qjg2QTA3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAyRTk3N0U4NjkwOTExRTY4MzI2OEU1NkY3Qjg2QTA3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDJFOTc3RTU2OTA5MTFFNjgzMjY4RTU2RjdCODZBMDciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDJFOTc3RTY2OTA5MTFFNjgzMjY4RTU2RjdCODZBMDciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7A3duJAAAANElEQVR42mL6//8/Ax6MDPCpY2BioBIYNYiOBrEA8X8i1f4fel5jJNI7jKPpaNQgHAAgwAAuLjvvigxAWAAAAABJRU5ErkJggg=="},ccae:function(t,e,i){"use strict";i.r(e);var a=i("81a2"),n=i("05dd"),r=i("f6ce");function s(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function a(n,r){try{var s=e[n](r),l=s.value}catch(t){return void i(t)}if(!s.done)return Promise.resolve(l).then(function(t){a("next",t)},function(t){a("throw",t)});t(l)}("next")})}}var l={data:function(){return{validityTypeArr:[{id:0,name:"月"},{id:1,name:"日"},{id:2,name:"年"}],validityObj:{time:"",type:"日",id:"",show:!1},isBrand:"",flag:"",materialName:"",materialCode:"",materialId:"",category:[],selectCategory:[],selectBrand:[],brandList:[],showCom:"",comObj:"",olddis:"",dispiceArr:[],selectUnit:[],updateArr:[],typeCate:[{value:0,label:"成品"},{value:1,label:"半成品"},{value:2,label:"普通物料"}],typeValue:""}},methods:{clickBtn:function(t){var e=this;switch(t){case"ok":if(!this.checkform())return;var i=this.formatData();this.MaterialEditMaterial(i).then(function(t){t&&(e.$store.commit("setWin",{title:"温馨提示",content:"修改物料成功!"}),e.$router.go(-1))});break;case"cancel":this.$router.go(-1)}},closeCommonWin:function(t,e){if("cancel"!=e&&"close"!=e){switch(this.flag){case"category":this.selectCategory=t;break;case"brand":this.selectBrand=t}this.flag="",this.showCom=""}else this.showCom=""},openCategoryWin:function(t){this.showCom="addCategory",this.flag=t,this.comObj={category:this.category,title:"选择分类",selectCategory:this.selectCategory,radio:!0,tips:"请先配置分类!"}},openAddBrand:function(t){this.showCom="unitBrand",this.flag=t,this.comObj={title:"添加品牌",list:this.brandList,selectlist:this.selectBrand,radio:!0,tips:"请先配置品牌"}},organizeCategory:function(t){var e=t,i=[];return t.forEach(function(t){if(t.child=[],t.showAdd=!1,0==t.pid){for(var a=0,n=e.length;a<n;a++)t.id==e[a].pid&&t.id!=e[a].id&&t.child.push(e[a]);i.push(t)}}),i},getValidity:function(t){this.validityObj.type=t.name,this.validityObj.id=t.id},hideUnitSelect:function(t){this.validityObj.show=!this.validityObj.show,t.cancelBubble=!0},checkform:function(){var t=this;if(n.a.checkData({materialName:{cond:"$$.length>0 && $$.length<=20",pro:"请输入20字以内的名称!"},materialCode:{reg:/[0-9A-Za-z]{0,20}/,pro:"简码由英文,数字组成!"}},this)&&n.a.checkData({time:{reg:/[1-9]\d{0,2}/,pro:"保质期由1-3位数字组成!"}},this.validityObj)){if(0!=this.selectCategory.length){var e=!0;return this.isBrand&&(this.updateArr=[],this.dispiceArr.map(function(i){i.value&&(t.updateArr.push(i),i.unitId||(t.$message.error("请选择分销价单位！"),e=!1),/^([+-]?)\d*\.?\d+$/.test(i.value)||(t.$message({message:"请输入正确价格！",type:"warning"}),e=!1))})),!!e}this.$store.commit("setWin",{content:"请选择分类!",title:"温馨提示"})}},formatData:function(){var t=null;this.selectBrand[0]&&(t=this.selectBrand[0].id);var e=[];this.selectCategory.forEach(function(t){e.push(t.id)});var i={mid:this.materialId,name:this.materialName,BC:this.materialCode,brandId:t,validity:this.validityObj.time,validityType:this.validityObj.id,cids:e.join(","),type:this.typeValue};return this.isBrand&&(i.distributionData=this.updateArr),i},domEvent:function(){this.validityObj.show=!1},MaterialGetCategoryList:function(){var t=this;return s(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.MaterialGetCategoryList({data:{}});case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},e,t)}))()},InvoicingBrandList:function(){var t=this;return s(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.InvoicingBrandList({data:{}});case 2:return i=t.sent,t.abrupt("return",i);case 4:case"end":return t.stop()}},e,t)}))()},MaterialEditMaterial:function(t){var e=this;return s(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.MaterialEditMaterial({data:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},i,e)}))()},MaterialGetMaterialDetail:function(t){var e=this;return s(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.MaterialGetMaterialDetail({data:{mid:t,isDistribution:1}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},i,e)}))()},syncRequest:function(){var t=this;return s(regeneratorRuntime.mark(function e(){var i,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.MaterialGetMaterialDetail(t.materialId);case 2:return i=e.sent,t.materialName=i.name,t.materialCode=i.BC,t.selectUnit=i.unit,t.typeValue=Number(i.type),t.olddis=i.distributionRela,a=null,t.validityTypeArr.some(function(t){if(t.id==i.validityType)return a=t.name,!0}),t.validityObj={time:i.validity,show:!1,id:i.validityType,type:a},e.next=13,t.MaterialGetCategoryList();case 13:return n=e.sent,t.category=t.organizeCategory(n),i.cate||(i.cate=[]),t.selectCategory=i.cate.map(function(t){for(var e=0,i=n.length;e<i;e++)if(t.cid==n[e].id)return n[e]}),e.next=19,t.InvoicingBrandList();case 19:t.brandList=e.sent,t.brandList.some(function(e){if(e.id==i.brandId)return t.selectBrand.push(e),!0});case 21:case"end":return e.stop()}},e,t)}))()},initData:function(){this.materialId=this.$route.query.id;var t=r.a.session("userShop");this.isBrand="3"==t.currentShop.ischain,console.log(this.isBrand)},getDistr:function(){var t=this;return s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.invoicingGetDistributionConfig();case 2:e.sent.map(function(e){var i={};Object.assign(i,{distributionId:e.id,value:"",name:e.name,unitId:""}),t.olddis.map(function(t){e.id==t.distributionId&&(i.value=t.value,i.unitId=t.unitId)}),t.dispiceArr.push(i)});case 4:case"end":return e.stop()}},e,t)}))()}},mounted:function(){var t=this;return s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.initData(),e.next=3,t.syncRequest();case 3:t.getDistr(),document.addEventListener("click",t.domEvent);case 5:case"end":return e.stop()}},e,t)}))()},components:{unitBrand:function(){return i.e("unit_brand_win").then(i.bind(null,"86b8"))},addCategory:function(){return i.e("add_category_com").then(i.bind(null,"16ef"))}},beforeDestroy:function(){document.removeEventListener("click",this.domEvent)}},c=(i("4c94"),i("d801")),o=Object(c.a)(l,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"material-edit"}},[a("div",{staticClass:"split-title"},[t._v("\n\t\t\t修改物料\n\t\t")]),t._v(" "),a("div",[a("div",{staticClass:"label-content"},[a("label",{staticClass:"required label"},[t._v("物料名称")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.materialName,expression:"materialName"}],staticClass:"input",attrs:{type:"text",maxlength:"20",placeholder:"请输入物料名称"},domProps:{value:t.materialName},on:{input:function(e){e.target.composing||(t.materialName=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"label-content"},[a("label",{staticClass:"require label"},[t._v("物料简码")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.materialCode,expression:"materialCode"}],staticClass:"input",attrs:{type:"text",maxlength:"20",placeholder:"请输入物料简码"},domProps:{value:t.materialCode},on:{input:function(e){e.target.composing||(t.materialCode=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"label-content"},[a("label",{staticClass:"required label"},[t._v("物料类型")]),t._v(" "),a("div",{staticStyle:{width:"210px",display:"inline-block"}},[a("el-select",{attrs:{placeholder:"全部类型"},model:{value:t.typeValue,callback:function(e){t.typeValue=e},expression:"typeValue"}},t._l(t.typeCate,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)]),t._v(" "),a("div",{staticClass:"label-content"},[a("label",{staticClass:"required label"},[t._v("物料分类")]),t._v(" "),a("div",{staticClass:"img-div",on:{click:function(e){t.openCategoryWin("category")}}},[a("img",{attrs:{src:i("8e35"),alt:"添加"}}),t._v("添加分类\n\t\t\t\t")]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.selectCategory.length>0,expression:"selectCategory.length>0"}],staticClass:"tips"},[t._v("\n                    (已选择:\n                        "),t._l(t.selectCategory,function(e,i){return a("i",{key:i},[t._v(t._s(e.name)+"\n                            "),i!=t.selectCategory.length-1?[t._v("\n                                ,\n                            ")]:t._e()],2)}),t._v("\n                    )\n                ")],2)]),t._v(" "),a("div",{staticClass:"label-content"},[a("label",{staticClass:"label"},[t._v("品牌")]),t._v(" "),a("div",{staticClass:"img-div",on:{click:function(e){t.openAddBrand("brand")}}},[a("img",{attrs:{src:i("8e35"),alt:"添加"}}),t._v("添加品牌\n\t\t\t\t")]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.selectBrand.length>0,expression:"selectBrand.length>0"}],staticClass:"tips"},[t._v("\n                    (已选择:\n                        "),t._l(t.selectBrand,function(e,i){return a("i",{key:i},[t._v(t._s(e.name))])}),t._v("\n                    )\n                ")],2)]),t._v(" "),a("div",{staticClass:"label-content"},[a("label",{staticClass:"required label"},[t._v("保质期")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.validityObj.time,expression:"validityObj.time"}],staticClass:"input validity-input",attrs:{type:"text",maxlength:"3"},domProps:{value:t.validityObj.time},on:{input:function(e){e.target.composing||t.$set(t.validityObj,"time",e.target.value)}}}),t._v(" "),a("div",{staticClass:"validity",on:{click:t.hideUnitSelect}},[a("span",{staticClass:"validity-num"},[t._v(t._s(t.validityObj.type))]),t._v(" "),a("span",{staticClass:"validity-trangle"}),t._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:t.validityObj.show,expression:"validityObj.show"}],staticClass:"validity-ul"},t._l(t.validityTypeArr,function(e,i){return a("li",{key:i,on:{click:function(i){t.getValidity(e)}}},[t._v(t._s(e.name))])}))])])]),t._v(" "),t.isBrand?a("div",{staticClass:"split-title"},[t._v("\n\t\t\t分销价格\n\t\t")]):t._e(),t._v(" "),t._l(t.dispiceArr,function(e,i){return t.isBrand?a("div",{key:i,staticClass:"label-content"},[a("div",{staticClass:"inline-box"},[a("label",{staticClass:"require label"},[t._v(t._s(e.name))]),t._v(" "),a("div",{staticClass:"input-box"},[a("el-input",{attrs:{placeholder:"请输入价格"},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"list.value"}})],1)]),t._v(" "),a("div",{staticClass:"inline-box"},[a("label",{staticClass:"require label"},[t._v("单位")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择单位"},model:{value:e.unitId,callback:function(i){t.$set(e,"unitId",i)},expression:"list.unitId"}},t._l(t.selectUnit,function(t){return a("el-option",{key:t.muId,attrs:{label:t.name,value:t.muId}})}))],1)]):t._e()}),t._v(" "),a("div",{staticClass:"bottom"},[a("div",{staticClass:"gray-btn gray",on:{click:function(e){t.clickBtn("cancel")}}},[t._v("取消")]),t._v(" "),a("div",{staticClass:"yellow-btn yellow",on:{click:function(e){t.clickBtn("ok")}}},[t._v("确定")])]),t._v(" "),a(t.showCom,{tag:"component",attrs:{pObj:t.comObj,list:t.comObj.category,selectList:t.comObj.selectCategory,title:t.comObj.title,radio:t.comObj.radio,tips:t.comObj.tips,showTips:!1},on:{throwCommonWin:t.closeCommonWin}})],2)},[],!1,null,"2a9d8d8c",null);e.default=o.exports}}]);