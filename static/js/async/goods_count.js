(window.webpackJsonp=window.webpackJsonp||[]).push([["goods_count"],{"165c":function(t,e,n){"use strict";var a=n("5df8");n.n(a).a},"54dc":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"goods-count-history"}},[t.showAddGoodsCom?t._e():n("div",{staticClass:"content-body"},[n("com-table",{attrs:{showHand:!0,listName:"盘库商品列表",listHeight:70,showTitle:1,titleData:t.titleData,introData:t.nowList,allTotal:t.pageObj.listNum,fixed:0,bannerStyle:{color:"#333","font-size":"16px"},widthType:!0,listWidth:1435,contentStyle:{color:"#666",fontSize:"14px"}},scopedSlots:t._u([{key:"con-0",fn:function(e){var a=e.data;e.index;return n("div",{},[n("span",{staticClass:"operation-left line",on:{click:function(e){t.clearInput(a)}}},[t._v("清空")]),t._v(" "),n("span",{staticClass:"operation-right",on:{click:function(e){t.openWin(a)}}},[t._v("批量盘库")])])}},{key:"con-1",fn:function(e){var a=e.data,r=e.index;return n("div",{},[n("input",{directives:[{name:"model",rawName:"v-model",value:a.countNum,expression:"data.countNum"}],staticClass:"count-num",class:{canWrite:a.canWrite},attrs:{type:"text",readonly:a.canWrite,maxlength:"9",placeholder:"请输入数字"},domProps:{value:a.countNum},on:{input:[function(e){e.target.composing||t.$set(a,"countNum",e.target.value)},function(e){t.checkNum(a,r)}]}})])}}])}),t._v(" "),n("div",[n("page-element",{attrs:{page:t.pageObj.page,total:t.pageObj.total},on:{pageNum:t.getPageNum}})],1),t._v(" "),n(t.showCom,{tag:"component",attrs:{title:t.comObj.title,list:t.comObj.list,info:t.comObj.info},on:{emitEvent:t.closeWin}})],1),t._v(" "),t.showAddGoodsCom?n("add-goods",{attrs:{selObj:t.stateStore.addGoods},on:{emit:t.getGoodsWin}}):t._e()],1)};a._withStripped=!0;var r=n("81a2"),i=n("bbb9");function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function s(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(r,i){try{var o=e[r](i),s=o.value}catch(t){return void n(t)}if(!o.done)return Promise.resolve(s).then(function(t){a("next",t)},function(t){a("throw",t)});t(s)}("next")})}}var u={data:function(){return{titleData:[{titleName:"操作"},{titleName:"盘库数量"},{titleName:"库存数量",dataName:"surplusUnit"},{titleName:"商品名",dataName:"name"},{titleName:"条形码",dataName:"barCode"},{titleName:"所属仓库",dataName:"storeName"},{titleName:"批次数量",dataName:"batch"},{titleName:"商品类型",dataName:"typeName"}],list:[],nowList:[],startTime:{time:"",show:!0,detail:!0,width:160},endTime:{time:"",show:!0,detail:!0,width:160},pageObj:{page:1,total:0,num:10,listNum:0,flag:!0},toggle:!0,showCom:"",comObj:{},showAddGoodsCom:!1,stateStore:{addGoods:{list:[],search:{}}},stateCountNum:[],batchListNum:[],opearItem:{}}},mounted:function(){this.isPrimitive(this.$route.query.id)?(this.initBtn(),this.showAddGoodsCom=!1,this.templateId=this.$route.query.id,this.useTemplate()):this.showAddGoodsCom=!0},methods:{getTime:function(t,e){this[t].time=e},closeWin:function(t,e){var n="",a=[];if(Array.isArray(t)||(t=[]),"ok"==e){var r,i=!0,o=!1,s=void 0;try{for(var u,c=t[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var l=u.value,d=l.countNum.trim();if(d){var m=Number(d);n=Number(n),n+=m,a.push(l)}}}catch(t){o=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}this.batchListNum=this.delBatchCountNum(t),(r=this.batchListNum).push.apply(r,a),n+="";for(var h=0;h<this.nowList.length;h++)if(this.nowList[h].id==this.opearItem.id){n?(this.opearItem.canWrite=!0,this.opearItem.countNum=n):this.opearItem.canWrite=!1,this.nowList.splice(h,1,this.opearItem);break}}this.opearItem={},this.showCom=""},openWin:function(t){var e=this;return s(regeneratorRuntime.mark(function n(){var a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.opearItem=t,n.next=3,e.getHttp("getGoodsBatch",{gid:t.id,areaId:t.areaId});case 3:a=n.sent,Array.isArray(a.list)||(a.list=[]),a.list=a.list.map(function(e,n){return n+=1,e.itemIndex=n>9?n:"0"+n,e.storeName=e.wName+"-"+e.aName,e.resetNum=""+e.surplus+t.unit,e.productionTimeShow=i.a.getTime({time:e.productionTime,format:"yyyy-MM-dd hh:mm"}).format,e.unit=t.unit,e.countNum="",e.id=t.id,e}),a.list=e.matchBatchList(e.batchListNum,a.list),e.comObj={title:"选择批次",list:a.list,info:[{name:"商品名称",val:t.name},{name:"条码",val:t.barCode},{name:"商品单位",val:t.unit}]},e.showCom="batchWin";case 9:case"end":return n.stop()}},n,e)}))()},getGoodsWin:function(t){if(this.initBtn(),this.showAddGoodsCom=!1,t){var e=t.list,n=void 0===e?[]:e,a=t.search,r=void 0===a?{}:a,i=t.storeAll,o=t.name,s=void 0===o?"":o;this.stateStore.addGoods={search:r,list:n,storeAll:i,name:s},0==n.length?this.pageObj.flag=!1:(this.list=n,this.list=this.ininList(this.list),this.pageObj.flag=!0,this.pageObj.listNum=this.list.length),this.pageObj.page=1,this.getPageNum({page:this.pageObj.page,num:this.pageObj.num})}},getPageNum:function(t){this.pageObj.page=t.page,this.pageObj.num=t.num,this.pageObj.flag?(this.addStateCountNum(),this.pageObj.total=Math.ceil(this.list.length/this.pageObj.num),this.nowList=this.initPage(this.list,this.pageObj.page,this.pageObj.num)):this.getList()},getHasNumItem:function(t){var e=[],n=!0,a=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(u.countNum=String(u.countNum),u.countNum.trim()){var c=i.a.deepCopy(u);e.push(c)}}}catch(t){a=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(a)throw r}}return e},matchStateList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!0,a=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value,c=!0,l=!1,d=void 0;try{for(var m,h=t[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var f=m.value;if(u.id==f.id){u.countNum=f.countNum;break}}}catch(t){l=!0,d=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw d}}}}catch(t){a=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(a)throw r}}return[].concat(o(e))},matchBatchList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!0,a=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value,c=!0,l=!1,d=void 0;try{for(var m,h=t[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var f=m.value;if(u.id==f.id&&u.wid==f.wid&&u.areaId==f.areaId&&u.batchId==f.batchId){u.countNum=f.countNum;break}}}catch(t){l=!0,d=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw d}}}}catch(t){a=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(a)throw r}}return[].concat(o(e))},delStateCountNum:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return 0==e.length?[].concat(o(t)):t.filter(function(t){var n=!0,a=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value;if(t.id==u.id){n=!1;break}}}catch(t){r=!0,i=t}finally{try{!a&&s.return&&s.return()}finally{if(r)throw i}}return n})},addStateCountNum:function(){var t,e;this.stateCountNum=this.delStateCountNum(this.stateCountNum,this.nowList),e=this.getHasNumItem(this.nowList),(t=this.stateCountNum).push.apply(t,o(e))},delBatchCountNum:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.batchListNum.filter(function(e){var n=!0,a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value;if(e.id==u.id&&e.wid==u.wid&&e.areaId==u.areaId&&e.batchId==u.batchId){n=!1;break}}}catch(t){r=!0,i=t}finally{try{!a&&s.return&&s.return()}finally{if(r)throw i}}return n})},getList:function(){var t=this;return s(regeneratorRuntime.mark(function e(){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={num:t.pageObj.num,page:t.pageObj.page,goodsName:"",barCode:"",secBarCode:""},Object.assign(n,t.stateStore.addGoods.search),n.type&&(n.type=Number(n.type)+1),e.next=5,t.getHttp("GoodsinventoryGetGoodsInventoryList",n);case 5:a=e.sent,t.pageObj.listNum=a.count,t.pageObj.total=a.total,Array.isArray(a.list)&&(t.addStateCountNum(),t.nowList=a.list,t.nowList=t.ininList(t.nowList),t.nowList=t.matchStateList(t.stateCountNum,t.nowList),t.list=[]);case 9:case"end":return e.stop()}},e,t)}))()},useTemplate:function(){var t=this;return s(regeneratorRuntime.mark(function e(){var n,a,r,i,s,u,c,l,d,m,h,f,p,v,g,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getHttp("templateGetInventoryGoodsTemplate",{id:t.templateId});case 2:if(n=e.sent,a=n.content,t.toRawType(a,"Object")||(a={}),r=[],s=(i=a).items,u=void 0===s?[]:s,c=i.type,l=void 0===c?"":c,d=i.wids,m=i.aids,t.stateStore.addGoods.name=n.name,!Array.isArray(u)){e.next=48;break}if(0!=u.length){e.next=17;break}Array.isArray(d)&&(d=d.join(",")),Array.isArray(m)&&(m=m.join(",")),t.stateStore.addGoods.search={type:l,wid:d,areaId:m},t.stateStore.addGoods.list=[],t.stateStore.addGoods.storeAll=!0,t.pageObj.flag=!1,e.next=46;break;case 17:for(h=!0,f=!1,p=void 0,e.prev=20,v=u[Symbol.iterator]();!(h=(g=v.next()).done);h=!0)(y=g.value).areaId=y.aid,y.aid=void 0;e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),f=!0,p=e.t0;case 28:e.prev=28,e.prev=29,!h&&v.return&&v.return();case 31:if(e.prev=31,!f){e.next=34;break}throw p;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.next=38,t.getHttp("GoodsInventoryGetGoodsInventoryListByGids",{param:u});case 38:r=e.sent,t.list=[].concat(o(r)),t.list=t.ininList(t.list),t.pageObj.flag=!0,t.pageObj.listNum=t.list.length,t.stateStore.addGoods.list=[].concat(o(r)),t.stateStore.addGoods.search={type:"",wid:"",areaId:""},t.stateStore.addGoods.storeAll=!1;case 46:t.pageObj.page=1,t.getPageNum({page:t.pageObj.page,num:t.pageObj.num});case 48:case"end":return e.stop()}},e,t,[[20,24,28,36],[29,,31,35]])}))()},checkNum:function(t){if(!t.canWrite){var e=t.countNum+"",n=[];e=(e=e.trim()).slice(0,30),(n=0==t.type?e.match(/([1-9]\d{0,9})|0/g):e.match(/([1-9]\d{0,9}|0)\.?(\d{0,3})?/g))||((n=[])[0]=""),n[0]&&Number(n[0])<0&&(n[0]=0),n[0]+="",t.countNum=n[0]}},clearInput:function(t){t.canWrite||(t.countNum="")},ininList:function(t){var e=["普通商品","称重商品","自定义商品"];return t.map(function(t){return t.warehouseArea||(t.warehouseArea=t.areaName),t.countNum||(t.countNum=""),t.storeName=t.warehouse+"/"+t.warehouseArea,t.typeName=e[t.type],t.surplusUnit=t.surplus+t.unit,t.id=t.gid,t.batchId="0",t})},formatData:function(t){var e={new:[],old:[]},n=!0,a=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,u={batchId:s.batchId,wid:s.wid,areaId:s.areaId,surplus:s.countNum,itemId:s.id};e.new.push(u)}}catch(t){a=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}return e},delSameList:function(){var t=this;this.stateCountNum=this.stateCountNum.filter(function(e){var n=!0,a=!0,r=!1,i=void 0;try{for(var o,s=t.batchListNum[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value;if(e.id==u.id){n=!1;break}}}catch(t){r=!0,i=t}finally{try{!a&&s.return&&s.return()}finally{if(r)throw i}}return n})},mergeList:function(){var t,e;return(t=e=[].concat(o(this.stateCountNum))).push.apply(t,o(this.batchListNum)),this.formatData(e)},submitData:function(){var t=this;return s(regeneratorRuntime.mark(function e(){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},t.addStateCountNum(),t.delSameList(),a=t.mergeList(),(n=a.new).push.apply(n,o(a.old)),0!=a.new.length){e.next=8;break}return t.alert("请先填写盘库数量!"),e.abrupt("return");case 8:t.alert("确认盘库?",s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getHttp("GoodsinventoryBatchSetGoodsInventory",{data:a.new,type:0});case 2:e.sent.result?(t.alert("盘库成功!"),delete t.$route.query.id,t.$router.push({path:"/admin/goodsCountHistory",query:t.$route.query})):t.alert("盘库失败!");case 4:case"end":return e.stop()}},e,t)})));case 9:case"end":return e.stop()}},e,t)}))()},initBtn:function(){var t=this,e={height:"40px",color:"#fff"};this.$store.commit("setPageTools",[{name:"确认盘库",className:"yellow",style:e,fn:function(){t.submitData()}},{name:"添加商品",style:e,fn:function(){t.showAddGoodsCom=!0}},{name:"取消盘库",className:"gray",style:e,fn:function(){t.$router.go(-1)}}])},alert:function(t,e){var n={title:"温馨提示",content:t,winType:"alert"};"function"==typeof e&&(n.winType="confirm",n.callback=function(t){"ok"==t&&e()}),this.$store.commit("setWin",n)},isPrimitive:function(t){return"string"==typeof t||"number"==typeof t},toRawType:function(t,e){return Object.prototype.toString.call(t).slice(8,-1)==e},initPage:function(t,e,n){var a=(e-1)*n,r=e*n;return t.slice(a,r)},listGetAttr:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return t.map(function(t){return t[e]+""})},getHttp:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a[t]({data:n});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}},a,e)}))()}},components:{comTable:function(){return n.e("table").then(n.bind(null,"4360"))},batchWin:function(){return Promise.all([n.e("check_material~goods_count_batch_win"),n.e("goods_count_batch_win")]).then(n.bind(null,"9031"))},addGoods:function(){return Promise.all([n.e("check_material~goods_count_batch_win"),n.e("goods_count_batch_win")]).then(n.bind(null,"bd16"))},pageElement:function(){return n.e("page_element").then(n.bind(null,"5921"))}}},c=(n("165c"),n("6ceb")),l=Object(c.a)(u,a,[],!1,null,"38315e16",null);l.options.__file="src\\module\\invoicing_system\\invoicing\\goods_count.vue";e.default=l.exports},"5df8":function(t,e,n){}}]);