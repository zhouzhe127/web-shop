(window.webpackJsonp=window.webpackJsonp||[]).push([["goods_count"],{"54dc":function(t,e,a){"use strict";a.r(e);var n=a("81a2"),r=a("bbb9");function i(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function n(r,i){try{var o=e[r](i),s=o.value}catch(t){return void a(t)}if(!o.done)return Promise.resolve(s).then(function(t){n("next",t)},function(t){n("throw",t)});t(s)}("next")})}}var s={data:function(){return{titleData:[{titleName:"操作"},{titleName:"盘库数量"},{titleName:"库存数量",dataName:"surplusUnit"},{titleName:"商品名",dataName:"name"},{titleName:"条形码",dataName:"barCode"},{titleName:"所属仓库",dataName:"storeName"},{titleName:"批次数量",dataName:"batch"},{titleName:"商品类型",dataName:"typeName"}],list:[],nowList:[],startTime:{time:"",show:!0,detail:!0,width:160},endTime:{time:"",show:!0,detail:!0,width:160},pageObj:{page:1,total:0,num:10,listNum:0,flag:!0},toggle:!0,showCom:"",comObj:{},showAddGoodsCom:!1,stateStore:{addGoods:{list:[],search:{}}},stateCountNum:[],batchListNum:[],opearItem:{}}},mounted:function(){this.isPrimitive(this.$route.query.id)?(this.initBtn(),this.showAddGoodsCom=!1,this.templateId=this.$route.query.id,this.useTemplate()):this.showAddGoodsCom=!0},methods:{getTime:function(t,e){this[t].time=e},closeWin:function(t,e){var a="",n=[];if(Array.isArray(t)||(t=[]),"ok"==e){var r,i=!0,o=!1,s=void 0;try{for(var u,c=t[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var l=u.value,d=l.countNum.trim();if(d){var m=Number(d);a=Number(a),a+=m,n.push(l)}}}catch(t){o=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}this.batchListNum=this.delBatchCountNum(t),(r=this.batchListNum).push.apply(r,n),a+="";for(var h=0;h<this.nowList.length;h++)if(this.nowList[h].id==this.opearItem.id){a?(this.opearItem.canWrite=!0,this.opearItem.countNum=a):this.opearItem.canWrite=!1,this.nowList.splice(h,1,this.opearItem);break}}this.opearItem={},this.showCom=""},openWin:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e.opearItem=t,a.next=3,e.getHttp("getGoodsBatch",{gid:t.id,areaId:t.areaId});case 3:n=a.sent,Array.isArray(n.list)||(n.list=[]),n.list=n.list.map(function(e,a){return a+=1,e.itemIndex=a>9?a:"0"+a,e.storeName=e.wName+"-"+e.aName,e.resetNum=""+e.surplus+t.unit,e.productionTimeShow=r.a.getTime({time:e.productionTime,format:"yyyy-MM-dd hh:mm"}).format,e.unit=t.unit,e.countNum="",e.id=t.id,e}),n.list=e.matchBatchList(e.batchListNum,n.list),e.comObj={title:"选择批次",list:n.list,info:[{name:"商品名称",val:t.name},{name:"条码",val:t.barCode},{name:"商品单位",val:t.unit}]},e.showCom="batchWin";case 9:case"end":return a.stop()}},a,e)}))()},getGoodsWin:function(t){if(this.initBtn(),this.showAddGoodsCom=!1,t){var e=t.list,a=void 0===e?[]:e,n=t.search,r=void 0===n?{}:n,i=t.storeAll,o=t.name,s=void 0===o?"":o;this.stateStore.addGoods={search:r,list:a,storeAll:i,name:s},0==a.length?this.pageObj.flag=!1:(this.list=a,this.list=this.ininList(this.list),this.pageObj.flag=!0,this.pageObj.listNum=this.list.length),this.pageObj.page=1,this.getPageNum({page:this.pageObj.page,num:this.pageObj.num})}},getPageNum:function(t){this.pageObj.page=t.page,this.pageObj.num=t.num,this.pageObj.flag?(this.addStateCountNum(),this.pageObj.total=Math.ceil(this.list.length/this.pageObj.num),this.nowList=this.initPage(this.list,this.pageObj.page,this.pageObj.num)):this.getList()},getHasNumItem:function(t){var e=[],a=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value;if(u.countNum=String(u.countNum),u.countNum.trim()){var c=r.a.deepCopy(u);e.push(c)}}}catch(t){n=!0,i=t}finally{try{!a&&s.return&&s.return()}finally{if(n)throw i}}return e},matchStateList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value,c=!0,l=!1,d=void 0;try{for(var m,h=t[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var f=m.value;if(u.id==f.id){u.countNum=f.countNum;break}}}catch(t){l=!0,d=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw d}}}}catch(t){n=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}return[].concat(i(e))},matchBatchList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value,c=!0,l=!1,d=void 0;try{for(var m,h=t[Symbol.iterator]();!(c=(m=h.next()).done);c=!0){var f=m.value;if(u.id==f.id&&u.wid==f.wid&&u.areaId==f.areaId&&u.batchId==f.batchId){u.countNum=f.countNum;break}}}catch(t){l=!0,d=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw d}}}}catch(t){n=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}return[].concat(i(e))},delStateCountNum:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return 0==e.length?[].concat(i(t)):t.filter(function(t){var a=!0,n=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(t.id==u.id){a=!1;break}}}catch(t){r=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return a})},addStateCountNum:function(){var t,e;this.stateCountNum=this.delStateCountNum(this.stateCountNum,this.nowList),e=this.getHasNumItem(this.nowList),(t=this.stateCountNum).push.apply(t,i(e))},delBatchCountNum:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.batchListNum.filter(function(e){var a=!0,n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(e.id==u.id&&e.wid==u.wid&&e.areaId==u.areaId&&e.batchId==u.batchId){a=!1;break}}}catch(t){r=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return a})},getList:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={num:t.pageObj.num,page:t.pageObj.page,goodsName:"",barCode:"",secBarCode:""},Object.assign(a,t.stateStore.addGoods.search),a.type&&(a.type=Number(a.type)+1),e.next=5,t.getHttp("GoodsinventoryGetGoodsInventoryList",a);case 5:n=e.sent,t.pageObj.listNum=n.count,t.pageObj.total=n.total,Array.isArray(n.list)&&(t.addStateCountNum(),t.nowList=n.list,t.nowList=t.ininList(t.nowList),t.nowList=t.matchStateList(t.stateCountNum,t.nowList),t.list=[]);case 9:case"end":return e.stop()}},e,t)}))()},useTemplate:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a,n,r,o,s,u,c,l,d,m,h,f,p,v,g,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getHttp("templateGetInventoryGoodsTemplate",{id:t.templateId});case 2:if(a=e.sent,n=a.content,t.toRawType(n,"Object")||(n={}),r=[],s=(o=n).items,u=void 0===s?[]:s,c=o.type,l=void 0===c?"":c,d=o.wids,m=o.aids,t.stateStore.addGoods.name=a.name,!Array.isArray(u)){e.next=48;break}if(0!=u.length){e.next=17;break}Array.isArray(d)&&(d=d.join(",")),Array.isArray(m)&&(m=m.join(",")),t.stateStore.addGoods.search={type:l,wid:d,areaId:m},t.stateStore.addGoods.list=[],t.stateStore.addGoods.storeAll=!0,t.pageObj.flag=!1,e.next=46;break;case 17:for(h=!0,f=!1,p=void 0,e.prev=20,v=u[Symbol.iterator]();!(h=(g=v.next()).done);h=!0)(y=g.value).areaId=y.aid,y.aid=void 0;e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),f=!0,p=e.t0;case 28:e.prev=28,e.prev=29,!h&&v.return&&v.return();case 31:if(e.prev=31,!f){e.next=34;break}throw p;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.next=38,t.getHttp("GoodsInventoryGetGoodsInventoryListByGids",{param:u});case 38:r=e.sent,t.list=[].concat(i(r)),t.list=t.ininList(t.list),t.pageObj.flag=!0,t.pageObj.listNum=t.list.length,t.stateStore.addGoods.list=[].concat(i(r)),t.stateStore.addGoods.search={type:"",wid:"",areaId:""},t.stateStore.addGoods.storeAll=!1;case 46:t.pageObj.page=1,t.getPageNum({page:t.pageObj.page,num:t.pageObj.num});case 48:case"end":return e.stop()}},e,t,[[20,24,28,36],[29,,31,35]])}))()},checkNum:function(t){if(!t.canWrite){var e=t.countNum+"",a=[];e=(e=e.trim()).slice(0,30),(a=0==t.type?e.match(/([1-9]\d{0,9})|0/g):e.match(/([1-9]\d{0,9}|0)\.?(\d{0,3})?/g))||((a=[])[0]=""),a[0]&&Number(a[0])<0&&(a[0]=0),a[0]+="",t.countNum=a[0]}},clearInput:function(t){t.canWrite||(t.countNum="")},ininList:function(t){var e=["普通商品","称重商品","自定义商品"];return t.map(function(t){return t.warehouseArea||(t.warehouseArea=t.areaName),t.countNum||(t.countNum=""),t.storeName=t.warehouse+"/"+t.warehouseArea,t.typeName=e[t.type],t.surplusUnit=t.surplus+t.unit,t.id=t.gid,t.batchId="0",t})},formatData:function(t){var e={new:[],old:[]},a=!0,n=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var s=i.value,u={batchId:s.batchId,wid:s.wid,areaId:s.areaId,surplus:s.countNum,itemId:s.id};e.new.push(u)}}catch(t){n=!0,r=t}finally{try{!a&&o.return&&o.return()}finally{if(n)throw r}}return e},delSameList:function(){var t=this;this.stateCountNum=this.stateCountNum.filter(function(e){var a=!0,n=!0,r=!1,i=void 0;try{for(var o,s=t.batchListNum[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(e.id==u.id){a=!1;break}}}catch(t){r=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return a})},mergeList:function(){var t,e;return(t=e=[].concat(i(this.stateCountNum))).push.apply(t,i(this.batchListNum)),this.formatData(e)},submitData:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},t.addStateCountNum(),t.delSameList(),n=t.mergeList(),(a=n.new).push.apply(a,i(n.old)),0!=n.new.length){e.next=8;break}return t.alert("请先填写盘库数量!"),e.abrupt("return");case 8:t.alert("确认盘库?",o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getHttp("GoodsinventoryBatchSetGoodsInventory",{data:n.new,type:0});case 2:e.sent.result?(t.alert("盘库成功!"),delete t.$route.query.id,t.$router.push({path:"/admin/goodsCountHistory",query:t.$route.query})):t.alert("盘库失败!");case 4:case"end":return e.stop()}},e,t)})));case 9:case"end":return e.stop()}},e,t)}))()},initBtn:function(){var t=this,e={height:"40px",color:"#fff"};this.$store.commit("setPageTools",[{name:"确认盘库",className:"yellow",style:e,fn:function(){t.submitData()}},{name:"添加商品",style:e,fn:function(){t.showAddGoodsCom=!0}},{name:"取消盘库",className:"gray",style:e,fn:function(){t.$router.go(-1)}}])},alert:function(t,e){var a={title:"温馨提示",content:t,winType:"alert"};"function"==typeof e&&(a.winType="confirm",a.callback=function(t){"ok"==t&&e()}),this.$store.commit("setWin",a)},isPrimitive:function(t){return"string"==typeof t||"number"==typeof t},toRawType:function(t,e){return Object.prototype.toString.call(t).slice(8,-1)==e},initPage:function(t,e,a){var n=(e-1)*a,r=e*a;return t.slice(n,r)},listGetAttr:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return t.map(function(t){return t[e]+""})},getHttp:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a[t]({data:a});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}},r,e)}))()}},components:{comTable:function(){return a.e("table").then(a.bind(null,"4360"))},batchWin:function(){return Promise.all([a.e("add_goods"),a.e("goods_count_batch_win")]).then(a.bind(null,"9031"))},addGoods:function(){return Promise.all([a.e("add_goods"),a.e("goods_count_batch_win")]).then(a.bind(null,"bd16"))},pageElement:function(){return a.e("page_element").then(a.bind(null,"5921"))}}},u=(a("c380"),a("d801")),c=Object(u.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"goods-count-history"}},[t.showAddGoodsCom?t._e():a("div",{staticClass:"content-body"},[a("com-table",{attrs:{showHand:!0,listName:"盘库商品列表",listHeight:70,showTitle:1,titleData:t.titleData,introData:t.nowList,allTotal:t.pageObj.listNum,fixed:0,bannerStyle:{color:"#333","font-size":"16px"},widthType:!0,listWidth:1435,contentStyle:{color:"#666",fontSize:"14px"}},scopedSlots:t._u([{key:"con-0",fn:function(e){var n=e.data;return e.index,a("div",{},[a("span",{staticClass:"operation-left line",on:{click:function(e){t.clearInput(n)}}},[t._v("清空")]),t._v(" "),a("span",{staticClass:"operation-right",on:{click:function(e){t.openWin(n)}}},[t._v("批量盘库")])])}},{key:"con-1",fn:function(e){var n=e.data,r=e.index;return a("div",{},[a("input",{directives:[{name:"model",rawName:"v-model",value:n.countNum,expression:"data.countNum"}],staticClass:"count-num",class:{canWrite:n.canWrite},attrs:{type:"text",readonly:n.canWrite,maxlength:"9",placeholder:"请输入数字"},domProps:{value:n.countNum},on:{input:[function(e){e.target.composing||t.$set(n,"countNum",e.target.value)},function(e){t.checkNum(n,r)}]}})])}}])}),t._v(" "),a("div",[a("page-element",{attrs:{page:t.pageObj.page,total:t.pageObj.total},on:{pageNum:t.getPageNum}})],1),t._v(" "),a(t.showCom,{tag:"component",attrs:{title:t.comObj.title,list:t.comObj.list,info:t.comObj.info},on:{emitEvent:t.closeWin}})],1),t._v(" "),t.showAddGoodsCom?a("add-goods",{attrs:{selObj:t.stateStore.addGoods},on:{emit:t.getGoodsWin}}):t._e()],1)},[],!1,null,"3985a43a",null);e.default=c.exports},a743:function(t,e,a){},c380:function(t,e,a){"use strict";var n=a("a743");a.n(n).a}}]);