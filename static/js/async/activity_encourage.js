(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_encourage"],{"31bf":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjFCQThBNjA5NTcxNTExRTdCNzI4QzVFQTBERTkzQkVEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjFCQThBNjBBNTcxNTExRTdCNzI4QzVFQTBERTkzQkVEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MUJBOEE2MDc1NzE1MTFFN0I3MjhDNUVBMERFOTNCRUQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MUJBOEE2MDg1NzE1MTFFN0I3MjhDNUVBMERFOTNCRUQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4kIzh0AAABmklEQVR42oyUTSgFURTHvdfzke+yYMNiUKOXyIKUCK9slJKPbGyUslBWVhIrK/UUexsLxEaRzxI2Sh4WJDNJsfGRFFHy/I/+U891Z8apX/d0z73/OXPuuTdgWVaSxppAN8cizt2AHbAAtp2FhmH8jCFFwASzoEYjXkL6QQz0gAsnGExY2ACOXURUqwQn3PNLSDJZBWkem8dAOwXEUsC6bdum82sBMAfSPUT2wTj9ZDBPPxUsQywsGTWDKp9fqQMdzHxYiZWBiGTU5SHwClbAPRgE9S7rhkI8Yp1tgiPWbo9zDyBPs7ZWfq1QE7hlzwyAAs5lsj46yxGhD00gF0yAA7DIuSjIdquBCN1p5jM49nLMB30etXwRoUOX4BR4pD/tc6qnQfaQau9glH4jj34GPLsITYrQBjhTAkuSLv03MEI/SyNiS4vI8cfZSzF2qlgpKGYNw6ATVGhEPkErXoC4c/vlFrcwO7lD1eDKpy4iEoHIuXr7d/nVy3/c/mtQzj1/nhEnM5PZrYEn8MWvS1dvgTZ5zxLfIrFvAQYAHHVSK1WxAuMAAAAASUVORK5CYII="},4342:function(t,e,s){},df39:function(t,e,s){"use strict";var i=s("4342");s.n(i).a},e701:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.showVip?s("memberScreening",{on:{selectVip:t.selectVipEvent}}):s("section",[s("div",{staticClass:"member-agift",attrs:{id:"consume"}},[t._m(0),t._v(" "),s("div",{staticClass:"main_Box",staticStyle:{overflow:"initial"}},[s("div",{staticClass:"agift-content"},[s("span",{staticClass:"fl required"},[t._v("活动标题")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.titles,expression:"titles"}],staticClass:"fl",attrs:{type:"text",placeholder:"请输入活动标题",maxlength:"20"},domProps:{value:t.titles},on:{input:function(e){e.target.composing||(t.titles=e.target.value)}}})]),t._v(" "),s("div",{staticClass:"agift-content clearfix",staticStyle:{overflow:"visible"}},[s("span",{staticClass:"fl required"},[t._v("活动时间")]),t._v(" "),s("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[s("calendar",{ref:"startCal",staticClass:"fl",attrs:{pObj:t.startObj},on:{throwTime:t.getStartTime}}),t._v(" "),s("span",{staticClass:"fl",staticStyle:{width:"40px","text-align":"center","margin-right":"0"}},[t._v("-")]),t._v(" "),s("calendar",{ref:"endCal",staticClass:"fl",attrs:{pObj:t.endObj},on:{throwTime:t.getEndTime}})],1),t._v(" "),s("span",{staticClass:"fl",staticStyle:{"text-align":"left","text-indent":"20px",color:"#A3A3A3"}},[t._v("共"+t._s(t.returnInt)+"天")])]),t._v(" "),s("div",{staticClass:"agift-content"},[s("span",{staticClass:"fl required"},[t._v("活动范围")]),t._v(" "),"3"==t.brandId?[s("div",{staticClass:"btn-concent",on:{click:t.openActivityWin}},[s("button",{staticClass:"fl increase",staticStyle:{width:"120px"}},[t._v("选择范围")])]),t._v(" "),t.selectsList.length>=1?s("span",{staticClass:"fl"},[t._v("已选择"+t._s(t.selectsList.length)+"家店铺")]):t._e()]:[s("span",{staticStyle:{width:"auto"}},[t._v(t._s(t.shopName))])]],2),t._v(" "),s("div",{staticClass:"agift-content"},[s("span",{staticClass:"fl"},[t._v("活动群体")]),t._v(" "),t._l(t.integralList,function(e,i){return s("span",{key:i,staticClass:"freeFix",class:{presentActive:t.integralOn==i},staticStyle:{"margin-right":"14px"},on:{click:function(e){t.chooseIntegral(i)}}},[t._v(t._s(e.name))])}),t._v(" "),1==t.integralOn?s("span",{staticClass:"associated"},[t._v("(已关联"+t._s(t.member)+"人)")]):t._e()],2)]),t._v(" "),t._m(1),t._v(" "),s("div",{staticClass:"mani_Box"},[s("div",{staticClass:"agift-content",staticStyle:{"padding-left":"120px",overflow:"inherit"}},[s("ul",[t._l(t.ruleList,function(e,i){return s("li",{key:i,class:t.ruleIndex==i?"on":"initial",on:{click:function(e){t.getDetails(i)}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t\t"),s("i",{staticClass:"deletes",on:{click:function(e){t.deleteRule(i)}}})])}),t._v(" "),t.ruleList.length<5?s("li",{staticClass:"adds",on:{click:t.addRule}},[t._v("新增规则")]):t._e()],2),t._v(" "),s("div",{staticClass:"content-set"},[s("div",{staticClass:"agift-content",staticStyle:{overflow:"initial",height:"40px","margin-top":"20px"}},[s("span",{staticClass:"fl"},[t._v("最低消费")]),t._v(" "),s("div",{staticClass:"fl selectList",on:{click:function(e){t.openSelect("1")}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.consumeName)+"\n\t\t\t\t\t\t\t"),t.isConsumeList?s("ul",t._l(t.consumeList,function(e,i){return s("li",{key:i,on:{click:function(s){t.getListDetail(e,i,"1")}}},[t._v(t._s(e.name))])})):t._e()]),t._v(" "),s("span",{staticClass:"fl moreBtn",staticStyle:{border:"1px solid #CCCCCC","border-left":"none",cursor:"pointer"},on:{click:function(e){t.openSelect("1")}}},[s("i")]),t._v(" "),1==t.minConsume?[s("input",{directives:[{name:"model",rawName:"v-model",value:t.minConsumess,expression:"minConsumess"}],staticClass:"fl",staticStyle:{width:"100px","margin-left":"10px"},attrs:{type:"text",placeholder:"请输入金额",maxlength:"6"},domProps:{value:t.minConsumess},on:{input:function(e){e.target.composing||(t.minConsumess=e.target.value)}}})]:t._e()],2),t._v(" "),s("div",{staticClass:"agift-content"},[s("span",{staticClass:"fl"},[t._v("最高消费")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.maxConsumes,expression:"maxConsumes"}],staticClass:"fl",staticStyle:{width:"138px",height:"40px"},attrs:{type:"text",placeholder:"请输入金额",maxlength:"6"},domProps:{value:t.maxConsumes},on:{input:function(e){e.target.composing||(t.maxConsumes=e.target.value)}}}),t._v(" "),s("span",{staticClass:"fl moreBtn",staticStyle:{border:"1px solid #CCCCCC","border-left":"none",cursor:"pointer","text-align":"center",color:"#999999"}},[t._v("元")])]),t._v(" "),s("div",{staticClass:"agift-content"},[s("span",{staticClass:"fl"}),t._v(" "),s("label",{staticClass:"fl"},[s("i",{class:t.ruleObj.isLoop?"chckOn":"",on:{click:t.isLoopFun}},[t._v("✓")])]),t._v(" "),s("p",{staticClass:"fl",staticStyle:{"font-size":"16px","margin-right":"10px"}},[t._v("循环赠送")]),t._v(" "),s("p",{staticClass:"fl",staticStyle:{color:"#999999","margin-top":"2px"}},[t._v("(满足交易额整数倍，发劵数同倍增加)")])]),t._v(" "),s("div",{staticClass:"agift-content",staticStyle:{overflow:"initial",height:"40px"}},[s("span",{staticClass:"fl"},[t._v("会员权益")]),t._v(" "),s("div",{staticClass:"fl selectList",on:{click:t.openSelect}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.onListName)+"\n\t\t\t\t\t\t\t"),t.isList?s("ul",t._l(t.lists,function(e,i){return s("li",{key:i,on:{click:function(s){t.getListDetail(e,i)}}},[t._v(t._s(e.name))])})):t._e()]),t._v(" "),s("span",{staticClass:"fl moreBtn",staticStyle:{border:"1px solid #CCCCCC","border-left":"none",cursor:"pointer"},on:{click:t.openSelect}},[s("i")])]),t._v(" "),0==t.memberRights?s("div",{staticClass:"agift-content"},[s("span",{staticClass:"fl"}),t._v(" "),s("div",{staticClass:"btn-concent",on:{click:t.openCouponWin}},[s("button",{staticClass:"fl increase",staticStyle:{width:"150px"}},[t._v("选择优惠劵")])]),t._v(" "),t.ruleObj.couponIds.length>=1?s("span",{staticClass:"fl"},[t._v("已选择"+t._s(t.ruleObj.couponIds.length)+"张")]):t._e()]):t._e(),t._v(" "),s("div",{staticClass:"agift-content",attrs:{id:"agift"}},[s("span",{staticClass:"fl"},[t._v("消息推送渠道")]),t._v(" "),s("mulSelect",{attrs:{styles:{backgroundColor:"rgb(247,247,247)"},list:t.list,selects:t.ruleObj.pushChannel,name:"name",keyName:"id"},on:{selOn:t.selOnSend}}),t._v(" "),s("span",{staticClass:"fl",staticStyle:{width:"auto",color:"#666666"}},[t._v("活动发布后将通过该渠道触发会员")])],1),t._v(" "),s("div",{staticClass:"agift-content"},[s("label",[s("span",{staticClass:"required required-none",staticStyle:{"vertical-align":"top","padding-top":"10px"}},[t._v("内容设置")]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.ruleObj.msgContent,expression:"ruleObj.msgContent"}],staticStyle:{width:"350px",height:"100px"},attrs:{placeholder:"内容设置",maxlength:"151"},domProps:{value:t.ruleObj.msgContent},on:{input:function(e){e.target.composing||t.$set(t.ruleObj,"msgContent",e.target.value)}}})]),t._v(" "),s("div",{staticClass:"limit"},[t._m(2),t._v(" "),t.msmStatus?s("p",{staticClass:"fl"},[t._v("您已输入"+t._s(t.ruleObj.msgContent.length)+"个字,目前发送"+t._s(Math.ceil(t.ruleObj.msgContent.length/60))+"条短信")]):t._e()]),t._v(" "),s("div",{staticClass:"limit"},[s("p",[t._v("引用参数:\n\t\t\t\t\t\t\t\t"),t._l(t.parameter,function(e,i){return s("a",{key:i,staticStyle:{color:"#FF9200"},on:{click:function(e){t.addParameter(i,1)}}},[t._v(t._s(e.name))])})],2)])])])]),t._v(" "),s("div",{staticClass:"agift-content"},[s("label",[s("span",{staticClass:"required required-none",staticStyle:{"vertical-align":"top","padding-top":"10px"}},[t._v("活动说明")]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.explain,expression:"explain"}],staticStyle:{width:"350px",height:"100px"},attrs:{placeholder:"请输入活动说明",maxlength:"151"},domProps:{value:t.explain},on:{input:function(e){e.target.composing||(t.explain=e.target.value)}}})]),t._v(" "),t._m(3)]),t._v(" "),s("div",{staticClass:"agift-content",staticStyle:{"padding-left":"60px"}},[s("a",{staticClass:"gray",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:t.closePage}},[t._v("取消")]),t._v(" "),"3"==t.brandId||"0"==t.brandId?s("a",{staticClass:"gray",staticStyle:{width:"200px",background:"#858585"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addActivity("0")}}},[t._v("保存")]):t._e(),t._v(" "),0==t.edit?s("a",{staticClass:"yellow",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addActivity("1")}}},[t._v("发布")]):t._e()])]),t._v(" "),t.showRang?s("rang",{attrs:{activityList:t.shopList,selectsList:t.selectsList},on:{winEvent:t.rangEvent,select:t.selectList}}):t._e(),t._v(" "),t.showCoupon?s("coupon",{attrs:{selectCoupon:t.ruleObj.couponIds},on:{winEvent:t.couponEvent}}):t._e()],1)])},n=[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"header_tit"},[e("span",[this._v("活动设置")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"header_tit"},[e("span",[this._v("营销规则设置")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"fl",staticStyle:{"margin-right":"102px"}},[e("img",{staticClass:"icon-i",attrs:{src:s("31bf")}}),this._v("限150字以内")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"limit"},[e("img",{staticClass:"icon-i",attrs:{src:s("31bf")}}),this._v("限150字以内")])}];i._withStripped=!0;var a=s("bbb9"),r=s("f6ce"),o=s("81a2");function l(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function i(n,a){try{var r=e[n](a),o=r.value}catch(t){return void s(t)}if(!r.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}("next")})}}var m=/[^\d]/g,u={data:function(){return{startObj:{time:a.a.getTime({time:new Date}).start},endObj:{time:(new Date).getTime()},dates:(new Date).getTime(),returnInt:1,list:[{name:"微信",id:"1"}],selects:[],msmStatus:!1,lists:[{name:"电子优惠劵",id:"1"},{name:"无",id:"2"}],consumeList:[{name:"不设限制"},{name:"指定额度"}],consumeName:"不设限制",isList:!1,isConsumeList:!1,onListName:"无",activityList:[],shopList:[],couponLists:[],memberRights:-1,minConsume:-1,isLoops:!1,Loops:"",ruleList:[{name:"规则1"}],brandId:0,ruleIndex:0,title:"",maxConsume:"",minConsumes:"",ruleObj:{minConsume:"",maxConsume:"",isLoop:!1,memberRights:"",couponIds:[],pushChannel:[],msgContent:""},ruleLists:[],compareArr:[],shopName:"",edit:!1,activityDetail:{},explain:"",parameter:[{name:"【会员姓名】",id:"{memberName}"},{name:"【优惠券名称】",id:"{couponName}"},{name:"【优惠券数量】",id:"{couponNum}"},{name:"【活动名称】",id:"{activityName}"},{name:"【消费日期】",id:"{salesTime}"}],showRang:!1,showCoupon:!1,selectsList:[],integralList:[{name:"默认全部"},{name:"会员筛选"}],integralOn:0,showVip:!1,member:"0",memfilter:"",memberStatus:!0}},methods:{selectList:function(t){this.selectsList=t},selOnSend:function(t){this.ruleObj.pushChannel=t},getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},openActivityWin:function(){this.showRang=!0},rangEvent:function(t){this.showRang=!1,t.selects&&(this.activityList=a.a.unique(t.selects))},couponEvent:function(t){this.showCoupon=!1,t.data.select&&"ok"==t.status&&(this.ruleObj.couponIds=t.data.select)},openCouponWin:function(){this.showCoupon=!0},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},addParameter:function(t){this.ruleObj.msgContent+=this.parameter[t].id},openSelect:function(t){"1"==t?(this.isConsumeList=!this.isConsumeList,this.isList=!1):(this.isList=!this.isList,this.isConsumeList=!1)},getListDetail:function(t,e,s){"1"==s?(this.minConsume=e,this.minConsumes=1==this.minConsume?this.minConsumes:"",this.ruleObj.minConsume=this.minConsumes,this.ruleLists[this.ruleIndex]=this.ruleObj,this.isLoops=Number(this.Loops),this.consumeName=t.name,1!=this.minConsume&&(this.Loops=!1,this.ruleObj.isLoop=this.Loops)):(this.onListName=t.name,this.memberRights=e,this.ruleObj.couponIds=1==this.memberRights?[]:this.ruleObj.couponIds,this.ruleLists.length>=1&&(this.ruleLists[this.ruleIndex].memberRights=Number(!this.memberRights)))},closePage:function(){this.$router.push("/admin/activity")},isLoopFun:function(){1==this.minConsume?this.ruleObj.isLoop=!this.ruleObj.isLoop:this.$store.commit("setWin",{content:"请输入最低消费金额",timerPowerOff:3e3})},getCouponList:function(t,e){for(var s=[],i=0;i<t.length;i++)for(var n=0;n<e.length;n++)t[i]==e[n].id&&s.push({id:e[n].id,name:e[n].name,micNum:"",micLimit:""});return s},addRule:function(){return"1"==this.minConsume&&this.ruleObj.minConsume<1?(this.$store.commit("setWin",{content:"请输入最低消费金额",timerPowerOff:1e3}),!1):"0"==this.memberRights&&a.a.isEmptyObject(this.ruleObj.couponIds)?(this.$store.commit("setWin",{content:"请选择优惠劵",timerPowerOff:1e3}),!1):5==this.ruleList.length?(this.$store.commit("setWin",{content:"最多只能添加5条规则",timerPowerOff:1e3}),!1):Number(this.maxConsume)>=1&&this.minConsumes>Number(this.maxConsume)?(this.$store.commit("setWin",{content:"最低消费不能大于最高消费",timerPowerOff:1e3}),this.minConsumes=0,this.ruleObj.minConsume=this.minConsumes,!1):Number(this.maxConsume)>=1&&Number(this.maxConsume)<Number(this.minConsumes)?(this.$store.commit("setWin",{content:"最高消费不能小于最低消费",timerPowerOff:1e3}),this.maxConsume=0,this.ruleObj.maxConsume=this.maxConsume,!1):(this.ruleObj.memberRights=Number(!this.memberRights),0==this.ruleIndex&&0==this.ruleLists.length&&this.ruleLists.push(this.ruleObj),this.ruleList.push({name:"规则"+(this.ruleList.length+1)}),this.minConsume=0,this.memberRights=0,this.minConsumes="",this.maxConsume="",this.onListName="电子优惠券",this.ruleObj={minConsume:"",maxConsume:"",isLoop:!1,memberRights:1,couponIds:[],pushChannel:[],msgContent:""},this.ruleLists.push(this.ruleObj),void(this.ruleIndex=this.ruleLists.length-1))},deleteRule:function(t){this.ruleList.splice(t,1);for(var e=0;e<this.ruleList.length;e++)this.ruleList[e].name="规则"+(e+1);this.ruleLists.splice(t,1),this.ruleIndex=this.ruleLists.length-1,this.ruleObj=this.ruleLists[this.ruleIndex]},getDetails:function(t){this.ruleObj=this.ruleLists[t],this.ruleIndex=t,this.maxConsume=this.ruleObj.maxConsume,this.minConsume=""!=this.ruleObj.minConsume&&this.ruleObj.minConsume>=1?1:0,this.memberRights=Number(!Number(this.ruleObj.memberRights)),this.onListName=0==this.memberRights?"电子优惠券":"无",Number(this.maxConsume)>0&&Number(this.minConsume)>0&&(this.consumeName="指定额度")},getCouponId:function(t,e){var s=void 0,i=[];for(t=1==e||a.a.isEmptyObject(t)?t:JSON.parse(t),s=0;s<t.length;s++)i.push(t[s].id);return i},addActivity:function(t){var e=this;return l(regeneratorRuntime.mark(function s(){var i,n;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(""!=e.title.trim()){s.next=3;break}return e.$store.commit("setWin",{content:"请填写活动标题",timerPowerOff:1e3}),s.abrupt("return",!1);case 3:if(!(e.endObj.time<(new Date).getTime())){s.next=6;break}return e.$store.commit("setWin",{content:"活动结束时间应大于当前时间",timerPowerOff:1e3}),s.abrupt("return",!1);case 6:if("3"!=e.brandId&&(e.selectsList=[],e.selectsList.push(e.userData.currentShop.id)),!a.a.isEmptyObject(e.selectsList)){s.next=10;break}return e.$store.commit("setWin",{content:"请选择活动范围",timerPowerOff:1e3}),s.abrupt("return",!1);case 10:if(!(Number(e.maxConsume)>=1&&e.minConsumes>Number(e.maxConsume))){s.next=15;break}return e.$store.commit("setWin",{content:"最低消费不能大于最高消费",timerPowerOff:1e3}),e.minConsumes=0,e.ruleLists[e.ruleIndex].minConsume=e.minConsumes,s.abrupt("return",!1);case 15:if(!(Number(e.maxConsume)>=1&&Number(e.maxConsume)<Number(e.minConsumes))){s.next=20;break}return e.$store.commit("setWin",{content:"最高消费不能小于最低消费",timerPowerOff:1e3}),e.maxConsume=0,e.ruleLists[e.ruleIndex].maxConsume=e.maxConsume,s.abrupt("return",!1);case 20:e.ruleLists[e.ruleIndex]=e.ruleObj,e.ruleLists[e.ruleIndex].memberRights=Number(!e.memberRights),0==e.ruleIndex&&0==e.ruleLists.length&&e.ruleLists.push(e.ruleObj),i=a.a.deepCopy(e.ruleLists),n=0;case 25:if(!(n<i.length)){s.next=38;break}if(i[n].isLoop=Number(i[n].isLoop),i[n].couponIds=i[n].couponIds,i[n].pushChannel&&(i[n].pushChannel=Number(i[n].pushChannel.toString().replace(/,/g,""))),!(i[n].minConsume>=1&&i[n].maxConsume>=1&&Number(i[n].minConsume)>Number(i[n].maxConsume))){s.next=32;break}return e.$store.commit("setWin",{content:"规则"+(n+1)+"最低消费大于最高消费,请修改！"}),s.abrupt("return",!1);case 32:if(!(i[n].minConsume>=1&&i[n].maxConsume>=1&&Number(i[n].maxConsume)<Number(i[n].minConsume))){s.next=35;break}return e.$store.commit("setWin",{content:"规则"+(n+1)+"最高消费小于最低消费,请修改！"}),s.abrupt("return",!1);case 35:n++,s.next=25;break;case 38:if(!e.edit){s.next=51;break}return e.activityDetail.name=e.title,e.activityDetail.explain=e.explain,e.activityDetail.shopIds=e.activityList.toString(),e.activityDetail.startTime=a.a.getTime({time:new Date(e.startObj.time),type:!1}).start,e.activityDetail.endTime=a.a.getTime({time:new Date(e.endObj.time),type:!1}).now,e.activityDetail.isAuto=t,e.activityDetail.rule=i,s.next=48,o.a.fissionActivity({data:{activityId:e.activityDetail.id,data:JSON.stringify(e.activityDetail)}});case 48:e.$store.commit("setWin",{content:"保存成功,1秒后跳转至活动列表",callback:function(){e.closePage()},timerPowerOff:1e3}),s.next=54;break;case 51:return s.next=53,o.a.fissionActivity({data:{shopIds:e.selectsList.toString(),type:3,name:e.title,mouldType:0,objectType:e.memberStatus?0==e.integralOn?"2":e.integralOn:4,memberIds:e.memfilter,memberNum:e.member,startTime:Math.round(e.startObj.time/1e3),endTime:Math.round(e.endObj.time/1e3),isAuto:t,getType:"0",explain:e.explain,rule:JSON.stringify(i)}});case 53:e.$store.commit("setWin",{content:"发布成功,1秒后跳转至活动列表",callback:function(){e.closePage()},timerPowerOff:1e3});case 54:case"end":return s.stop()}},s,e)}))()},getNoLimitCoupon:function(){var t=this;return l(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.getCouponCondition({data:{}});case 2:s=e.sent,t.compareArr=a.a.deepCopy(s);case 4:case"end":return e.stop()}},e,t)}))()},getActivityDetail:function(t){var e=this;return l(regeneratorRuntime.mark(function s(){var i,n,r;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,o.a.getActivityDetail({data:{aid:t.id,type:t.type,mouldType:t.mouldType}});case 2:if(i=s.sent,n=i,e.activityDetail=a.a.deepCopy(n),"3"==n.type){for(e.title=n.name,e.explain=n.explain,e.selectsList=n.shopIds?n.shopIds.split(","):[],e.startObj.time=Number(Math.round(1e3*n.startTime)),e.endObj.time=Number(Math.round(1e3*n.endTime)),e.ruleObj=a.a.deepCopy(n.rule[0]),e.ruleObj.couponIds=JSON.parse(e.ruleObj.couponIds),e.ruleObj.pushChannel=String(e.ruleObj.pushChannel).split(""),e.ruleObj.isLoop=Number(e.ruleObj.isLoop),e.minthiss=e.ruleObj.minthis,e.minthis=Number(Number(e.minthiss)),e.maxthis=e.ruleObj.maxthis,e.memberRights=Number(!Number(e.ruleObj.memberRights)),e.onListName=0==e.memberRights?"电子优惠劵":"无","4"==n.objectType?(e.integralOn=1,e.memberStatus=!1):e.integralOn="2"==n.objectType?0:n.objectType,e.memfilter=n.memberIds,e.member=n.sendProgress.split(",")[0],e.edit=!0,e.ruleList=[],r=0;r<n.rule.length;r++)e.ruleLists.push({id:n.rule[r].id,isLoop:Number(n.rule[r].isLoop),maxthis:n.rule[r].maxthis,memberRights:n.rule[r].memberRights,minthis:n.rule[r].minthis,msgContent:n.rule[r].msgContent,pushChannel:String(n.rule[r].pushChannel).split(""),couponIds:JSON.parse(n.rule[r].couponIds),maxConsume:n.rule[r].maxConsume,mixConsume:n.rule[r].mixConsume}),e.ruleList.push({name:"规则"+(r+1)});e.getNoLimitCoupon()}setTimeout(function(){e.$refs.startCal.initData(),e.$refs.endCal.initData()},200),e.getDetails(0);case 8:case"end":return s.stop()}},s,e)}))()},getShopList:function(){var t=this;return l(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.couGetShopList({data:{}});case 2:s=e.sent,t.shopList=s;case 4:case"end":return e.stop()}},e,t)}))()},chooseIntegral:function(t){this.integralOn=t,"1"==this.integralOn&&this.memberStatus&&this.addVip()},addVip:function(){this.showVip=!0},selectVipEvent:function(t){"ok"==t.status&&(this.member=t.member,this.memfilter=t.memfilter),this.showVip=!1}},computed:{titles:{get:function(){return this.title},set:function(t){this.title=t}},maxConsumes:{get:function(){return this.maxConsume},set:function(t){this.maxConsume=t.replace(m,""),this.ruleObj.maxConsume=this.maxConsume}},minConsumess:{get:function(){return this.minConsumes},set:function(t){this.minConsumes=t.replace(m,""),this.ruleObj.minConsume=this.minConsumes}}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange","ruleObj.pushChannel":function(){-1!=this.ruleObj.pushChannel.indexOf("2")?this.msmStatus=!0:this.msmStatus=!1},"ruleObj.msgContent":function(){this.ruleObj.msgContent.length>=150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.ruleObj.msgContent=this.ruleObj.msgContent.substr(0,150))},explain:function(){this.explain.length>=150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.explain=this.explain.substr(0,150))}},components:{calendar:function(){return s.e("calendar_result").then(s.bind(null,"9265"))},mulSelect:function(){return s.e("mul_select").then(s.bind(null,"7d09"))},rang:function(){return s.e("activity_agift_rang").then(s.bind(null,"5267"))},coupon:function(){return s.e("activity_agift_coupon").then(s.bind(null,"30d3"))},memberScreening:function(){return s.e("activity_screening").then(s.bind(null,"3b95"))}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){t.closePage()}}]),this.userData=r.a.session("userShop"),this.brandId=this.userData.currentShop.ischain,this.shopName=this.userData.currentShop.name,this.getShopList();var e=r.a.session("memberIds");e&&(this.integralOn=1,this.member=e.length,this.memfilter=e.join(","),this.memberStatus=!1);var s=r.a.session("activityInfo");s&&this.getActivityDetail(s),this.getShopList()},beforeDestroy:function(){r.a.session("activityInfo",null),r.a.session("memberIds",null)}},c=(s("df39"),s("7610")),h=Object(c.a)(u,i,n,!1,null,"315f7351",null);h.options.__file="src\\module\\marketing_tools\\activity_encourage.vue";e.default=h.exports}}]);