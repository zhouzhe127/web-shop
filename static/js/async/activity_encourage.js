(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_encourage"],{ce58:function(t,e,i){},da0d:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.showVip?i("memberScreening",{on:{selectVip:t.selectVipEvent}}):i("div",{staticClass:"member-agift",attrs:{id:"consume"}},[t._m(0),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动名称")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.titles,expression:"titles"}],staticClass:"name",attrs:{type:"text",placeholder:"请输入活动标题",maxlength:"10"},domProps:{value:t.titles},on:{input:function(e){e.target.composing||(t.titles=e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("活动时间")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[i("calendar",{ref:"startCal",staticClass:"fl",attrs:{pObj:t.startObj},on:{throwTime:t.getStartTime}}),t._v(" "),i("span",{staticClass:"fl lines"},[t._v("-")]),t._v(" "),i("calendar",{ref:"endCal",staticClass:"fl",attrs:{pObj:t.endObj},on:{throwTime:t.getEndTime}})],1),t._v(" "),i("span",{staticClass:"fl returnInt"},[t._v("共"+t._s(t.returnInt)+"天")])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动范围")]),t._v(" "),"3"==t.ischain?i("div",{staticClass:"rightHalf"},[i("a",{staticClass:"addclassify",attrs:{href:"javascript:void(0);"},on:{click:t.openActivityWin}},[t._v("关联门店")]),t._v(" "),t.selectsList.length>=1?i("span",[t._v("(已选择"+t._s(t.selectsList.length)+"家店铺)")]):t._e()]):i("div",{staticClass:"rightHalf"},[i("span",{staticClass:"obj"},[t._v(t._s(t.shopName))])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动对象")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("singleSelect",{key:"id",staticClass:"fl",attrs:{index:t.integralOn,styles:{width:"108px",border:"1px solid #cecdcd",marginRight:"8px"},list:t.integralList,name:"name"},on:{selOn:t.haveIndex}}),t._v(" "),1==t.integralOn?i("span",{staticClass:"fl associated"},[t._v("(已关联"+t._s(t.member)+"人)")]):t._e()],1)]),t._v(" "),t._m(1),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"}),t._v(" "),i("div",{staticClass:"rightHalf"},[i("ul",[t._l(t.ruleList,function(e,s){return i("li",{key:s,class:t.ruleIndex==s?"on":"initial",on:{click:function(e){t.getDetails(s)}}},[t._v("\n\t\t\t\t\t规则"+t._s(s+1)+"\n\t\t\t\t\t"),i("i",{staticClass:"deletes",on:{click:function(e){e.stopPropagation(),t.deleteRule(s)}}})])}),t._v(" "),t.ruleList.length<5?i("li",{staticClass:"adds",on:{click:t.addRule}},[t._v("新增规则")]):t._e()],2),t._v(" "),t._l(t.ruleList,function(e,s){return t.ruleIndex==s?i("div",{key:s,staticClass:"content-set"},[i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("最低消费")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("select-btn",{attrs:{name:e.durationName,sorts:t.durationList.map(function(t){return t.name}),width:189,showIndex:s},on:{selOn:t.selexpirationTime}})],1)]),t._v(" "),"1"==e.durationId?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("指定额度")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("section",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.minConsumess,expression:"item.minConsumess"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入金额",maxlength:"6",onkeyup:"value=value.replace(/[^\\d\\.]/g,'')"},domProps:{value:e.minConsumess},on:{blur:function(i){t.formatValue(e,"1")},input:function(i){i.target.composing||t.$set(e,"minConsumess",i.target.value)}}}),t._v(" "),i("span",[t._v("元")])])])]):t._e(),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("最高消费")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("section",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.maxConsumes,expression:"item.maxConsumes"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入金额",maxlength:"6",onkeyup:"value=value.replace(/[^\\d\\.]/g,'')"},domProps:{value:e.maxConsumes},on:{blur:function(i){t.formatValue(e,"2")},input:function(i){i.target.composing||t.$set(e,"maxConsumes",i.target.value)}}}),t._v(" "),i("span",[t._v("元")])])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"}),t._v(" "),i("div",{staticClass:"rightHalf",staticStyle:{"line-height":"40px"}},[i("div",{class:e.isLoop?"active check":"check",on:{click:function(i){t.isLoopFun(e)}}}),t._v(" "),i("p",{staticClass:"fl",staticStyle:{"font-size":"16px"}},[t._v("循环赠送")]),t._v(" "),t._m(2,!0)])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("会员权益")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("select-btn",{attrs:{name:e.interestName,sorts:t.interestList.map(function(t){return t.name}),width:189,showIndex:s},on:{selOn:t.selinterest}})],1)]),t._v(" "),"2"==e.interestId?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("关联优惠券")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("a",{staticClass:"addclassify",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(i){t.openCouponWin(e)}}},[t._v("选择关联优惠券")]),t._v(" "),e.couponIds.length>=1?i("span",[t._v("(已关联"+t._s(e.couponIds.length)+"张)")]):t._e()])]):t._e(),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("消息推送渠道")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("mulSelect",{staticClass:"fl",attrs:{styles:{backgroundColor:"rgb(240,240,240)"},list:t.list,selects:e.pushChannel,name:"name",keyName:"id"},on:{selOn:t.selOnSend}}),t._v(" "),t._m(3,!0)],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("内容设置")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msgContent,expression:"item.msgContent"}],attrs:{placeholder:"请输入内容设置",maxlength:"151"},domProps:{value:e.msgContent},on:{input:function(i){i.target.composing||t.$set(e,"msgContent",i.target.value)}}}),t._v(" "),t._m(4,!0),t._v(" "),i("div",{staticClass:"limit"},[i("p",[t._v("引用参数:\n\t\t\t\t\t\t\t\t"),t._l(t.parameter,function(e,s){return i("a",{key:s,staticStyle:{color:"#FF9200"},on:{click:function(e){t.addParameter(s,1)}}},[t._v(t._s(e.name))])})],2)])])])]):t._e()})],2)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("活动说明")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.explain,expression:"explain"}],attrs:{placeholder:"请输入活动说明",maxlength:"151"},domProps:{value:t.explain},on:{input:function(e){e.target.composing||(t.explain=e.target.value)}}}),t._v(" "),t._m(5)])]),t._v(" "),i("div",{staticClass:"agift-content",staticStyle:{"padding-left":"60px"}},[i("a",{staticClass:"gray",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:t.closePage}},[t._v("取消")]),t._v(" "),t.isactivityDetail?[i("a",{staticClass:"gray",staticStyle:{width:"200px",background:"#858585"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addActivity("0")}}},[t._v("保存")]),t._v(" "),0==t.edit?i("a",{staticClass:"yellow",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addActivity("1")}}},[t._v("发布")]):t._e()]:t._e()],2),t._v(" "),t.showRang?i("rang",{attrs:{activityList:t.shopList,selectsList:t.selectsList},on:{winEvent:t.rangEvent}}):t._e(),t._v(" "),t.showCoupon?i("coupon",{attrs:{selectCoupon:t.selectCoupon},on:{winEvent:t.couponEvent}}):t._e()],1)};s._withStripped=!0;var n=i("bbb9"),a=i("f6ce"),r=i("81a2");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function s(n,a){try{var r=e[n](a),o=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(o).then(function(t){s("next",t)},function(t){s("throw",t)});t(o)}("next")})}}var l={data:function(){return{startObj:{time:n.a.getTime({time:new Date}).start},endObj:{time:n.a.getTime({time:new Date}).end},dates:(new Date).getTime(),returnInt:1,list:[{name:"微信",id:"1"}],selects:[],msmStatus:!1,interestList:[{name:"无",id:1},{name:"电子优惠券",id:2}],interestName:"无",interestId:1,durationList:[{name:"不设限制",id:0},{name:"指定额度",id:1}],durationId:0,durationName:"不设限制",isList:!1,isConsumeList:!1,onListName:"无",activityList:[],shopList:[],couponLists:[],memberRights:-1,minConsume:-1,isLoops:!1,Loops:"",ruleList:[{durationName:"不设限制",durationId:0,minConsumess:"",maxConsumes:"",isLoop:!1,interestName:"无",interestId:1,couponIds:[],pushChannel:[],msgContent:""}],ischain:0,title:"",maxConsume:"",minConsumes:"",ruleObj:{minConsume:"",maxConsume:"",isLoop:!1,memberRights:"",couponIds:[],pushChannel:[],msgContent:""},ruleLists:[],compareArr:[],shopName:"",edit:!1,activityDetail:{},explain:"",parameter:[{name:"【会员姓名】",id:"{memberName}"},{name:"【优惠券名称】",id:"{couponName}"},{name:"【优惠券数量】",id:"{couponNum}"},{name:"【活动名称】",id:"{activityName}"},{name:"【消费日期】",id:"{salesTime}"}],showRang:!1,showCoupon:!1,selectsList:[],integralList:[{name:"默认全部"},{name:"会员筛选"}],integralOn:0,indexCustom:0,showVip:!1,member:"0",memfilter:"",memberStatus:!0,isactivityDetail:!0,ruleIndex:0,selectCoupon:[]}},methods:{haveIndex:function(t){this.integralOn=t,"1"==this.integralOn&&this.memberStatus&&this.addVip()},selOnSend:function(t){this.ruleList[this.ruleIndex].pushChannel=t},getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},valiData:function(t,e,i){this.$store.commit("setWin",{content:t,title:e,winType:i})},selexpirationTime:function(t,e){this.ruleList[e].durationName=this.durationList[t].name,this.ruleList[e].durationId=this.durationList[t].id,0==this.ruleList[e].durationId&&(this.ruleList[e].isLoop=!1)},selinterest:function(t,e){this.ruleList[e].interestName=this.interestList[t].name,this.ruleList[e].interestId=this.interestList[t].id},openActivityWin:function(){this.showRang=!0},rangEvent:function(t){"ok"==t.status&&(this.selectsList=t.select),this.showRang=!1},couponEvent:function(t){this.showCoupon=!1,t.data.select&&"ok"==t.status&&(this.ruleList[this.ruleIndex].couponIds=t.data.select)},openCouponWin:function(t){this.selectCoupon=t.couponIds,this.showCoupon=!0},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},addParameter:function(t){this.ruleList[t].msgContent+=this.parameter[t].id},closePage:function(){this.$router.push("/admin/activity/generalActivity")},isLoopFun:function(t){1==t.durationId?t.isLoop=!t.isLoop:this.valiData("请选择并填写最低消费金额")},formatValue:function(t,e){switch(e){case"1":t.minConsumess=n.a.toFloatStr(t.minConsumess,2);break;case"2":t.maxConsumes=n.a.toFloatStr(t.maxConsumes,2)}},addRule:function(){this.ruleList.push({durationName:"不设限制",durationId:0,minConsumess:"",maxConsumes:"",isLoop:!1,interestName:"无",interestId:1,couponIds:[],pushChannel:[],msgContent:""})},deleteRule:function(t){this.ruleIndex>=t&&(this.ruleIndex=0),this.ruleList.splice(t,1)},getDetails:function(t){this.ruleIndex=t},checkForm:function(){if(""==this.title)return this.valiData("请填写活动标题"),!1;if(this.endObj.time<(new Date).getTime())return this.valiData("活动结束时间应大于当前时间"),!1;if("3"==this.ischain&&0==this.selectsList.length)return this.valiData("请选择活动范围"),!1;for(var t=0;t<this.ruleList.length;t++){if(1==this.ruleList[t].durationId&&""==this.ruleList[t].minConsumess)return this.valiData("规则"+(t+1)+"请填写最低消费金额"),!1;if(1==this.ruleList[t].durationId&&""==this.ruleList[t].maxConsumes)return this.valiData("规则"+(t+1)+"请填写最高消费金额"),!1;if(1==this.ruleList[t].durationId&&Number(this.ruleList[t].minConsumess)>Number(this.ruleList[t].maxConsumes))return this.valiData("规则"+(t+1)+"最低消费金额不能大于最高消费金额"),!1;if(2==this.ruleList[t].interestId&&0==this.ruleList[t].couponIds.length)return this.valiData("规则"+(t+1)+"请关联优惠券"),!1}return!0},addActivity:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var s,n,a,o,l,c,u,m,d;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e.checkForm()){i.next=2;break}return i.abrupt("return");case 2:for(s=[],n=!0,a=!1,o=void 0,i.prev=6,l=e.ruleList[Symbol.iterator]();!(n=(c=l.next()).done);n=!0)u=c.value,m={minConsume:u.minConsumess,maxConsume:u.maxConsumes,isLoop:Number(u.isLoop),memberRights:u.durationId,couponIds:2==u.interestId?u.couponIds:[],pushChannel:u.pushChannel.join(","),msgContent:u.msgContent},u.id&&""!=u.id&&(m.id=u.id),s.push(m);i.next=14;break;case 10:i.prev=10,i.t0=i.catch(6),a=!0,o=i.t0;case 14:i.prev=14,i.prev=15,!n&&l.return&&l.return();case 17:if(i.prev=17,!a){i.next=20;break}throw o;case 20:return i.finish(17);case 21:return i.finish(14);case 22:if(!e.edit){i.next=34;break}return e.activityDetail.name=e.title,e.activityDetail.explain=e.explain,e.activityDetail.shopIds="3"==e.ischain?e.selectsList.join(","):e.shopId,e.activityDetail.startTime=Math.round(e.startObj.time/1e3),e.activityDetail.endTime=Math.round(e.endObj.time/1e3),e.activityDetail.isAuto=t,e.activityDetail.rule=s,i.next=32,r.a.fissionActivity({data:{activityId:e.activityDetail.id,data:JSON.stringify(e.activityDetail)}});case 32:i.next=36;break;case 34:return i.next=36,r.a.fissionActivity({data:{shopIds:e.selectsList.toString(),type:3,name:e.title,mouldType:0,objectType:e.memberStatus?0==e.integralOn?"2":e.integralOn:4,memberIds:e.memfilter,memberNum:e.member,startTime:Math.round(e.startObj.time/1e3),endTime:Math.round(e.endObj.time/1e3),isAuto:t,getType:"0",explain:e.explain,rule:JSON.stringify(s)}});case 36:d="0"==t?"保存成功":"发布成功",e.valiData(d),e.closePage();case 39:case"end":return i.stop()}},i,e,[[6,10,14,22],[15,,17,21]])}))()},getNoLimitCoupon:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.getCouponCondition({data:{}});case 2:i=e.sent,t.compareArr=n.a.deepCopy(i);case 4:case"end":return e.stop()}},e,t)}))()},getActivityDetail:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var s,a,o,l,c,u,m,d,h,v,p,f,g,C;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.a.newgetActivityDetail({data:{activityId:t.id,type:t.type,mouldType:t.mouldType}});case 2:for(s=i.sent,a=s,e.activityDetail=n.a.deepCopy(a),e.title=a.name,e.explain=a.explain,e.selectsList=a.shopIds.split(","),e.startObj.time=Number(Math.round(1e3*a.startTime)),e.endObj.time=Number(Math.round(1e3*a.endTime)),e.ruleList=[],o=a.rule,l=!0,c=!1,u=void 0,i.prev=15,m=o[Symbol.iterator]();!(l=(d=m.next()).done);l=!0)h=d.value,v="",p="",f=1,"0"==h.memberRights?v="不设限制":"1"==h.memberRights&&(v="指定额度"),0==(g=JSON.parse(h.couponIds)).length?(p="无",f=1):(p="电子优惠券",f=2),C={id:h.id,durationName:v,durationId:h.memberRights,minConsumess:h.minConsume,maxConsumes:h.maxConsume,isLoop:Boolean(Number(h.isLoop)),interestName:p,interestId:f,couponIds:g,pushChannel:h.pushChannel.split(","),msgContent:h.msgContent},e.ruleList.push(C);i.next=23;break;case 19:i.prev=19,i.t0=i.catch(15),c=!0,u=i.t0;case 23:i.prev=23,i.prev=24,!l&&m.return&&m.return();case 26:if(i.prev=26,!c){i.next=29;break}throw u;case 29:return i.finish(26);case 30:return i.finish(23);case 31:"4"==a.objectType?(e.integralOn=1,e.memberStatus=!1):e.integralOn="2"==a.objectType?0:a.objectType,e.memfilter=a.memberIds,e.member=a.sendProgress.split(",")[0],e.edit=!0;case 35:case"end":return i.stop()}},i,e,[[15,19,23,31],[24,,26,30]])}))()},getShopList:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.couGetShopList({data:{}});case 2:i=e.sent,t.shopList=i;case 4:case"end":return e.stop()}},e,t)}))()},chooseIntegral:function(t){this.integralOn=t,"1"==this.integralOn&&this.memberStatus&&this.addVip()},addVip:function(){this.showVip=!0},selectVipEvent:function(t){"ok"==t.status&&(this.member=t.member,this.memfilter=t.memfilter),this.showVip=!1}},computed:{titles:{get:function(){return this.title},set:function(t){this.title=t}}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange","ruleObj.msgContent":function(){this.ruleObj.msgContent.length>=150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.ruleObj.msgContent=this.ruleObj.msgContent.substr(0,150))},explain:function(){this.explain.length>=150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.explain=this.explain.substr(0,150))}},components:{calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))},mulSelect:function(){return i.e("mul_select").then(i.bind(null,"7d09"))},rang:function(){return i.e("activity_agift_rang").then(i.bind(null,"4b40"))},coupon:function(){return i.e("activity_agift_coupon").then(i.bind(null,"c8cd"))},memberScreening:function(){return i.e("activity_screening").then(i.bind(null,"1e4a"))},singleSelect:function(){return i.e("mul_select").then(i.bind(null,"7231"))},selectBtn:function(){return i.e("select_btn").then(i.bind(null,"3d41"))}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){t.closePage()}}]),this.userData=a.a.session("userShop"),this.ischain=this.userData.currentShop.ischain,this.shopName=this.userData.currentShop.name,this.getShopList();var e=a.a.session("memberIds");e&&(this.integralOn=1,this.member=e.length,this.memfilter=e.join(","),this.memberStatus=!1);var i=a.a.session("activityInfo");i&&(i.isShowdetail&&(this.isactivityDetail=!1),this.getActivityDetail(i)),this.getShopList()},beforeDestroy:function(){a.a.session("activityInfo",null),a.a.session("memberIds",null),a.a.session("activityDetail",null)}},c=(i("fbd1"),i("6ceb")),u=Object(c.a)(l,s,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("活动设置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("营销规则设置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 满足交易额整数倍，发劵数同倍增加\n\t\t\t\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 活动发布后将通过该渠道触发会员\n\t\t\t\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bluehandle-tips"},[e("i"),this._v(" 活动发布后将通过该渠道触发会员\n\t\t\t\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bluehandle-tips"},[e("i"),this._v(" 限150字以内\n\t\t\t")])}],!1,null,"1312fbe7",null);u.options.__file="src\\module\\marketing_tools\\new_activity\\activity_encourage.vue";e.default=u.exports},fbd1:function(t,e,i){"use strict";var s=i("ce58");i.n(s).a}}]);