(window.webpackJsonp=window.webpackJsonp||[]).push([["order_constructions"],{2713:function(t,e,a){},3976:function(t,e,a){"use strict";var i=a("2713");a.n(i).a},"98b4":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"proprietary"}},[t.showdetail?a("section",[a("order-detail",{attrs:{oid:t.oid,constructionsId:t.shopIds},on:{orderdetailResult:t.getdetailresult}})],1):a("section",[a("div",{staticClass:"button"},[a("a",{attrs:{href:"javascript:void(0);"},on:{click:t.toOrder}},[t._v("堂吃")]),t._v(" "),a("a",{attrs:{href:"javascript:void(0);"},on:{click:t.toTakeout}},[t._v("外卖")]),t._v(" "),a("a",{staticClass:"select",attrs:{href:"javascript:void(0);"}},[t._v("自营外卖")])]),t._v(" "),a("div",{staticClass:"filter clearfix"},[a("section",{staticClass:"fl",staticStyle:{height:"40px","margin-bottom":"20px","line-height":"40px"}},[a("section",{staticClass:"tableListInp fl"},[a("calendar",{attrs:{pObj:t.startObj},on:{throwTime:t.getStartTime}})],1),t._v(" "),a("span",{staticClass:"fl line"},[t._v("-")]),t._v(" "),a("section",{staticClass:"tableListInp fl"},[a("calendar",{attrs:{pObj:t.endObj},on:{throwTime:t.getEndTime}})],1),t._v(" "),a("span",{staticClass:"order-order-searchA fl",on:{click:function(e){t.takeoutOrderQuery()}}},[a("span",{staticClass:"order-order-search",attrs:{href:"javascript:void(0)"}})])]),t._v(" "),a("div",{staticClass:"orderNum fl"},[a("div",{staticClass:"checkBox",class:{selected:t.isOpenTime},on:{click:t.selectBusinessHours}}),t._v(" "),a("span",{staticStyle:{"font-size":"16px"}},[t._v("按营业时间")])]),t._v(" "),a("div",{staticClass:"orderNum fl"},[a("span",{staticClass:"title fl"},[t._v("订单号")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.oidnum,expression:"oidnum"}],staticClass:"fl",attrs:{type:"text",placeholder:"订单号",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.oidnum},on:{input:function(e){e.target.composing||(t.oidnum=e.target.value)}}}),t._v(" "),a("span",{staticClass:"order-order-searchA fl",on:{click:t.getOrderByMobileOrOid}},[a("span",{staticClass:"order-order-search",attrs:{href:"javascript:void(0)"}})])]),t._v(" "),a("div",{staticClass:"orderNum fl"},[a("span",{staticClass:"title fl"},[t._v("手机号")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.phonenum,expression:"phonenum"}],staticClass:"fl",attrs:{type:"text",placeholder:"手机号",maxlength:"11",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.phonenum},on:{input:function(e){e.target.composing||(t.phonenum=e.target.value)}}}),t._v(" "),a("span",{staticClass:"order-order-searchA fl",on:{click:t.getOrderByMobileOrOid}},[a("span",{staticClass:"order-order-search",attrs:{href:"javascript:void(0)"}})])]),t._v(" "),a("div",{staticClass:"search-box fl"},[a("span",{staticClass:"reset-btn gray",on:{click:function(e){t.resetting()}}},[t._v("重置")])])]),t._v(" "),a("div",{staticClass:"compared"},t._l(t.payWays,function(e,i){return a("span",{key:i,class:{effect:t.payType==e.id},on:{click:function(a){t.changeRadio(e)}}},[t._v(t._s(e.name))])})),t._v(" "),"moreday"==t.showType?a("section",[a("section",{staticStyle:{"margin-bottom":"20px"}},[a("com-table",{attrs:{listHeight:80,listWidth:1400,showHand:!1,titleData:t.titleList,introData:t.staticLists},scopedSlots:t._u([{key:"con-6",fn:function(e){return a("div",{},[t._v("\n\t\t\t\t\t\t"+t._s(e.data.totalVouchersPain)+"("+t._s(e.data.totalVouchersNum)+"张)\n\t\t\t\t\t")])}}])})],1),t._v(" "),a("section",[a("com-table",{key:t.index,attrs:{listHeight:80,listWidth:1400,showHand:!0,titleData:t.shoptitleList,introData:t.formList,listName:"外卖统计",showTitle:1,allTotal:t.allFormList.length},scopedSlots:t._u([{key:"con-0",fn:function(e){return a("div",{on:{click:function(a){t.getDetail(e.data)}}},[t._v("\n\t\t\t\t\t\t查看详情\n\t\t\t\t\t")])}},{key:"con-7",fn:function(e){return a("div",{},[t._v("\n\t\t\t\t\t\t"+t._s(e.data.totalVouchersPain)+"("+t._s(e.data.totalVouchersNum)+"张)\n\t\t\t\t\t")])}}])})],1),t._v(" "),a("section",{staticClass:"turn-page"},[a("pageElement",{attrs:{page:Number(t.page),total:Number(t.endTotal),numArr:[10,20,30,40,50],isNoJump:!0},on:{pageNum:t.getPageNum}})],1)]):t._e(),t._v(" "),"oneday"==t.showType?a("section",[a("scancode-order",{attrs:{constructionsId:t.shopIds,oneData:t.oneData,taskId:t.taskId,payType:t.payType},on:{scanorderResult:t.getscanorder}})],1):t._e(),t._v(" "),"phone"==t.showType?a("section",[a("phone-order",{attrs:{phoneOroidList:t.phoneOroidList},on:{phoneResult:t.getphoneresult}})],1):t._e()])])};i._withStripped=!0;var n=a("81a2"),s=a("f6ce"),r=a("05dd");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function i(n,s){try{var r=e[n](s),o=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(o).then(function(t){i("next",t)},function(t){i("throw",t)});t(o)}("next")})}}var l={data:function(){return{index:null,page:1,num:10,endTotal:1,startObj:{time:(new Date).setHours(0,0,0,0),width:170},endObj:{time:(new Date).setHours(23,59,59,999),width:170},payWays:[{id:0,name:"已完成"},{id:1,name:"已取消/退单"}],payType:0,titleList:[{titleName:"天数",dataName:"days"},{titleName:"订单数",dataName:"totalOrderNum"},{titleName:"销量 ",dataName:"totalSales"},{titleName:"赠品数",dataName:"totalGift"},{titleName:"配送总额",dataName:"totalMoveFee"},{titleName:"优惠总额",dataName:"totalDiscount"},{titleName:"代金券"},{titleName:"消费总额",dataName:"totalConsumption"},{titleName:"微信支付",dataName:"totalWeChatPain"},{titleName:"会员支付",dataName:"totalMemberPain"},{titleName:"积分抵扣总额",dataName:"totalPointCash"},{titleName:"实收总额",dataName:"totalPain"}],staticLists:[],shoptitleList:[{titleName:"操作",conStyle:{color:"#27a8e0",cursor:"pointer"}},{titleName:"日期 ",dataName:"day"},{titleName:"订单数",dataName:"totalOrderNum"},{titleName:"销量",dataName:"totalSales"},{titleName:"赠品数",dataName:"totalGift"},{titleName:"配送金额",dataName:"totalMoveFee"},{titleName:"优惠总额",dataName:"totalDiscount"},{titleName:"代金券"},{titleName:"消费金额",dataName:"totalConsumption"},{titleName:"微信支付",dataName:"totalWeChatPain"},{titleName:"会员支付",dataName:"totalMemberPain"},{titleName:"积分抵扣总额",dataName:"totalPointCash"},{titleName:"实收金额",dataName:"totalPain"}],allFormList:[],formList:[],isOpenTime:!1,shopIds:null,timer:"",timeout:"",taskId:"",timerqueue:[],isloadingstatus:!1,loading:!1,oneData:"",showdetail:!1,oid:"",oidnum:"",phonenum:"",showType:"moreday",phoneOroidList:[]}},methods:{getStartTime:function(t){this.startObj.time=new Date(t).getTime()},getEndTime:function(t){this.endObj.time=new Date(t).getTime()},changeRadio:function(t){var e=t.id;this.payType=e,this.takeoutOrderQuery()},getPageNum:function(t){this.page=t.page,this.num=t.num,this.setPage()},setPage:function(){this.endTotal=Math.ceil(this.allFormList.length/this.num);var t=(this.page-1)*this.num,e=this.page*this.num,a=this.allFormList.slice(t,e);this.formList=a},selectBusinessHours:function(){this.isOpenTime=!this.isOpenTime},checkData:function(){return this.endObj.time-this.startObj.time>r.a.timeConst.THREEMONTHS?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"只能查询间隔三个月的数据"}),!1):this.startObj.time-this.endObj.time>0?(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"查询时间选择错误"}),!1):1!=this.loading||(this.$store.commit("setWin",{title:"提示信息",winType:"alert",content:"正在搜索,请勿重复点击"}),!1)},takeoutOrderQuery:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.checkData()){e.next=2;break}return e.abrupt("return");case 2:return t.$store.commit("setPageTools",{}),t.showType="moreday",t.loading=!0,t.isloadingstatus=!1,e.next=8,n.a.takeoutOrderQuery({data:{shopIds:t.shopIds,isOpenTime:Number(t.isOpenTime),startTime:parseInt(t.startObj.time/1e3),endTime:parseInt(t.endObj.time/1e3),orderStatus:t.payType}});case 8:(a=e.sent)&&(t.taskId=a,t.timer=setInterval(function(){t.getTaskStatus(a)},2e3));case 10:case"end":return e.stop()}},e,t)}))()},getTaskStatus:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.getScanTaskStatus({data:{taskId:t}});case 2:if(i=a.sent,e.timeout=setTimeout(function(){if(!e.isloadingstatus){for(e.loading=!1,e.$store.commit("setWin",{content:"页面加载失败,请重新加载",title:"操作提示",winType:"alert"}),clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());return!1}},1e4),e.timerqueue.push(e.timeout),1==i){for(clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());e.getTakeoutData(t)}case 6:case"end":return a.stop()}},a,e)}))()},getTakeoutData:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.getTakeoutData({data:{taskId:t,showDetail:1,showShopId:e.shopIds,showDay:""}});case 2:(i=a.sent)&&(e.loading=!1,e.isloadingstatus=!0,1==i.days.length&&(e.showType="oneday",e.oneData=i.days[0].day),e.staticLists=[],e.staticLists.push(i.total),e.allFormList=i.days,e.$nextTick(function(){e.setPage()}));case 4:case"end":return a.stop()}},a,e)}))()},getscanorder:function(t,e){this.showType=t,e&&(this.oid=e.oid,this.showdetail=e.showdetail)},getphoneresult:function(t,e){this.showType=t,e&&(this.oid=e.oid,this.showdetail=e.showdetail)},resetting:function(){this.phonenum="",this.oidnum="",this.startObj.time=(new Date).setHours(0,0,0,0),this.endObj.time=(new Date).setHours(23,59,59,999),this.isOpenTime=!1,this.takeoutOrderQuery()},getDetail:function(t){this.showType="oneday",this.oneData=t.day},getdetailresult:function(t){this.showdetail=t,"phone"==this.showType&&this.$store.commit("setPageTools",{})},toOrder:function(){this.$router.push({path:"/admin/orderStatistics/orderMore",query:this.$route.query})},toTakeout:function(){this.$router.push({path:"/admin/orderStatistics/orderTakeaway",query:this.$route.query})},getOrderByMobileOrOid:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.getOrderByMobileOrOid({data:{mobile:t.phonenum,oid:t.oidnum}});case 2:a=e.sent,t.phoneOroidList=a,t.showType="phone";case 5:case"end":return e.stop()}},e,t)}))()}},watch:{},components:{calendar:function(){return a.e("calendar_result").then(a.bind(null,"9265"))},pageElement:function(){return a.e("page_element").then(a.bind(null,"5921"))},comTable:function(){return a.e("table").then(a.bind(null,"4360"))},oneshopStatics:function(){return a.e("order_proprietary_shopstatistics").then(a.bind(null,"1495"))},"scancode-order":function(){return a.e("order_constructions_one").then(a.bind(null,"7244"))},"order-detail":function(){return a.e("delivery_detail").then(a.bind(null,"c15a"))},"phone-order":function(){return a.e("order_constructions_phoneoroid").then(a.bind(null,"6798"))}},created:function(){var t={titleStyle:{fontSize:"16px"}},e={conStyle:{color:"#ff9800"}},a=!0,i=!1,n=void 0;try{for(var s,r=this.titleList[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var o=s.value;Object.assign(o,t,e)}}catch(t){i=!0,n=t}finally{try{!a&&r.return&&r.return()}finally{if(i)throw n}}var l=!0,u=!1,c=void 0;try{for(var d,m=this.shoptitleList[Symbol.iterator]();!(l=(d=m.next()).done);l=!0){var h=d.value;Object.assign(h,t)}}catch(t){u=!0,c=t}finally{try{!l&&m.return&&m.return()}finally{if(u)throw c}}},mounted:function(){this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(23,59,59,999),this.shopIds=s.a.session("userShop").currentShop.id,this.takeoutOrderQuery()},destroyed:function(){clearInterval(this.timer),clearTimeout(this.timeout)}},u=(a("3976"),a("6ceb")),c=Object(u.a)(l,i,[],!1,null,"bdfff79c",null);c.options.__file="src\\module\\statistics\\order_constructions.vue";e.default=c.exports}}]);