(window.webpackJsonp=window.webpackJsonp||[]).push([["warehouse_count"],{"0272":function(t,e,i){"use strict";var n=i("2527");i.n(n).a},2527:function(t,e,i){},"619f":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"warehouse-count"}},[i("div",{staticClass:"split-title"},[t._v("\n\t\t\t盘库\n\t\t\t"),i("span",{staticClass:"slide-up",on:{click:function(e){t.slideUp=!t.slideUp}}},[t._v(t._s(t.slideUp?"收起":"展开"))])]),t._v(" "),i("div",{staticClass:"detail-body"},[i("li",{staticClass:"small-li"},[t._v("物料名称 : "+t._s(t.material.name))]),t._v(" "),i("li",[t._v("分类 : \n\t\t\t\t"),t._l(t.material.cate,function(e,n){return i("i",{key:n},[t._v(t._s(e.name)),n!=t.material.cate.length-1?i("i",[t._v(",")]):t._e()])})],2),t._v(" "),i("li",[t._v("备注\n\t\t\t\t"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.remark,expression:"remark"}],staticClass:"note",attrs:{type:"text",placeholder:"请填写备注信息,限40字以内",maxlength:"40"},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value)}}})]),t._v(" "),t.slideUp?[i("li",{staticClass:"small-li"},[t._v("物料简码 : "+t._s(t.material.BC))]),t._v(" "),i("li",[t._v("物料单位 : \n\t\t\t\t\t"),t._l(t.material.unit,function(e,n){return i("i",{key:n},[t._v(t._s(e.name)),n!=t.material.unit.length-1?i("i",[t._v(",")]):t._e()])})],2),t._v(" "),i("li",{class:{"to-block":t.material.unit.length>2}},[t._v("单位换算 : \n\t\t\t\t\t"),t._l(t.material.unit,function(e,n){return t.material.unit.length>1?i("i",{key:n},[t._v("\n                        1"+t._s(e.name)+"="+t._s(e.value)+t._s(t.material.minUnit)+"\n                        "),n!=t.material.unit.length-1?i("i",[t._v("|")]):t._e()]):t._e()}),t._v(" "),t._l(t.material.unit,function(e,n){return 1==t.material.unit.length?i("i",{key:n},[t._v("\n                        1"+t._s(e.name)+"="+t._s(e.value)+t._s(e.name)+"\n                    ")]):t._e()})],2),t._v(" "),i("li",{staticClass:"small-li"},[t._v("品牌 : "+t._s(t.material.brandName))]),t._v(" "),i("li",[t._v("默认单位 : \n\t\t\t\t\t"),t._l(t.material.unit,function(e,n){return 1==e.isDefault?i("i",{key:n},[t._v(t._s(e.name))]):t._e()})],2),t._v(" "),i("li",[t._v("操作人 : "+t._s(t.userName))]),t._v(" "),i("li",{staticClass:"small-li"},[t._v("保质期 : "+t._s(t.material.validity)+t._s(t.material.validityName))]),t._v(" "),i("li",[t._v("最小单位 : \n\t\t\t\t\t"),t._l(t.material.unit,function(e,n){return 1==e.isMin?i("i",{key:n},[t._v(t._s(e.name))]):t._e()})],2)]:t._e()],2),t._v(" "),i("div",{staticClass:"filter-condition"},[i("div",{staticClass:"hide-content"},[i("div",{staticClass:"inline-block"},[t._v("\n\t\t\t\t\t"+t._s(t.cond[t.selectCond])+":\n\t\t\t\t\t"),i("calendar",{staticStyle:{"vertical-align":"middle"},attrs:{pObj:t.startTime},on:{throwTime:function(e){t.getTime("startTime",e)}}}),t._v("\n\t\t\t\t\t - \n\t\t\t\t\t"),i("calendar",{staticStyle:{"vertical-align":"middle"},attrs:{pObj:t.endTime},on:{throwTime:function(e){t.getTime("endTime",e)}}})],1),t._v(" "),i("div",{staticClass:"inline-block"},[i("mul-select",{attrs:{width:180,sorts:t.cond,name:t.cond[t.selectCond]},on:{emit:t.getCondIndex}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchCode,expression:"searchCode"}],staticClass:"input input-common",attrs:{type:"text",placeholder:"请输入批次编号"},domProps:{value:t.searchCode},on:{input:function(e){e.target.composing||(t.searchCode=e.target.value)}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchSupplier,expression:"searchSupplier"}],staticClass:"input input-common",attrs:{type:"text",placeholder:"请输入供应商"},domProps:{value:t.searchSupplier},on:{input:function(e){e.target.composing||(t.searchSupplier=e.target.value)}}})],1),t._v(" "),i("div",{staticClass:"inline-block"},[i("span",{staticClass:"blue btn-common filter-btn",on:{click:function(e){t.filterMaterialList(null)}}},[t._v("筛选")]),t._v(" "),i("span",{staticClass:"gray btn-common",on:{click:t.resetData}},[t._v("重置")]),t._v(" "),i("div",{staticClass:"unit-change"},[i("mul-select",{attrs:{width:180,sorts:t.relationUnitName,name:"单位切换"},on:{emit:t.getSelectUnit}})],1)])])]),t._v(" "),i("div",{staticStyle:{overflow:"auto"}},[i("div",{staticClass:"table"},[i("div",{staticClass:"table-title"},[t._v("\n\t\t\t\t\t批次列表"),i("span",{staticClass:"circle"}),t._v("共"),i("span",{staticClass:"tips-num"},[t._v(t._s(t.tempList.length))]),t._v("个条目\n\t\t\t\t")]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"table-body"},t._l(t.nowList,function(e,n){return i("div",{key:n,staticClass:"table-row",class:{"error-flag":e.errorFlag}},[i("li",[t._v(t._s(e.itemIndex))]),t._v(" "),i("li",[t._v(t._s(e.batchCode))]),t._v(" "),i("li",{staticClass:"big-li"},[t._v(t._s(e.NewSurplus))]),t._v(" "),i("li",{staticClass:"big-li"},[i("div",{staticClass:"input-div"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.maxNum,expression:"item.maxNum"}],attrs:{type:"text",maxlength:"9",placeholder:"输入数字"},domProps:{value:e.maxNum},on:{input:function(i){i.target.composing||t.$set(e,"maxNum",i.target.value)}}}),t._v(" "),i("span",{attrs:{title:t.selectUnit.name}},[t._v(t._s(t.selectUnit.name))])]),t._v(" "),t.materialMinUnit.id!=t.selectUnit.id?[t._v("\n\t\t\t\t\t\t\t\t+\n\t\t\t\t\t\t\t")]:t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.materialMinUnit.id!=t.selectUnit.id,expression:"materialMinUnit.id!=selectUnit.id"}],staticClass:"input-div"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.minNum,expression:"item.minNum"}],attrs:{type:"text",maxlength:"9",placeholder:"输入数字"},domProps:{value:e.minNum},on:{input:function(i){i.target.composing||t.$set(e,"minNum",i.target.value)}}}),t._v(" "),i("span",{attrs:{title:t.materialMinUnit.name}},[t._v(t._s(t.materialMinUnit.name))])])],2),t._v(" "),i("li",[t._v(t._s(t._f("formatTimeStamp")(e.productionTime)))]),t._v(" "),i("li",{staticClass:"big-li"},[t._v(t._s(e.supplier))]),t._v(" "),i("li",[t._v(t._s(e.purchasePrice)+" / "+t._s(e.purchaseUnit?e.purchaseUnit.name:"进价单位不存在"))]),t._v(" "),i("li",[t._v(t._s(e.wName)+" / "+t._s(e.aName))])])})),t._v(" "),0==t.tempList.length?i("div",{staticClass:"tip-div"},[t._v("\n\t\t\t\t\t无批次信息\n\t\t\t\t")]):t._e()])]),t._v(" "),i("div",{staticClass:"page-container"},[i("pageElement",{attrs:{page:t.currentPage,total:t.total,num:t.num,isNoPaging:!1,isNoJump:!0},on:{pageNum:t.funGetPageNum}})],1)])};n._withStripped=!0;var a=i("81a2"),r=i("05dd"),s=i("f6ce");function l(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(a,r){try{var s=e[a](r),l=s.value}catch(t){return void i(t)}if(!s.done)return Promise.resolve(l).then(function(t){n("next",t)},function(t){n("throw",t)});t(l)}("next")})}}var u={data:function(){return{validityTypeArr:[{id:0,name:"月"},{id:1,name:"日"},{id:2,name:"年"}],startTime:{show:!0,detail:!0,width:160,time:""},endTime:{show:!0,detail:!0,width:160,time:""},slideUp:!0,materialId:"",userName:"",remark:"",material:{brand:{},cate:[],unit:[]},cond:["更新日期","生产日期"],selectCond:0,selectBrand:{},materialList:[],nowList:[],tempList:[],searchCode:"",searchSupplier:"",currentPage:1,total:0,num:10,numArr:[10,20,30,40],relationUnit:[],relationUnitName:[],selectUnit:{id:"",name:"",value:""},materialMinUnit:{id:"",name:"",value:""}}},methods:{getSelectUnit:function(t){var e=this,i=this.relationUnitName[t];this.relationUnit.some(function(t){if(t.name==i)return e.selectUnit={id:t.muId,name:t.name,value:t.value},!0}),this.materialList=this.initSurplus(this.materialList)},getCondIndex:function(t){this.selectCond=Number(t)},getTime:function(t,e){this[t].time=Number(e)},filterMaterialList:function(t){var e,i=[];(this.currentPage=1,t)?(e=i).push.apply(e,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(this.materialList)):i=this.filterMaterialListByTime(this.materialList,this.startTime.time,this.endTime.time);this.searchCode=this.searchCode.trim(),this.searchSupplier=this.searchSupplier.trim(),this.searchCode&&(i=this.filterMaterialListByCode(i,this.searchCode)),this.searchSupplier&&(i=this.filterMaterialListBySupplier(i,this.searchSupplier)),this.tempList=i,this.tempList=this.markItemIndex(this.tempList),this.initPage(this.tempList,this.currentPage,this.num)},filterMaterialListByTime:function(t,e,i){var n=this;return t.filter(function(t){var a;a=n.selectCond?"productionTime":"updateTime";var r=1e3*Number(t[a]);if(e<=r&&r<i)return!0})},filterMaterialListByCode:function(t,e){return(e=e.trim())?t.filter(function(t){if(t.batchCode.includes(e))return!0}):t},filterMaterialListBySupplier:function(t,e){return(e=e.trim())?t.filter(function(t){if(t.supplier.includes(e))return!0}):t},resetData:function(){this.initTime(),this.searchCode="",this.searchSupplier="",this.selectCond=0,this.filterMaterialList(!0),this.currentPage=1},funGetPageNum:function(t){this.currentPage=Number(t.page),this.num!=t.num&&(this.num=Number(t.num),this.total=Math.ceil(this.tempList/this.num)),this.initPage(this.tempList,this.currentPage,this.num)},initPage:function(t,e,i){e=Number(e),i=Number(i),this.total=Math.ceil(t.length/this.num);var n=(e-1)*i,a=e*i;this.nowList=t.slice(n,a)},filterValidyList:function(t){return t.filter(function(t){if(t.maxNum=t.maxNum.trim(),t.minNum=t.minNum.trim(),""!=t.maxNum||""!=t.minNum)return!0})},checkForm:function(t){var e=this;this.materialList=this.materialList.map(function(t){return t.errorFlag=!1,t});var i=this.filterValidyList(t).some(function(t){var i,n;return n=Number(t.itemIndex)-1,i=Math.ceil((n+1)/e.num),t.maxNum&&!/(^[-]?\d{1,9}(\.\d{1,3})?$)|(^[-]?0\.\d{1,3}$)/.test(t.maxNum)||t.minNum&&!/(^[-]?\d{1,9}(\.\d{1,3})?$)|(^[-]?0\.\d{1,3}$)/.test(t.minNum)?(t.errorFlag=!0,e.alert("请输入数字,且最多含三位小数!"),e.initPage(e.tempList,i,e.num),e.currentPage=i,!0):Number(t.maxNum)*e.selectUnit.value+Number(t.minNum)>999999999?(t.errorFlag=!0,e.alert("盘点数量过大!"),e.initPage(e.tempList,i,e.num),e.currentPage=i,!0):void(t.errorFlag=!1)});return this.nowList.push(this.nowList.pop()),i},formatData:function(t){for(var e={old:[],new:[]},i=this.filterValidyList(t),n=0,a=i.length;n<a;n++){var r=i[n],s=Number(r.maxNum),l=Number(r.minNum),u=s*Number(this.selectUnit.value)+l,m=r.surplus,o={batchId:r.batchId,wid:r.wid,areaId:r.areaId,surplus:u};Number(u)!=Number(m)?e.new.push(o):e.old.push(o)}return e},syncRequestMaterialDetail:function(){var t=this;return l(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getHttp("MaterialGetMaterialDetail",{mid:t.materialId});case 2:if(i=e.sent,(!Array.isArray(i)||0!=i.length)&&i){e.next=6;break}return t.alert("该物料不存在!"),e.abrupt("return",!1);case 6:return e.next=8,t.getHttp("InvoicingBrandList");case 8:e.sent.some(function(t){if(t.id==i.brandId)return i.brandName=t.name,!0}),t.validityTypeArr.some(function(t){if(t.id==i.validityType)return i.validityName=t.name,!0}),i.unit||(i.unit=[]),i.unit.some(function(t){if(1==t.isMin)return i.minUnit=t.name,i.minId=t.muId,!0}),t.material=i;case 14:case"end":return e.stop()}},e,t)}))()},syncInvoicingGetMaterialBatch:function(){var t=this;return l(regeneratorRuntime.mark(function e(){var i,n,a,r,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getHttp("InvoicingGetMaterialBatch",{mid:t.materialId});case 2:if(i=e.sent){e.next=5;break}return e.abrupt("return");case 5:n=i.list,a=void 0===n?[]:n,r=i.relation,s=void 0===r?[]:r,t.relationUnit=s,t.materialList=a,t.materialList.map(function(t,e){return t.onlyId=e,t}),t.relationUnitName=t.relationUnit.map(function(t){return t.name}),t.relationUnit.some(function(e){if(1==e.isDefault)return t.selectUnit={id:e.muId,name:e.name,value:e.value},!0}),t.relationUnit.some(function(e){if(1==e.isMin)return t.materialMinUnit={id:e.muId,name:e.name,value:e.value},!0}),t.materialList=t.initSurplus(t.materialList),t.filterMaterialList(!0);case 14:case"end":return e.stop()}},e,t)}))()},markItemIndex:function(t){for(var e=0,i=t.length;e<i;e++){var n=e+1;t[e].itemIndex=n<10?"0"+n:n}return t},getHttp:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a[t]({data:i});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},n,e)}))()},initSurplus:function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];n.NewSurplus=r.a.comUnit(n.surplus,this.selectUnit.value,this.selectUnit.name,this.materialMinUnit.name),n.maxNum="",n.minNum=""}return t},initBtn:function(){var t=this;s.a.session("tabactive",1),s.a.session("publicDetailReturn",!0),this.$store.commit("setPageTools",[{name:"确定",className:["btn-ok","yellow"],fn:function(){if(!t.checkForm(t.tempList)){var e=t.formatData(t.tempList);if(0==e.new.length&&e.old.length>0)t.alert("盘点数量与库存数量一致!");else if(0!=e.new.length||0!=e.old.length){var i={mid:t.materialId,remark:t.remark,data:e.new};t.getHttp("GoodsinventorySetInventory",i).then(function(i){if(i.res){for(var n=e.new,a=0,r=t.materialList.length;a<r;a++)for(var s=t.materialList[a],l=0,u=n.length;l<u;l++)if(s.batchId==n[l].batchId){s.surplus=n[l].surplus;break}t.materialList=t.initSurplus(t.materialList);var m=t.nowList.pop();t.nowList.push(m),t.alert("盘库成功!")}else t.alert("盘库失败!")})}else t.alert("请先盘点数量!")}}},{name:"取消",className:["btn-cancel","gray"],fn:function(){t.$router.go(-1)}}])},initTime:function(){var t=new Date,e=[];e[0]=t.getFullYear(),e[1]=t.getMonth(),e[2]=t.getDate(),this.startTime.time=new Date(Number(e[0]),Number(e[1]),Number(e[2]),0,0,0).getTime(),this.endTime.time=new Date(Number(e[0]),Number(e[1]),Number(e[2]),23,59,59).getTime()},initData:function(){var t=s.a.session("userShop");this.userName=t.user.name,this.materialId=this.$route.query.id,this.initTime()},alert:function(t){this.$store.commit("setWin",{content:t,title:"温馨提示"})}},mounted:function(){this.initBtn(),this.initData(),this.syncRequestMaterialDetail(),this.syncInvoicingGetMaterialBatch()},filters:{formatTimeStamp:function(t){t=1e3*Number(t);var e=new Date(t),i=[];return i[0]=e.getFullYear(),i[1]=e.getMonth(),i[2]=e.getDate(),i[0]+"年"+(i[1]+1)+"月"+i[2]+"日"}},components:{mulSelect:function(){return i.e("select_btn").then(i.bind(null,"3d41"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))},pageElement:function(){return i.e("page_element").then(i.bind(null,"5921"))}}},m=(i("0272"),i("6ceb")),o=Object(m.a)(u,n,[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"table-head"},[i("li",[t._v("序号")]),t._v(" "),i("li",[t._v("批次编码")]),t._v(" "),i("li",{staticClass:"big-li"},[t._v("现库存数量/重量")]),t._v(" "),i("li",{staticClass:"big-li"},[t._v("盘点数量/重量")]),t._v(" "),i("li",[t._v("生产日期")]),t._v(" "),i("li",{staticClass:"big-li"},[t._v("供应商")]),t._v(" "),i("li",[t._v("进价")]),t._v(" "),i("li",[t._v("所属仓库")])])}],!1,null,"94ef9ab4",null);o.options.__file="src\\module\\invoicing_system\\warehouse_manage\\warehouse_count.vue";e.default=o.exports}}]);