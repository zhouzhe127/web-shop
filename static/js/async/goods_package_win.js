(window.webpackJsonp=window.webpackJsonp||[]).push([["goods_package_win"],{7913:function(t,e,s){"use strict";var o=s("a511");s.n(o).a},a511:function(t,e,s){},f163:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("win",{attrs:{align:"center",width:800,height:560},on:{winEvent:t.goodListWin}},[s("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),t._v(" "),s("div",{attrs:{slot:"content",id:"good_list"},slot:"content"},[s("section",{staticClass:"configTan"},[t.showSearch?s("section",{staticClass:"search-goods"},[s("span",{staticStyle:{"font-size":"16px"}},[t._v("搜索商品：")]),t._v(" "),s("input",{attrs:{type:"text",placeholder:"请输入商品的简码或名称"}})]):t._e(),t._v(" "),s("section",{staticClass:"oCont",staticStyle:{width:"100%"}},[0==t.type?s("div",{staticClass:"Box",staticStyle:{width:"160px",float:"left"}},[s("section",{staticClass:"oDe",class:{act:t.toggle},staticStyle:{"border-left":"none",width:"50%"},on:{click:function(e){t.toggle=!0}}},[t._v("商品")]),t._v(" "),s("section",{staticClass:"oDe",class:{act:!t.toggle},on:{click:function(e){t.toggle=!1}}},[t._v("套餐")])]):t._e(),t._v(" "),t.toggle&&2!=t.type?s("ul",{staticStyle:{width:"550px",float:"left","margin-left":"20px"},on:{click:t.catchEvent}},[0==t.showCategory||1==t.showCategory?s("li",{staticStyle:{width:"210px",float:"left"}},[s("section",{staticClass:"staList fl detLi"},[s("section",{staticClass:"tableList",on:{click:t.showOneArea}},[s("span",{staticClass:"oSpan"},[t._v(t._s(t.oneArea.name))]),t._v(" "),s("div",{staticClass:"fl"},[s("i")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.oneArea.show,expression:"oneArea.show"}],staticClass:"detDiv"},[s("i",{staticClass:"detI"}),t._v(" "),s("div",{staticStyle:{width:"100%",height:"100%","overflow-y":"auto","z-index":"16"}},t._l(t.category,function(e,o){return s("section",{key:o,class:{shoName:!0,"shoName-select-one":e.id==t.oneArea.id},on:{click:function(s){t.selectOneArea(e)}}},[t._v(t._s(e.name))])}))])])]):t._e(),t._v(" "),2==t.showCategory||0==t.showCategory?s("li",{staticStyle:{width:"210px","margin-left":"20px",float:"left"}},[s("section",{staticClass:"staList fl detLi"},[s("section",{staticClass:"tableList",on:{click:t.showTwoArea}},[s("span",{staticClass:"oSpan"},[t._v(t._s(t.twoArea.name))]),t._v(" "),s("div",{staticClass:"fl"},[s("i")])]),t._v(" "),t.twoArea.show?s("div",{staticClass:"detDiv",staticStyle:{left:"-180px"}},[s("i",{staticClass:"detI",staticStyle:{left:"290px"}}),t._v(" "),s("div",{staticStyle:{width:"100%",height:"100%","overflow-y":"auto","z-index":"16"}},t._l(t.child,function(e,o){return s("section",{key:o,staticClass:"shoName",class:{"shoName-select-one":e.id==t.twoArea.id},on:{click:function(s){t.selectTwoArea(e)}}},[t._v(t._s(e.name))])}))]):t._e()])]):t._e()]):t._e(),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.toggle,expression:"!toggle"}],staticStyle:{width:"100%",height:"50px",overflow:"hidden","padding-top":"10px"}},t._l(t.packMenu,function(e,o){return s("a",{key:o,class:{raduobtn:!0,selectbtn:e.id==t.selectPackMenu},attrs:{href:"javascript:void(0);"},on:{click:function(s){t.selectPack(e,o)}}},[t._v(t._s(e.name))])}))]),t._v(" "),s("ul",{staticClass:"aUl"},[-1==t.oneArea.id&&2!=t.type&&t.toggle&&t.parentGoods&&t.parentGoods.length>0?s("section",t._l(t.parentGoods,function(e,o){return s("li",{key:o,class:{aLi:!0,"shoName-select":e.isSelect},attrs:{"data-id":e.id},on:{click:function(s){t.choseParentGood(e,o)}}},[t._v(t._s(e.goodsName))])})):t._e(),t._v(" "),t.toggle?t._e():s("section",t._l(t.nowPackages,function(e,o){return t.packages.length>0?s("li",{key:o,staticClass:"aLi",class:{"shoName-select":e.isSelect},on:{click:function(s){t.choseParentGood(e,o)}}},[t._v(t._s(e.packageName))]):t._e()})),t._v(" "),t.toggle&&-1!=t.oneArea.id?s("section",[t.parentGoods&&t.parentGoods.length>0?s("div",{staticClass:"onecate"},[s("section",{staticClass:"onecataTitle"},[s("i",{class:{twoI:!0,oneI:!0}}),t._v(" "),s("li",{class:{twoTitle:!0,oneTitle:!0}},[t._v(t._s(t.oneArea.name))])]),t._v(" "),s("section",{staticStyle:{clear:"both"}},t._l(t.parentGoods,function(e,o){return s("li",{key:o,staticClass:"aLi",class:{"shoName-select":e.isSelect},on:{click:function(s){t.choseParentGood(e,o)}}},[t._v(t._s(e.goodsName))])}))]):t._e(),t._v(" "),t._l(t.nowChildGoods,function(e,o){return s("div",{key:o,staticClass:"onecate"},[s("section",{staticClass:"onecataTitle"},[s("i",{staticClass:"twoI"}),t._v(" "),s("li",{staticClass:"twoTitle"},[t._v(t._s(e.name))])]),t._v(" "),s("section",{staticStyle:{clear:"both"}},t._l(e.arr,function(e,i){return s("li",{key:i,staticClass:"aLi",class:{"shoName-select":e.isSelect},on:{click:function(s){t.choseChildGood(e,i,o)}}},[t._v(t._s(e.goodsName))])}))])})],2):t._e()]),t._v(" "),0==t.showSelectAll||1==t.showSelectAll||2==t.showSelectAll?s("div",{staticStyle:{width:"100%",height:"40px","background-color":"#f7f7f7",position:"fixed",bottom:"50px",left:"0"}},[1==t.showSelectAll||0==t.showSelectAll?s("section",{staticClass:"isallselect allselect",on:{click:t.cancelAll}},[t._v("取消全部")]):t._e(),t._v(" "),1==t.showSelectAll||0==t.showSelectAll?s("section",{staticClass:"isallselect",on:{click:t.selectAll}},[t._v("选择全部")]):t._e(),t._v(" "),2==t.showSelectAll||0==t.showSelectAll?s("h3",{directives:[{name:"show",rawName:"v-show",value:t.toggle,expression:"toggle"}],staticStyle:{width:"auto",height:"40px","line-height":"40px","margin-right":"25px",float:"right",color:"#FF9700"}},[t._v("已选择: "+t._s(t.countGoods.count>1?t.countGoods.count+"个":t.countGoods.name))]):t._e(),t._v(" "),2==t.showSelectAll||0==t.showSelectAll?s("h3",{directives:[{name:"show",rawName:"v-show",value:!t.toggle,expression:"!toggle"}],staticStyle:{width:"auto",height:"40px","line-height":"40px","margin-right":"25px",float:"right",color:"#FF9700"}},[t._v("已选择: "+t._s(t.countPackages.count>1?t.countPackages.count+"个":t.countPackages.name))]):t._e()]):t._e()])])])};o._withStripped=!0;var i=s("bbb9"),n=s("81a2"),a=s("f6ce");function c(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function o(i,n){try{var a=e[i](n),c=a.value}catch(t){return void s(t)}if(!a.done)return Promise.resolve(c).then(function(t){o("next",t)},function(t){o("throw",t)});t(c)}("next")})}}var r={data:function(){return{oneArea:{name:"请选择一级分类",id:-1,show:!1},twoArea:{name:"请选择二级分类",id:null,show:!1},packMenu:[{id:-1,name:"全部"},{id:0,name:"固定套餐"},{id:1,name:"可选套餐"}],category:[],child:[],goodsList:[],copyGoods:null,packages:[],copyPack:null,nowPackages:null,parentGoods:[],childGoods:[],nowChildGoods:[],title:null,type:null,showSearch:!1,showCategory:null,toggle:!0,showSelectAll:0,selectPackMenu:-1,countGoods:{count:0,name:""},countPackages:{count:0,name:""},isGetExtra:!1}},props:{pGoodsList:null},methods:{goodListWin:function(t){var e=this,s={goodArr:[],packArr:[]};"ok"==t?(s.goodArr=this.goodsList.filter(function(t){return t.isSelect}),s.packArr=this.packages.filter(function(t){return t.isSelect}),s.goodArr||(s.goodArr=[]),s.packArr||(s.packArr=[])):(this.copyGoods||(this.copyGoods=[]),this.copyPack||(this.copyPack=[]),this.goodsList.forEach(function(t){e.copyGoods.forEach(function(e){t.id==e&&s.goodArr.push(t)})}),this.packages.forEach(function(t){e.copyPack.forEach(function(e){t.id==e&&s.packArr.push(t)})})),this.$emit("throwGoodListWin",t,s)},showOneArea:function(){this.oneArea.show=!this.oneArea.show,this.twoArea.show=!1},selectOneArea:function(t){this.oneArea={id:t.id,name:t.name,show:!1},this.twoArea={id:-2,name:"请选择二级分类",show:!1},this.child=t.child,this.child||(this.child=[]);var e=this.filterGoodsByPid(this.goodsList,this.category,t.id);this.parentGoods=e.parent,this.childGoods=e.child,this.nowChildGoods=this.childGoods},showTwoArea:function(){this.child||(this.child=[]),-1!=this.oneArea.id?0!=this.child.length?(this.twoArea.show=!this.twoArea.show,this.oneArea.show=!1,-1!=this.child[0].id&&this.child.unshift({id:-1,name:"全部二级分类",show:!1})):this.$store.commit("setWin",{title:"温馨提示",content:"该分类下不存在二级分类"}):this.$store.commit("setWin",{title:"温馨提示",content:"请先选择一级分类"})},selectTwoArea:function(t){this.twoArea.id=t.id,this.twoArea.name=t.name,this.twoArea.show=!1,this.nowChildGoods=this.childGoods.filter(function(e){return-1==t.id||e.id==t.id}),this.parentGoods=[]},filterGoodsByPid:function(t,e,s){var o=[],i=[];return-1==s?{parent:t,child:[]}:(t.forEach(function(t){var e=t.cids;e||(e=[]);for(var i=0,n=e.length;i<n;i++)if(e[i]==s){o.push(t);break}}),e.some(function(e){if(e.id==s){var o=e.child;return o||(o=[]),o.forEach(function(e){var s={name:e.name,id:e.id,arr:[]};t.forEach(function(t){var o=t.cids;o||(o=[]);for(var i=0,n=o.length;i<n;i++)if(o[i]==e.id){s.arr.push(t);break}}),s.arr.length>0&&i.push(s)}),!0}}),{parent:o,child:i})},selectPack:function(t){this.selectPackMenu=t.id,this.nowPackages=this.packages.filter(function(e){return-1==t.id||e.type==t.id})},choseParentGood:function(t,e){this.toggle?(this.pGoodsList.goodRadio&&(this.goodsList=this.goodsList.map(function(t){return t.isSelect=!1,t})),t.isSelect=!t.isSelect,this.parentGoods.splice(e,1,t),this.countGoods=this.initSelectNum(this.goodsList,"good")):(this.pGoodsList.packageRadio&&(this.packages=this.packages.map(function(t){return t.isSelect=!1,t})),t.isSelect=!t.isSelect,this.countPackages=this.initSelectNum(this.packages,"pack"))},choseChildGood:function(t,e,s){this.pGoodsList.goodRadio&&(this.goodsList=this.goodsList.map(function(t){return t.isSelect=!1,t})),t.isSelect=!t.isSelect,this.childGoods[s].arr.splice(e,1,t),this.countGoods=this.initSelectNum(this.goodsList,"good")},selectAll:function(){this.toggle?(this.parentGoods=this.parentGoods.map(function(t){return t.isSelect=!0,t}),this.nowChildGoods||(this.nowChildGoods=[]),this.nowChildGoods=this.nowChildGoods.map(function(t){return t.arr.forEach(function(t){t.isSelect=!0}),t}),this.countGoods=this.initSelectNum(this.goodsList,"good")):(this.nowPackages=this.nowPackages.map(function(t){return t.isSelect=!0,t}),this.countPackages=this.initSelectNum(this.packages,"pack"))},cancelAll:function(){this.toggle?(this.parentGoods=this.parentGoods.map(function(t){return t.isSelect=!1,t}),this.nowChildGoods||(this.nowChildGoods=[]),this.nowChildGoods=this.nowChildGoods.map(function(t){return t.arr.forEach(function(t){t.isSelect=!1}),t}),this.countGoods={count:0,name:""}):(this.nowPackages=this.nowPackages.map(function(t){return t.isSelect=!1,t}),this.countPackages={count:0,name:""})},initData:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.a.session("userShop"),t.shopId=s.currentShop.id,t.pGoodsList.title?t.title=t.pGoodsList.title:t.title="选择关联商品",t.type=t.pGoodsList.type,t.isGetExtra=t.pGoodsList.isGetExtra,t.pGoodsList.showSearch||(t.showSearch=!1),t.showSelectAll=t.pGoodsList.showSelectAll,void 0===t.pGoodsList.showSelectAll&&(t.showSelectAll=0),o=null,t.isGetExtra){e.next=13;break}return e.next=12,t.ShopGetExtra();case 12:o=e.sent;case 13:e.t0=""+t.type,e.next="0"===e.t0?16:"1"===e.t0?19:"2"===e.t0?21:23;break;case 16:return t.initGoods(o),t.initPackages(o),e.abrupt("break",25);case 19:return t.initGoods(o),e.abrupt("break",25);case 21:return t.initPackages(o),e.abrupt("break",25);case 23:t.initGoods(o),t.initPackages(o);case 25:t.showCategory=t.pGoodsList.showCategory,void 0===t.showCategory&&(t.showCategory=0),t.isGetExtra||a.a.session("httpGoodVersion",o);case 28:case"end":return e.stop()}},e,t)}))()},initGoods:function(t){var e=this;if(this.goodsList=this.pGoodsList.goodsList,this.goodsList=this.copyData(this.goodsList),this.pGoodsList.delGoods){var s=this.pGoodsList.delGoods;this.goodsList=this.filterGoods(this.goodsList,s)}if(this.pGoodsList.selGoods){var o=this.pGoodsList.selGoods;this.copyGoods=this.copyData(o)}if(this.goodsList=this.initSelect(this.goodsList,this.pGoodsList.selGoods),this.countGoods=this.initSelectNum(this.goodsList,"good"),this.pGoodsList.category){this.category=i.a.deepCopy(this.pGoodsList.category),this.category.unshift({id:-1,name:"全部"});var n=this.filterGoodsByPid(this.goodsList,this.category,this.oneArea.id);this.parentGoods=n.parent,this.childGoods=n.child}else this.getCategoryList(!1,t.otherConfigVer).then(function(t){t[0]&&-1!=t[0].id&&t.unshift({id:-1,name:"全部一级分类"}),e.category=t;var s=e.filterGoodsByPid(e.goodsList,e.category,e.oneArea.id);e.parentGoods=s.parent,e.childGoods=s.child})},initPackages:function(t){var e=this;this.getpackagelist(!1,t.otherConfigVer).then(function(t){if(e.packages=t,e.pGoodsList.delPack){var s=e.pGoodsList.delPack;e.packages=e.filterGoods(t,s)}if(e.pGoodsList.selPack){var o=e.pGoodsList.selPack;e.copyPack=e.copyData(o)}e.packages=e.initSelect(e.packages,e.pGoodsList.selPack),e.selectPack({id:e.selectPackMenu}),e.countPackages=e.initSelectNum(e.packages,"pack")})},initSelectNum:function(t,e){var s={},o={count:0,name:""};return t.forEach(function(t){t.isSelect&&(o.count++,s=t)}),1==o.count&&(o.name="good"==e?s.goodsName:s.packageName),o},filterGoods:function(t,e){return t.filter(function(t){for(var s=!1,o=0,i=e.length;o<i;o++)if(t.id==e[o]){s=!0;break}return!s})},initSelect:function(t,e){return t.map(function(t){var s=!1;if(e)for(var o=0,i=e.length;o<i;o++)if(t.id==e[o]){s=!0;break}return t.isSelect=!!s,t})},copyData:function(t){var e=null;return e=JSON.stringify(t),e=JSON.parse(e)},ShopGetExtra:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.a.ShopGetExtra({data:{}});case 2:return s=t.sent,t.abrupt("return",s);case 4:case"end":return t.stop()}},e,t)}))()},getPack:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.getpackagelist({data:{shopId:t.shopId,page:1,num:9999}});case 2:return s=e.sent,a.a.session("packList",s),e.abrupt("return",s);case 5:case"end":return e.stop()}},e,t)}))()},getpackagelist:function(t,e){var s=this;return c(regeneratorRuntime.mark(function o(){var i,n;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=null,!t){o.next=7;break}return o.next=4,s.getPack();case 4:i=o.sent,o.next=25;break;case 7:if(n=a.a.session("httpGoodVersion")){o.next=14;break}return o.next=11,s.getPack();case 11:i=o.sent,o.next=25;break;case 14:if(n.otherConfigVer!=e){o.next=22;break}if(i=a.a.session("packList")){o.next=20;break}return o.next=19,s.getPack();case 19:i=o.sent;case 20:o.next=25;break;case 22:return o.next=24,s.getPack();case 24:i=o.sent;case 25:return o.abrupt("return",i);case 26:case"end":return o.stop()}},o,s)}))()},getCate:function(){var t=this;return c(regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.getCategoryList({data:{shopId:t.shopId}});case 2:return s=e.sent,a.a.session("areaList",s),e.abrupt("return",s);case 5:case"end":return e.stop()}},e,t)}))()},getCategoryList:function(t,e){var s=this;return c(regeneratorRuntime.mark(function o(){var i,n;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=null,!t){o.next=7;break}return o.next=4,s.getCate();case 4:i=o.sent,o.next=25;break;case 7:if(n=a.a.session("httpGoodVersion")){o.next=14;break}return o.next=11,s.getCate();case 11:i=o.sent,o.next=25;break;case 14:if(n.otherConfigVer!=e){o.next=22;break}if(i=a.a.session("areaList")){o.next=20;break}return o.next=19,s.getCate();case 19:i=o.sent;case 20:o.next=25;break;case 22:return o.next=24,s.getCate();case 24:i=o.sent;case 25:return o.abrupt("return",i);case 26:case"end":return o.stop()}},o,s)}))()},domClick:function(){this.twoArea.show=this.oneArea.show=!1},catchEvent:function(t){t.cancelBubble=!0}},mounted:function(){this.initData(),document.addEventListener("click",this.domClick,!1)},components:{win:function(){return s.e("win").then(s.bind(null,"f60a"))}},beforeDestroy:function(){document.removeEventListener("click",this.domClick)}},l=(s("7913"),s("7610")),h=Object(l.a)(r,o,[],!1,null,"0b05ccfb",null);h.options.__file="src\\module\\goods_config\\common\\good_package_win.vue";e.default=h.exports}}]);