(window.webpackJsonp=window.webpackJsonp||[]).push([["attr_add_win"],{2500:function(t,e,n){},2593:function(t,e,n){"use strict";n.r(e);var r=n("81a2"),s=n("f6ce");function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function r(s,i){try{var a=e[s](i),o=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(o).then(function(t){r("next",t)},function(t){r("throw",t)});t(o)}("next")})}}var a={data:function(){return{attr:0,tasteGroup:"",newObj:[["",""]],sort:1,shopId:null,brandId:null,taste:[],editId:null,title:null,relativeGoods:[],goodsList:[],showCom:null,comObj:null,btnOk:{},btnCancel:{}}},props:{pObj:null},methods:{initData:function(){var t=this;for(var e in this.pObj)this[e]=this.pObj[e];var n=s.a.session("userShop");this.brandId=n.currentShop.brandId,this.shopId=n.currentShop.id,this.editId?this.funGetOneAttr().then(function(e){t.attr=e.attr,t.tasteGroup=e.name,t.sort=e.sort,t.newObj=t.formatOptions(e.options),e.goods||(e.goods=[]),t.relativeGoods=e.goods.map(function(t){return{id:t.gid,goodsName:t.goodsName}})}):(this.attr=0,this.sort=1,this.tasteGroup="",this.newObj=[["",""]])},initBtn:function(){this.editId?(this.btnOk={content:"保存",style:"background-color:#f8941f"},this.btnCancel={content:"删除",style:"background-color:#c33"}):(this.btnOk={content:"添加",style:"background-color:#f8941f"},this.btnCancel={content:"取消",style:"background-color:#a0a0a0"})},getSort:function(t){this.sort=t},funAddReleative:function(){this.showCom="addRelative";var t;t=this.goodsList.filter(function(t){if((0==t.status||1==t.status)&&(0==t.type&&!Number(t.groupId)&&!Number(t.isGroup)||0==t.type&&Number(t.groupId)>0&&!Number(t.isGroup)||1==t.type))return!0});var e=this.relativeGoods.map(function(t){return t.id});this.comObj={goodsList:t,selGoods:e,title:"添加关联菜品",type:1}},funGetAddRelative:function(t,e){this.showCom="",this.relativeGoods=e.goodArr},funGetSelfWin:function(t){var e=this;if("ok"==t){if(!this.checkForm())return;var n=this.formatData();this.editId?this.editAttr(n).then(function(t){e.$emit("throwAddAttrWin","edit",t)}):this.createAttr(n).then(function(t){e.$emit("throwAddAttrWin","add",t)})}else"cancel"==t&&this.editId?this.$store.commit("setWin",{title:"温馨提示",winType:"confirm",content:"确定删除该口味",callback:function(t){"ok"==t&&e.delAttr().then(function(t){t&&e.$emit("throwAddAttrWin","delete",e.editId)})}}):this.$emit("throwAddAttrWin",t,null)},deleteTaste:function(t){var e=this;this.$store.commit("setWin",{winType:"confirm",title:"提示信息",content:"确定删除该口味？",callback:function(n){"ok"==n&&e.newObj.splice(t,1)}})},append:function(){for(var t=0,e=this.newObj.length;t<e;t++)for(var n=this.newObj[t],r=t+1;r<e;r++){var s=this.newObj[r];if(0==s[0].trim().length)return this.$store.commit("setWin",{title:"提示信息",content:"请输入口味名称!"}),!1;if(n[0]==s[0])return this.$store.commit("setWin",{title:"提示信息",content:"口味名称不能重复!"}),!1}this.newObj.push(["",""])},checkForm:function(){if(0==this.newObj.length)return this.$store.commit("setWin",{title:"提示信息",content:"至少要有一个口味!"}),!1;if(!this.tasteGroup)return this.$store.commit("setWin",{title:"提示信息",content:"请输入口味分组名称!"}),!1;if(this.tasteGroup=this.tasteGroup.trim(),/[&'\s]+/g.test(this.tasteGroup))return this.$store.commit("setWin",{title:"提示信息",content:"口味分组名称不能含有特殊符号"}),!1;for(var t=0,e=this.newObj.length;t<e;t++){var n=this.newObj[t];if(!n[0])return this.$store.commit("setWin",{title:"提示信息",content:"请输入口味名称!"}),!1;if(/[''&:\s]+/g.test(n[0].trim()))return this.$store.commit("setWin",{title:"提示信息",content:"口味名称不能含有特殊字符!"}),!1;if(n[1]=n[1].trim(),n[1].length>0){if(!/((^([1-9]\d*))|^0)(\.\d{1,2})?$|(^[-]0\.\d{1,2}$)/.test(n[1].trim()))return this.$store.commit("setWin",{title:"提示信息",content:"价格最多含有两位小数且不能为负数!"}),!1;if(Number(n[1])>1e5)return this.$store.commit("setWin",{title:"提示信息",content:"价格不能大于10万!"}),!1}}return!0},formatData:function(){for(var t,e=[],n={},r=[],s=0,i=this.newObj.length;s<i;s++){var a=this.newObj[s];a[1]||(a[1]="0.0");var o=a.join(":");e.push(o)}return t=e.join("|"),this.relativeGoods.forEach(function(t){r.push(t.id)}),this.editId&&(n.id=this.editId),n.goods=r.join(","),n.shopId=this.shopId,n.name=this.tasteGroup,n.options=t,n.sort=this.sort,n.attr=this.attr,n.optionsType=0,n.optionsRange="",n},formatOptions:function(t){if(!t)return"";var e=[];return t.split("|").forEach(function(t){var n=t.split(":"),r=[];r.push.apply(r,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(n)),e.push(r)}),e},funGetOneAttr:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.getOneAttr({data:{id:t.editId,shopId:t.shopId}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,t)}))()},createAttr:function(t){var e=this;return i(regeneratorRuntime.mark(function n(){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.a.createAttr({data:t});case 2:return(s=n.sent).goodsNum=e.relativeGoods.length,s.optionsNum=e.newObj.length,n.abrupt("return",s);case 6:case"end":return n.stop()}},n,e)}))()},editAttr:function(t){var e=this;return i(regeneratorRuntime.mark(function n(){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.a.editAttr({data:t});case 2:return(s=n.sent).goodsNum=e.relativeGoods.length,s.optionsNum=e.newObj.length,n.abrupt("return",s);case 6:case"end":return n.stop()}},n,e)}))()},delAttr:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.delAttr({data:{shopId:t.shopId,brandId:t.brandId,id:t.editId}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,t)}))()},ShopGetExtra:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.a.ShopGetExtra({data:{}});case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}},e,t)}))()},getGoods:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.next=3,r.a.getGoodsList({data:{shopId:t.shopId,page:1,num:9999,specification:1}});case 3:return i=e.sent,n=i.list,s.a.session("goodList",n),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,t)}))()},getGoodsList:function(t,e){var n=this;return i(regeneratorRuntime.mark(function r(){var i,a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=null,!t){r.next=7;break}return r.next=4,n.getGoods();case 4:i=r.sent,r.next=25;break;case 7:if(a=s.a.session("httpGoodVersion")){r.next=14;break}return r.next=11,n.getGoods();case 11:i=r.sent,r.next=25;break;case 14:if(a.goodsConfigVer!=e){r.next=22;break}if(i=s.a.session("goodList")){r.next=20;break}return r.next=19,n.getGoods();case 19:i=r.sent;case 20:r.next=25;break;case 22:return r.next=24,n.getGoods();case 24:i=r.sent;case 25:return r.abrupt("return",i);case 26:case"end":return r.stop()}},r,n)}))()},syncRequest:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.ShopGetExtra();case 2:return n=e.sent,e.next=5,t.getGoodsList(!1,n.goodsConfigVer);case 5:r=e.sent,t.goodsList=r,s.a.session("httpGoodVersion",n);case 8:case"end":return e.stop()}},e,t)}))()}},mounted:function(){this.initData(),this.initBtn(),this.syncRequest()},components:{addRelative:function(){return n.e("good_package_win").then(n.bind(null,"f163"))},subAdd:function(){return n.e("subadd").then(n.bind(null,"e7ea"))},win:function(){return n.e("win").then(n.bind(null,"f60a"))}}},o=(n("aad2"),n("d801")),u=Object(o.a)(a,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("win",{attrs:{height:556,width:556,ok:t.btnOk,cancel:t.btnCancel,align:"right"},on:{winEvent:t.funGetSelfWin}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))]),t._v(" "),n("div",{staticClass:"tas-addtas",attrs:{slot:"content",id:"attr_add"},slot:"content"},[n("div",{staticClass:"tas-type"},[n("p",{staticClass:"tas-text required fl",staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),n("span",{class:{sign:0==t.attr},on:{click:function(e){t.attr=0}}},[t._v("单选口味")]),t._v(" "),n("span",{class:{sign:1==t.attr},on:{click:function(e){t.attr=1}}},[t._v("多选口味")]),t._v(" "),n("p",{staticClass:"tas-text required fl",staticStyle:{width:"70px"}},[t._v("排序")])]),t._v(" "),n("span",{staticClass:"attr-sort",staticStyle:{float:"right","margin-top":"-40px","margin-right":"40px"}},[n("sub-add",{attrs:{minnum:1,bindnum:t.sort,sign:!1},on:{toClick:t.getSort}})],1),t._v(" "),n("div",{staticClass:"taste-max"},[n("div",{staticClass:"taste-addAttr"},[n("div",{staticClass:"tas-inputname"},[n("label",{staticClass:"tas-text2 required fl"},[t._v("口味分組")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.tasteGroup,expression:"tasteGroup"}],attrs:{type:"text",placeholder:"请输入口味分组名称",maxlength:"10"},domProps:{value:t.tasteGroup},on:{input:function(e){e.target.composing||(t.tasteGroup=e.target.value)}}})]),t._v(" "),t._l(t.newObj,function(e,r){return n("div",{key:r,staticClass:"tas-change"},[n("span",{staticClass:"tas-text2 required fl"},[t._v("口味名称")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e[0],expression:"value[0]"}],attrs:{type:"text",placeholder:"请输入口味名称",maxlength:"10"},domProps:{value:e[0]},on:{input:function(n){n.target.composing||t.$set(e,0,n.target.value)}}}),t._v(" "),n("span",{staticClass:"tas-text2  fl",staticStyle:{width:"64px","text-indent":"14px"}},[t._v("价格")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e[1],expression:"value[1]"}],staticStyle:{width:"100px","margin-left":"0px"},attrs:{type:"text",placeholder:"请输入价格",maxlength:"6"},domProps:{value:e[1]},on:{input:function(n){n.target.composing||t.$set(e,1,n.target.value)}}}),t._v(" "),t.newObj.length>1?n("span",{staticClass:"cata-delete",staticStyle:{"font-size":"14px"},on:{click:function(e){t.deleteTaste(r)}}}):t._e()])})],2)]),t._v(" "),n("div",{staticClass:"tas-second",staticStyle:{"margin-top":"20px"}},[n("div",{staticClass:"tas-tastype",attrs:{id:"tas-tastype"}},[n("span",{staticClass:"tas-secondWindow"},[n("a",{staticClass:"addclassify fl",staticStyle:{width:"490px","background-position":"190px"},on:{click:t.append}},[t._v("添加口味属性")])])]),t._v(" "),n("div",{staticClass:"tas-add-text"},[n("div",{staticClass:"tas-add-content"},[t._l(t.relativeGoods,function(e,r){return[n("span",{key:r},[t._v(t._s(e.goodsName)+";")])]})],2)]),t._v(" "),n("div",{staticClass:"tas-tastype",staticStyle:{"margin-top":"-10px"}},[n("a",{staticClass:"addclassify fl",staticStyle:{width:"490px","background-position":"190px","margin-top":"10px"},on:{click:t.funAddReleative}},[t._v("添加关联菜品")])])])])]),t._v(" "),n("transition",{attrs:{name:"fade"}},[n(t.showCom,{tag:"component",attrs:{pGoodsList:t.comObj},on:{throwGoodListWin:t.funGetAddRelative}})],1)],1)},[],!1,null,"29d5c23e",null);e.default=u.exports},aad2:function(t,e,n){"use strict";var r=n("2500");n.n(r).a}}]);