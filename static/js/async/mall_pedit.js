(window.webpackJsonp=window.webpackJsonp||[]).push([["mall_pedit"],{"9c3d":function(t,e,i){},b411:function(t,e,i){"use strict";var n=i("9c3d");i.n(n).a},c909:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mall-box",attrs:{id:"proedit"}},[t._m(0),t._v(" "),i("div",{staticClass:"name"},[i("div",{staticClass:"sub"},[t._v("素材名称")]),t._v(" "),i("el-input",{staticClass:"text",attrs:{placeholder:"输入名称"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),i("div",{staticClass:"type"},[i("div",{staticClass:"sub"},[t._v("素材编辑器")]),t._v(" "),i("div",{staticClass:"container"},[i("div",{class:{button:!0,disable:!t.isname,able:t.isname},on:{click:function(e){t.toggle("name")}}},[i("span",[t._v("添加昵称")]),t._v(" "),i("i",{staticClass:"el-icon-close"})]),t._v(" "),i("div",{class:{button:!0,disable:!t.islogo,able:t.islogo},on:{click:function(e){t.toggle("logo")}}},[i("span",[t._v("添加头像")]),t._v(" "),i("i",{staticClass:"el-icon-close"})]),t._v(" "),i("div",{class:{button:!0,disable:!t.isqr,able:t.isqr},on:{click:function(e){t.toggle("qr")}}},[i("span",[t._v("添加二维码")]),t._v(" "),i("i",{staticClass:"el-icon-close"})])]),t._v(" "),i("div",{staticClass:"nameConfig"},[i("div",{staticClass:"font"},[i("div",{staticClass:"tips"},[t._v("昵称字号")]),t._v(" "),i("el-input-number",{style:{fontSize:t.fontSize},attrs:{"controls-position":"right",step:2,min:12,max:64},model:{value:t.fontSize,callback:function(e){t.fontSize=e},expression:"fontSize"}})],1),t._v(" "),i("div",{staticClass:"color"},[i("div",{staticClass:"tips"},[t._v("昵称颜色")]),t._v(" "),i("el-color-picker",{attrs:{"color-format":"rgb"},model:{value:t.color,callback:function(e){t.color=e},expression:"color"}})],1)])]),t._v(" "),i("div",{staticClass:"upload"},[i("div",{staticClass:"sub"},[t._v("上传图片")]),t._v(" "),i("form",{staticStyle:{position:"absolute"},attrs:{id:"imageUpForm",enctype:"multipart/form-data"}},[i("input",{staticStyle:{opacity:"0"},attrs:{type:"file",id:"file_upload",accept:"image/jpeg,image/png,image/gif,image/tiff",name:"image"},on:{change:t.fileNameChange}})]),t._v(" "),i("el-button",{staticClass:"upload_but",staticStyle:{position:"relative"},attrs:{type:"primary"}},[i("label",{staticStyle:{position:"absolute",width:"100%",height:"100%",left:"0",top:"0",cursor:"pointer"},attrs:{for:"file_upload"}}),t._v(" "),i("i",{staticClass:"el-icon-plus el-icon--left"}),t._v("上传图片\n\t\t")])],1),t._v(" "),t._m(1),t._v(" "),i("div",{ref:"editContent",staticClass:"editCont"},[t.isname?i("div",{directives:[{name:"moves",rawName:"v-moves"}],ref:"names",staticClass:"names",style:{fontSize:t.fontSize+"px",color:t.color,top:t.editConfig.name.y,left:t.editConfig.name.x},attrs:{"data-name":"name"}},[t._v("昵称")]):t._e(),t._v(" "),t.islogo?i("div",{directives:[{name:"moves",rawName:"v-moves"}],ref:"editHead",staticClass:"edit-head",style:{lineHeight:t.editConfig.logo.h,width:t.editConfig.logo.w,height:t.editConfig.logo.h,top:t.editConfig.logo.y,left:t.editConfig.logo.x},attrs:{"data-name":"logo"}},[t._v("\n\t\t\t头像\n\t\t\t"),i("div")]):t._e(),t._v(" "),t.isqr?i("div",{directives:[{name:"moves",rawName:"v-moves"}],ref:"prowx",staticClass:"prowx",style:{lineHeight:t.editConfig.qr.h,width:t.editConfig.qr.w,height:t.editConfig.qr.h,top:t.editConfig.qr.y,left:t.editConfig.qr.x},attrs:{"data-name":"qr"}},[t._v("\n\t\t\t二维码\n\t\t\t"),i("div")]):t._e(),t._v(" "),null!=t.fileName?i("img",{staticClass:"centerImg",style:t.imgStyle,attrs:{src:t.imgHost+t.fileName}}):t._e()]),t._v(" "),i("div",{staticClass:"submitBut"},[i("el-button",{attrs:{type:"info"},on:{click:t.openPro}},[t._v("关闭")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.onPro}},[t._v("保存")])],1)])};n._withStripped=!0;var o=i("81a2"),a=i("f6ce"),s=i("05dd"),r=i("bbb9");function l(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(o,a){try{var s=e[o](a),r=s.value}catch(t){return void i(t)}if(!s.done)return Promise.resolve(r).then(function(t){n("next",t)},function(t){n("throw",t)});t(r)}("next")})}}var c={data:function(){return{imgData:null,imgHost:"",fileName:null,name:null,pid:null,uid:"",isname:!1,islogo:!1,isqr:!1,color:"rgb(255,255,255)",imgStyle:{width:0,height:0},imgRang:{top:0,left:0},imgScale:1,fontSize:24,editConfig:{name:{x:0,y:0,w:"60px",h:"28px"},logo:{w:"64px",h:"64px",x:0,y:0},qr:{w:"64px",h:"64px",x:0,y:0}}}},props:{position:{type:null,default:null}},methods:{handleChange:function(t){this.fontSize=t+"px"},toggle:function(t){this.fileName?(this["is"+t]=!this["is"+t],this["is"+t]?(this.editConfig[t].x=parseFloat(this.imgRang.left)+"px",this.editConfig[t].y=parseFloat(this.imgRang.top)+"px"):"name"==t&&(this.color="#fff",this.fontSize=24)):this.$store.commit("setWin",{content:"请先上传背景图"})},reset:function(){this.color="rgb(255,255,255)",this.fontSize=24,this.imgStyle={width:0,height:0},this.imgRang={top:0,left:0},this.imgScale=1},openPro:function(){this.$emit("closePedit")},loadImg:function(t){var e=this;return new Promise(function(i){var n=new Image;n.src=t.indexOf("base64")>-1?t:e.imgHost+t,n.onload=function(){i(n),n=null}})},readFile:function(t){return new Promise(function(e){var i=new FileReader;i.readAsDataURL(t),i.onload=function(){e(this.result)}})},countScale:function(t,e){var i=0,n=0;t<750&&e<750?(i=t,n=e):t>e?(this.imgScale=t/750,n=e/this.imgScale,i=750):e>t&&(this.imgScale=e/750,i=t/this.imgScale,n=750),this.imgStyle={width:i+"px",height:n+"px"},this.imgRang={width:i,height:n,top:(750-n)/2+"px",left:(750-i)/2+"px"}},preFn:function(t){var e=this;return l(regeneratorRuntime.mark(function i(){var n,o,a,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.readFile(t);case 2:return n=i.sent,i.next=5,e.loadImg(n);case 5:if(o=i.sent,a=o.width,s=o.height,!(a<100||s<100)){i.next=10;break}return e.$store.commit("setWin",{content:"宽和高必须要大于100px"}),i.abrupt("return",!1);case 10:if(!(a>3e3||s>3e3)){i.next=13;break}return e.$store.commit("setWin",{content:"宽或者高不能大于3000px"}),i.abrupt("return",!1);case 13:e.reset(),e.countScale(a,s);case 15:case"end":return i.stop()}},i,e)}))()},fileNameChange:function(){var t=this;return l(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.uploadImg({data:{type:6,shopId:a.a.session("shopId")},fn:t.preFn,formId:"imageUpForm"});case 2:i=e.sent,t.imgData=i,t.fileName=i;case 5:case"end":return e.stop()}},e,t)}))()},countSize:function(t,e,i){t&&(t.push(parseInt(parseFloat(this.editConfig[i].x)*this.imgScale-parseFloat(this.imgRang.left))),t.push(parseInt(parseFloat(this.editConfig[i].y)*this.imgScale-parseFloat(this.imgRang.top)))),e&&(e.push(parseInt(parseFloat(this.editConfig[i].w)*this.imgScale)),e.push(parseInt(parseFloat(this.editConfig[i].h)*this.imgScale)))},onPro:function(){var t=this;return l(regeneratorRuntime.mark(function e(){var i,n,a,l,c,m,p,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],n=[],a=[],l=[],c=[],m=[],s.a.checkData({name:{cond:"$$.toString().trim() != '' && $$.toString().trim() != 0",pro:"请输入正确格式的素材名称!"}},t)){e.next=8;break}return e.abrupt("return",!1);case 8:if(t.isname&&(t.countSize(i,null,"name"),p=r.a.getDOMPosition(t.$refs.names),n.push(p.w,p.h)),t.islogo&&t.countSize(a,l,"logo"),t.isqr&&t.countSize(c,m,"qr"),u={name:t.name.toString(),imageName:t.fileName,positionName:i.toString(),positionNameSize:n.toString(),positionNameFontSize:t.fontSize,positionNameColor:t.color,positionHead:a.toString(),positionHeadSize:l.toString(),positionQR:c.toString(),positionQRSize:m.toString(),uid:t.uid},!t.position){e.next=18;break}return e.next=15,o.a.ActivityEdit({data:Object.assign(u,{id:t.pid})});case 15:t.$store.commit("setWin",{title:"操作提示",content:"修改素材成功,一秒后跳转至素材列表页面！",winType:"confirm",timerPowerOff:1e3,callback:function(){t.$emit("closePedit",{imageName:t.fileName})}}),e.next=21;break;case 18:return e.next=20,o.a.ActivityAdd({data:u});case 20:t.$store.commit("setWin",{title:"操作提示",content:"修改素材成功,一秒后跳转至素材列表页面！",winType:"confirm",timerPowerOff:1e3,callback:function(){t.$emit("closePedit",{imageName:t.fileName})}});case 21:case"end":return e.stop()}},e,t)}))()},initPosition:function(t){var e=this;return l(regeneratorRuntime.mark(function i(){var n,o,a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e.islogo=!0,e.isqr=!0,e.color=t.positionNameColor,e.fontSize=t.positionNameFontSize,e.fileName=t.imageName,e.name=t.name,e.pid=t.id,!e.fileName){i.next=13;break}return i.next=10,e.loadImg(e.fileName);case 10:n=i.sent,o=n.width,a=n.height,e.countScale(o,a);case 13:t.positionName.length>0&&(e.isname=!0,e.$nextTick().then(function(){e.initStyle("name",t.positionName,"")})),t.positionHead.length>0&&(e.islogo=!0,e.$nextTick().then(function(){e.initStyle("logo",t.positionHead,t.positionHeadSize)})),t.positionQR.length>0&&(e.isqr=!0,e.$nextTick().then(function(){e.initStyle("qr",t.positionQR,t.positionQRSize)}));case 16:case"end":return i.stop()}},i,e)}))()},initStyle:function(t,e,i){var n=e.split(","),o=0,a=0,s=0,r=0;n.length>0&&(o=parseFloat(this.imgRang.left)+parseInt(n[0])*this.imgScale,a=parseFloat(this.imgRang.top)+parseInt(n[1])*this.imgScale);var l="";if(i&&(l=i.split(","))&&l.length>0&&(s=parseInt(l[0]*this.imgScale),r=parseInt(l[1]*this.imgScale)),o+s>parseFloat(this.imgRang.left)+parseFloat(this.imgStyle.width)||a+r>parseFloat(this.imgRang.left)+parseFloat(this.imgStyle.height)||o<parseFloat(this.imgRang.left)||a<parseFloat(this.imgRang.top))this.editConfig[t].x=this.imgRang.left,this.editConfig[t].y=this.imgRang.top,this.$store.commit("setWin",{content:"坐标位置出现问题,已经重置,\n建议重新新建素材."});else{var c=this.editConfig[t];c.x=o+"px",c.y=a+"px",c.w=s+"px",c.h=r+"px"}}},directives:{moves:{bind:function(t,e,i){var n=i.context.imgRang;t.addEventListener("mousedown",function(e){var o=e.clientX-t.offsetLeft,a=e.clientY-t.offsetTop,s=t.getAttribute("data-name");document.onmousemove=function(e){var r=e.clientX-o,l=e.clientY-a,c=t.getBoundingClientRect();r<=parseFloat(n.left)&&(r=n.left),r>n.width-c.width+parseFloat(n.left)&&(r=n.width-c.width+parseFloat(n.left)),l<parseFloat(n.top)&&(l=n.top),l>n.height-c.height+parseFloat(n.top)&&(l=n.height-c.height+parseFloat(n.top)),t.style.cursor="move",i.context.editConfig[s].x=r+"px",i.context.editConfig[s].y=l+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},!1);var o=t.children[0];o&&o.addEventListener("mousedown",function(e){e.stopPropagation();var o=t.getAttribute("data-name"),a=0;document.onmousemove=function(s){var l=s.clientX-e.clientX,c=parseFloat(r.a.getDOMPosition(t).w),m=((a>0?.5*(l-a):l)+c)/c,p=c*m,u=c*m;if(!(p<24||u<24)){var f=t.offsetLeft-parseFloat(n.left),g=t.offsetTop-parseFloat(n.top);f+p>=n.width||g+u>=n.height||(t.style.lineHeight=u+"px",a=l,i.context.editConfig[o].w=p+"px",i.context.editConfig[o].h=p+"px")}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}})}}},mounted:function(){var t=a.a.session("userShop");this.uid=t.user.id,this.imgHost=t.uploadUrl,this.position&&this.initPosition(this.position)}},m=(i("b411"),i("6ceb")),p=Object(m.a)(c,n,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("基础配置")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"alertTips"},[e("i",{staticClass:"el-icon-info",staticStyle:{color:"rgb(216,219,227)"}}),this._v(" "),e("span",[this._v("底图尺寸：大小不能超过300KB，微信昵称的设计字号为24px")])])}],!1,null,"5bd54c83",null);p.options.__file="src\\module\\marketing_tools\\mall_pedit.vue";e.default=p.exports}}]);