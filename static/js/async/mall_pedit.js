(window.webpackJsonp=window.webpackJsonp||[]).push([["mall_pedit"],{"3e70":function(t,e,i){"use strict";var n=i("d105");i.n(n).a},c909:function(t,e,i){"use strict";i.r(e);var n=i("81a2"),o=i("f6ce"),a=i("05dd"),s=i("bbb9");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(o,a){try{var s=e[o](a),r=s.value}catch(t){return void i(t)}if(!s.done)return Promise.resolve(r).then(function(t){n("next",t)},function(t){n("throw",t)});t(r)}("next")})}}var l={top:0,left:0},c={data:function(){return{imgData:null,imgHost:"",fileName:null,name:null,pid:null,uid:"",isname:!1,islogo:!1,isqr:!1,color:"rgb(255,255,255)",imgStyle:{width:0,height:0},imgScale:1,fontSize:24,editConfig:{name:{x:0,y:0,w:"60px",h:"28px"},logo:{w:"64px",h:"64px",x:0,y:0},qr:{w:"64px",h:"64px",x:0,y:0}}}},props:{position:{type:null,default:null}},methods:{handleChange:function(t){this.fontSize=t+"px"},toggle:function(t){this.fileName?(this["is"+t]=!this["is"+t],this["is"+t]?(this.editConfig[t].x=parseFloat(l.left)+"px",this.editConfig[t].y=parseFloat(l.top)+"px"):"name"==t&&(this.color="#fff",this.fontSize=24)):this.$store.commit("setWin",{content:"请先上传背景图"})},reset:function(){this.color="rgb(255,255,255)",this.fontSize=24,this.imgStyle={width:0,height:0},l={top:0,left:0},this.imgScale=1},openPro:function(){this.$emit("closePedit")},loadImg:function(t){var e=this;return new Promise(function(i){var n=new Image;n.src=t.indexOf("base64")>-1?t:e.imgHost+t,n.onload=function(){i(n),n=null}})},readFile:function(t){return new Promise(function(e){var i=new FileReader;i.readAsDataURL(t),i.onload=function(){e(this.result)}})},countScale:function(t,e){var i=0,n=0;t<750&&e<750?(i=t,n=e):t>e?(this.imgScale=t/750,n=e/this.imgScale,i=750):e>t&&(this.imgScale=e/750,i=t/this.imgScale,n=750),this.imgStyle={width:i+"px",height:n+"px"},l={width:i,height:n,top:(750-n)/2+"px",left:(750-i)/2+"px"}},preFn:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var n,o,a,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.readFile(t);case 2:return n=i.sent,i.next=5,e.loadImg(n);case 5:if(o=i.sent,a=o.width,s=o.height,!(a<100||s<100)){i.next=10;break}return e.$store.commit("setWin",{content:"宽和高必须要大于100px"}),i.abrupt("return",!1);case 10:if(!(a>3e3||s>3e3)){i.next=13;break}return e.$store.commit("setWin",{content:"宽或者高不能大于3000px"}),i.abrupt("return",!1);case 13:e.reset(),e.countScale(a,s);case 15:case"end":return i.stop()}},i,e)}))()},fileNameChange:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.a.uploadImg({data:{type:6,shopId:o.a.session("shopId")},fn:t.preFn,formId:"imageUpForm"});case 2:i=e.sent,t.imgData=i,t.fileName=i;case 5:case"end":return e.stop()}},e,t)}))()},countSize:function(t,e,i){t&&(t.push(parseInt((parseFloat(this.editConfig[i].x)-parseFloat(l.left))*this.imgScale)),t.push(parseInt((parseFloat(this.editConfig[i].y)-parseFloat(l.top))*this.imgScale))),e&&(e.push(parseInt(parseFloat(this.editConfig[i].w)*this.imgScale)),e.push(parseInt(parseFloat(this.editConfig[i].h)*this.imgScale)))},onPro:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i,o,r,l,c,p,m,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],o=[],r=[],l=[],c=[],p=[],a.a.checkData({name:{cond:"$$.toString().trim() != '' && $$.toString().trim() != 0",pro:"请输入正确格式的素材名称!"}},t)){e.next=8;break}return e.abrupt("return",!1);case 8:if(t.isname&&(t.countSize(i,null,"name"),m=s.a.getDOMPosition(t.$refs.names),o.push(m.w,m.h)),t.islogo&&t.countSize(r,l,"logo"),t.isqr&&t.countSize(c,p,"qr"),u={name:t.name.toString(),imageName:t.fileName,positionName:i.toString(),positionNameSize:o.toString(),positionNameFontSize:t.fontSize,positionNameColor:t.color.replace(/rgb\(|\)/g,""),positionHead:r.toString(),positionHeadSize:l.toString(),positionQR:c.toString(),positionQRSize:p.toString(),uid:t.uid},console.log(u),!t.position){e.next=19;break}return e.next=16,n.a.ActivityEdit({data:Object.assign(u,{id:t.pid})});case 16:t.$store.commit("setWin",{title:"操作提示",content:"修改素材成功,一秒后跳转至素材列表页面！",winType:"confirm",timerPowerOff:1e3,callback:function(){t.$emit("closePedit",{imageName:t.fileName})}}),e.next=22;break;case 19:return e.next=21,n.a.ActivityAdd({data:u});case 21:t.$store.commit("setWin",{title:"操作提示",content:"修改素材成功,一秒后跳转至素材列表页面！",winType:"confirm",timerPowerOff:1e3,callback:function(){t.$emit("closePedit",{imageName:t.fileName})}});case 22:case"end":return e.stop()}},e,t)}))()},initPosition:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var n,o,a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(console.log(t),e.islogo=!0,e.isqr=!0,e.color=t.positionNameColor,e.fontSize=t.positionNameFontSize,e.fileName=t.imageName,e.name=t.name,e.pid=t.id,!e.fileName){i.next=14;break}return i.next=11,e.loadImg(e.fileName);case 11:n=i.sent,o=n.width,a=n.height,e.countScale(o,a);case 14:t.positionName.length>0&&(e.isname=!0,e.$nextTick().then(function(){e.initStyle("name",t.positionName,"")})),t.positionHead.length>0&&(e.islogo=!0,e.$nextTick().then(function(){e.initStyle("logo",t.positionHead,t.positionHeadSize)})),t.positionQR.length>0&&(e.isqr=!0,e.$nextTick().then(function(){e.initStyle("qr",t.positionQR,t.positionQRSize)}));case 17:case"end":return i.stop()}},i,e)}))()},initStyle:function(t,e,i){var n=e.split(","),o=0,a=0,s=0,r=0;n.length>0&&(o=parseFloat(l.left)+parseInt(n[0])/this.imgScale,a=parseFloat(l.top)+parseInt(n[1])/this.imgScale);var c="";if(i&&(c=i.split(","))&&c.length>0&&(s=parseInt(c[0]/this.imgScale),r=parseInt(c[1]/this.imgScale)),o+s>parseFloat(l.left)+parseFloat(this.imgStyle.width)||a+r>parseFloat(l.left)+parseFloat(this.imgStyle.height)||o<parseFloat(l.left)||a<parseFloat(l.top))this.editConfig[t].x=l.left,this.editConfig[t].y=l.top,this.$store.commit("setWin",{content:"坐标位置出现问题,已经重置,\n建议重新新建素材."});else{var p=this.editConfig[t];p.x=o+"px",p.y=a+"px",p.w=s+"px",p.h=r+"px"}}},directives:{moves:{bind:function(t,e,i){t.addEventListener("mousedown",function(e){var n=e.clientX-t.offsetLeft,o=e.clientY-t.offsetTop,a=t.getAttribute("data-name");document.onmousemove=function(e){var s=e.clientX-n,r=e.clientY-o,c=t.getBoundingClientRect();s<=parseFloat(l.left)&&(s=l.left),s>l.width-c.width+parseFloat(l.left)&&(s=l.width-c.width+parseFloat(l.left)),r<parseFloat(l.top)&&(r=l.top),r>l.height-c.height+parseFloat(l.top)&&(r=l.height-c.height+parseFloat(l.top)),t.style.cursor="move",i.context.editConfig[a].x=s+"px",i.context.editConfig[a].y=r+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},!1);var n=t.children[0];n&&n.addEventListener("mousedown",function(e){e.stopPropagation();var n=t.getAttribute("data-name"),o=0;document.onmousemove=function(a){var r=a.clientX-e.clientX,c=parseFloat(s.a.getDOMPosition(t).w),p=((o>0?.5*(r-o):r)+c)/c,m=c*p,u=c*p;if(!(m<24||u<24)){var f=t.offsetLeft-parseFloat(l.left),d=t.offsetTop-parseFloat(l.top);f+m>=l.width||d+u>=l.height||(t.style.lineHeight=u+"px",o=r,i.context.editConfig[n].w=m+"px",i.context.editConfig[n].h=m+"px")}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}})}}},mounted:function(){var t=o.a.session("userShop");this.uid=t.user.id,this.imgHost=t.uploadUrl,this.position&&this.initPosition(this.position)}},p=(i("3e70"),i("d801")),m=Object(p.a)(c,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mall-box",attrs:{id:"proedit"}},[t._m(0),t._v(" "),i("div",{staticClass:"name"},[i("div",{staticClass:"sub"},[t._v("素材名称")]),t._v(" "),i("el-input",{staticClass:"text",attrs:{placeholder:"输入名称"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),i("div",{staticClass:"type"},[i("div",{staticClass:"sub"},[t._v("素材编辑器")]),t._v(" "),i("div",{staticClass:"container"},[i("div",{class:{button:!0,disable:!t.isname,able:t.isname},on:{click:function(e){t.toggle("name")}}},[i("span",[t._v("添加昵称")]),t._v(" "),i("i",{staticClass:"el-icon-close"})]),t._v(" "),i("div",{class:{button:!0,disable:!t.islogo,able:t.islogo},on:{click:function(e){t.toggle("logo")}}},[i("span",[t._v("添加头像")]),t._v(" "),i("i",{staticClass:"el-icon-close"})]),t._v(" "),i("div",{class:{button:!0,disable:!t.isqr,able:t.isqr},on:{click:function(e){t.toggle("qr")}}},[i("span",[t._v("添加二维码")]),t._v(" "),i("i",{staticClass:"el-icon-close"})])]),t._v(" "),i("div",{staticClass:"nameConfig"},[i("div",{staticClass:"font"},[i("div",{staticClass:"tips"},[t._v("昵称字号")]),t._v(" "),i("el-input-number",{style:{fontSize:t.fontSize},attrs:{"controls-position":"right",step:2,min:12,max:64},model:{value:t.fontSize,callback:function(e){t.fontSize=e},expression:"fontSize"}})],1),t._v(" "),i("div",{staticClass:"color"},[i("div",{staticClass:"tips"},[t._v("昵称颜色")]),t._v(" "),i("el-color-picker",{attrs:{"color-format":"rgb"},model:{value:t.color,callback:function(e){t.color=e},expression:"color"}})],1)])]),t._v(" "),i("div",{staticClass:"upload"},[i("div",{staticClass:"sub"},[t._v("上传图片")]),t._v(" "),i("form",{staticStyle:{position:"absolute"},attrs:{id:"imageUpForm",enctype:"multipart/form-data"}},[i("input",{staticStyle:{opacity:"0"},attrs:{type:"file",id:"file_upload",accept:"image/jpeg,image/png,image/gif,image/tiff",name:"image"},on:{change:t.fileNameChange}})]),t._v(" "),i("el-button",{staticClass:"upload_but",staticStyle:{position:"relative"},attrs:{type:"primary"}},[i("label",{staticStyle:{position:"absolute",width:"100%",height:"100%",left:"0",top:"0",cursor:"pointer"},attrs:{for:"file_upload"}}),t._v(" "),i("i",{staticClass:"el-icon-plus el-icon--left"}),t._v("上传图片\n\t\t")])],1),t._v(" "),t._m(1),t._v(" "),i("div",{ref:"editContent",staticClass:"editCont"},[t.isname?i("div",{directives:[{name:"moves",rawName:"v-moves"}],ref:"names",staticClass:"names",style:{fontSize:t.fontSize+"px",color:t.color,top:t.editConfig.name.y,left:t.editConfig.name.x},attrs:{"data-name":"name"}},[t._v("昵称")]):t._e(),t._v(" "),t.islogo?i("div",{directives:[{name:"moves",rawName:"v-moves"}],ref:"editHead",staticClass:"edit-head",style:{lineHeight:t.editConfig.logo.h,width:t.editConfig.logo.w,height:t.editConfig.logo.h,top:t.editConfig.logo.y,left:t.editConfig.logo.x},attrs:{"data-name":"logo"}},[t._v("\n\t\t\t头像\n\t\t\t"),i("div")]):t._e(),t._v(" "),t.isqr?i("div",{directives:[{name:"moves",rawName:"v-moves"}],ref:"prowx",staticClass:"prowx",style:{lineHeight:t.editConfig.qr.h,width:t.editConfig.qr.w,height:t.editConfig.qr.h,top:t.editConfig.qr.y,left:t.editConfig.qr.x},attrs:{"data-name":"qr"}},[t._v("\n\t\t\t二维码\n\t\t\t"),i("div")]):t._e(),t._v(" "),null!=t.fileName?i("img",{staticClass:"centerImg",style:t.imgStyle,attrs:{src:t.imgHost+t.fileName}}):t._e()]),t._v(" "),i("div",{staticClass:"submitBut"},[i("el-button",{attrs:{type:"info"},on:{click:t.openPro}},[t._v("关闭")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.onPro}},[t._v("保存")])],1)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("基础配置")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"alertTips"},[e("i",{staticClass:"el-icon-info",staticStyle:{color:"rgb(216,219,227)"}}),this._v(" "),e("span",[this._v("底图尺寸：大小不能超过300KB，微信昵称的设计字号为24px")])])}],!1,null,"a5df1a0a",null);e.default=m.exports},d105:function(t,e,i){}}]);