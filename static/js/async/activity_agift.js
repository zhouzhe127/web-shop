(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_agift"],{"09e8":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"member-agift",attrs:{id:"member-agift"}},[t._m(0),t._v(" "),i("div",{staticClass:"main_Box",staticStyle:{overflow:"initial"}},[i("div",{staticClass:"agift-content"},[i("span",{staticClass:"fl required"},[t._v("活动标题")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"fl",attrs:{type:"text",placeholder:"请输入活动标题",maxlength:"20"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"agift-content clearfix",staticStyle:{overflow:"visible"}},[i("span",{staticClass:"fl required"},[t._v("活动时间")]),t._v(" "),i("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[i("calendar",{staticClass:"fl",attrs:{pObj:t.startObj},on:{throwTime:t.getStartTime}}),t._v(" "),i("span",{staticClass:"fl",staticStyle:{width:"50px","text-align":"center","margin-right":"0"}},[t._v("-")]),t._v(" "),i("calendar",{staticClass:"fl",attrs:{pObj:t.endObj},on:{throwTime:t.getEndTime}})],1),t._v(" "),i("span",{staticClass:"fl",staticStyle:{"text-align":"left","text-indent":"20px",color:"#A3A3A3"}},[t._v("共"+t._s(t.returnInt)+"天")])]),t._v(" "),i("div",{staticClass:"agift-content"},[i("span",{staticClass:"fl required"},[t._v("活动范围")]),t._v(" "),"3"==t.brandId?[i("div",{staticClass:"btn-concent",on:{click:t.openActivityWin}},[i("button",{staticClass:"fl increase",staticStyle:{width:"120px"}},[t._v("选择范围")])]),t._v(" "),t.activityList.length>=1?i("span",{staticClass:"fl"},[t._v("已选择"+t._s(t.activityList.length)+"家店铺")]):t._e()]:[i("span",{staticStyle:{width:"auto"}},[t._v(t._s(t.shopName))])]],2),t._v(" "),t._m(1)]),t._v(" "),t._m(2),t._v(" "),i("div",{staticClass:"mani_Box"},[i("div",{staticClass:"agift-content",staticStyle:{overflow:"inherit",height:"40px"}},[i("span",{staticClass:"fl"},[t._v("会员权益")]),t._v(" "),i("div",{staticClass:"fl selectList",on:{click:t.openSelect}},[t._v("\n\t\t\t\t"+t._s(t.onListName)+"\n\t\t\t\t"),t.isList?i("ul",t._l(t.lists,function(e,n){return i("li",{key:n,on:{click:function(i){t.getListDetail(e,n)}}},[t._v(t._s(e.name))])})):t._e()]),t._v(" "),i("span",{staticClass:"fl moreBtn",staticStyle:{border:"1px solid #CCCCCC","border-left":"none",cursor:"pointer"},on:{click:t.openSelect}},[i("i")])]),t._v(" "),0==t.memberRights?i("div",{staticClass:"agift-content"},[i("span",{staticClass:"fl"}),t._v(" "),i("div",{staticClass:"btn-concent",on:{click:t.openCouponWin}},[i("button",{staticClass:"fl increase",staticStyle:{width:"150px"}},[t._v("选择优惠劵")])]),t._v(" "),t.couponLists.length>=1?i("span",{staticClass:"fl"},[t._v("已选择"+t._s(t.couponLists.length)+"张")]):t._e()]):t._e(),t._v(" "),i("div",{staticClass:"agift-content"},[i("span",{staticClass:"fl"},[t._v("消息推送渠道")]),t._v(" "),i("mulSelect",{attrs:{styles:{backgroundColor:"rgb(247,247,247)"},list:t.list,selects:t.selects,name:"name",keyName:"id"},on:{selOn:t.selOnSend}}),t._v(" "),i("span",{staticClass:"fl",staticStyle:{width:"auto",color:"#666666","padding-left":"20px"}},[t._v("活动发布后将通过该渠道触发会员")])],1),t._v(" "),i("div",{staticClass:"agift-content"},[i("label",[i("span",{staticClass:"required required-none",staticStyle:{"vertical-align":"top","padding-top":"10px"}},[t._v("内容设置")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.memberContent,expression:"memberContent"}],staticStyle:{width:"350px",height:"100px"},attrs:{placeholder:"内容设置",maxlength:"151"},domProps:{value:t.memberContent},on:{input:function(e){e.target.composing||(t.memberContent=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"limit"},[t._m(3),t._v(" "),t.msmStatus?i("p",{staticClass:"fl"},[t._v("您已输入"+t._s(t.memberContent.length)+"个字,目前发送"+t._s(Math.ceil(t.memberContent.length/60))+"条短信")]):t._e()]),t._v(" "),i("div",{staticClass:"limit"},[i("p",[t._v("引用参数:\n\t\t\t\t\t"),t._l(t.parameter,function(e,n){return i("a",{key:n,staticStyle:{color:"#FF9200"},on:{click:function(e){t.addParameter(n,1)}}},[t._v(t._s(e.name))])})],2)])]),t._v(" "),i("div",{staticClass:"agift-content"},[i("label",[i("span",{staticClass:"required required-none",staticStyle:{"vertical-align":"top","padding-top":"10px"}},[t._v("活动说明")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.explain,expression:"explain"}],staticStyle:{width:"350px",height:"100px"},attrs:{placeholder:"请输入活动说明",maxlength:"151"},domProps:{value:t.explain},on:{input:function(e){e.target.composing||(t.explain=e.target.value)}}})]),t._v(" "),t._m(4)]),t._v(" "),i("div",{staticClass:"agift-content",staticStyle:{"padding-left":"60px"}},[i("a",{staticClass:"gray",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:t.closePage}},[t._v("取消")]),t._v(" "),"3"==t.brandId||"0"==t.brandId?i("a",{staticClass:"gray",staticStyle:{width:"200px",background:"#858585"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addActivity("0")}}},[t._v("保存")]):t._e(),t._v(" "),0==t.edit?i("a",{staticClass:"yellow",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addActivity("1")}}},[t._v("发布")]):t._e()])]),t._v(" "),t.showRang?i("rang",{attrs:{activityList:t.activityList},on:{winEvent:t.rangEvent}}):t._e(),t._v(" "),t.showCoupon?i("coupon",{attrs:{selectCoupon:t.couponLists},on:{winEvent:t.couponEvent}}):t._e()],1)},s=[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"header_tit"},[e("span",[this._v("活动设置")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"agift-content"},[e("span",{staticClass:"fl"},[this._v("活动群体")]),this._v(" "),e("span",{staticStyle:{"text-align":"left",color:"#A3A3A3"}},[this._v("全部会员")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"header_tit"},[e("span",[this._v("营销规则设置")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"fl",staticStyle:{"margin-right":"102px"}},[e("img",{staticClass:"icon-i",attrs:{src:i("31bf")}}),this._v("限150字以内")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"limit"},[e("img",{staticClass:"icon-i",attrs:{src:i("31bf")}}),this._v("限150字以内")])}];n._withStripped=!0;var a=i("bbb9"),r=i("f6ce"),c=i("81a2");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(s,a){try{var r=e[s](a),c=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(c).then(function(t){n("next",t)},function(t){n("throw",t)});t(c)}("next")})}}var l={data:function(){return{startObj:{time:a.a.getTime({time:new Date}).start},endObj:{time:(new Date).getTime()},returnInt:1,list:[{name:"微信",id:"1"}],selects:[],msmStatus:!1,lists:[{name:"电子优惠劵",id:"1"},{name:"无",id:"2"}],isList:!1,brandId:0,onListName:"无",activityList:[],couponLists:[],explain:"",memberRights:-1,title:"",compareArr:[],shopName:"",edit:!1,activityDetail:{},memberContent:"",parameter:[{name:"【会员姓名】",id:"{memberName}"},{name:"【优惠券名称】",id:"{couponName}"},{name:"【优惠券数量】",id:"{couponNum}"},{name:"【活动名称】",id:"{activityName}"},{name:"【注册时间】",id:"{registerTime}"}],showRang:!1,showCoupon:!1}},computed:{start:{get:function(){return a.a.format(this.startObj.time,"yyyy/MM/dd")}},end:{get:function(){return a.a.format(this.endObj.time,"yyyy/MM/dd")}},titles:{get:function(){return this.title},set:function(t){this.title=t}}},methods:{selOnSend:function(t){this.selects=t},getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},addParameter:function(t){this.memberContent+=this.parameter[t].id},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},openSelect:function(){this.isList=!this.isList},getListDetail:function(t,e){this.onListName=t.name,this.memberRights=e,0!=this.memberRights&&(this.couponLists=[])},openActivityWin:function(){this.showRang=!0},rangEvent:function(t){this.showRang=!1,t.selects&&(this.activityList=a.a.unique(t.selects))},couponEvent:function(t){this.showCoupon=!1,t.data.select&&"ok"==t.status&&(this.couponLists=t.data.select)},openCouponWin:function(){this.showCoupon=!0},closePage:function(){this.$router.push("/admin/activity")},getCouponList:function(t,e){for(var i=[],n=0;n<t.length;n++)for(var s=0;s<e.length;s++)t[n]==e[s].id&&i.push({id:e[s].id,name:e[s].name});return i},getCouponId:function(t,e){var i=void 0,n=[];for(t=1!=e?JSON.parse(t):t,i=0;i<t.length;i++)n.push(t[i].id);return n},getNoLimitCoupon:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.a.getCouponCondition({data:{}});case 2:i=e.sent,t.compareArr=a.a.deepCopy(i);case 4:case"end":return e.stop()}},e,t)}))()},addActivity:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var n,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(""!=e.title.trim()){i.next=3;break}return e.$store.commit("setWin",{content:"请填写活动标题",timerPowerOff:1e3}),i.abrupt("return",!1);case 3:if(!(e.startObj.time>e.endObj.time)){i.next=6;break}return e.$store.commit("setWin",{content:"开始时间不能大于结束时间",timerPowerOff:1e3}),i.abrupt("return",!1);case 6:if(!(e.endObj.time<e.startObj.time)){i.next=9;break}return e.$store.commit("setWin",{content:"结束时间不能小于开始时间",timerPowerOff:1e3}),i.abrupt("return",!1);case 9:if(!(e.endObj.time<(new Date).getTime())){i.next=12;break}return e.$store.commit("setWin",{content:"活动结束时间应大于当前时间",timerPowerOff:1e3}),i.abrupt("return",!1);case 12:if("3"!=e.brandId&&(e.activityList=[],e.activityList.push(e.userData.currentShop.id)),!a.a.isEmptyObject(e.activityList)){i.next=16;break}return e.$store.commit("setWin",{content:"请选择活动范围",timerPowerOff:1e3}),i.abrupt("return",!1);case 16:if(n=[],s={couponIds:e.couponLists,minConsume:"",maxConsume:"",isLoop:"0",memberRights:Number(!e.memberRights),pushChannel:e.selects.toString().replace(/,/g,""),msgContent:e.memberContent},n.push(s),!e.edit){i.next=32;break}return e.activityDetail.name=e.title,e.activityDetail.startTime=Math.round(e.startObj.time/1e3),e.activityDetail.endTime=Math.round(e.endObj.time/1e3),e.activityDetail.shopIds=e.activityList.toString(),n[0].id=e.activityDetail.rule[0].id,e.activityDetail.rule=a.a.deepCopy(n),e.activityDetail.isAuto=t,i.next=29,c.a.editActivity({data:{activityId:r.a.session("activityInfo").id,data:JSON.stringify(e.activityDetail)}});case 29:e.$store.commit("setWin",{content:"保存成功,1秒后跳转至活动列表",callback:function(){e.closePage()},timerPowerOff:1e3}),i.next=35;break;case 32:return i.next=34,c.a.addActivity({data:{shopIds:e.activityList.toString(),type:r.a.session("activityType").type,name:e.title,mouldType:r.a.session("activityType").mouldType,objectType:"2",startTime:Math.round(e.startObj.time/1e3),endTime:Math.round(e.endObj.time/1e3),isAuto:t,getType:"0",explain:e.explain,rule:JSON.stringify(n)}});case 34:e.$store.commit("setWin",{content:"发布成功,1秒后跳转至活动列表",callback:function(){e.closePage()},timerPowerOff:1e3});case 35:case"end":return i.stop()}},i,e)}))()},getActivityDetail:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var n,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,c.a.getActivityDetail({data:{aid:t.id,type:t.type,mouldType:t.mouldType}});case 2:n=i.sent,s=n,e.title=s.name,e.startObj.time=Number(Math.round(1e3*s.startTime)),e.endObj.time=Number(Math.round(1e3*s.endTime)),e.activityList=null==s.shopIds?[]:s.shopIds.split(","),e.selects=s.rule[0].pushChannel.length>1?s.rule[0].pushChannel.split("").toString().split(","):s.rule[0].pushChannel.split(","),e.explain=s.explain,e.memberContent=s.rule[0].msgContent,e.couponLists=JSON.parse(s.rule[0].couponIds),e.activityDetail=a.a.deepCopy(s),e.edit=!0,e.memberRights=Number(!Number(s.rule[0].memberRights)),e.onListName=0==e.memberRights?"电子优惠卷":"无";case 16:case"end":return i.stop()}},i,e)}))()}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange",selects:function(){-1!=this.selects.indexOf("2")?this.msmStatus=!0:this.msmStatus=!1},memberContent:function(){this.memberContent.length>150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.memberContent=this.memberContent.substr(0,150))},explain:function(){this.explain.length>150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.explain=this.explain.substr(0,150))}},components:{calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))},canMulti:function(){return i.e("can_multi").then(i.bind(null,"742e"))},mulSelect:function(){return i.e("mul_select").then(i.bind(null,"7d09"))},rang:function(){return i.e("activity_agift_rang").then(i.bind(null,"5267"))},coupon:function(){return i.e("activity_agift_coupon").then(i.bind(null,"30d3"))}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){t.closePage()}}]),this.userData=r.a.session("userShop"),this.ischain=this.userData.currentShop.ischain,this.shopName=this.userData.currentShop.name;var e=r.a.session("activityInfo");e&&this.getActivityDetail(e),this.getNoLimitCoupon()},beforeDestroy:function(){r.a.session("activityInfo",null)}},m=(i("f6f4"),i("7610")),u=Object(m.a)(l,n,s,!1,null,"455324d5",null);u.options.__file="src\\module\\marketing_tools\\activity_agift.vue";e.default=u.exports},"31bf":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjFCQThBNjA5NTcxNTExRTdCNzI4QzVFQTBERTkzQkVEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjFCQThBNjBBNTcxNTExRTdCNzI4QzVFQTBERTkzQkVEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MUJBOEE2MDc1NzE1MTFFN0I3MjhDNUVBMERFOTNCRUQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MUJBOEE2MDg1NzE1MTFFN0I3MjhDNUVBMERFOTNCRUQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4kIzh0AAABmklEQVR42oyUTSgFURTHvdfzke+yYMNiUKOXyIKUCK9slJKPbGyUslBWVhIrK/UUexsLxEaRzxI2Sh4WJDNJsfGRFFHy/I/+U891Z8apX/d0z73/OXPuuTdgWVaSxppAN8cizt2AHbAAtp2FhmH8jCFFwASzoEYjXkL6QQz0gAsnGExY2ACOXURUqwQn3PNLSDJZBWkem8dAOwXEUsC6bdum82sBMAfSPUT2wTj9ZDBPPxUsQywsGTWDKp9fqQMdzHxYiZWBiGTU5SHwClbAPRgE9S7rhkI8Yp1tgiPWbo9zDyBPs7ZWfq1QE7hlzwyAAs5lsj46yxGhD00gF0yAA7DIuSjIdquBCN1p5jM49nLMB30etXwRoUOX4BR4pD/tc6qnQfaQau9glH4jj34GPLsITYrQBjhTAkuSLv03MEI/SyNiS4vI8cfZSzF2qlgpKGYNw6ATVGhEPkErXoC4c/vlFrcwO7lD1eDKpy4iEoHIuXr7d/nVy3/c/mtQzj1/nhEnM5PZrYEn8MWvS1dvgTZ5zxLfIrFvAQYAHHVSK1WxAuMAAAAASUVORK5CYII="},"5fc4":function(t,e,i){},f6f4:function(t,e,i){"use strict";var n=i("5fc4");i.n(n).a}}]);