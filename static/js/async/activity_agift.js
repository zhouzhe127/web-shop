(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_agift"],{"7fc1":function(t,e,i){},"95c4":function(t,e,i){"use strict";i.r(e);var n=i("bbb9"),s=i("f6ce"),a=i("81a2");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(s,a){try{var r=e[s](a),l=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(l).then(function(t){n("next",t)},function(t){n("throw",t)});t(l)}("next")})}}var l={data:function(){return{ischain:"",shopId:"",startObj:{time:n.a.getTime({time:new Date}).start},endObj:{time:n.a.getTime({time:new Date}).end},returnInt:1,list:[{name:"微信",id:"1"}],selects:[],durationList:[{name:"无",id:0},{name:"电子优惠劵",id:1}],durationId:0,durationName:"无",explain:"",title:"",shopName:"",edit:!1,activityDetail:{},memberContent:"",parameter:[{name:"【会员姓名】",id:"{memberName}"},{name:"【优惠券名称】",id:"{couponName}"},{name:"【优惠券数量】",id:"{couponNum}"},{name:"【活动名称】",id:"{activityName}"},{name:"【注册时间】",id:"{registerTime}"}],showRang:!1,showCoupon:!1,isactivityDetail:!0,shopList:[],selectsList:[],selectCoupon:[],couponList:[],editId:""}},methods:{valiData:function(t,e,i){this.$store.commit("setWin",{content:t,title:e,winType:i})},selOnSend:function(t){this.selects=t},getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},selexpirationTime:function(t){this.durationId=t},addParameter:function(t){this.memberContent+=this.parameter[t].id},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},openActivityWin:function(){this.showRang=!0},rangEvent:function(t){"ok"==t.status&&(this.selectsList=t.select),this.showRang=!1},couponEvent:function(t){this.showCoupon=!1,"ok"==t.status&&(this.selectCoupon=t.data.select,this.couponList=t.data.list)},openCouponWin:function(){var t=this;return r(regeneratorRuntime.mark(function e(){var i,n,s,r,l,o,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.getGetCouponCondition({});case 2:for(i=e.sent,n=[],s=!0,r=!1,l=void 0,e.prev=7,o=i[Symbol.iterator]();!(s=(c=o.next()).done);s=!0)(u=c.value).num=1,7!=u.type&&n.push(u);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),r=!0,l=e.t0;case 15:e.prev=15,e.prev=16,!s&&o.return&&o.return();case 18:if(e.prev=18,!r){e.next=21;break}throw l;case 21:return e.finish(18);case 22:return e.finish(15);case 23:t.couponList=n,t.showCoupon=!0;case 25:case"end":return e.stop()}},e,t,[[7,11,15,23],[16,,18,22]])}))()},closePage:function(){this.$router.push("/admin/activity/generalActivity")},checkForm:function(){return""==this.title.trim()?(this.valiData("请填写活动标题"),!1):this.startObj.time>this.endObj.time?(this.valiData("开始时间不能大于结束时间"),!1):this.endObj.time<this.startObj.time?(this.valiData("结束时间不能小于开始时间"),!1):this.endObj.time<(new Date).getTime()?(this.valiData("活动结束时间应大于当前时间"),!1):0==this.selectsList.length?(this.valiData("请选择活动范围"),!1):1!=this.durationId||0!=this.selectCoupon.length||(this.valiData("请选择优惠券"),!1)},addActivity:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var s,r,l;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e.checkForm()){i.next=2;break}return i.abrupt("return");case 2:if(s=[],r={couponIds:e.selectCoupon,minConsume:"",maxConsume:"",isLoop:"0",memberRights:e.durationId,pushChannel:e.selects.toString().replace(/,/g,""),msgContent:e.memberContent},s.push(r),!e.edit){i.next=17;break}return e.activityDetail.name=e.title,e.activityDetail.startTime=Math.round(e.startObj.time/1e3),e.activityDetail.endTime=Math.round(e.endObj.time/1e3),e.activityDetail.shopIds="3"==e.ischain?e.selectsList.join(","):e.shopId,s[0].id=e.activityDetail.rule[0].id,e.activityDetail.rule=n.a.deepCopy(s),e.activityDetail.isAuto=t,i.next=15,a.a.fissionActivity({data:{activityId:e.editId,data:JSON.stringify(e.activityDetail)}});case 15:i.next=19;break;case 17:return i.next=19,a.a.fissionActivity({data:{shopIds:"3"==e.ischain?e.selectsList.join(","):e.shopId,type:2,name:e.title,mouldType:0,objectType:2,startTime:Math.round(e.startObj.time/1e3),endTime:Math.round(e.endObj.time/1e3),isAuto:t,getType:"0",explain:e.explain,rule:JSON.stringify(s)}});case 19:l="0"==t?"保存成功":"发布成功",e.valiData(l),e.closePage();case 22:case"end":return i.stop()}},i,e)}))()},getActivityDetail:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var s,r;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.a.newgetActivityDetail({data:{activityId:t.id,type:t.type,mouldType:t.mouldType}});case 2:s=i.sent,r=s,e.title=r.name,e.startObj.time=Number(Math.round(1e3*r.startTime)),e.endObj.time=Number(Math.round(1e3*r.endTime)),e.selectsList=s.shopIds.split(","),e.selects=r.rule[0].pushChannel.length>1?r.rule[0].pushChannel.split("").toString().split(","):r.rule[0].pushChannel.split(","),e.explain=r.explain,e.memberContent=r.rule[0].msgContent,s.rule[0].couponIds=JSON.parse(s.rule[0].couponIds),e.durationId=Number(r.rule[0].memberRights),e.durationName=e.durationList[e.durationId].name,1==e.durationId&&(e.selectCoupon=s.rule[0].couponIds),e.activityDetail=n.a.deepCopy(r),e.edit=!0;case 17:case"end":return i.stop()}},i,e)}))()}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange",memberContent:function(){this.memberContent.length>150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.memberContent=this.memberContent.substr(0,150))},explain:function(){this.explain.length>150&&(this.$store.commit("setWin",{content:"仅限150个字符"}),this.explain=this.explain.substr(0,150))}},components:{calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))},canMulti:function(){return i.e("can_multi").then(i.bind(null,"742e"))},mulSelect:function(){return i.e("mul_select").then(i.bind(null,"7d09"))},rang:function(){return i.e("activity_agift_rang").then(i.bind(null,"4b40"))},birthCoupon:function(){return i.e("activity_birth_coupon").then(i.bind(null,"2d94"))},selectBtn:function(){return i.e("select_btn").then(i.bind(null,"3d41"))}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){t.closePage()}}]),this.shopList=s.a.session("shopList");var e=s.a.session("userShop");this.ischain=e.currentShop.ischain,this.shopName=e.currentShop.name;var i=s.a.session("activityInfo");i&&(i.isShowdetail&&(this.isactivityDetail=!1),this.editId=i.id,this.getActivityDetail(i))},beforeDestroy:function(){s.a.session("activityInfo",null)}},o=(i("de682"),i("d801")),c=Object(o.a)(l,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"member-agift",attrs:{id:"member-agift"}},[t._m(0),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动名称")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-input",{attrs:{maxlength:"10",placeholder:"请输入活动标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("活动时间")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[i("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp"},on:{change:t.getStartTime},model:{value:t.startObj.time,callback:function(e){t.$set(t.startObj,"time",e)},expression:"startObj.time"}}),t._v(" "),i("span",{staticClass:"fl lines"},[t._v("-")]),t._v(" "),i("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp"},on:{change:t.getEndTime},model:{value:t.endObj.time,callback:function(e){t.$set(t.endObj,"time",e)},expression:"endObj.time"}})],1),t._v(" "),i("span",{staticClass:"fl returnInt"},[t._v("共"+t._s(t.returnInt)+"天")])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动范围")]),t._v(" "),"3"==t.ischain?i("div",{staticClass:"rightHalf"},[i("el-button",{staticStyle:{width:"179px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.openActivityWin}},[t._v("关联门店")]),t._v(" "),t.selectsList.length>=1?i("span",[t._v("(已选择"+t._s(t.selectsList.length)+"家店铺)")]):t._e()],1):i("div",{staticClass:"rightHalf"},[i("span",{staticClass:"obj"},[t._v(t._s(t.shopName))])])]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("会员权益")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-select",{staticStyle:{color:"#c0c4cc",width:"179px"},attrs:{placeholder:"请选择"},on:{change:t.selexpirationTime},model:{value:t.durationName,callback:function(e){t.durationName=e},expression:"durationName"}},t._l(t.durationList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)]),t._v(" "),"1"==t.durationId?i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("关联优惠券")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-button",{staticStyle:{width:"179px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.openCouponWin}},[t._v("选择关联优惠券")]),t._v(" "),t.selectCoupon.length>0?i("span",[t._v("(已关联"+t._s(t.selectCoupon.length)+"张)")]):t._e()],1)]):t._e(),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("消息推送渠道")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("mulSelect",{staticClass:"fl",attrs:{styles:{backgroundColor:"rgb(240,240,240)"},list:t.list,selects:t.selects,name:"name",keyName:"id"},on:{selOn:t.selOnSend}}),t._v(" "),t._m(3)],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("内容设置")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.memberContent,expression:"memberContent"}],attrs:{placeholder:"请输入内容设置",maxlength:"151"},domProps:{value:t.memberContent},on:{input:function(e){e.target.composing||(t.memberContent=e.target.value)}}}),t._v(" "),t._m(4),t._v(" "),i("div",{staticClass:"limit"},[i("p",[t._v("引用参数:\n\t\t\t\t\t"),t._l(t.parameter,function(e,n){return i("a",{key:n,staticStyle:{color:"#FF9200"},on:{click:function(e){t.addParameter(n,1)}}},[t._v(t._s(e.name))])})],2)])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("活动说明")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.explain,expression:"explain"}],attrs:{placeholder:"请输入活动说明",maxlength:"151"},domProps:{value:t.explain},on:{input:function(e){e.target.composing||(t.explain=e.target.value)}}}),t._v(" "),t._m(5)])]),t._v(" "),i("div",{staticClass:"agift-content",staticStyle:{"padding-left":"60px"}},[i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"info",plain:""},on:{click:t.closePage}},[t._v("取消")]),t._v(" "),t.isactivityDetail?[i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"info"},on:{click:function(e){t.addActivity("0")}}},[t._v("保存")]),t._v(" "),0==t.edit?i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"primary"},on:{click:function(e){t.addActivity("1")}}},[t._v("发布")]):t._e()]:t._e()],2),t._v(" "),t.showRang?i("rang",{attrs:{activityList:t.shopList,selectsList:t.selectsList},on:{winEvent:t.rangEvent}}):t._e(),t._v(" "),t.showCoupon?i("birthCoupon",{attrs:{selectCoupon:t.selectCoupon,couponList:t.couponList},on:{winEvent:t.couponEvent}}):t._e()],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("活动设置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"online-box clearfix"},[e("span",{staticClass:"online-sub fl required"},[this._v("活动群体")]),this._v(" "),e("div",{staticClass:"rightHalf"},[e("span",{staticClass:"obj"},[this._v("全部会员")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("营销规则设置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl handle-tips"},[e("i"),this._v(" 活动发布后将通过该渠道触发会员\n\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bluehandle-tips"},[e("i"),this._v(" 活动发布后将通过该渠道触发会员\n\t\t\t")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bluehandle-tips"},[e("i"),this._v(" 限150字以内\n\t\t\t")])}],!1,null,"51d89d12",null);e.default=c.exports},de682:function(t,e,i){"use strict";var n=i("7fc1");i.n(n).a}}]);