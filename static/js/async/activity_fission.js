(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_fission"],{"5ebb":function(t,e,i){"use strict";var n=i("6897");i.n(n).a},6897:function(t,e,i){},cf16:function(t,e,i){"use strict";i.r(e);var n=i("81a2"),s=i("f6ce"),a=i("bbb9");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(s,a){try{var o=e[s](a),r=o.value}catch(t){return void i(t)}if(!o.done)return Promise.resolve(r).then(function(t){n("next",t)},function(t){n("throw",t)});t(r)}("next")})}}var r={data:function(){return{startObj:{time:a.a.getTime({time:new Date}).start},endObj:{time:(new Date).getTime()},dates:(new Date).getTime(),returnInt:1,promotersPoint:"",promotersNum:"",followersPoint:"",activityName:"",showBirthCoupon:!1,couponList:[],selectCoupon:[],promotersCoupon:[],followersCoupon:[],couponType:"",editId:"",ruleId:"",isclick:!1,isactivityDetail:!0}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange"},methods:{closePage:function(){this.$router.push("/admin/activity/generalActivity")},getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},transformDate:function(t){return a.a.format(new Date(t),"yyyy-MM-dd")},valiData:function(t,e,i){this.$store.commit("setWin",{content:t,title:e,winType:i})},winEvent:function(t){this.showBirthCoupon=!1,"ok"==t.status&&("1"==this.couponType?this.promotersCoupon=t.data.select:"2"==this.couponType&&(this.followersCoupon=t.data.select))},addCount:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var s,a,o,r,l,c,u,p;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.a.getGetCouponCondition({data:{}});case 2:for(s=i.sent,a=[],o=!0,r=!1,l=void 0,i.prev=7,c=s[Symbol.iterator]();!(o=(u=c.next()).done);o=!0)7!=(p=u.value).type&&a.push(p);i.next=15;break;case 11:i.prev=11,i.t0=i.catch(7),r=!0,l=i.t0;case 15:i.prev=15,i.prev=16,!o&&c.return&&c.return();case 18:if(i.prev=18,!r){i.next=21;break}throw l;case 21:return i.finish(18);case 22:return i.finish(15);case 23:e.couponList=a,e.couponList.forEach(function(t){t.num=1}),e.couponType=t,"1"==e.couponType?e.selectCoupon=e.promotersCoupon:"2"==e.couponType&&(e.selectCoupon=e.followersCoupon),e.showBirthCoupon=!0;case 28:case"end":return i.stop()}},i,e,[[7,11,15,23],[16,,18,22]])}))()},checkForm:function(){return""==this.activityName?(this.valiData("活动标题不能为空!"),!1):!this.isclick||(this.valiData("请勿重复保存!"),!1)},saveConfig:function(t){this.checkForm()&&(""==this.editId?this.addConfig(t):this.ediConfig(t))},addConfig:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var s,a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return s=[],a={couponIds:{couponLimit:e.promotersNum,promoter:e.promotersCoupon,fans:e.followersCoupon},maxConsume:e.followersPoint,minConsume:e.promotersPoint},s.push(a),i.next=5,n.a.fissionActivity({data:{type:4,mouldType:0,name:e.activityName,objectType:2,startTime:parseInt(e.startObj.time/1e3),endTime:parseInt(e.endObj.time/1e3),isAuto:t,rule:JSON.stringify(s)}});case 5:e.isclick=!0,o="0"==t?"保存成功":"发布成功",e.valiData(o),e.closePage();case 9:case"end":return i.stop()}},i,e)}))()},ediConfig:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var s,a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(s={}).type=4,s.mouldType=0,s.name=e.activityName,s.objectType=2,s.startTime=parseInt(e.startObj.time/1e3),s.endTime=parseInt(e.endObj.time/1e3),s.isAuto=t,s.rule=[],a={id:e.ruleId,couponIds:{couponLimit:e.promotersNum,promoter:e.promotersCoupon,fans:e.followersCoupon},maxConsume:e.followersPoint,minConsume:e.promotersPoint},s.rule.push(a),i.next=13,n.a.fissionActivity({data:{activityId:e.editId,data:JSON.stringify(s)}});case 13:e.isclick=!0,e.valiData("保存成功"),e.closePage();case 16:case"end":return i.stop()}},i,e)}))()},getActivityDetail:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.a.newgetActivityDetail({data:{activityId:t.id,type:t.type,mouldType:t.mouldType}});case 2:(s=i.sent)&&(e.activityName=s.name,e.startObj.time=1e3*s.startTime,e.endObj.time=1e3*s.endTime,s.rule[0].couponIds=JSON.parse(s.rule[0].couponIds),e.promotersPoint=s.rule[0].minConsume,e.followersPoint=s.rule[0].maxConsume,e.promotersNum=s.rule[0].couponIds.couponLimit,e.promotersCoupon=s.rule[0].couponIds.promoter,e.followersCoupon=s.rule[0].couponIds.fans,e.ruleId=s.rule[0].id);case 4:case"end":return i.stop()}},i,e)}))()}},components:{"can-multi":function(){return i.e("can_multi").then(i.bind(null,"742e"))},birthCoupon:function(){return i.e("activity_birth_coupon").then(i.bind(null,"2d94"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){t.closePage()}}]);var e=s.a.session("activityInfo");s.a.session("activityDetail")&&(this.isactivityDetail=!1),e&&(this.editId=e.id,this.getActivityDetail(e))},beforeDestroy:function(){s.a.session("activityInfo",null),s.a.session("activityDetail",null)}},l=(i("5ebb"),i("d801")),c=Object(l.a)(r,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"fissoin"}},[t._m(0),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动名称")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-input",{attrs:{maxlength:"10",placeholder:"请输入活动标题"},model:{value:t.activityName,callback:function(e){t.activityName=e},expression:"activityName"}})],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("活动时间")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[i("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp"},on:{change:t.getStartTime},model:{value:t.startObj.time,callback:function(e){t.$set(t.startObj,"time",e)},expression:"startObj.time"}}),t._v(" "),i("span",{staticClass:"fl",staticStyle:{width:"40px","text-align":"center","margin-right":"0"}},[t._v("-")]),t._v(" "),i("el-date-picker",{staticClass:"fl",attrs:{type:"datetime",placeholder:"选择日期时间",clearable:!1,"value-format":"timestamp"},on:{change:t.getEndTime},model:{value:t.endObj.time,callback:function(e){t.$set(t.endObj,"time",e)},expression:"endObj.time"}})],1),t._v(" "),i("span",{staticClass:"fl",staticStyle:{"text-align":"left","text-indent":"20px",color:"#A3A3A3"}},[t._v("共"+t._s(t.returnInt)+"天")])])]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("推广者获礼")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-button",{staticStyle:{width:"179px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.addCount("1")}}},[t._v("选择关联优惠券")]),t._v(" "),t.promotersCoupon.length>0?i("span",[t._v("(已关联"+t._s(t.promotersCoupon.length)+"张)")]):t._e()],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("推广者获得积分")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-input",{staticStyle:{width:"179px"},attrs:{placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.followersPoint,callback:function(e){t.followersPoint=e},expression:"followersPoint"}},[i("template",{slot:"suffix"},[t._v("分")])],2),t._v(" "),i("span",[t._v("(只有当其微信用户通过本推广者分享的【推广者二维码】而满足公众号的情况下,才能获得相应积分奖励)")])],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("获券上限")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-input",{staticStyle:{width:"179px"},attrs:{placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.promotersNum,callback:function(e){t.promotersNum=e},expression:"promotersNum"}},[i("template",{slot:"suffix"},[t._v("次")])],2)],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("关注者获礼")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-button",{staticStyle:{width:"179px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.addCount("2")}}},[t._v("选择关联优惠券")]),t._v(" "),t.followersCoupon.length>0?i("span",[t._v("(已关联"+t._s(t.followersCoupon.length)+"张)")]):t._e()],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("关注者获得积分")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("el-input",{staticStyle:{width:"179px"},attrs:{placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.promotersPoint,callback:function(e){t.promotersPoint=e},expression:"promotersPoint"}},[i("template",{slot:"suffix"},[t._v("分")])],2),t._v(" "),i("span",[t._v("(不管是通过推广者的专属二维码,还是通过公众号二维码,公众号名称,他人分享链接等,都可以获得相应积分)")])],1)]),t._v(" "),i("div",{staticClass:"online-box clearfix",staticStyle:{"padding-left":"60px"}},[i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"info",plain:""},on:{click:t.closePage}},[t._v("取消")]),t._v(" "),t.isactivityDetail?i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"info"},on:{click:function(e){t.saveConfig("0")}}},[t._v("保存")]):t._e(),t._v(" "),""==t.editId?i("el-button",{staticStyle:{"margin-right":"10px",width:"190px"},attrs:{type:"primary"},on:{click:function(e){t.saveConfig("1")}}},[t._v("发布")]):t._e()],1),t._v(" "),t.showBirthCoupon?i("birthCoupon",{attrs:{selectCoupon:t.selectCoupon,couponList:t.couponList},on:{winEvent:t.winEvent}}):t._e()],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("活动设置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"online-box clearfix"},[e("span",{staticClass:"online-sub fl required"},[this._v("活动对象")]),this._v(" "),e("div",{staticClass:"rightHalf"},[e("span",{staticClass:"obj"},[this._v("全体会员")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("推广权益")]),this._v(" "),e("div",{staticClass:"line"})])}],!1,null,"1968a8df",null);e.default=c.exports}}]);