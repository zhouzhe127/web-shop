(window.webpackJsonp=window.webpackJsonp||[]).push([["activity_fission"],{"619b":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"fissoin"}},[t._m(0),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl required"},[t._v("活动标题")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.activityName,expression:"activityName"}],staticClass:"name",attrs:{type:"text",placeholder:"请输入活动标题"},domProps:{value:t.activityName},on:{input:function(e){e.target.composing||(t.activityName=e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("活动时间")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("div",{staticClass:"fl",staticStyle:{cursor:"pointer"}},[i("calendar",{ref:"startCal",staticClass:"fl",attrs:{pObj:t.startObj},on:{throwTime:t.getStartTime}}),t._v(" "),i("span",{staticClass:"fl",staticStyle:{width:"40px","text-align":"center","margin-right":"0"}},[t._v("-")]),t._v(" "),i("calendar",{ref:"endCal",staticClass:"fl",attrs:{pObj:t.endObj},on:{throwTime:t.getEndTime}})],1),t._v(" "),i("span",{staticClass:"fl",staticStyle:{"text-align":"left","text-indent":"20px",color:"#A3A3A3"}},[t._v("共"+t._s(t.returnInt)+"天")])])]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("推广者获礼")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("a",{staticClass:"addclassify",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addCount("1")}}},[t._v("选择关联优惠券")]),t._v(" "),t.promotersCoupon.length>0?i("span",[t._v("(已关联"+t._s(t.promotersCoupon.length)+"张)")]):t._e()])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("推广者获得积分")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("section",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.followersPoint,expression:"followersPoint"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.followersPoint},on:{input:function(e){e.target.composing||(t.followersPoint=e.target.value)}}}),t._v(" "),i("span",[t._v("分")])]),t._v(" "),i("span",[t._v("(只有当其微信用户通过本推广者分享的【推广者二维码】而满足公众号的情况下,才能获得相应积分奖励)")])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("获券上限")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("section",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.promotersNum,expression:"promotersNum"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.promotersNum},on:{input:function(e){e.target.composing||(t.promotersNum=e.target.value)}}}),t._v(" "),i("span",[t._v("次")])])])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("关注者获礼")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("a",{staticClass:"addclassify",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.addCount("2")}}},[t._v("选择关联优惠券")]),t._v(" "),t.followersCoupon.length>0?i("span",[t._v("(已关联"+t._s(t.followersCoupon.length)+"张)")]):t._e()])]),t._v(" "),i("div",{staticClass:"online-box clearfix"},[i("span",{staticClass:"online-sub fl"},[t._v("关注者获得积分")]),t._v(" "),i("div",{staticClass:"rightHalf"},[i("section",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.promotersPoint,expression:"promotersPoint"}],staticClass:"cumulative",attrs:{type:"text",placeholder:"请输入正整数",maxlength:"6",onkeyup:"value=value.replace(/[^\\d]/g,'')"},domProps:{value:t.promotersPoint},on:{input:function(e){e.target.composing||(t.promotersPoint=e.target.value)}}}),t._v(" "),i("span",[t._v("分")])]),t._v(" "),i("span",[t._v("(不管是通过推广者的专属二维码,还是通过公众号二维码,公众号名称,他人分享链接等,都可以获得相应积分)")])])]),t._v(" "),i("div",{staticClass:"online-box clearfix",staticStyle:{"padding-left":"60px"}},[i("a",{staticClass:"gray fl",staticStyle:{width:"200px","margin-right":"10px","background-color":"#a7a7a7"},attrs:{href:"javascript:void(0);"},on:{click:t.closePage}},[t._v("取消")]),t._v(" "),i("a",{staticClass:"gray fl",staticStyle:{width:"200px","margin-right":"10px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.saveConfig("0")}}},[t._v("保存")]),t._v(" "),""==t.editId?i("a",{staticClass:"yellow fl",staticStyle:{width:"200px"},attrs:{href:"javascript:void(0);"},on:{click:function(e){t.saveConfig("1")}}},[t._v("发布")]):t._e()]),t._v(" "),t.showBirthCoupon?i("birthCoupon",{attrs:{selectCoupon:t.selectCoupon,couponList:t.couponList},on:{winEvent:t.winEvent}}):t._e()],1)};n._withStripped=!0;var s=i("81a2"),a=i("f6ce"),o=i("bbb9");function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function n(s,a){try{var o=e[s](a),r=o.value}catch(t){return void i(t)}if(!o.done)return Promise.resolve(r).then(function(t){n("next",t)},function(t){n("throw",t)});t(r)}("next")})}}var c={data:function(){return{startObj:{time:o.a.getTime({time:new Date}).start},endObj:{time:(new Date).getTime()},dates:(new Date).getTime(),returnInt:1,promotersPoint:"",promotersNum:"",followersPoint:"",activityName:"",showBirthCoupon:!1,couponList:[],selectCoupon:[],promotersCoupon:[],followersCoupon:[],couponType:"",editId:"",ruleId:"",isclick:!1}},watch:{"startObj.time":"timeChange","endObj.time":"timeChange"},methods:{closePage:function(){this.$router.push("/admin/activity")},getStartTime:function(t){this.startObj.time=t},getEndTime:function(t){this.endObj.time=t},timeChange:function(){this.returnInt=Math.ceil((new Date(this.endObj.time).getTime()-new Date(this.startObj.time).getTime())/864e5)},transformDate:function(t){return o.a.format(new Date(t),"yyyy-MM-dd")},valiData:function(t,e,i){this.$store.commit("setWin",{content:t,title:e,winType:i})},winEvent:function(t){this.showBirthCoupon=!1,"ok"==t.status&&("1"==this.couponType?this.promotersCoupon=t.data.select:"2"==this.couponType&&(this.followersCoupon=t.data.select))},addCount:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var n,a,o,r,c,l,u,p;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.getGetCouponCondition({data:{flag:1}});case 2:for(n=i.sent,a=[],o=!0,r=!1,c=void 0,i.prev=7,l=n[Symbol.iterator]();!(o=(u=l.next()).done);o=!0)7!=(p=u.value).type&&a.push(p);i.next=15;break;case 11:i.prev=11,i.t0=i.catch(7),r=!0,c=i.t0;case 15:i.prev=15,i.prev=16,!o&&l.return&&l.return();case 18:if(i.prev=18,!r){i.next=21;break}throw c;case 21:return i.finish(18);case 22:return i.finish(15);case 23:e.couponList=a,e.couponList.forEach(function(t){t.num=1}),e.couponType=t,"1"==e.couponType?e.selectCoupon=e.promotersCoupon:"2"==e.couponType&&(e.selectCoupon=e.followersCoupon),e.showBirthCoupon=!0;case 28:case"end":return i.stop()}},i,e,[[7,11,15,23],[16,,18,22]])}))()},checkForm:function(){return""==this.activityName?(this.valiData("活动标题不能为空!"),!1):!this.isclick||(this.valiData("请勿重复保存!"),!1)},saveConfig:function(t){this.checkForm()&&(""==this.editId?this.addConfig(t):this.ediConfig(t))},addConfig:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var n,a,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n=[],a={couponIds:{couponLimit:e.promotersNum,promoter:e.promotersCoupon,fans:e.followersCoupon},maxConsume:e.followersPoint,minConsume:e.promotersPoint},n.push(a),i.next=5,s.a.fissionActivity({data:{type:4,mouldType:0,name:e.activityName,objectType:2,startTime:parseInt(e.startObj.time/1e3),endTime:parseInt(e.endObj.time/1e3),isAuto:t,rule:JSON.stringify(n)}});case 5:e.isclick=!0,o="0"==t?"保存成功":"发布成功",e.valiData(o),e.closePage();case 9:case"end":return i.stop()}},i,e)}))()},ediConfig:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var n,a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(n={}).type=4,n.mouldType=0,n.name=e.activityName,n.objectType=2,n.startTime=parseInt(e.startObj.time/1e3),n.endTime=parseInt(e.endObj.time/1e3),n.isAuto=t,n.rule=[],a={id:e.ruleId,couponIds:{couponLimit:e.promotersNum,promoter:e.promotersCoupon,fans:e.followersCoupon},maxConsume:e.followersPoint,minConsume:e.promotersPoint},n.rule.push(a),i.next=13,s.a.fissionActivity({data:{activityId:e.editId,data:JSON.stringify(n)}});case 13:e.isclick=!0,e.valiData("保存成功"),e.closePage();case 16:case"end":return i.stop()}},i,e)}))()},getActivityDetail:function(t){var e=this;return r(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.getActivityDetails({data:{activityId:t.id}});case 2:(n=i.sent)&&(e.activityName=n.name,e.startObj.time=1e3*n.startTime,e.endObj.time=1e3*n.endTime,e.promotersPoint=n.rule[0].minConsume,e.followersPoint=n.rule[0].maxConsume,e.promotersNum=n.rule[0].couponIds.couponLimit,e.promotersCoupon=n.rule[0].couponIds.promoter,e.followersCoupon=n.rule[0].couponIds.fans,e.ruleId=n.rule[0].id);case 4:case"end":return i.stop()}},i,e)}))()}},components:{"can-multi":function(){return i.e("can_multi").then(i.bind(null,"742e"))},birthCoupon:function(){return i.e("activity_birth_coupon").then(i.bind(null,"60f1"))},calendar:function(){return i.e("calendar_result").then(i.bind(null,"9265"))}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"<返回活动列表",className:["activity"],fn:function(){t.closePage()}}]);var e=a.a.session("activityInfo");e&&(this.editId=e.id,this.getActivityDetail(e))},beforeDestroy:function(){a.a.session("activityInfo",null)}},l=(i("dd9c"),i("7610")),u=Object(l.a)(c,n,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("活动设置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"online-box clearfix"},[e("span",{staticClass:"online-sub fl required"},[this._v("活动对象")]),this._v(" "),e("div",{staticClass:"rightHalf"},[e("span",{staticClass:"fans"},[this._v("全体会员")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"titles"},[this._v("推广权益")]),this._v(" "),e("div",{staticClass:"line"})])}],!1,null,"47b90189",null);u.options.__file="src\\module\\marketing_tools\\activity_fission.vue";e.default=u.exports},dd9c:function(t,e,i){"use strict";var n=i("faf4");i.n(n).a},faf4:function(t,e,i){}}]);