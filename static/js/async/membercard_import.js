(window.webpackJsonp=window.webpackJsonp||[]).push([["membercard_import"],{"0609":function(t,e,r){},"518a":function(t,e,r){"use strict";var a=r("0609");r.n(a).a},"585e":function(t,e,r){"use strict";r.r(e);var a=r("81a2"),s=r("f6ce");function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){return function a(s,i){try{var n=e[s](i),o=n.value}catch(t){return void r(t)}if(!n.done)return Promise.resolve(o).then(function(t){a("next",t)},function(t){a("throw",t)});t(o)}("next")})}}var n=s.a.session("userShop"),o=void 0,c={data:function(){return{page:1,num:10,endTotal:1,exportUrl:"javascript:void(0);",allFormList:[],formList:[],sucexportUrl:"javascript:void(0);",failexportUrl:"javascript:void(0);",resultShowed:"",progressTotal:100,curN:0,importStatus:!0,shopId:"",titleList:[{titleName:"表格下载",titleStyle:{fontSize:"16px",width:"287px",flex:"none"}},{titleName:"序号",dataName:"id",titleStyle:{fontSize:"16px",width:"229.5px",flex:"none"}},{titleName:"导入时间",titleStyle:{fontSize:"16px",width:"229.5px",flex:"none"}},{titleName:"成功人数",dataName:"successNum",titleStyle:{fontSize:"16px",width:"229.5px",flex:"none"}},{titleName:"失败人数",dataName:"failNum",titleStyle:{fontSize:"16px",width:"229.5px",flex:"none"}},{titleName:"共计导入金额",dataName:"successPrice",titleStyle:{fontSize:"16px",width:"229.5px",flex:"none"}}]}},methods:{init:function(){var t=document.getElementsByClassName("fill")[0],e=30,r=setInterval(function(){e++,t.style.width=e/100*421+"px",t.innerHTML=e/100*100+"%",e>=100&&clearInterval(r)},1)},selectPage:function(t){this.page=1,this.num=t.name,this.getPastform(),this.pageBtn=!this.pageBtn},showPageList:function(){this.pageBtn=!this.pageBtn},imports:function(t,e){this.importsForm(t,e)},importsForm:function(t,e){var r=this;return i(regeneratorRuntime.mark(function s(){var i,c;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.a.importCard({data:{ischain:n.currentShop.ischain,shopId:r.shopId,type:1,importType:t},formId:e});case 2:(i=s.sent)&&(r.$refs.progress.style.opacity="1",r.curN=0,r.resultShowed="",(c=r).$refs.fill.style.width="0px",c.$refs.fill.innerHTML="0%",o=setInterval(function(){c.curN<90&&(c.curN+=Math.floor(10*Math.random()+1)),c.$refs.fill.style.width=c.curN/c.progressTotal*421+"px",c.$refs.fill.innerHTML=parseInt(c.curN/c.progressTotal*100)+"%",c.getProgress(i)},2e3));case 4:case"end":return s.stop()}},s,r)}))()},getProgress:function(t){var e=this;return i(regeneratorRuntime.mark(function r(){var s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s=null,r.prev=1,r.next=4,a.a.getImportCardExcel({data:{createTime:t,type:0}},!0);case 4:s=r.sent,r.next=13;break;case 7:return r.prev=7,r.t0=r.catch(1),e.importStatus=!1,clearInterval(o),e.$store.commit("setWin",{content:r.t0.error.message,title:"操作提示",winType:"alert"}),r.abrupt("return",!1);case 13:!1!==s&&(e.importStatus=!0,clearInterval(o),e.$refs.fill.style.width="421px",e.$refs.fill.innerHTML="100%",e.resultShowed=s,e.getPastform());case 14:case"end":return r.stop()}},r,e,[[1,7]])}))()},filterExport:function(t){this.getsampleForm(t)},getsampleForm:function(t){var e=this;return i(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.importCardSample({data:{type:t}});case 2:case"end":return e.stop()}},r,e)}))()},getPastform:function(){var t=this;return i(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.getImportCardList({data:{}});case 2:r=e.sent,t.allFormList=r,t.allFormList=t.allFormList.sort(t.sortList("id")),t.$nextTick(function(){t.setPage()});case 6:case"end":return e.stop()}},e,t)}))()},changeFormat:function(t){return(t-=0)<10?"0"+t:t+""},transFormDates:function(t){10==(t+="").length?(t-=0,t*=1e3):t-=0;var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"/"+e.getHours()+":"+this.changeFormat(e.getMinutes())},downloadForm:function(t,e){this.donloadsForm(t,e)},donloadsForm:function(t,e){var r=this;return i(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a.a.getImportCardExcels({data:{createTime:t.createTime,type:e},type:"file"});case 2:case"end":return r.stop()}},s,r)}))()},setPage:function(){this.endTotal=Math.ceil(this.allFormList.length/this.num);var t=(this.page-1)*this.num,e=this.page*this.num,r=this.allFormList.slice(t,e);this.formList=r},getPageNum:function(t){this.page=t.page,this.num=t.num,this.setPage()},sortList:function(t){return function(e,r){var a=parseInt(e[t]),s=parseInt(r[t]);return a>s?-1:a<s?1:0}}},mounted:function(){var t=s.a.session("userShop");this.shopId=t.currentShop.id,this.getPastform()},components:{pageElement:function(){return r.e("page_element").then(r.bind(null,"5921"))},comTable:function(){return r.e("table").then(r.bind(null,"4360"))}}},l=(r("518a"),r("d801")),u=Object(l.a)(c,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"member-import"}},[r("div",{staticClass:"title"},[r("form",{staticClass:"theForm",attrs:{enctype:"multipart/form-data",id:"uploadmemberForm"}},[r("a",{staticStyle:{background:"#28A8E0",color:"#fff"},attrs:{href:"javascript:void(0);"}},[t._v("电子会员导入")]),t._v(" "),r("input",{staticStyle:{opacity:"0",position:"absolute",top:"0",left:"0",width:"133px",height:"38px"},attrs:{type:"file",accept:"application/vnd.ms-excel,.csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",id:"file",name:"file"},on:{change:function(e){t.imports("1","uploadmemberForm")}}})]),t._v(" "),r("form",{staticClass:"theForm",attrs:{enctype:"multipart/form-data",id:"uploadcardForm"}},[r("a",{staticStyle:{background:"#28A8E0",color:"#fff"},attrs:{href:"javascript:void(0);"}},[t._v("实体会员导入")]),t._v(" "),r("input",{staticStyle:{opacity:"0",position:"absolute",top:"0",left:"0",width:"133px",height:"38px"},attrs:{type:"file",accept:"application/vnd.ms-excel,.csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",id:"file",name:"file"},on:{change:function(e){t.imports("0","uploadcardForm")}}})]),t._v(" "),r("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.filterExport("0")}}},[t._v("实体卡样例表格下载")]),t._v(" "),r("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.filterExport("1")}}},[t._v("电子会员样例表格下载")])]),t._v(" "),r("div",{ref:"progress",staticClass:"progress",staticStyle:{opacity:"0"}},[r("span",[t._v("进度")]),t._v(" "),r("div",{staticClass:"progressbar"},[r("div",{ref:"fill",staticClass:"fill"})]),t._v(" "),""==t.resultShowed&&1==t.importStatus?r("div",{staticClass:"spinner"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2)]):t._e(),t._v(" "),""==t.resultShowed&&1==t.importStatus?r("span",[t._v("导入中")]):t._e(),t._v(" "),""!=t.resultShowed&&1==t.importStatus?r("span",[t._v("导入完成")]):t._e(),t._v(" "),""==t.resultShowed&&0==t.importStatus?r("span",[t._v("导入失败")]):t._e()]),t._v(" "),""!=t.resultShowed?r("div",{staticClass:"results"},[r("div",{staticClass:"results_t"},[t._v("\n\t\t\t结果显示\n\t\t")]),t._v(" "),r("div",{staticClass:"results_b"},[r("div",{staticClass:"results_l"},[r("div",{staticClass:"container"},[r("div",{staticClass:"container_t"},[r("span"),t._v(" "),r("span",[t._v("导入成功")]),t._v(" "),r("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.downloadForm(t.resultShowed,"1")}}},[t._v("下载")])]),t._v(" "),r("div",{staticClass:"container_b"},[r("span",[t._v(t._s(t.resultShowed.successNum)+"人")]),t._v(" "),r("span",{staticStyle:{margin:"0 15px"}},[t._v("|")]),t._v(" "),r("span",[t._v(t._s(t.resultShowed.successPrice)+"元")])])])]),t._v(" "),r("div",{staticClass:"results_r"},[r("div",{staticClass:"container"},[r("div",{staticClass:"container_t"},[r("span"),t._v(" "),r("span",[t._v("导入失败")]),t._v(" "),r("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.downloadForm(t.resultShowed,"2")}}},[t._v("下载")])]),t._v(" "),r("div",{staticClass:"container_b"},[r("span",[t._v(t._s(t.resultShowed.failNum)+"人")]),t._v(" "),r("span",{staticStyle:{margin:"0 15px"}},[t._v("|")]),t._v(" "),r("span",[t._v(t._s(t.resultShowed.failPrice)+"元")])])])])])]):t._e(),t._v(" "),r("com-table",{attrs:{listHeight:80,listName:"会员导入",showTitle:2,listWidth:1436,widthType:!0,introData:t.formList,titleData:t.titleList,allTotal:t.allFormList.length},scopedSlots:t._u([{key:"con-0",fn:function(e){return r("div",{staticClass:"imports"},[r("a",{attrs:{href:"javascript:void(0);"},on:{click:function(r){t.downloadForm(e.data,"1")}}},[t._v("已导入表格")]),t._v(" "),r("a",{attrs:{href:"javascript:void(0);"},on:{click:function(r){t.downloadForm(e.data,"2")}}},[t._v("未导入表格")])])}},{key:"con-2",fn:function(e){return r("div",{},[t._v(t._s(t.transFormDates(e.data.createTime)))])}}])}),t._v(" "),r("section",{staticClass:"turn-page"},[r("pageElement",{attrs:{page:Number(t.page),total:Number(t.endTotal),numArr:[10,20,30,40,50],isNoJump:!0},on:{pageNum:t.getPageNum}})],1)],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"spinner-container container1"},[e("div",{staticClass:"circle1"}),this._v(" "),e("div",{staticClass:"circle2"}),this._v(" "),e("div",{staticClass:"circle3"}),this._v(" "),e("div",{staticClass:"circle4"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"spinner-container container2"},[e("div",{staticClass:"circle1"}),this._v(" "),e("div",{staticClass:"circle2"}),this._v(" "),e("div",{staticClass:"circle3"}),this._v(" "),e("div",{staticClass:"circle4"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"spinner-container container3"},[e("div",{staticClass:"circle1"}),this._v(" "),e("div",{staticClass:"circle2"}),this._v(" "),e("div",{staticClass:"circle3"}),this._v(" "),e("div",{staticClass:"circle4"})])}],!1,null,"38328020",null);e.default=u.exports}}]);