(window.webpackJsonp=window.webpackJsonp||[]).push([["warrant"],{"37f4":function(t,e,n){"use strict";n.r(e);var a=n("81a2"),i=n("f6ce");var r={data:function(){return{userData:"",brandId:"",shopId:"",boxList:[],urlData:"",showMt:!1,goods:"",category:"",erpDishData:{dishes:[]},eleShopList:[],relation:!0,eleShopid:"",eleGoods:"",edit:!1,timer:""}},methods:{init:function(){var t,e=this;return(t=regeneratorRuntime.mark(function t(){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.getTakeOutList({data:{brandId:e.brandId}});case 2:for(n=t.sent,console.log(e.timer),e.boxList=n,i=0;i<e.boxList.length;i++)2==e.boxList[i].id&&e.boxList[i].status;case 6:case"end":return t.stop()}},t,e)}),function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(i,r){try{var s=e[i](r),o=s.value}catch(t){return void n(t)}if(!s.done)return Promise.resolve(o).then(function(t){a("next",t)},function(t){a("throw",t)});t(o)}("next")})})()},addWarrant:function(t){var e=this;clearInterval(this.timer);var n=void 0;2!=t&&(i.a.session("waimai",t),n=window.open("","newWindow")),a.a.getAuthorizationUrl({data:{type:t,brandId:this.brandId,shopId:this.shopId}}).then(function(a){if(2!=t){n.location=a,e.timer=setInterval(e.getReturn(t,0,n),1500)}else{var i=window.location.href;e.showMt=!0,e.urlData=a+"&eOrigin="+i}},function(){e.$store.commit("setWin",{title:"错误提示",content:"请求失败"})})},getReturn:function(t,e,n){var i=this;return function(){a.a.getReturnInfo({data:{type:t}}).then(function(t){1==t?(clearInterval(i.timer),n&&n.close(),i.init()):0==t&&(clearInterval(i.timer),n&&n.close(),i.$store.commit("setWin",{title:"授权失败",content:"授权失败"}))},function(t){clearInterval(i.timer),i.$store.commit("setWin",{title:"提示",content:t})}),(e+=1)>180&&(n&&n.close(),this.init(),clearInterval(this.timer))}},cancelWarrant:function(t,e){if(0==t)return!1;var n=e;i.a.session("hello","open"),i.a.session("waimai",n),setTimeout(function(){sessionStorage.removeItem("hello")},1e3);var a=window.location.href.split(/authorization/g)[0]+"authorization/relation";window.open(a)},hidden:function(t){this.showMt=t}},mounted:function(){var t=this;this.userData=i.a.session("userShop"),this.shopId=this.userData.currentShop.id,this.brandId=0==this.userData.currentShop.ischain?0:this.userData.currentShop.brandId,window.onmessage=function(e){"msg-token"==e.data.event?a.a.addMeituanShopRelation({data:{brandId:t.brandId,mtShopId:e.data.value.poiId,mtShopName:e.data.value.poiName}}).then(function(){clearInterval(t.timer),t.timer=setInterval(t.getReturn(2,0),1500)},function(){t.$store.commit("setWin",{title:"错误提示",content:"请求失败"})}):"finish-storebind"==e.data.event?t.showMt=!1:"getErpDishData"==e.data.event?t.showMt=!1:e.data.event},this.init()},components:{meiTuanWarrant:function(){return n.e("iframe_warrant").then(n.bind(null,"6d65"))}},destroyed:function(){clearInterval(this.timer)}},s=(n("8317"),n("d801")),o=Object(s.a)(r,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticStyle:{height:"100%"},attrs:{id:"warrant"}},[a("section",[0==t.boxList.length?a("div",{staticClass:"loading"},[a("img",{attrs:{src:n("b8bc")}})]):t._l(t.boxList,function(e,n){return a("div",{key:n,staticClass:"box"},[a("div",{staticClass:"left",class:{one:0==n,two:1==n,three:2==n}}),t._v(" "),0==e.status?a("div",{staticClass:"right"},[a("span",[t._v(t._s(e.name))]),t._v(" "),a("a",{staticClass:"rant",attrs:{href:"javascript:void(0)"},on:{click:function(n){t.addWarrant(e.id,n)}}},[t._v("点击授权")])]):t._e(),t._v(" "),1==e.status?a("div",{staticClass:"right warranted"},[a("span",{staticClass:"spcet"},[t._v(t._s(e.name))])]):t._e(),t._v(" "),1==e.status?a("a",{staticClass:"eleJump",attrs:{href:"javascript:void(0)"},on:{click:function(n){t.cancelWarrant(e.status,e.id)}}}):t._e()])}),t._v(" "),t.showMt?a("meiTuan-warrant",{attrs:{urlData:t.urlData},on:{show:t.hidden}}):t._e()],2)])},[],!1,null,"6a3e1286",null);e.default=o.exports},"67d4":function(t,e,n){},8317:function(t,e,n){"use strict";var a=n("67d4");n.n(a).a},b8bc:function(t,e,n){t.exports=n.p+"images/preloader.3e54c692.gif"}}]);