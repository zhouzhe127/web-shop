(window.webpackJsonp=window.webpackJsonp||[]).push([["cashier_anslysis"],{"6b0e":function(t,e,s){},"755c":function(t,e,s){},"96f3":function(t,e,s){"use strict";var i=s("755c");s.n(i).a},a7c0:function(t,e,s){"use strict";s.r(e);var i=s("81a2"),a=s("f6ce"),n=s("bbb9");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,s){return function i(a,n){try{var o=e[a](n),r=o.value}catch(t){return void s(t)}if(!o.done)return Promise.resolve(r).then(function(t){i("next",t)},function(t){i("throw",t)});t(r)}("next")})}}var r={data:function(){return{shopId:null,options:["日报表","周报表","月报表","季度报表","年报表"],selectedType:0,startTime:"",timeStart:"",timeEnd:"",endTime:"",hourMinute:["00-00","23-59"],index:0,shopList:[],selects:[],reset:1,shopName:"请选择店铺",backList:!1,isBack:!1,formHead:!1,headList:[],selHead:[],showWidth:0,chartsHead:"",chartList:{flag:0,list:[{index:0,name:"数据"},{index:1,name:"图表"}]},buttonList:{flag:0,list:[{index:0,name:"原表"},{index:1,name:"占比"},{index:2,name:"总占比"},{index:3,name:"环比"},{index:4,name:"同比"}]},chartType:{flag:0,list:[{index:0,name:"店铺日常运营数据"},{index:1,name:"商品销售数量"},{index:2,name:"商品销售金额"},{index:3,name:"优惠数据"},{index:4,name:"退品数据"},{index:5,name:"系统取整数据"},{index:6,name:"支付方式"}]},taskId:"",orderList:{list:[],total:{}},selOrderList:[],selTotalList:[],loading:!0,list:[],ChartShopName:[],typeFlag:-1,exportIndex:-1,repeat:!1,hide:0,taskCountTotal:1,taskCount:0,totalCount:1,num:0,selShopid:[]}},mounted:function(){var t=a.a.session("userShop");this.shopId=t.currentShop.id,this.shopList=a.a.session("shopList"),this.getReportHead(),this.initBtn()},methods:{initBtn:function(){var t=this,e=[{name:"表头设置",className:["firstBtn","headSet"],fn:function(){t.showHead()}},{name:"导出",className:["pickCheck","headSet"],fn:function(){t.exportData()}}];this.backList&&e.unshift({name:"返回",className:["huiC","headSet"],fn:function(){t.back()}}),this.$store.commit("setPageTools",e)},getReportHead:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var s,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.getReportHead({data:{shopId:t.shopId}});case 2:for(s=e.sent,console.log(s),a=0;a<s.length;a++)s[a].selected=!0;for(t.headList=n.a.deepCopy(s),t.selHead=n.a.deepCopy(s),t.chartsHead=n.a.deepCopy(s),o=0;o<t.chartsHead.length;o++)t.chartsHead[o].selected=!1;t.showWidth=100*t.headList.length;case 10:case"end":return e.stop()}},e,t)}))()},orderReportAnalysis:function(t){var e=this;return o(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i.a.orderReportAnalysis({data:{shopId:e.shopId,timeType:e.selectedType+1,startTime:0===e.selectedType?e.startTime:e.timeStart,endTime:0===e.selectedType?e.endTime:e.timeEnd,timeBetween:t,reportType:e.buttonList.flag+1,shopIds:e.selShopid.join()},timeout:6e4}).then(function(t){e.taskCountTotal=t.taskCount,e.totalCount=1,e.taskInfo(t),window.timer=setInterval(function(){e.taskInfo(t)},3e3)});case 1:case"end":return s.stop()}},s,e)}))()},taskInfo:function(t){var e=this;return o(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i.a.taskInfo({data:{shopId:e.shopId,taskId:t.taskId}}).then(function(s){e.taskCount=s.taskCount,e.totalCount+=3,3==s.status?(clearInterval(window.timer),e.getAnalysis(t.taskId),e.repeat=!1):2==s.status&&(e.loading=!0,e.repeat=!1,e.$store.commit("setWin",{title:"温馨提示",winType:"alert",content:"请求失败，请重试！"}),clearInterval(window.timer))});case 1:case"end":return s.stop()}},s,e)}))()},getAnalysis:function(t){var e=this;return o(regeneratorRuntime.mark(function s(){return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i.a.getAnalysis({data:{shopId:e.shopId,taskId:t},timeout:6e4}).then(function(t){if(e.loading=!0,!t.list)return!1;for(var s=0;s<t.list.length;s++)t.list[s].selected=!1;console.log(t),e.orderList=n.a.deepCopy(t),e.list=n.a.deepCopy(t)});case 1:case"end":return s.stop()}},s,e)}))()},fadeAway:function(){this.hide++},startTimeChange:function(t,e){console.log(t),console.log(e),this.startTime=t,2==this.selectedType?this.timeStart=new Date(t).getFullYear()+"年"+(new Date(t).getMonth()+1):(this.timeStart=e,this.timeStart=this.timeStart.substring(0,this.timeStart.length-1),3==this.selectedType&&(this.timeStart=this.timeStart.substring(0,this.timeStart.length-1)),this.timeStart=this.timeStart.replace(/\s/g,""))},endTimeChange:function(t,e){console.log(t),console.log(e),this.endTime=t,2==this.selectedType?this.timeEnd=new Date(t).getFullYear()+"年"+(new Date(t).getMonth()+1):(this.timeEnd=e,this.timeEnd=this.timeEnd.substring(0,this.timeEnd.length-1),3==this.selectedType&&(this.timeEnd=this.timeEnd.substring(0,this.timeEnd.length-1)),this.timeEnd=this.timeEnd.replace(/\s/g,""))},getShopname:function(){if("请选择店铺"!=this.shopName){for(var t=this.shopName.split(","),e=[],s=0;s<t.length;s++){var i={};0===s?(i.className="chyellow",i.name=t[s]):1===s?(i.className="chblue",i.name=t[s]):2===s?(i.className="chgreen",i.name=t[s]):(i.className="",i.name=t[s]),e.push(i)}this.ChartShopName=e}else this.shopName="请选择店铺"},getShop:function(t){this.shopName="";for(var e=0;e<this.shopList.length;e++)t.includes(this.shopList[e].id)&&(""==this.shopName?this.shopName=this.shopName+this.shopList[e].shopName:this.shopName=this.shopName+","+this.shopList[e].shopName);this.selShopid=t,this.getShopname()},search:function(){if(this.repeat)return this.$store.commit("setWin",{title:"温馨提示",winType:"alert",content:"当前查询尚未结束，请结束后再进行查询或刷新浏览器重新查询！"}),!1;if(0==this.selShopid.length)return this.$store.commit("setWin",{title:"温馨提示",winType:"alter",content:"请选择店铺"}),!1;switch(this.repeat=!0,this.loading=!1,this.taskCountTotal=1,this.taskCount=0,this.selectedType){case 0:this.startTime=n.a.format(new Date(this.startTime),"yyyy-MM-dd"),this.endTime=n.a.format(new Date(this.endTime),"yyyy-MM-dd");break;case 1:this.timeStart=this.timeStart.replace("年第","/"),this.timeEnd=this.timeEnd.replace("年第","/");break;case 2:this.timeStart=this.timeStart.replace("年","/"),this.timeEnd=this.timeEnd.replace("年","/");break;case 3:this.timeStart=this.timeStart.replace("年第","/"),this.timeEnd=this.timeEnd.replace("年第","/")}var t=this.hourMinute[0].substring(0,2)+":"+this.hourMinute[0].substring(3,5)+"-"+this.hourMinute[1].substring(0,2)+":"+this.hourMinute[1].substring(3,5);this.orderReportAnalysis(t),this.typeFlag=this.selectedType,this.selShopid.length<=3?this.num=8:this.selShopid.length>3&&this.selShopid.length<=5?this.num=5:this.selShopid.length>5&&this.selShopid.length<10?this.num=3:this.selShopid.length>=10&&this.selShopid.length<20?this.num=2:this.num=1},chartSearch:function(t){this.buttonList.flag=t,this.search()},resetAll:function(){this.shopName="请选择店铺",this.reset++,this.selects=[],this.selectedType=0,this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(0,0,0,0),this.index++,this.hourMinute=["00-00","23-59"],this.selShopid=[]},showHead:function(){this.formHead=!0,this.headList=n.a.deepCopy(this.selHead)},exportData:function(){this.exportIndex++},isHead:function(){for(var t=0;t<this.headList.length;t++)if(!this.headList[t].selected)return!0;return!1},allHead:function(){if(this.isHead())for(var t=0;t<this.headList.length;t++)this.headList[t].selected=!0;else for(var e=0;e<this.headList.length;e++)this.headList[e].selected=!1},choseHead:function(t){t.selected=!t.selected},enterHead:function(){this.formHead=!1,this.selHead=n.a.deepCopy(this.headList)},cancelHead:function(){this.formHead=!1,this.headList=n.a.deepCopy(this.selHead)},changeChart:function(t){if(1==t&&0===this.orderList.list.length)return this.$store.commit("setWin",{title:"温馨提示",winType:"alert",content:"请先搜索数据列表"}),!1;this.formHead=!1,this.chartList.flag=t,this.orderList=n.a.deepCopy(this.list),1==t?this.$store.commit("setPageTools",[]):this.initBtn()},light:function(t){if(this.repeat)return this.$store.commit("setWin",{title:"温馨提示",winType:"alert",content:"当前查询尚未结束，请结束后再进行查询或刷新浏览器重新查询！"}),!1;this.buttonList.flag=t,this.search()},changeCtype:function(t){this.chartType.flag=t},getBack:function(t){this.backList=t,this.initBtn()},back:function(){this.backList=!1,this.isBack=!this.isBack}},components:{selectBtn:function(){return s.e("select_btn").then(s.bind(null,"3d41"))},calendar:function(){return s.e("calendar_type").then(s.bind(null,"f2dd"))},timehm:function(){return s.e("time").then(s.bind(null,"4712"))},mulSelect:function(){return s.e("mul_select").then(s.bind(null,"7d09"))},dataform:function(){return s.e("anslysis_form").then(s.bind(null,"273f"))},datacharts:function(){return s.e("anslysis_charts").then(s.bind(null,"c7fdd"))},selectstore:function(){return s.e("select_shop").then(s.bind(null,"27a4"))},loading:function(){return s.e("category_loading").then(s.bind(null,"ab0a"))},elShopList:function(){return s.e("el_shopList").then(s.bind(null,"60ff"))}},destroyed:function(){clearInterval(window.timer)}},l=(s("96f3"),s("b707"),s("d801")),h=Object(l.a)(r,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"report"}},[s("section",{staticClass:"yuChairFix clearfix"},[s("section",{staticClass:"top-box fl",on:{click:t.fadeAway}},[s("span",{staticClass:"wordSize"},[t._v("时间类型：")]),t._v(" "),s("el-select",{model:{value:t.selectedType,callback:function(e){t.selectedType=e},expression:"selectedType"}},t._l(t.options,function(t,e){return s("el-option",{key:e,attrs:{label:t,value:e}})}))],1),t._v(" "),s("section",{staticClass:"top-box fl",staticStyle:{"margin-right":"0"},on:{click:t.fadeAway}},[s("section",{staticClass:"cala chairFix"},[s("calendar",{staticClass:"data-box",attrs:{time:t.startTime,type:t.selectedType,format:"yyyy年MM月dd日"},on:{emit:t.startTimeChange}})],1)]),t._v(" "),s("span",{staticClass:"line"},[t._v("-")]),t._v(" "),s("section",{staticClass:"top-box fl",on:{click:t.fadeAway}},[s("section",{staticClass:"cala chairFix"},[s("calendar",{staticClass:"data-box",attrs:{time:t.endTime,type:t.selectedType,format:"yyyy年MM月dd日"},on:{emit:t.endTimeChange}})],1)]),t._v(" "),s("section",{staticClass:"top-box fl",on:{click:t.fadeAway}},[s("span",{staticClass:"wordSize"},[t._v("时间段筛选：")]),t._v(" "),s("el-time-picker",{staticStyle:{width:"200px"},attrs:{"is-range":"",clearable:!1,"value-format":"HH-mm"},model:{value:t.hourMinute,callback:function(e){t.hourMinute=e},expression:"hourMinute"}})],1),t._v(" "),s("section",{staticStyle:{display:"inline-block"}},[s("section",{staticClass:"top-box fl",staticStyle:{height:"42px"}},[s("elShopList",{attrs:{shopIds:t.selShopid},on:{chooseShop:t.getShop}})],1),t._v(" "),s("section",{staticClass:"top-box fl detLi",staticStyle:{"margin-left":"10px"}},[s("a",{staticClass:"blue searchs",attrs:{href:"javascript:void(0);"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),s("a",{staticClass:"gray",attrs:{href:"javascript:void(0);"},on:{click:t.resetAll}},[t._v("重置")])])]),t._v(" "),s("section",{staticClass:"detLi "},[t.formHead?s("div",{staticClass:"detDiv formHead",staticStyle:{width:"600px",top:"0",position:"absolute","z-index":"100"},on:{click:function(t){t.stopPropagation()}}},[s("i",{staticClass:"detI",staticStyle:{left:"450px"}}),t._v(" "),s("h3",{staticClass:"detH3",staticStyle:{"text-align":"left",height:"400px",overflow:"auto",padding:"10px"},on:{click:function(t){t.stopPropagation()}}},[s("span",{staticClass:"all",on:{click:t.allHead}},[t._v("全部")]),t._v(" "),s("div",{staticClass:"selectbtns"},t._l(t.headList,function(e,i){return s("span",{key:i,staticClass:"aLi",class:{sign:e.selected},on:{click:function(s){t.choseHead(e)}}},[t._v(t._s(e.name))])}))]),t._v(" "),s("div",{staticClass:"detLiBtn"},[s("span",{staticClass:"gray",on:{click:t.cancelHead}},[t._v("取消")]),t._v(" "),s("span",{staticClass:"sure",on:{click:t.enterHead}},[t._v("确定")])])]):t._e()])]),t._v(" "),s("section",{staticClass:"nav"},[s("div",{staticClass:"formType light"},t._l(t.chartList.list,function(e,i){return s("span",{key:i,staticClass:"typeTotal",class:{typeOn:t.chartList.flag==i},on:{click:function(e){t.changeChart(i)}}},[t._v(t._s(e.name))])})),t._v(" "),0==t.chartList.flag?s("div",{staticClass:"light"},t._l(t.buttonList.list,function(e,i){return s("span",{key:i,staticClass:"sel",class:{on:t.buttonList.flag==i},on:{click:function(e){t.light(i)}}},[t._v(t._s(e.name))])})):s("div",{staticClass:"light"},t._l(t.chartType.list,function(e,i){return s("span",{key:i,staticClass:"sel",class:{on:t.chartType.flag==i},on:{click:function(e){t.changeCtype(i)}}},[t._v(t._s(e.name))])}))]),t._v(" "),s("dataform",{directives:[{name:"show",rawName:"v-show",value:0===t.chartList.flag,expression:"chartList.flag === 0"}],attrs:{num:t.num,shopId:t.shopId,exportIndex:t.exportIndex,width:t.showWidth,loading:t.loading,headList:t.headList,reportList:t.orderList,selShopid:t.selShopid,selectedType:t.typeFlag,selHead:t.selHead,flag:t.buttonList.flag,isBack:t.isBack},on:{back:t.getBack}}),t._v(" "),1===t.chartList.flag?s("datacharts",{attrs:{num:t.num,loading:t.loading,ChartShop:t.ChartShopName,selShopid:t.selShopid,chartFlag:t.chartType.flag,typeFlag:t.typeFlag,reportList:t.orderList,flag:t.buttonList.flag,headList:t.headList},on:{search:t.chartSearch}}):t._e(),t._v(" "),t.loading?t._e():s("loading",{attrs:{totalCount:t.totalCount,taskCountTotal:t.taskCountTotal,taskCount:t.taskCount}})],1)},[],!1,null,"c06835a6",null);e.default=h.exports},b707:function(t,e,s){"use strict";var i=s("6b0e");s.n(i).a}}]);