(window.webpackJsonp=window.webpackJsonp||[]).push([["free"],{"3ef7":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"delete"},[e.detailShow?e._e():[s("div",{staticClass:"filter"},[5!=e.showStep?[s("div",{staticClass:"block"},[1==e.showStep?[s("div",{staticClass:"input-box"},[s("calendar",{attrs:{time:e.timeObj.startTime,format:"yyyy年MM月dd日"},on:{emit:e.startTimeChange}})],1),e._v(" "),s("span",{staticClass:"input-word"},[e._v("至")]),e._v(" "),s("div",{staticClass:"input-box mr-right"},[s("calendar",{attrs:{time:e.timeObj.endTime,format:"yyyy年MM月dd日"},on:{emit:e.endTimeChange}})],1)]:e._e(),e._v(" "),!e.isBrand&&3==e.showStep||!e.isBrand&&4==e.showStep?[s("div",{staticClass:"input-box"},[s("calendar",{attrs:{time:e.timeObj.startTimeStore,format:"yyyy年MM月dd日"},on:{emit:e.startTimeChange}})],1),e._v(" "),s("span",{staticClass:"input-word"},[e._v("至")]),e._v(" "),s("div",{staticClass:"input-box mr-right"},[s("calendar",{attrs:{time:e.timeObj.endTimeStore,format:"yyyy年MM月dd日"},on:{emit:e.endTimeChange}})],1)]:e._e()],2),e._v(" "),s("div",{staticClass:"block"},[3==e.showStep||4==e.showStep?[s("selectBtn",{attrs:{sorts:e.areas,index:e.areaIndex,width:150},on:{emit:e.areaSelect}}),e._v(" "),s("selectBtn",{attrs:{sorts:e.table,index:e.tableIndex,width:150},on:{emit:e.tableSelect}})]:e._e(),e._v(" "),2!=e.showStep?s("div",{staticClass:"input-check select-ban"},[s("i",{class:{active:1==this.openTime},on:{click:e.timeCheck}}),e._v("\n\t\t\t\t\t\t按营业时间\n\t\t\t\t\t")]):e._e(),e._v(" "),4==e.showStep?s("div",{staticClass:"search-input mr-right"},[s("input",{attrs:{type:"text",placeholder:"请输入订单号"},on:{input:e.orderInput,propertychange:e.orderInput}}),e._v(" "),s("em",{on:{click:e.searchOrder}})]):e._e()],2),e._v(" "),s("div",{staticClass:"block"},[e.isBrand&&1==e.showStep?s("div",{staticClass:"search-box"},[s("select-store",{attrs:{sorts:e.shopList,tipName:e.dropName},on:{emit:e.getDrop}})],1):e._e(),e._v(" "),2!=e.showStep?s("div",{staticClass:"search-box"},[s("span",{staticClass:"search-btn yellow",on:{click:e.search}},[e._v("搜索")]),e._v(" "),s("span",{staticClass:"reset-btn gray",on:{click:e.reset}},[e._v("重置")])]):e._e()]),e._v(" "),e.isBrand&&1==e.showStep||2==e.showStep?s("div",{staticClass:"store-show"},[s("i",[e._v("已选择店铺：")]),e._v(" "),e._l(e.shopList,function(t,i){return t.selected?s("span",{key:i,attrs:{"data-id":t.id}},[e._v(e._s(t.name)+"，")]):e._e()}),e._v(" "),2==e.showStep?s("span",{staticClass:"time-span"},[e._v(e._s(e.formatTime(e.timeObj.startTime))+" ~ "+e._s(e.formatTime(e.timeObj.endTime)))]):e._e()],2):e._e()]:e._e()],2),e._v(" "),s("div",{staticClass:"main"},[s("freeStore",{attrs:{store:e.orderStoreList,order:e.goodsData,otherData:e.orderStoreSend,step:e.showStep,loading:e.loading},on:{emit:e.getStep}})],1)],e._v(" "),e.detailShow?s("orderDetail",{attrs:{detail:e.detail,isDelete:!0},on:{detailShow:e.getDetailShow}}):e._e()],2)};i._withStripped=!0;var r=s("f6ce"),a=s("81a2"),n=s("44e7"),o=s("bbb9");function h(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,s){return function i(r,a){try{var n=t[r](a),o=n.value}catch(e){return void s(e)}if(!n.done)return Promise.resolve(o).then(function(e){i("next",e)},function(e){i("throw",e)});e(o)}("next")})}}var d={data:function(){return{goodsData:"",deleteData:"",orderStoreList:"",orderStoreSend:{store:{},brand:{}},isOneDay:!1,areas:[],table:[],areaIndex:0,tableIndex:0,areasList:[],tableList:[],areaId:"",tableId:"",areasDefault:"全部区域",tableDefault:"全部桌台",shopList:[],brandId:"",shopId:"",shopIds:"",isBrand:"",storeName:"",storeListShow:"",allSelected:!0,timeObj:{startTime:"",endTime:"",startTimeStore:"",endTimeStore:""},page:1,pageNum:0,pageShow:10,openTime:1,orderInputValue:"",detail:null,detailShow:!1,showStep:"",userData:"",userShopList:"",userShopIdStr:"",repeat:!0,taskId:"",timerId:"",loading:!1,dropName:"请选择店铺"}},watch:{showStep:"initBtn"},components:{selectBtn:function(){return s.e("select_btn").then(s.bind(null,"3d41"))},calendar:function(){return s.e("calendar_type").then(s.bind(null,"f2dd"))},orderDetail:function(){return s.e("order_detail").then(s.bind(null,"603c"))},freeStore:function(){return s.e("free_store").then(s.bind(null,"9678"))},selectStore:function(){return s.e("win").then(s.bind(null,"cb83"))}},created:function(){this.userData=r.a.session("userShop");var e=[],t=[];"3"==this.userData.currentShop.ischain&&(this.userShopList=r.a.session("shopList"),this.userShopList.forEach(function(s,i){e[i]=s.id;var r={id:s.id,name:s.shopName};t.push(r)}),this.userShopIdStr=e.join(","),this.userShopList=t)},mounted:function(){for(var e in this.brandId=this.userData.currentShop.id,this.shopId=this.userData.currentShop.id,this.shopIds=this.userShopIdStr,this.userShopList)this.userShopList[e].selected=!0;this.shopList=this.userShopList,this.storeName=this.userShopList.length>0?this.userShopList[0].name:"选择店铺",this.isBrand="3"==this.userData.currentShop.ischain?1:0,this.resetDate(),0==this.isBrand?(this.showStep=3,this.getCondition()):this.showStep=1,this.search()},destroyed:function(){r.a.session("deleteShopId",null),r.a.session("dayData",null),r.a.session("orderListCache",null),r.a.session("deleteSingleTime",null),r.a.session("moreReturnCache",null),n.a.clear(this.timerId)},methods:{initBtn:function(){var e=this,t=[];3!=this.showStep&&4!=this.showStep||t.push({name:"导出",className:["fd-yellow"],fn:function(){e.exportMethods()}}),(this.isBrand&&1!=this.showStep||!this.isBrand&&3!=this.showStep)&&t.push({name:"返回",className:["fd-blue"],fn:function(){e.back()}}),this.$store.commit("setPageTools",t)},getGoods:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var s,i,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.validate()){t.next=2;break}return t.abrupt("return");case 2:return s=new Date(e.timeObj.endTimeStore).setHours(23,59,59,0),t.next=5,a.a.moreFreeByName({data:{trueShopId:e.shopId,startTime:parseInt(e.timeObj.startTimeStore/1e3),endTime:parseInt(s/1e3),areaId:e.areaId,tableId:e.tableId,page:e.page,num:e.pageShow,isOpenTime:e.openTime}});case 5:for(o in i=t.sent,r.a.session("moreReturnCache",i),n={startTime:e.timeObj.startTimeStore,endTime:e.timeObj.endTimeStore,areaId:e.areaId,tableId:e.tableId,openTime:e.openTime,shopId:e.shopId,isRequest:!1})e.setNewObj(e.orderStoreSend.store,o,n[o]);e.showStep=3,e.goodsData=i;case 11:case"end":return t.stop()}},t,e)}))()},getCondition:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var s,i,r,n,o,h,d,p,c,u,m,l,S,f,b;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.getCondition({data:{trueShopId:e.shopId}});case 2:for(s=t.sent,i=[],r=[],n=!0,o=!1,h=void 0,t.prev=7,d=s.areaList[Symbol.iterator]();!(n=(p=d.next()).done);n=!0)c=p.value,i.push(c.name);t.next=15;break;case 11:t.prev=11,t.t0=t.catch(7),o=!0,h=t.t0;case 15:t.prev=15,t.prev=16,!n&&d.return&&d.return();case 18:if(t.prev=18,!o){t.next=21;break}throw h;case 21:return t.finish(18);case 22:return t.finish(15);case 23:for(u=!0,m=!1,l=void 0,t.prev=26,S=s.tableList[Symbol.iterator]();!(u=(f=S.next()).done);u=!0)b=f.value,r.push(b.name);t.next=34;break;case 30:t.prev=30,t.t1=t.catch(26),m=!0,l=t.t1;case 34:t.prev=34,t.prev=35,!u&&S.return&&S.return();case 37:if(t.prev=37,!m){t.next=40;break}throw l;case 40:return t.finish(37);case 41:return t.finish(34);case 42:i.unshift("全部区域"),r.unshift("全部桌台"),e.areas=i,e.areasList=s.areaList,e.table=r,e.tableList=s.tableList;case 47:case"end":return t.stop()}},t,e,[[7,11,15,23],[16,,18,22],[26,30,34,42],[35,,37,41]])}))()},getStoreOrder:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new Date(e.timeObj.endTime).setHours(23,59,59,0),e.repeat){t.next=4;break}return e.$store.commit("setWin",{title:"提示信息",content:"当前查询尚未结束，请结束后再进行查询或刷新浏览器重新查询！"}),t.abrupt("return");case 4:if(e.validate()){t.next=6;break}return t.abrupt("return");case 6:a.a.OrderReport({data:{type:3,timeType:1,startTime:parseInt(e.timeObj.startTime/1e3),endTime:parseInt(s/1e3),isOpenTime:e.openTime,shopIds:e.shopIds,shopId:e.brandId}}).then(function(t){e.taskId=t.taskId,e.repeat=!1,e.loading=!0,e.timerId=n.a.add(function(){a.a.taskInfo({data:{shopId:e.brandId,taskId:e.taskId}}).then(function(t){3==t.status?(n.a.clear(e.timerId),e.repeat=!0,a.a.ReportGet({data:{shopId:e.brandId,taskId:e.taskId}}).then(function(t){e.loading=!1,e.orderStoreList=t;var i={startTime:e.timeObj.startTime,endTime:s,openTime:e.openTime,shopId:e.brandId};for(var r in i)e.setNewObj(e.orderStoreSend.brand,r,i[r])})):2==t.status&&(n.a.clear(e.timerId),e.loading=!1,e.repeat=!0,e.$store.commit("setWin",{title:"提示信息",content:"请求失败，请重试！"}))})},1e3,60,!1,function(){n.a.clear(e.timerId),e.repeat=!0,e.loading=!1})});case 7:case"end":return t.stop()}},t,e)}))()},exportMethods:function(){3==this.showStep?this.exportGoods():4==this.showStep&&this.exportOrder()},exportGoods:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.goodsData){t.next=4;break}e.$store.commit("setWin",{title:"提示信息",content:"没有订单可以导出"}),t.next=7;break;case 4:return s=new Date(e.timeObj.endTimeStore).setHours(23,59,59,0),t.next=7,a.a.exportMoreFreeByName({data:{trueShopId:e.shopId,startTime:parseInt(e.timeObj.startTimeStore/1e3),endTime:parseInt(s/1e3),areaId:e.areaId,tableId:e.tableId,isOpenTime:e.openTime}});case 7:case"end":return t.stop()}},t,e)}))()},exportOrder:function(){var e=this;return h(regeneratorRuntime.mark(function t(){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=new Date(e.timeObj.endTimeStore).setHours(23,59,59,0),t.next=3,a.a.exportFreeList({data:{trueShopId:e.shopId,startTime:parseInt(e.timeObj.startTimeStore/1e3),endTime:parseInt(s/1e3),areaId:e.areaId,tableId:e.tableId,isOpenTime:e.openTime,goodsName:e.goodsName,gid:e.gid,packageId:e.packageId}});case 3:case"end":return t.stop()}},t,e)}))()},getDetail:function(e){var t=this;return h(regeneratorRuntime.mark(function s(){var i;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,a.a.orderBillDelite({data:{trueShopId:t.shopId,oid:e}});case 2:i=s.sent,t.detailShow=!0,t.detail=i;case 5:case"end":return s.stop()}},s,t)}))()},setNewObj:function(e,t,s){this.$set(e,t,s)},resetDate:function(){for(var e in this.timeObj)this.timeObj[e]=(new Date).setHours(0,0,0,0)},back:function(){if(3==this.showStep&&this.isOneDay)this.showStep=this.showStep-2;else if(this.showStep=this.showStep-1,3==this.showStep){var e=r.a.session("moreReturnCache");e&&(this.goodsData=e)}},search:function(){1==this.isBrand&&(1==this.showStep||2==this.showStep)?this.getStoreOrder():this.getGoods()},getStep:function(e){e.step>0?(this.showStep=e.step,3==this.showStep?(this.shopId=e.id?e.id:this.shopId,this.orderStoreSend.store.isRequest=!1,e.time&&(this.timeObj.startTimeStore=e.time,this.timeObj.endTimeStore=e.time),e.page?(this.page=e.page,this.pageShow=e.pageShow,this.getGoods()):(this.page=1,this.pageShow=e.pageShow,this.getCondition(),this.getGoods(),this.isOneDay=e.isOneDay)):4==this.showStep&&(this.goodsName=e.goodsName,this.gid=e.gid,this.packageId=e.packageId)):this.getDetail(e.id)},setIsOneStore:function(e){this.isOneStore=1==e},getDrop:function(e){this.shopList=e;var t=[],s=0;this.shopList.forEach(function(e){1==e.selected&&(t.push(e.id),s++)}),this.shopIds=t.join(","),this.setIsOneStore(s)},searchOrder:function(){var e=this.orderInputValue;e?this.getDetail(e):this.$store.commit("setWin",{title:"提示信息",content:"订单号不能为空"}),this.orderInputValue=""},toDetail:function(){var e=event.target;if("light"==e.className){var t=e.textContent;this.getDetail(t)}},getDetailShow:function(e){this.detailShow=e,this.initBtn()},orderInput:function(e){var t=e.target.value;t=t.replace(/[^\d]/g,""),isNaN(t)&&(t=""),this.orderInputValue=t,e.target.value=t},reset:function(){var e=(new Date).setHours(0,0,0,0);if(3==this.showStep||4==this.showStep)this.openTime=1,this.areaIndex=0,this.tableIndex=0,this.areaId="",this.tableId="",3==this.showStep?(this.isBrand||(this.timeObj.startTimeStore=e,this.timeObj.endTimeStore=e),this.search()):(this.orderStoreSend.store.areaId="",this.orderStoreSend.store.tableId="");else{if(this.timeObj.startTime=e,this.timeObj.endTime=e,this.isBrand){var t=o.a.deepCopy(this.shopList),s=[];t.forEach(function(e){e.selected=!0,s.push(e.id)}),this.shopList=t,this.shopIds=s.join(","),this.setIsOneStore(this.shopList.length)}this.search()}},timeCheck:function(){this.openTime=0==this.openTime?1:0},areaSelect:function(e){this.areaIndex=e,this.areaId=this.areaIndex>0?this.areasList[this.areaIndex-1].id:"",3==this.showStep?this.getGoods():4==this.showStep&&(this.orderStoreSend.store.isRequest=!0,this.orderStoreSend.store.areaId=this.areaId)},tableSelect:function(e){this.tableIndex=e,this.tableId=this.tableIndex>0?this.tableList[this.tableIndex-1].id:"",3==this.showStep?this.getGoods():4==this.showStep&&(this.orderStoreSend.store.isRequest=!0,this.orderStoreSend.store.tableId=this.tableId)},startTimeChange:function(e){3==this.showStep?this.timeObj.startTimeStore=e:this.timeObj.startTime=e},endTimeChange:function(e){3==this.showStep?this.timeObj.endTimeStore=e:this.timeObj.endTime=e},formatTime:function(e){return o.a.format(new Date(e),"yyyy年MM月dd日")},validate:function(){var e=!0,t="",s="";return 3==this.showStep?(t=this.timeObj.startTimeStore,s=this.timeObj.endTimeStore):(t=this.timeObj.startTime,s=this.timeObj.endTime),parseInt(t/864e5)>parseInt(s/864e5)?(this.$store.commit("setWin",{title:"提示信息",content:"开始时间不能大于结束时间"}),e=!1):s-t>=80352e5&&(this.$store.commit("setWin",{title:"提示信息",content:"最大只能查询三个月时间"}),e=!1),this.isBrand&&""==this.shopIds&&(this.$store.commit("setWin",{title:"提示信息",content:"没有可选店铺"}),e=!1),e}}},p=(s("c5e3"),s("7610")),c=Object(p.a)(d,i,[],!1,null,"9ed39aca",null);c.options.__file="src\\module\\statistics\\free.vue";t.default=c.exports},"89c8":function(e,t,s){},c5e3:function(e,t,s){"use strict";var i=s("89c8");s.n(i).a}}]);