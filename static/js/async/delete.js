(window.webpackJsonp=window.webpackJsonp||[]).push([["delete"],{"69a9":function(t,e,i){},"6bc2":function(t,e,i){"use strict";var s=i("8d54");i.n(s).a},"8d54":function(t,e,i){},ce89:function(t,e,i){"use strict";i.r(e);var s=i("f6ce"),a=i("81a2"),r=i("44e7"),n=i("bbb9");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function s(a,r){try{var n=e[a](r),o=n.value}catch(t){return void i(t)}if(!n.done)return Promise.resolve(o).then(function(t){s("next",t)},function(t){s("throw",t)});t(o)}("next")})}}var h={data:function(){return{deleteData:"",orderStoreList:"",orderStoreSend:{},total:{orderNum:0,totalPrice:0,totalDay:1},areas:[],table:[],areasList:[],tableList:[],areaId:"",tableId:"",orderInputValue:"",shopList:[],brandId:"",shopId:"",shopIds:"",isBrand:"",storeName:"",storeListShow:"",allSelected:!0,timeObj:{startTime:"",endTime:"",startTimeStore:"",endTimeStore:""},page:1,pageNum:0,pageShow:10,openTime:1,detail:null,detailShow:!1,showStep:"",userData:"",userShopList:"",userShopIdStr:"",repeat:!0,taskId:"",timerId:"",loading:!1,dropName:"请选择店铺",shopNameB:[]}},created:function(){this.userData=s.a.session("userShop");var t=[],e=[];"3"==this.userData.currentShop.ischain&&(this.userShopList=s.a.session("shopList"),this.userShopList.forEach(function(i,s){t[s]=i.id;var a={id:i.id,name:i.shopName};e.push(a)}),this.userShopIdStr=t.join(","),this.userShopList=e)},mounted:function(){this.isBrand="3"==this.userData.currentShop.ischain?1:0,this.brandId=this.userData.currentShop.id,this.shopId=this.userData.currentShop.id,this.shopIds=this.userShopIdStr;var t=!0,e=!1,i=void 0;try{for(var s,a=this.userShopList[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){s.value.selected=!0}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}this.isBrand&&(console.log(this.userShopList),this.shopNameB=n.a.deepCopy(this.userShopList),this.shopList=this.userShopList.map(function(t){return t.id}),console.log(this.shopList)),this.storeName=this.userShopList.length>0?this.userShopList[0].name:"选择店铺",this.resetDate(),0==this.isBrand?(this.showStep=3,this.getCondition()):this.showStep=1,this.search()},watch:{showStep:"initBtn"},destroyed:function(){s.a.session("deleteShopId",null),s.a.session("dayData",null),s.a.session("deleteSingleTime",null),r.a.clear(this.timerId)},methods:{initBtn:function(){var t=this,e=[];3==this.showStep&&e.push({name:"导出",className:["fd-yellow"],fn:function(){t.exportFile()}}),1!=this.showStep&&this.isBrand&&e.push({name:"返回",className:["fd-blue"],fn:function(){t.back()}}),this.$store.commit("setPageTools",e)},getData:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.validate()){e.next=2;break}return e.abrupt("return");case 2:return i=new Date(t.timeObj.endTimeStore).setHours(23,59,59,0),e.next=5,a.a.getDelOrder({data:{trueShopId:t.shopId,startTime:parseInt(t.timeObj.startTimeStore/1e3),endTime:parseInt(i/1e3),areaId:t.areaId,tableId:t.tableId,page:t.page,num:t.pageShow,isOpenTime:t.openTime}});case 5:s=e.sent,t.deleteData=s,t.pageNum=s.pageNum;case 8:case"end":return e.stop()}},e,t)}))()},getCondition:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i,s,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.getCondition({data:{trueShopId:t.shopId}});case 2:i=e.sent,s=i.areaList,r=i.tableList,s.unshift({id:"",name:"全部区域"}),r.unshift({id:"",name:"全部桌台"}),t.areas=s,t.table=r,t.areasList=n.a.deepCopy(s),t.tableList=n.a.deepCopy(r),console.log(s),console.log(r);case 12:case"end":return e.stop()}},e,t)}))()},areaSelect:function(){var t=this;console.log(this.areaId),this.tableId="",""==this.areaId?this.table=n.a.deepCopy(this.tableList):this.table=this.tableList.filter(function(e){return e.areaId==t.areaId}),this.getData()},tableSelect:function(){console.log(this.tableId),this.getData()},getStoreOrder:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new Date(t.timeObj.endTime).setHours(23,59,59,0),t.repeat){e.next=4;break}return t.$store.commit("setWin",{title:"提示信息",content:"当前查询尚未结束，请结束后再进行查询或刷新浏览器重新查询！"}),e.abrupt("return");case 4:if(t.validate()){e.next=6;break}return e.abrupt("return");case 6:a.a.OrderReport({data:{type:2,timeType:1,startTime:parseInt(t.timeObj.startTime/1e3),endTime:parseInt(i/1e3),isOpenTime:t.openTime,shopIds:t.shopIds,shopId:t.brandId}}).then(function(e){t.taskId=e.taskId,t.repeat=!1,t.loading=!0,t.timerId=r.a.add(function(){a.a.taskInfo({data:{shopId:t.brandId,taskId:t.taskId}}).then(function(e){3==e.status?(r.a.clear(t.timerId),t.repeat=!0,a.a.ReportGet({data:{shopId:t.brandId,taskId:t.taskId}}).then(function(e){t.loading=!1,t.orderStoreList=e,t.orderStoreSend={startTime:t.timeObj.startTime,endTime:i,openTime:t.openTime,shopId:t.brandId}})):2==e.status&&(r.a.clear(t.timerId),t.loading=!1,t.repeat=!0,t.$store.commit("setWin",{title:"提示信息",content:"请求失败，请重试！"}))})},1e3,60,!1,function(){r.a.clear(t.timerId),t.repeat=!0,t.loading=!1})});case 7:case"end":return e.stop()}},e,t)}))()},exportFile:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.deleteData){e.next=4;break}t.$store.commit("setWin",{title:"提示信息",content:"没有订单可以导出"}),e.next=7;break;case 4:return i=new Date(t.timeObj.endTimeStore).setHours(23,59,59,0),e.next=7,a.a.exportDelOrder({data:{trueShopId:t.shopId,startTime:parseInt(t.timeObj.startTimeStore/1e3),endTime:parseInt(i/1e3),areaId:t.areaId,tableId:t.tableId,isOpenTime:t.openTime}});case 7:case"end":return e.stop()}},e,t)}))()},getDetail:function(t){var e=this;return o(regeneratorRuntime.mark(function i(){var s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.a.deleteBillDelite({data:{trueShopId:e.shopId,oid:t}});case 2:s=i.sent,e.detailShow=!0,e.detail=s;case 5:case"end":return i.stop()}},i,e)}))()},resetDate:function(){for(var t in this.timeObj)this.timeObj[t]=(new Date).setHours(0,0,0,0)},back:function(){this.showStep=this.showStep-1,3==this.showStep&&(this.page=1,this.getData())},search:function(){1==this.isBrand?3==this.showStep?this.getData():this.getStoreOrder():this.getData()},getStep:function(t){console.log(t),t.step>0?(this.showStep=t.step,3==this.showStep&&(this.shopId=t.id?t.id:this.shopId,t.time&&(this.timeObj.startTimeStore=t.time,this.timeObj.endTimeStore=t.time),t.page?(this.page=t.page,this.pageShow=t.pageShow,this.getData()):(this.page=1,this.pageShow=t.pageShow,this.getCondition(),this.getData()))):this.getDetail(t.id)},setIsOneStore:function(t){this.isOneStore=1==t},getDrop:function(t){console.log(t),this.shopList=t,this.shopIds=this.shopList.join(","),this.setIsOneStore(this.shopList.length),this.shopNameB=n.a.deepCopy(this.userShopList);for(var e=0;e<this.shopNameB.length;e++)this.shopList.includes(this.shopNameB[e].id)||(this.shopNameB.splice(e,1),e--);console.log(this.shopNameB)},searchOrder:function(){var t=this.orderInputValue;""==t?this.$store.commit("setWin",{title:"提示信息",content:"订单号不能为空"}):/[^\d]/.test(t)?this.$store.commit("setWin",{title:"提示信息",content:"订单号只能为数字"}):this.getDetail(t),this.orderInputValue=""},toDetail:function(){var t=event.target;if("light"==t.className){var e=t.textContent;this.getDetail(e)}},getDetailShow:function(t){this.detailShow=t,this.initBtn()},reset:function(){var t=(new Date).setHours(0,0,0,0);3==this.showStep?(this.openTime=1,this.areaId="",this.tableId="",this.isBrand||(this.timeObj.startTimeStore=t,this.timeObj.endTimeStore=t)):(this.timeObj.startTime=t,this.timeObj.endTime=t,this.isBrand&&(this.shopList=this.userShopList.map(function(t){return t.id}),this.shopIds=this.shopList.join(","),this.shopNameB=n.a.deepCopy(this.userShopList),this.setIsOneStore(this.shopList.length))),this.search()},timeCheck:function(){this.openTime=0==this.openTime?1:0},startTimeChange:function(t){3==this.showStep?this.timeObj.startTimeStore=t:this.timeObj.startTime=t},endTimeChange:function(t){3==this.showStep?this.timeObj.endTimeStore=t:this.timeObj.endTime=t},formatTime:function(t){return n.a.format(new Date(t),"yyyy年MM月dd日")},validate:function(){var t=!0,e=void 0,i=void 0;return 3==this.showStep?(e=this.timeObj.startTimeStore,i=this.timeObj.endTimeStore):(e=this.timeObj.startTime,i=this.timeObj.endTime),e/864e5>i/864e5?(this.$store.commit("setWin",{title:"提示信息",content:"开始时间不能大于结束时间"}),t=!1):i-e>=80352e5&&(this.$store.commit("setWin",{title:"提示信息",content:"最大只能查询三个月时间"}),t=!1),this.isBrand&&""==this.shopIds&&(this.$store.commit("setWin",{title:"提示信息",content:"没有可选店铺"}),t=!1),t}},components:{orderDetail:function(){return i.e("order_detail").then(i.bind(null,"603c"))},deleteStore:function(){return i.e("delete_store").then(i.bind(null,"f81a"))},elShopList:function(){return i.e("el_shopList").then(i.bind(null,"60ff"))}}},d=(i("d9c0"),i("6bc2"),i("d801")),l=Object(d.a)(h,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"delete"}},[t.detailShow?t._e():[i("div",{staticClass:"filter"},[i("div",{staticClass:"block"},[1==t.showStep?[i("el-date-picker",{staticStyle:{width:"150px",cursor:"pointer"},attrs:{clearable:!1,type:"date",format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.timeObj.startTime,callback:function(e){t.$set(t.timeObj,"startTime",e)},expression:"timeObj.startTime"}}),t._v(" "),i("span",{staticClass:"input-word"},[t._v("-")]),t._v(" "),i("el-date-picker",{staticStyle:{width:"150px",cursor:"pointer"},attrs:{clearable:!1,type:"date",format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.timeObj.endTime,callback:function(e){t.$set(t.timeObj,"endTime",e)},expression:"timeObj.endTime"}})]:t._e(),t._v(" "),3!=t.showStep||t.isBrand?t._e():[i("el-date-picker",{staticStyle:{width:"150px",cursor:"pointer"},attrs:{clearable:!1,type:"date",format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.timeObj.startTimeStore,callback:function(e){t.$set(t.timeObj,"startTimeStore",e)},expression:"timeObj.startTimeStore"}}),t._v(" "),i("span",{staticClass:"input-word"},[t._v("-")]),t._v(" "),i("el-date-picker",{staticStyle:{width:"150px",cursor:"pointer"},attrs:{clearable:!1,type:"date",format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.timeObj.endTimeStore,callback:function(e){t.$set(t.timeObj,"endTimeStore",e)},expression:"timeObj.endTimeStore"}})]],2),t._v(" "),i("div",{staticClass:"block"},[3==t.showStep?[i("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择区域"},on:{change:t.areaSelect},model:{value:t.areaId,callback:function(e){t.areaId=e},expression:"areaId"}},t._l(t.areas,function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),t._v(" "),i("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择桌台"},on:{change:t.tableSelect},model:{value:t.tableId,callback:function(e){t.tableId=e},expression:"tableId"}},t._l(t.table,function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))]:t._e(),t._v(" "),2!=t.showStep?i("div",{staticClass:"input-check"},[i("i",{class:{active:1==this.openTime},on:{click:t.timeCheck}}),t._v("\n\t\t\t\t\t按营业时间\n\t\t\t\t")]):t._e(),t._v(" "),3==t.showStep?i("div",{staticStyle:{display:"inline-block"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入订单号"},model:{value:t.orderInputValue,callback:function(e){t.orderInputValue=e},expression:"orderInputValue"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchOrder},slot:"append"})],1)],1):t._e()],2),t._v(" "),i("div",{staticClass:"block"},[t.isBrand&&1==t.showStep?i("div",{staticClass:"align"},[i("elShopList",{attrs:{shopIds:t.shopList},on:{chooseShop:t.getDrop}})],1):t._e(),t._v(" "),2!=t.showStep?i("div",{staticClass:"align"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.search()}}},[t._v("搜索")]),t._v(" "),i("el-button",{attrs:{type:"info"},on:{click:function(e){t.reset()}}},[t._v("重置")])],1):t._e()]),t._v(" "),t.isBrand&&1==t.showStep||2==t.showStep?i("div",{staticClass:"store-show"},[2==t.showStep?i("span",[t._v(t._s(t.formatTime(t.timeObj.startTime))+" ~ "+t._s(t.formatTime(t.timeObj.endTime)))]):t._e()]):t._e()]),t._v(" "),i("div",{staticClass:"main"},[i("deleteStore",{attrs:{store:t.orderStoreList,order:t.deleteData,otherData:t.orderStoreSend,step:t.showStep,loading:t.loading},on:{emit:t.getStep}})],1)],t._v(" "),t.detailShow?i("orderDetail",{attrs:{detail:t.detail,isDelete:!0},on:{detailShow:t.getDetailShow}}):t._e()],2)},[],!1,null,"2b05ff72",null);e.default=l.exports},d9c0:function(t,e,i){"use strict";var s=i("69a9");i.n(s).a}}]);