(window.webpackJsonp=window.webpackJsonp||[]).push([["printaddedit_win"],{6166:function(e,t,n){"use strict";var s=n("d5d1");n.n(s).a},d5d1:function(e,t,n){},e80b:function(e,t,n){"use strict";n.r(t);var s=n("81a2"),r=n("f6ce"),i=n("bbb9");function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function s(r,i){try{var o=t[r](i),a=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(a).then(function(e){s("next",e)},function(e){s("throw",e)});e(a)}("next")})}}var a=r.a.session("userShop"),d=void 0;d=a.currentShop.brandId?a.currentShop.brandId:0;var c={props:{pObj:null},data:function(){return{btnOk:{},btnCancel:{},showBounced:!0,docType:[],orderType:null,printerList:[],printTimes:1,isAlam:!1,printerId:null,areaIdsList:[],areaIds:[],status:"1",orderTypeIndex:-1,printerIdIndex:-1,areaIndex:[],printerIndex:-1,goodsLength:null,goodsIds:[],shopsList:[],shopsIndex:[],eleShopid:"",elemeUserId:"",goods:{},isAreaid:"",packageIds:null,postFirstPid:null,postFirstTypes:null,postFirstIndex:null,title:null,showCom:"",comObj:{},goodsCom:[],selectgoods:[]}},methods:{getOnOff:function(e){this.isAlam=e},getSubadd:function(e){this.printTimes=e},getSelOn:function(e){this.orderTypeIndex=e},getPrintSelOn:function(e){this.printerIndex=e},getDate:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var n,r,i,o,a,c,l,p,u,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.getOrderName();case 2:return n=t.sent,e.docType=n,e.initTogath(),t.next=7,s.a.getWireprinter();case 7:if(null!=(r=t.sent)){t.next=13;break}return e.$store.commit("setWin",{title:"操作提示",content:"打印机为空,请先添加打印机",winType:"confirm",callback:function(t){e.showBounced=!1,"ok"==t&&e.$store.commit("setWin",{title:"操作提示",content:"打印机为空不能操作打印机配置！"})}}),t.abrupt("return",!1);case 13:e.printerList=r,e.initTogath();case 15:return t.next=17,s.a.getTakeOutList({data:{brandId:d}});case 17:if(i=t.sent,e.areaIdsList=i,"新建打印机配置"==e.title){t.next=40;break}return t.next=22,s.a.getTakeoutprint({data:{id:e.postFirstPid}});case 22:for(p in o=t.sent,e.printerId=o.printerId,e.orderType=o.orderType,e.printTimes=Number(o.printTimes),e.isAlam="0"!=o.isAlam,a=o.areaIds+"",e.areaIndex=a.split(","),c=o.areaShopId+"",e.shopsIndex=c.split(","),e.eleShopid=o.areaShopId,l=[],JSON.parse(o.goodsIds))l.push(parseInt(p));for(u in e.goodsIds=l,e.goods=o.goodsIds,e.isAreaid=o.areaShopId,e.chooseShop([o.areaIds]),e.docType)e.docType[u].type==o.orderType&&(e.orderTypeIndex=u);for(h in r)r[h].id==o.printerId&&(e.printerIndex=h);case 40:e.initTogath();case 41:case"end":return t.stop()}},t,e)}))()},getWinClickResult:function(e){var t=this;return o(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("ok"!=e){n.next=32;break}if(null!=t.orderType){n.next=4;break}return t.$store.commit("setWin",{title:"错误提示",content:"单据数据不能为空！"}),n.abrupt("return",!1);case 4:if(0!=t.printerIndex.length&&-1!=t.printerIndex){n.next=7;break}return t.$store.commit("setWin",{title:"错误提示",content:"打印机不能不选！"}),n.abrupt("return",!1);case 7:if(null!=t.areaIndex){n.next=10;break}return t.$store.commit("setWin",{title:"错误提示",content:"渠道不能不选！"}),n.abrupt("return",!1);case 10:if(null!=t.shopsIndex){n.next=13;break}return t.$store.commit("setWin",{title:"错误提示",content:"店铺不能不选！"}),n.abrupt("return",!1);case 13:if(0!=t.goodsIds.length||""!=t.goodsIds){n.next=16;break}return t.$store.commit("setWin",{title:"错误提示",content:"请选择菜品！"}),n.abrupt("return",!1);case 16:if(r=void 0,"新建打印机配置"!=t.title){n.next=23;break}return n.next=20,s.a.takeoutprintAdd({data:{shopId:a.currentShop.id,printerId:t.printerId,orderType:t.orderType,areaIds:t.areaIndex.toString(),areaShopId:t.shopsIndex.toString(),goodsIds:t.goods,printTimes:t.printTimes,isAlam:Number(t.isAlam),elemeUserId:t.elemeUserId,packageIds:t.packageIds}});case 20:r=n.sent,n.next=27;break;case 23:if("修改打印机配置"!=t.title){n.next=27;break}return n.next=26,s.a.takeoutprintEdit({data:{id:t.postFirstPid,printerId:t.printerId,orderType:t.orderType,areaIds:t.areaIndex.toString(),areaShopId:t.shopsIndex.toString(),goodsIds:t.goods,printTimes:t.printTimes,isAlam:Number(t.isAlam),elemeUserId:t.elemeUserId,packageIds:t.packageIds}});case 26:r=n.sent;case 27:if(r){n.next=29;break}return n.abrupt("return");case 29:t.$emit("toClick",e),n.next=33;break;case 32:"cancel"==e?"修改打印机配置"==t.title?t.$store.commit("setWin",{title:"操作提示",content:"确认删除打印机？",winType:"confirm",callback:function(n){"ok"==n&&(t.deletePrint(),t.$emit("toClick",e,n))}}):t.$emit("toClick",e):"close"==e&&t.$emit("toClick",e);case 33:case"end":return n.stop()}},n,t)}))()},deletePrint:function(){var e=this;return o(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.takeoutprintDelete({data:{id:e.postFirstPid,elemeUserId:e.elemeUserId,areaShopId:e.shopsIndex.toString()}});case 2:case"end":return t.stop()}},t,e)}))()},getBouncedBtn:function(){"新建打印机配置"==this.title?(this.btnOk={content:"保存",style:"background-color:#f8941f"},this.btnCancel={content:"取消",style:"background-color:#a0a0a0"}):"修改打印机配置"==this.title&&(this.btnOk={content:"保存",style:"background-color:#f8941f"},this.btnCancel={content:"删除",style:"background-color:#c33"})},chooseShop:function(e){var t=this;return o(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.areaIndex=e,!e){n.next=4;break}if(void 0!=e[0]){n.next=4;break}return n.abrupt("return");case 4:return n.next=6,s.a.getTakeoutShop({data:{type:e?e[0]:t.areaIndex[0],brandId:d}},!0);case 6:if(!(r=n.sent).error_code){n.next=10;break}return t.$store.commit("setWin",{title:"错误提示",content:r.error_message}),n.abrupt("return");case 10:(i=[]).push(r),t.shopsList=i,t.shopsIndex=[i[0].TakeoutShopId],t.eleShopid&&i[0].TakeoutShopId!=t.eleShopid&&(t.shopsList=[],t.shopsIndex=[]),t.initTogath();case 16:case"end":return n.stop()}},n,t)}))()},chooseId:function(e){if(this.shopsIndex=e,this.eleShopid=e[0],parseInt(this.eleShopid)==this.isAreaid)return!1;this.goodsIds=[],this.isAreaid=this.eleShopid},getRelationGoods:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var n,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(1!=e.areaIndex[0]){t.next=9;break}return t.next=3,s.a.takeoutGetCategoryList({data:{eleShopId:e.eleShopid}});case 3:return n=t.sent,e.category=n,t.next=7,e.catecarygoods(e.category.length-1);case 7:t.next=25;break;case 9:if(2!=e.areaIndex[0]){t.next=18;break}return t.next=12,s.a.getMtGoods({data:{}});case 12:r=t.sent,e.category=r.typeList,e.mtgoods=r.goodsList,e.goodReady(),t.next=25;break;case 18:if(3!=e.areaIndex[0]){t.next=25;break}return t.next=21,s.a.getBaiduGoods({data:{type:1,brandId:d}});case 21:i=t.sent,e.category=i.categoryList,e.baidugoods=i.goodsList,e.goodReady();case 25:case"end":return t.stop()}},t,e)}))()},catecarygoods:function(e){var t=this;return o(regeneratorRuntime.mark(function n(){var r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e<1)){n.next=4;break}return n.abrupt("return");case 4:return n.next=6,s.a.getGoodsByCategoryId({data:{type:1,categoryId:t.category[e].categoryId}});case 6:for(r=n.sent,i=0;i<r.length;i++)t.goodsCom.push(r[i]);t.catecarygoods(e-1);case 9:t.goodReady();case 10:case"end":return n.stop()}},n,t)}))()},goodReady:function(e){var t=[];if(1==this.areaIndex[0])for(var n=0;n<this.goodsCom.length;n++)if(void 0===e||0===e){var s=this.goodsCom[n];s.categoryId instanceof Array||(t=t.concat(s))}else this.goodsCom[n].categoryId==e&&(t=t.concat(this.goodsCom[n]));else if(2==this.areaIndex[0])for(var r=0;r<this.mtgoods.length;r++)if(void 0===e||"全部"===e){var i=this.mtgoods[r];i.categoryName instanceof Array||t.push(i)}else this.mtgoods[r].categoryName==e&&t.push(this.mtgoods[r]);else if(3==this.areaIndex[0])for(var o=0;o<this.baidugoods.length;o++)if(void 0===e||"全部"===e){var a=this.baidugoods[o];a.categoryName instanceof Array||t.push(a)}else this.baidugoods[o].categoryName==e&&t.push(this.baidugoods[o]);this.selectgoods=t},openWinThree:function(){if(!this.eleShopid)return this.$store.commit("setWin",{content:"请选择店铺"}),!1;this.showCom="printerRelation",this.comObj={areaIndex:this.areaIndex,goodsIds:this.goodsIds,eleShopid:this.eleShopid}},getReturnInfo:function(e,t){"ok"==e&&(this.goods=t.goods,this.packageIds=t.packageIds,this.goodsLength=t.goodsLength,this.goodsIds=t.goodsIds),this.showCom=""},initTogath:function(){if(this.printerId&&this.printerList&&this.printerList.length>0)for(var e=0;e<this.printerList.length;e++)this.printerList[e].id==this.printerId&&(this.printerIndex=e)},orderTypeIndexChange:function(){this.orderTypeIndex>-1&&null!=this.docType&&(this.orderType=this.docType[this.orderTypeIndex].type)},printerIndexChange:function(){this.printerIndex>-1&&(this.printerId=this.printerList[this.printerIndex].id)},areaIndexChange:function(){if(null!=this.areaIndex)for(var e=0;e<this.areaIndex.length;e++)this.areaIds.push(this.areaIndex[e]);this.areaIds=i.a.unique(this.areaIds)},shopIndexChange:function(){if(null!=this.shopIndex)for(var e=0;e<this.shopIndex.length;e++)this.shopIds.push(this.shopIndex[e]);this.shopIds=i.a.unique(this.shopIds)},goodsNonull:function(){this.goodsLength=0==this.goodsIds.length?null:this.goodsIds.length}},watch:{printerIndex:"printerIndexChange",orderTypeIndex:"orderTypeIndexChange",areaIndex:"areaIndexChange",shopIndex:"shopIndexChange",goodsIds:"goodsNonull"},mounted:function(){this.postFirstPid=this.pObj.postFirstPid,this.postFirstTypes=this.pObj.postFirstTypes,this.postFirstIndex=this.pObj.postFirstIndex,this.title=this.pObj.title,this.getBouncedBtn(),this.getDate(),this.initTogath()},components:{win:function(){return n.e("win").then(n.bind(null,"f60a"))},radioBtn:function(){return n.e("radio_btn").then(n.bind(null,"4dfe"))},mulSelect:function(){return n.e("mul_select").then(n.bind(null,"7d09"))},subadd:function(){return n.e("subadd").then(n.bind(null,"e7ea"))},onOff:function(){return n.e("on_off").then(n.bind(null,"034b"))},printerRelation:function(){return n.e("printrelation_win").then(n.bind(null,"b172"))}}},l=(n("6166"),n("d801")),p=Object(l.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("win",{attrs:{align:"right",ok:e.btnOk,cancel:e.btnCancel,width:580,height:467},on:{winEvent:e.getWinClickResult}},[n("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.title))]),e._v(" "),n("section",{staticClass:"Pconfig",attrs:{slot:"content"},slot:"content"},[n("div",{staticClass:"configOne"},[n("label",{staticClass:"fl"},[n("span",{staticClass:"fl required pNmae"},[e._v("单据数据")]),e._v(" "),n("radioBtn",{attrs:{list:e.docType,index:e.orderTypeIndex,name:"name"},on:{selOn:e.getSelOn}})],1),e._v(" "),n("label",{staticClass:"fl"},[n("span",{staticClass:"fl required pNmae"},[e._v("打印机")]),e._v(" "),n("radioBtn",{staticStyle:{float:"left",width:"80%"},attrs:{list:e.printerList,index:e.printerIndex,name:"printerName"},on:{selOn:e.getPrintSelOn}})],1),e._v(" "),n("div",{staticClass:"fl"},[n("span",{staticClass:"fl required pNmae"},[e._v("渠道")]),e._v(" "),e.areaIdsList.length>0?n("mulSelect",{attrs:{list:e.areaIdsList,selects:e.areaIndex,name:"name",keys:"id",isradio:!0},on:{selOn:e.chooseShop}}):e._e(),e._v(" "),n("span",{staticClass:"tips"},[n("i"),e._v("未授权的渠道请先授权后选择")])],1),e._v(" "),0!=e.shopsList.length?n("label",{staticClass:"fl"},[n("span",{staticClass:"fl required pNmae"},[e._v("店铺")]),e._v(" "),n("mulSelect",{attrs:{list:e.shopsList,selects:e.shopsIndex,name:"TakeoutShopName",keys:"TakeoutShopId",isradio:!0},on:{selOn:e.chooseId}})],1):e._e(),e._v(" "),0!=e.shopsIndex.length?n("label",{staticClass:"fl"},[n("span",{staticClass:"fl required pNmae"},[e._v("选择菜品")]),e._v(" "),n("a",{staticClass:"addclassify fl",attrs:{href:"javascript:void(0);"},on:{click:e.openWinThree}},[e._v("添加关联菜品")]),e._v(" "),null!==e.goodsLength?n("span",{staticClass:"fl spanCom"},[e._v("已选择菜品："+e._s(e.goodsLength)+"道")]):e._e()]):e._e(),e._v(" "),n("label",{staticClass:"fl"},[n("span",{staticClass:"fl required pNmae"},[e._v("打印次数")]),e._v(" "),n("div",{staticClass:"fl",staticStyle:{width:"185px"}},[n("subadd",{attrs:{bindnum:e.printTimes,maxnum:9,minnum:1},on:{toClick:e.getSubadd}})],1),e._v(" "),n("span",{staticClass:"fl pNmae"},[e._v("蜂鸣")]),e._v(" "),n("onOff",{attrs:{status:e.isAlam},on:{statusChange:e.getOnOff}})],1)])])]),e._v(" "),n(e.showCom,{tag:"component",attrs:{pObj:e.comObj},on:{toClick:e.getReturnInfo}})],1)},[],!1,null,"4475f157",null);t.default=p.exports}}]);