(window.webpackJsonp=window.webpackJsonp||[]).push([["member_recharge"],{"14d8":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"statistics-recharge"}},["all"==t.showtype?a("section",[a("div",{staticClass:"timeSearch"},[a("div",{staticClass:"selectDate"},[a("div",{staticClass:"activation fl"},[t._v("\n\t\t\t\t\t时间筛选\n\t\t\t\t")]),t._v(" "),a("div",{staticClass:"inp-box inp-start fl"},[a("calendar",{staticClass:"data-box",attrs:{time:t.startTime,type:0,format:"yyyy年MM月dd日"},on:{emit:t.startTimeChange}})],1),t._v(" "),a("span",{staticClass:"line"},[t._v(" - ")]),t._v(" "),a("div",{staticClass:"inp-box inp-start fl"},[a("calendar",{staticClass:"data-box",attrs:{time:t.endTime,type:0,format:"yyyy年MM月dd日"},on:{emit:t.endTimeChange}})],1),t._v(" "),a("span",{staticClass:"order-order-searchA",on:{click:t.rechargeQuery}},[a("span",{staticClass:"order-order-search",attrs:{href:"javascript:void(0)"}})])]),t._v(" "),a("div",{staticClass:"enquiries"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.orderNumber,expression:"orderNumber"}],staticClass:"inputBox",attrs:{type:"text",placeholder:"按手机号查询",maxlength:"11"},domProps:{value:t.orderNumber},on:{input:function(e){e.target.composing||(t.orderNumber=e.target.value)}}}),t._v(" "),a("a",{staticClass:"order-order-searchA",on:{click:function(e){t.getPhone("phone")}}},[a("span",{staticClass:"order-order-search"})])])]),t._v(" "),a("div",{staticClass:"sta_head"},[a("div",{staticClass:"operateStore"},[a("div",{staticClass:"operateStore_l"},[t._v("\n\t\t\t\t\t充值来源\n\t\t\t\t")]),t._v(" "),a("div",{staticClass:"operateStore_r fl detLi",on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.openShop(e)}}},[t.isBrand?a("selectStore",{attrs:{sorts:t.shopsList,tipName:t.selectName},on:{emit:t.clickShopList}}):[a("div",{staticClass:"operateStore_r_l"},[t._v(t._s(t.selectName))]),t._v(" "),a("div",{staticClass:"select_d"},[a("i")])],t._v(" "),t.constructionsBtn?a("div",{staticClass:"constructions"},[a("i",{staticClass:"sharpCorners"}),t._v(" 单店模式下，店铺只有一家！\n\t\t\t\t\t")]):t._e()],2)]),t._v(" "),a("div",{staticClass:"fl mb15",staticStyle:{"margin-right":"12px",height:"40px"}},[a("section",{staticClass:"statisticsLists"},[a("select-btn",{attrs:{name:t.cardhigh,sorts:t.cardList.map(function(t){return t.name}),width:157},on:{selOn:t.selCard}})],1)]),t._v(" "),a("div",{staticClass:"fl mb15",staticStyle:{"margin-right":"12px"}},[a("section",{staticClass:"statisticsLists"},[a("select-btn",{attrs:{name:t.datahigh,sorts:t.dataList.map(function(t){return t.name}),width:157},on:{selOn:t.selData}})],1)]),t._v(" "),a("div",{staticClass:"zw mb15"},[a("div",{staticClass:"businessHours"},[a("div",{class:{active:t.isOpenTime},on:{click:t.selectBusinessHours}}),t._v(" "),a("span",[t._v("按营业时间")])])]),t._v(" "),a("a",{staticClass:"blue fl screenings mb15",attrs:{href:"javascript:void(0);"},on:{click:t.rechargeQuery}},[t._v("筛选")]),t._v(" "),a("a",{staticClass:"gray fl reset mb15",attrs:{href:"javascript:void(0);"},on:{click:t.filterReset}},[t._v("重置")])]),t._v(" "),a("div",{staticClass:"theSelected"},[a("div",{staticClass:"choice"},[t._v("选择店铺：")]),t._v(" "),a("div",{staticClass:"shopName"},[t._v(t._s(t.selectName))])]),t._v(" "),t.phone?a("recharge-phone",{attrs:{count:t.count,phonelist:t.phonelist,phonetotal:t.phonetotal}}):a("section",[a("section",{staticStyle:{"margin-bottom":"20px"}},[a("com-table",{attrs:{listHeight:80,listWidth:1400,showHand:!1,titleData:t.titleList,introData:t.staticLists},scopedSlots:t._u([{key:"con-11",fn:function(e){return a("div",{on:{click:function(a){t.openPayment(e.data,"all")}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.data.totalOtherPay)+"\n\t\t\t\t\t")])}}])})],1),t._v(" "),a("section",[a("com-table",{key:t.index,attrs:{listHeight:80,listWidth:1400,showHand:!0,titleData:t.shoptitleList,introData:t.formList,listName:"会员充值统计",showTitle:1,allTotal:t.allFormList.length},scopedSlots:t._u([{key:"con-0",fn:function(e){return a("div",{on:{click:function(a){t.showoneshopDetail(e.data)}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.getshopName(e.data.shopId))+"\n\t\t\t\t\t")])}},{key:"con-11",fn:function(e){return a("div",{on:{click:function(a){t.openPayment(e.data,"one")}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.data.totalOtherPay)+"\n\t\t\t\t\t")])}},{key:"con-14",fn:function(e){return a("div",{on:{click:function(a){t.openDiscount(e.data)}}},[t._v("\n\t\t\t\t\t\t"+t._s(e.data.totalGiftCoupon)+"\n\t\t\t\t\t")])}}])})],1),t._v(" "),t.showWin?a("coupon-detail",{attrs:{CouponDetails:t.CouponDetails},on:{getAppliedWin:t.getResult}}):t._e(),t._v(" "),t.preferentialBounced?a("paymentWin",{attrs:{otherPayDetail:t.otherPayDetail,shopsList:t.shopsList,paymentType:t.paymentType,paymentShopId:t.paymentShopId},on:{toClick:t.whetherToclick}}):t._e()],1),t._v(" "),a("section",{staticClass:"turn-page"},[a("pageElement",{attrs:{page:Number(t.page),total:Number(t.endTotal),numArr:[10,20,30,40,50],isNoJump:!0},on:{pageNum:t.getPageNum}})],1)],1):t._e(),t._v(" "),"one"==t.showtype?a("oneshoprecharge",{attrs:{constructionsName:t.constructionsName,startTime:t.startTime,endTime:t.endTime,isOpenTime:t.isOpenTime,constructionsId:t.constructionsId,taskId:t.taskId,shopsList:t.shopsList},on:{throwWinResult:t.getDetailShow}}):t._e(),t._v(" "),"onedetail"==t.showtype?a("oneshopdetail",{attrs:{constructionsName:t.constructionsName,startTime:t.startTime,endTime:t.endTime,isOpenTime:t.isOpenTime,constructionsId:t.constructionsId,taskId:t.taskId,shopsList:t.shopsList},on:{throwWinResult:t.getDetailShow}}):t._e()],1)};s._withStripped=!0;var i=a("81a2"),n=a("f6ce"),r=a("05dd");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function s(i,n){try{var r=e[i](n),o=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(o).then(function(t){s("next",t)},function(t){s("throw",t)});t(o)}("next")})}}var c={mixins:[a("c159").a],data:function(){return{userShop:"",startTime:(new Date).setHours(0,0,0,0),endTime:(new Date).setHours(23,59,59,999),isBrand:!1,constructionsBtn:!1,cardList:[{name:"全部",id:-1},{name:"电子卡",id:0},{name:"实体卡",id:1}],cardId:-1,cardLimit:!1,cardhigh:"全部",dataList:[{name:"按天数",id:1},{name:"按详情",id:0}],dataId:"1",dataLimit:!1,datahigh:"按天数",shopsList:[],orderNumber:"",page:1,num:10,count:"",endTotal:1,isOpenTime:!1,shopListBtn:!1,selectName:"请选择店铺",selectShopList:[],shopName:"",ischain:"",selectShopId:"",index:null,titleList:[{titleName:"天数",dataName:"days"},{titleName:"充值人数",dataName:"rechargePersonNum"},{titleName:"充值次数",dataName:"rechargeNum"},{titleName:"充值总额",dataName:"totalRecharge"},{titleName:"支付总额 ",dataName:"totalPayment"},{titleName:"现金",dataName:"totalCash"},{titleName:"银行卡",dataName:"totalCard"},{titleName:"微信",dataName:"totalWeChat"},{titleName:"支付宝",dataName:"totalAliPay"},{titleName:"中信微信",dataName:"totalZXWeChat"},{titleName:"中信支付宝",dataName:"totalZXAliPay"},{titleName:"自定义支付",dataName:"totalOtherPay",titleStyle:{fontSize:"16px"},conStyle:{color:"#27a8e0",cursor:"pointer"}},{titleName:"赠送总额",dataName:"totalGiftAmount"},{titleName:"赠送积分",dataName:"totalGiftPoint"},{titleName:"赠送优惠券",dataName:"totalGiftCoupon",conStyle:{color:"#27a8e0",cursor:"pointer"}}],staticLists:[],shoptitleList:[{titleName:"来源名称",dataName:"payTimes",conStyle:{color:"#27a8e0",cursor:"pointer"}},{titleName:"充值人数",dataName:"rechargePersonNum"},{titleName:"充值次数",dataName:"rechargeNum"},{titleName:"充值总额 ",dataName:"totalRecharge"},{titleName:"支付总额",dataName:"totalPayment"},{titleName:"现金",dataName:"totalCash"},{titleName:"银行卡",dataName:"totalCard"},{titleName:"微信",dataName:"totalWeChat"},{titleName:"支付宝",dataName:"totalAliPay"},{titleName:"中信微信",dataName:"totalZXWeChat"},{titleName:"中信支付宝",dataName:"totalZXAliPay"},{titleName:"自定义支付",dataName:"totalOtherPay",conStyle:{color:"#27a8e0",cursor:"pointer"}},{titleName:"赠送总额",dataName:"totalGiftAmount"},{titleName:"赠送积分",dataName:"totalGiftPoint"},{titleName:"赠送优惠券",dataName:"totalGiftCoupon",conStyle:{color:"#27a8e0",cursor:"pointer"}}],allFormList:[],formList:[],isloadingstatus:!1,loading:!1,timer:"",timerqueue:[],taskId:"",showtype:"all",constructionsName:"",constructionsId:"",phone:!1,phonetotal:[],phonelist:[]}},created:function(){this.isBrand=!1,this.userShop=n.a.session("userShop"),this.ischain=this.userShop.currentShop.ischain,this.userShop.currentShop&&3==this.ischain?this.isBrand=!0:this.isBrand=!1,this.getshopIdorshopName();var t={titleStyle:{fontSize:"16px"}},e={conStyle:{color:"#ff9800"}},a=!0,s=!1,i=void 0;try{for(var r,o=this.titleList[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var c=r.value;"totalOtherPay"!=c.dataName&&Object.assign(c,t,e)}}catch(t){s=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(s)throw i}}var h=!0,l=!1,u=void 0;try{for(var d,m=this.shoptitleList[Symbol.iterator]();!(h=(d=m.next()).done);h=!0){var p=d.value;Object.assign(p,t)}}catch(t){l=!0,u=t}finally{try{!h&&m.return&&m.return()}finally{if(l)throw u}}},methods:{startTimeChange:function(t){this.startTime=new Date(t).setHours(0,0,0,0)},endTimeChange:function(t){this.endTime=new Date(t).setHours(23,59,59,999)},openShop:function(){if(!this.isBrand)return this.constructionsBtn=!this.constructionsBtn,!1;this.shopListBtn=!this.shopListBtn},getshopIdorshopName:function(){if("3"==this.ischain){var t=n.a.session("userShop").currentShop,e={id:t.id,shopName:"微信充值",shopNumber:t.shopNumber},a=n.a.session("shopList");a.push(e);var s=[],i=[],r=!0,o=!1,c=void 0;try{for(var h,l=a[Symbol.iterator]();!(r=(h=l.next()).done);r=!0){var u=h.value;u.selected=!0,u.name=u.shopName,s.push(u.id),i.push(u.name)}}catch(t){o=!0,c=t}finally{try{!r&&l.return&&l.return()}finally{if(o)throw c}}this.selectShopId=s.join(","),this.selectName=i.join(","),this.shopsList=a}else this.selectShopId=n.a.session("userShop").currentShop.id,this.selectName=n.a.session("userShop").currentShop.name,this.shopsList.push(n.a.session("userShop").currentShop)},clickShopList:function(t){this.shopsList=t;var e=[],a=[];t.forEach(function(t){1==t.selected&&(e.push(t.id),a.push(t.name))}),this.selectName=a.join(","),""==this.selectName&&(this.selectName="请选择店铺"),this.selectShopId=e.join(",")},selCard:function(t){this.cardhigh=this.cardList[t].name,this.cardId=this.cardList[t].id},selData:function(t){this.datahigh=this.dataList[t].name,this.dataId=this.dataList[t].id},selCardType:function(t){this.cardTypehigh=this.cardTypeList[t].name,this.cardTypeId=this.cardTypeList[t].id},rechargeQuery:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.checkData()){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,t.isloadingstatus=!1,e.next=6,i.a.rechargeQuery({data:{shopIds:t.selectShopId,isOpenTime:Number(t.isOpenTime),isCard:t.cardId,isDay:t.dataId,startTime:parseInt(t.startTime/1e3),endTime:parseInt(t.endTime/1e3)}});case 6:(a=e.sent)&&(t.taskId=a,t.timer=setInterval(function(){t.getTaskStatus(a)},2e3));case 8:case"end":return e.stop()}},e,t)}))()},getTaskStatus:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.getScanTaskStatus({data:{taskId:t}});case 2:if(s=a.sent,e.timeout=setTimeout(function(){if(!e.isloadingstatus){for(e.loading=!1,e.$store.commit("setWin",{content:"页面加载失败,请重新加载",title:"操作提示",winType:"alert"}),clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());return!1}},1e4),e.timerqueue.push(e.timeout),1==s){for(clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());e.getRechargeData(t)}case 6:case"end":return a.stop()}},a,e)}))()},getRechargeData:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.getRechargeData({data:{taskId:t,showDetail:0,showShopId:"",showDay:"",page:"",num:""}});case 2:(s=a.sent)&&(e.loading=!1,e.isloadingstatus=!0,e.phone=!1,e.staticLists=[],e.staticLists.push(s.total),e.allFormList=s.list,e.$nextTick(function(){e.setPage()}));case 4:case"end":return a.stop()}},a,e)}))()},getPageNum:function(t){this.page=t.page,this.num=t.num,this.phone?this.getPhone():this.setPage()},getshopName:function(t){var e="",a=!0,s=!1,i=void 0;try{for(var n,r=this.shopsList[Symbol.iterator]();!(a=(n=r.next()).done);a=!0){var o=n.value;o.id==t&&(e=o.name?o.name:o.shopName)}}catch(t){s=!0,i=t}finally{try{!a&&r.return&&r.return()}finally{if(s)throw i}}return e},showoneshopDetail:function(t){"1"==this.dataId?this.showtype="one":this.showtype="onedetail",this.constructionsName=this.getshopName(t.shopId),this.constructionsId=t.shopId},getDetailShow:function(t){var e=this;this.showtype=t,this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){e.Export()}}])},checkData:function(t){if(this.endTime-this.startTime>r.a.timeConst.THREEMONTHS)return this.valiData("只能查询间隔三个月的数据"),!1;if(this.startTime-this.endTime>0)return this.valiData("查询时间选择错误"),!1;if(""==this.selectShopId)return this.valiData("请选择店铺"),!1;if(1==this.loading)return this.valiData("正在搜索,请勿重复点击"),!1;if("phone"==t){if(!/^1\d{10}$/.test(this.orderNumber))return this.valiData("手机号码格式有误"),!1;""==this.orderNumber&&this.valiData("请填写手机号码")}return!0},selectBusinessHours:function(){this.isOpenTime=!this.isOpenTime},filterReset:function(){this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(23,59,59,999),this.dataId=1,this.datahigh="按天数",this.page=1,this.cardhigh="全部",this.cardId=-1,this.isBrand&&(this.selectName="请选择店铺",this.selectShopId=""),this.getShopList()},getPhone:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var s,n,r,o,c,h,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e.checkData(t)){a.next=2;break}return a.abrupt("return");case 2:return"phone"==t&&(e.page=1),a.next=5,i.a.rechargeQuery({data:{shopIds:e.selectShopId,isOpenTime:Number(e.isOpenTime),isCard:e.cardId,isDay:e.dataId,startTime:parseInt(e.startTime/1e3),endTime:parseInt(e.endTime/1e3),page:e.page,num:e.num,mobile:e.orderNumber}});case 5:for(s=a.sent,e.phonetotal=[],e.phonetotal.push(s.list.total),n=!0,r=!1,o=void 0,a.prev=11,c=s.list.list[Symbol.iterator]();!(n=(h=c.next()).done);n=!0)l=h.value,"3"==e.ischain?l.shopName=e.getshopName(l.fromId):l.shopName=e.getshopName(l.shopId);a.next=19;break;case 15:a.prev=15,a.t0=a.catch(11),r=!0,o=a.t0;case 19:a.prev=19,a.prev=20,!n&&c.return&&c.return();case 22:if(a.prev=22,!r){a.next=25;break}throw o;case 25:return a.finish(22);case 26:return a.finish(19);case 27:e.phonelist=s.list.list,e.count=s.count,e.endTotal=s.total,e.phone=!0;case 31:case"end":return a.stop()}},a,e,[[11,15,19,27],[20,,22,26]])}))()},Export:function(){var t=this;return o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.phone){e.next=3;break}return t.valiData("按手机搜索暂不支持导出"),e.abrupt("return",!1);case 3:return e.next=5,i.a.exportRechargeData({data:{taskId:t.taskId,showDetail:0,showShopId:"",showDay:"",page:"",num:"",isExport:1}});case 5:case"end":return e.stop()}},e,t)}))()}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){t.Export()}}]),this.rechargeQuery(),document.onclick=function(){this.constructionsBtn=!1}},components:{Calendar:function(){return a.e("calendar_type").then(a.bind(null,"f2dd"))},SelectStore:function(){return a.e("win").then(a.bind(null,"cb83"))},PageElement:function(){return a.e("page_element").then(a.bind(null,"5921"))},selectBtn:function(){return a.e("select_btn").then(a.bind(null,"3d41"))},ComTable:function(){return a.e("table").then(a.bind(null,"4360"))},oneshoprecharge:function(){return a.e("member_recharges_oneshop").then(a.bind(null,"45a3"))},oneshopdetail:function(){return a.e("member_recharges_onedetail").then(a.bind(null,"6958"))},"coupon-detail":function(){return a.e("member_recharge_couponwin").then(a.bind(null,"f4a5"))},"recharge-phone":function(){return a.e("member_recharges_phone").then(a.bind(null,"3d61"))},paymentWin:function(){return a.e("payment_win").then(a.bind(null,"f7ec"))}}},h=(a("d3a1"),a("7610")),l=Object(h.a)(c,s,[],!1,null,"32b066b4",null);l.options.__file="src\\module\\statistics\\member_recharge\\member_recharges.vue";e.default=l.exports},"4b7f":function(t,e,a){},c159:function(t,e,a){"use strict";a.d(e,"a",function(){return s});var s={data:function(){return{showWin:!1,CouponDetails:{couponList:[],couponCount:0},preferentialBounced:!1,otherPayDetail:"",paymentType:"",paymentShopId:""}},methods:{openDiscount:function(t){this.showWin=!0,this.CouponDetails.couponCount=t.totalGiftCoupon,this.CouponDetails.couponList=t.couponData},getResult:function(t){this.showWin=!1},valiData:function(t,e,a){this.$store.commit("setWin",{content:t,title:e,winType:a})},setPage:function(){this.endTotal=Math.ceil(this.allFormList.length/this.num);var t=(this.page-1)*this.num,e=this.page*this.num,a=this.allFormList.slice(t,e);this.formList=a},whetherToclick:function(t){t&&(this.preferentialBounced=!1)},openPayment:function(t,e){this.preferentialBounced=!0,this.paymentShopId=t.shopId,this.otherPayDetail=t.otherPayDetail,this.paymentType=e}}}},d3a1:function(t,e,a){"use strict";var s=a("4b7f");a.n(s).a}}]);