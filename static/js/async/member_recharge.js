(window.webpackJsonp=window.webpackJsonp||[]).push([["member_recharge"],{"03ed":function(t,e,a){},"14d8":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"statistics-recharge"}},["all"==t.showtype?a("section",[a("div",{staticClass:"timeSearch"},[a("div",{staticClass:"selectDate fl"},[a("div",{staticClass:"activation fl"},[t._v("\n\t\t\t\t\t时间筛选\n\t\t\t\t")]),t._v(" "),a("div",{staticClass:"inp-box inp-start fl"},[a("el-date-picker",{attrs:{type:"date",format:"yyyy 年 MM 月 dd 日",placeholder:"选择日期","value-format":"timestamp"},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}})],1),t._v(" "),a("span",{staticClass:"line"},[t._v(" - ")]),t._v(" "),a("div",{staticClass:"inp-box inp-start fl"},[a("el-date-picker",{attrs:{type:"date",format:"yyyy 年 MM 月 dd 日",placeholder:"选择日期","value-format":"timestamp"},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.rechargeQuery}})],1),t._v(" "),a("div",{staticClass:"enquiries"},[a("el-input",{staticClass:"fl",staticStyle:{width:"202px"},attrs:{placeholder:"请输入内容"},model:{value:t.orderNumber,callback:function(e){t.orderNumber=e},expression:"orderNumber"}}),t._v(" "),a("el-button",{staticClass:"fl",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){t.getPhone("phone")}}})],1)]),t._v(" "),a("div",{staticClass:"sta_head"},[a("div",{staticClass:"operateStore"},[a("div",{staticClass:"operateStore_l"},[t._v("\n\t\t\t\t\t充值来源\n\t\t\t\t")]),t._v(" "),a("selStore",{attrs:{shopIds:"10062"}})],1),t._v(" "),a("div",{staticClass:"fl mb15",staticStyle:{"margin-right":"12px",height:"40px"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.selCard},model:{value:t.cardhigh,callback:function(e){t.cardhigh=e},expression:"cardhigh"}},t._l(t.cardList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("div",{staticClass:"fl mb15",staticStyle:{"margin-right":"12px"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.selData},model:{value:t.datahigh,callback:function(e){t.datahigh=e},expression:"datahigh"}},t._l(t.dataList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("div",{staticClass:"zw mb15"},[a("el-checkbox",{attrs:{size:"mini"},model:{value:t.isOpenTime,callback:function(e){t.isOpenTime=e},expression:"isOpenTime"}},[t._v("按营业时间")])],1),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.rechargeQuery}},[t._v("筛选")]),t._v(" "),a("el-button",{attrs:{type:"info"},on:{click:t.filterReset}},[t._v("重置")])],1),t._v(" "),a("div",{staticClass:"theSelected"},[a("div",{staticClass:"choice"},[t._v("选择店铺：")]),t._v(" "),a("div",{staticClass:"shopName"},[t._v(t._s(t.selectName))])]),t._v(" "),t.phone?a("recharge-phone",{attrs:{count:t.count,phonelist:t.phonelist,phonetotal:t.phonetotal}}):a("section",[a("el-table",{staticStyle:{width:"1400px","margin-bottom":"20px"},attrs:{data:t.staticLists,border:"",stripe:!0,"header-cell-style":{"background-color":"#f5f7fa"}}},[a("el-table-column",{attrs:{fixed:"",prop:"days",label:"天数",width:"111",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{color:"#ff9800"}},[t._v(t._s(e.row.days))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"rechargePersonNum",label:"充值人数",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"rechargeNum",label:"充值次数",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalRecharge",label:"充值总额",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalCash",label:"现金",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalCard",label:"银行卡",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalWeChat",label:"微信",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalAliPay",label:"支付宝",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalZXWeChat",label:"中信微信",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalZXAliPay",label:"中信支付宝",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalOtherPay",label:"自定义支付",width:"111",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{color:"#27a8e0"},on:{click:function(a){t.openPayment(e.$index,e.row,"all")}}},[t._v(t._s(e.row.totalOtherPay))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"totalGiftAmount",label:"赠送总额",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalGiftPoint",label:"赠送积分",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalGiftCoupon",label:"赠送优惠券",width:"111",align:"center"}})],1),t._v(" "),a("div",{staticClass:"box"},[a("div",{staticClass:"list_title"},[a("div",{staticClass:"list_title_l fl"},[a("span",[t._v("会员充值统计")]),t._v(" "),a("span"),t._v(" "),a("span",[t._v("共\n\t\t\t\t\t\t\t"),a("a",{attrs:{href:"javascript:;"}},[t._v(t._s(t.allFormList.length))]),t._v("条记录")])]),t._v(" "),a("div",{staticClass:"list_title_r fr"})]),t._v(" "),a("el-table",{staticStyle:{width:"1500px","margin-bottom":"20px"},attrs:{data:t.formList,border:"",stripe:!0,"header-cell-style":{"background-color":"#f5f7fa"}}},[a("el-table-column",{attrs:{fixed:"",prop:"shopId",label:"来源名称",width:"211",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{color:"#27a8e0"},on:{click:function(a){t.showoneshopDetail(e.row)}}},[t._v(t._s(t.getshopName(e.row.shopId)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"rechargePersonNum",label:"充值人数",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"rechargeNum",label:"充值次数",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalRecharge",label:"充值总额",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPayment",label:"支付总额",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalCash",label:"现金",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalCard",label:"银行卡",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalWeChat",label:"微信",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalAliPay",label:"支付宝",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalZXWeChat",label:"中信微信",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalZXAliPay",label:"中信支付宝",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalOtherPay",label:"自定义支付",width:"111",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{color:"#27a8e0"},on:{click:function(a){t.openPayment(e.$index,e.row,"one")}}},[t._v(t._s(e.row.days))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"totalGiftAmount",label:"赠送总额",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalGiftPoint",label:"赠送积分",width:"111",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalGiftCoupon",label:"赠送优惠券",width:"111",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{color:"#27a8e0"},on:{click:function(a){t.openDiscount(e.row)}}},[t._v(t._s(e.row.totalGiftCoupon))])]}}])})],1)],1),t._v(" "),t.showWin?a("coupon-detail",{attrs:{CouponDetails:t.CouponDetails},on:{getAppliedWin:t.getResult}}):t._e(),t._v(" "),t.preferentialBounced?a("paymentWin",{attrs:{otherPayDetail:t.otherPayDetail,shopsList:t.shopsList,paymentType:t.paymentType,paymentShopId:t.paymentShopId},on:{toClick:t.whetherToclick}}):t._e()],1),t._v(" "),a("div",{staticClass:"pageWrap"},[a("el-pagination",{attrs:{background:"","current-page":t.page,"page-size":t.num,layout:"sizes, prev, pager, next","page-count":t.endTotal,"page-sizes":[10,20,30]},on:{"size-change":t.handleSizeChange,"current-change":t.pageChange}})],1)],1):t._e(),t._v(" "),"one"==t.showtype?a("oneshoprecharge",{attrs:{constructionsName:t.constructionsName,startTime:t.startTime,endTime:t.endTime,isOpenTime:t.isOpenTime,constructionsId:t.constructionsId,taskId:t.taskId,shopsList:t.shopsList},on:{throwWinResult:t.getDetailShow}}):t._e(),t._v(" "),"onedetail"==t.showtype?a("oneshopdetail",{attrs:{constructionsName:t.constructionsName,startTime:t.startTime,endTime:t.endTime,isOpenTime:t.isOpenTime,constructionsId:t.constructionsId,taskId:t.taskId,shopsList:t.shopsList},on:{throwWinResult:t.getDetailShow}}):t._e()],1)};n._withStripped=!0;var i=a("81a2"),s=a("f6ce"),r=a("05dd");function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function n(i,s){try{var r=e[i](s),o=r.value}catch(t){return void a(t)}if(!r.done)return Promise.resolve(o).then(function(t){n("next",t)},function(t){n("throw",t)});t(o)}("next")})}}var l={mixins:[a("c159").a],data:function(){return{userShop:"",startTime:(new Date).setHours(0,0,0,0),endTime:(new Date).setHours(23,59,59,999),isBrand:!1,constructionsBtn:!1,cardList:[{name:"全部",id:-1},{name:"电子卡",id:0},{name:"实体卡",id:1}],cardId:-1,cardLimit:!1,cardhigh:"全部",dataList:[{name:"按天数",id:1},{name:"按详情",id:0}],dataId:"1",dataLimit:!1,datahigh:"按天数",shopsList:[],orderNumber:"",page:1,num:10,count:"",endTotal:1,isOpenTime:!1,shopListBtn:!1,selectName:"请选择店铺",selectShopList:[],shopName:"",ischain:"",selectShopId:"",index:null,staticLists:[],allFormList:[],formList:[],isloadingstatus:!1,loading:!1,timer:"",timerqueue:[],taskId:"",showtype:"all",constructionsName:"",constructionsId:"",phone:!1,phonetotal:[],phonelist:[]}},created:function(){this.isBrand=!1,this.userShop=s.a.session("userShop"),this.ischain=this.userShop.currentShop.ischain,this.userShop.currentShop&&3==this.ischain?this.isBrand=!0:this.isBrand=!1,this.getshopIdorshopName();var t={titleStyle:{fontSize:"16px"}},e={conStyle:{color:"#ff9800"}},a=!0,n=!1,i=void 0;try{for(var r,o=this.titleList[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var l=r.value;"totalOtherPay"!=l.dataName&&Object.assign(l,t,e)}}catch(t){n=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}var c=!0,h=!1,u=void 0;try{for(var p,d=this.shoptitleList[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var m=p.value;Object.assign(m,t)}}catch(t){h=!0,u=t}finally{try{!c&&d.return&&d.return()}finally{if(h)throw u}}},methods:{startTimeChange:function(t){this.startTime=new Date(t).setHours(0,0,0,0)},endTimeChange:function(t){this.endTime=new Date(t).setHours(23,59,59,999)},openShop:function(){if(!this.isBrand)return this.constructionsBtn=!this.constructionsBtn,!1;this.shopListBtn=!this.shopListBtn},getshopIdorshopName:function(){if("3"==this.ischain){var t=s.a.session("userShop").currentShop,e={id:t.id,shopName:"微信充值",shopNumber:t.shopNumber},a=s.a.session("shopList");a.push(e);var n=[],i=[],r=!0,o=!1,l=void 0;try{for(var c,h=a[Symbol.iterator]();!(r=(c=h.next()).done);r=!0){var u=c.value;u.selected=!0,u.name=u.shopName,n.push(u.id),i.push(u.name)}}catch(t){o=!0,l=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw l}}this.selectShopId=n.join(","),this.selectName=i.join(","),this.shopsList=a}else this.selectShopId=s.a.session("userShop").currentShop.id,this.selectName=s.a.session("userShop").currentShop.name,this.shopsList.push(s.a.session("userShop").currentShop)},clickShopList:function(t){this.shopsList=t;var e=[],a=[];t.forEach(function(t){1==t.selected&&(e.push(t.id),a.push(t.name))}),this.selectName=a.join(","),""==this.selectName&&(this.selectName="请选择店铺"),this.selectShopId=e.join(",")},selCard:function(t){this.cardId=t},selData:function(t){this.dataId=t},rechargeQuery:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.checkData()){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,t.isloadingstatus=!1,e.next=6,i.a.rechargeQuery({data:{shopIds:t.selectShopId,isOpenTime:Number(t.isOpenTime),isCard:t.cardId,isDay:t.dataId,startTime:parseInt(t.startTime/1e3),endTime:parseInt(t.endTime/1e3)}});case 6:(a=e.sent)&&(t.taskId=a,t.timer=setInterval(function(){t.getTaskStatus(a)},2e3));case 8:case"end":return e.stop()}},e,t)}))()},getTaskStatus:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.getScanTaskStatus({data:{taskId:t}});case 2:if(n=a.sent,e.timeout=setTimeout(function(){if(!e.isloadingstatus){for(e.loading=!1,e.$store.commit("setWin",{content:"页面加载失败,请重新加载",title:"操作提示",winType:"alert"}),clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());return!1}},1e4),e.timerqueue.push(e.timeout),1==n){for(clearInterval(e.timer);e.timerqueue.length;)clearTimeout(e.timerqueue.pop());e.getRechargeData(t)}case 6:case"end":return a.stop()}},a,e)}))()},getRechargeData:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.getRechargeData({data:{taskId:t,showDetail:0,showShopId:"",showDay:"",page:"",num:""}});case 2:(n=a.sent)&&(e.loading=!1,e.isloadingstatus=!0,e.phone=!1,e.staticLists=[],e.staticLists.push(n.total),e.allFormList=n.list,e.$nextTick(function(){e.setPage()}));case 4:case"end":return a.stop()}},a,e)}))()},handleSizeChange:function(t){this.num=t,this.phone?this.getPhone():this.setPage()},pageChange:function(t){this.page=t,this.phone?this.getPhone():this.setPage()},getshopName:function(t){var e="",a=!0,n=!1,i=void 0;try{for(var s,r=this.shopsList[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var o=s.value;o.id==t&&(e=o.name?o.name:o.shopName)}}catch(t){n=!0,i=t}finally{try{!a&&r.return&&r.return()}finally{if(n)throw i}}return e},showoneshopDetail:function(t){"1"==this.dataId?this.showtype="one":this.showtype="onedetail",this.constructionsName=this.getshopName(t.shopId),this.constructionsId=t.shopId},getDetailShow:function(t){var e=this;this.showtype=t,this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){e.Export()}}])},checkData:function(t){if(this.endTime-this.startTime>r.a.timeConst.THREEMONTHS)return this.valiData("只能查询间隔三个月的数据"),!1;if(this.startTime-this.endTime>0)return this.valiData("查询时间选择错误"),!1;if(""==this.selectShopId)return this.valiData("请选择店铺"),!1;if(1==this.loading)return this.valiData("正在搜索,请勿重复点击"),!1;if("phone"==t){if(!/^1\d{10}$/.test(this.orderNumber))return this.valiData("手机号码格式有误"),!1;""==this.orderNumber&&this.valiData("请填写手机号码")}return!0},selectBusinessHours:function(){this.isOpenTime=!this.isOpenTime},filterReset:function(){this.startTime=(new Date).setHours(0,0,0,0),this.endTime=(new Date).setHours(23,59,59,999),this.dataId=1,this.datahigh="按天数",this.page=1,this.cardhigh="全部",this.cardId=-1,this.isBrand&&(this.selectName="请选择店铺",this.selectShopId=""),this.getShopList()},getPhone:function(t){var e=this;return o(regeneratorRuntime.mark(function a(){var n,s,r,o,l,c,h;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e.checkData(t)){a.next=2;break}return a.abrupt("return");case 2:return"phone"==t&&(e.page=1),a.next=5,i.a.rechargeQuery({data:{shopIds:e.selectShopId,isOpenTime:Number(e.isOpenTime),isCard:e.cardId,isDay:e.dataId,startTime:parseInt(e.startTime/1e3),endTime:parseInt(e.endTime/1e3),page:e.page,num:e.num,mobile:e.orderNumber}});case 5:for(n=a.sent,e.phonetotal=[],e.phonetotal.push(n.list.total),s=!0,r=!1,o=void 0,a.prev=11,l=n.list.list[Symbol.iterator]();!(s=(c=l.next()).done);s=!0)h=c.value,"3"==e.ischain?h.shopName=e.getshopName(h.fromId):h.shopName=e.getshopName(h.shopId);a.next=19;break;case 15:a.prev=15,a.t0=a.catch(11),r=!0,o=a.t0;case 19:a.prev=19,a.prev=20,!s&&l.return&&l.return();case 22:if(a.prev=22,!r){a.next=25;break}throw o;case 25:return a.finish(22);case 26:return a.finish(19);case 27:e.phonelist=n.list.list,e.count=n.count,e.endTotal=n.total,e.phone=!0;case 31:case"end":return a.stop()}},a,e,[[11,15,19,27],[20,,22,26]])}))()},Export:function(){var t=this;return o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.phone){e.next=3;break}return t.valiData("按手机搜索暂不支持导出"),e.abrupt("return",!1);case 3:return e.next=5,i.a.exportRechargeData({data:{taskId:t.taskId,showDetail:0,showShopId:"",showDay:"",page:"",num:"",isExport:1}});case 5:case"end":return e.stop()}},e,t)}))()}},mounted:function(){var t=this;this.$store.commit("setPageTools",[{name:"导出",className:["fd-blue"],fn:function(){t.Export()}}]),this.rechargeQuery(),document.onclick=function(){this.constructionsBtn=!1}},components:{Calendar:function(){return a.e("calendar_type").then(a.bind(null,"f2dd"))},SelectStore:function(){return a.e("win").then(a.bind(null,"cb83"))},PageElement:function(){return a.e("page_element").then(a.bind(null,"5921"))},selectBtn:function(){return a.e("select_btn").then(a.bind(null,"3d41"))},ComTable:function(){return a.e("table").then(a.bind(null,"4360"))},oneshoprecharge:function(){return a.e("member_recharges_oneshop").then(a.bind(null,"45a3"))},oneshopdetail:function(){return a.e("member_recharges_onedetail").then(a.bind(null,"6958"))},"coupon-detail":function(){return a.e("member_recharge_couponwin").then(a.bind(null,"f4a5"))},"recharge-phone":function(){return a.e("member_recharges_phone").then(a.bind(null,"3d61"))},paymentWin:function(){return a.e("payment_win").then(a.bind(null,"f7ec"))},selStore:function(){return a.e("el_shopList").then(a.bind(null,"60ff"))}}},c=(a("d3a1"),a("6ceb")),h=Object(c.a)(l,n,[],!1,null,"32b066b4",null);h.options.__file="src\\module\\statistics\\member_recharge\\member_recharges.vue";e.default=h.exports},c159:function(t,e,a){"use strict";a.d(e,"a",function(){return n});var n={data:function(){return{showWin:!1,CouponDetails:{couponList:[],couponCount:0},preferentialBounced:!1,otherPayDetail:"",paymentType:"",paymentShopId:""}},methods:{openDiscount:function(t){this.showWin=!0,this.CouponDetails.couponCount=t.totalGiftCoupon,this.CouponDetails.couponList=t.couponData},getResult:function(t){this.showWin=!1},valiData:function(t,e,a){this.$store.commit("setWin",{content:t,title:e,winType:a})},setPage:function(){this.endTotal=Math.ceil(this.allFormList.length/this.num);var t=(this.page-1)*this.num,e=this.page*this.num,a=this.allFormList.slice(t,e);this.formList=a},whetherToclick:function(t){t&&(this.preferentialBounced=!1)},openPayment:function(t,e,a){this.preferentialBounced=!0,this.paymentShopId=e.shopId,this.otherPayDetail=e.otherPayDetail,this.paymentType=a}}}},d3a1:function(t,e,a){"use strict";var n=a("03ed");a.n(n).a}}]);