(window.webpackJsonp=window.webpackJsonp||[]).push([["integralcard_coupon"],{"529d":function(t,e,i){"use strict";var a=i("f423");i.n(a).a},bdf6:function(t,e,i){t.exports=i.p+"images/alert.cbc28c67.jpg"},ec50:function(t,e,i){"use strict";i.r(e);var a=[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line"},[e("div",{staticClass:"title"},[this._v("主要信息")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left "},[e("div",{staticClass:"text required"},[this._v("\n\t\t\t\t积分卡券名称\n\t\t\t")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left"},[e("div",{staticClass:"text required"},[this._v("\n\t\t\t\t积分量\n\t\t\t")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left "},[e("div",{staticClass:"text required"},[this._v("\n\t\t\t\t券有效期\n\t\t\t")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"set-line",staticStyle:{float:"left"}},[e("div",{staticClass:"title"},[this._v("其他设置")]),this._v(" "),e("div",{staticClass:"line"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left "},[e("div",{staticClass:"text",staticStyle:{"margin-right":"10px"}},[this._v("\n\t\t\t\t备注\n\t\t\t")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"left "},[e("div",{staticClass:"text",staticStyle:{"margin-right":"10px"}},[this._v("\n\t\t\t\t使用须知\n\t\t\t")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fl describetip"},[e("div",{staticClass:"fl tips"},[e("img",{attrs:{src:i("bdf6")}})]),this._v(" "),e("div",{staticClass:"fl"},[this._v("\n\t\t\t\t\t\t限制150字\n\t\t\t\t\t")])])}],n=i("05dd"),s=i("f6ce"),l=i("81a2"),r=i("bbb9");var o={data:function(){return{ischain:"",couponName:"",isShowCa:!1,selectShops:[],validList:[{validType:"0",name:"相对时间"},{validType:"1",name:"指定时间"}],validName:"相对时间",validType:{index:0,time:"",startTime:(new Date).getTime(),endTime:(new Date).getTime(),valueTime:[(new Date).setHours(0,0,0,0),(new Date).setHours(23,59,59,999)]},annotation:"",useKnow:"",deratePrice:"",editCoupon:!1}},props:{couponDetail:Object},mounted:function(){if(this.ischain=s.a.session("userShop").currentShop.ischain,!r.a.isEmptyObject(this.couponDetail)){var t=this.couponDetail;this.editCoupon=!0,this.couponName=t.name,this.deratePrice=t.param,this.validType.index=t.validityType,0==t.validityType?this.validType.time=t.relativeTime:1==t.validityType&&(this.validName="指定时间",this.validType.valueTime[0]=1e3*(t.startTime-0),this.validType.valueTime[1]=1e3*(t.endTime-0)),this.annotation=t.annotation,this.useKnow=t.useKnow}},components:{"can-multi":function(){return i.e("can_multi").then(i.bind(null,"742e"))},selectBtn:function(){return i.e("select_btn").then(i.bind(null,"3d41"))},"use-time":function(){return i.e("use_time").then(i.bind(null,"5b78"))},goodListWin:function(){return i.e("good_list_win").then(i.bind(null,"8bf4"))}},methods:{closeShopWin:function(t){this.shopWin=!1,t&&(this.selectShops=t.selectShops)},getArrLength:function(t){return this[t].length},showCalendar:function(){this.isShowCa=!this.isShowCa},transformDate:function(t){return r.a.format(new Date(t),"yyyy-MM-dd")},getValidDay:function(){return Math.floor((this.validType.valueTime[1]-this.validType.valueTime[0])/864e5+1)},getAddAlltime:function(t){this.validType.startTime=t.startTime,this.validType.endTime=t.endTime,this.isShowCa=!1},valiData:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"提示信息",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"alert";this.$store.commit("setWin",{winType:i,title:e,content:t})},arrToString:function(t){for(var e="",i=0;i<t.length;i++)e+=t[i],i<t.length-1&&(e+=",");return e},changeArr:function(t,e){for(var i=[],a=0;a<t.length;a++){var n={};"w"==e?n.week=t[a].week.sort(function(t,e){return t-e}):"m"==e&&(n.month=t[a].month.sort(function(t,e){return t-e})),n.isNextDay=t[a].isNextDay;var s=t[a].startslotH+":"+t[a].startslotM,l=t[a].endslotH+":"+t[a].endslotM;n.startslot=s,n.endslot=l,i.push(n)}return i},changeArrToNeed:function(t,e){for(var i=[],a=0;a<t.length;a++){var n={};n.startslotH=t[a].startslot.split(":")[0],n.startslotM=t[a].startslot.split(":")[1],n.endslotH=t[a].endslot.split(":")[0],n.endslotM=t[a].endslot.split(":")[1],n.isNextDay=t[a].isNextDay,"w"==e?n.week=t[a].week:"m"==e&&(n.month=t[a].month),i.push(n)}return i},checkData:function(){if(!n.a.checkData({couponName:{cond:"$$.trim() !== '' && $$.length<=20",pro:"积分卡券名称不能为空且不能超过20个字"}},this))return!1;if(!/^[0-9]+$/.test(this.deratePrice))return this.valiData("积分量只能是正整数"),!1;if(this.deratePrice-0<0)return this.valiData("积分量不能小于0"),!1;if(""==this.deratePrice)return this.valiData("请输入积分量"),!1;if(0==this.validType.index){if(""==this.validType.time.toString().trim())return this.valiData("请输入券有效期"),!1;if(!/^[0-9]*$/.test(this.validType.time))return this.valiData("券有效期只能是整数"),!1}return this.annotation.length>20?(this.valiData("备注字数不能大于20"),!1):!(this.useKnow.length>150)||(this.valiData("使用须知字数不能大于150"),!1)},getSendInfo:function(){if(this.checkData()){var t={};t.shopIds=s.a.session("userShop").currentShop.id,t.gids="",t.pids="",t.name=this.couponName,t.param=this.deratePrice,t.delayHours="",t.annotation=this.annotation,t.useKnow=this.useKnow,t.validityType=this.validType.index,t.periodSel="",t.isDiscount="",t.tastePrice="",t.useLimit="",t.billPrice="",t.reckoningPrice="",t.lowestConsume="";t.useTime={},0==this.validType.index?t.relativeTime=this.validType.time:(t.startTime=parseInt(this.validType.valueTime[0]/1e3),t.endTime=parseInt(this.validType.valueTime[1]/1e3)),t.type=7,r.a.isEmptyObject(this.couponDetail)||(t.id=this.couponDetail.id),this.operateCoupons(t)}},operateCoupons:function(t){var e,i=this;return(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i.editCoupon){e.next=7;break}return e.next=3,l.a.addCoupon({data:t});case 3:i.valiData("添加成功"),i.$router.push("/admin/addCoupon"),e.next=11;break;case 7:return e.next=9,l.a.editCoupon({data:t});case 9:i.valiData("修改成功"),setTimeout(function(){s.a.session("couponDetail",""),i.$emit("changeMnage")},500);case 11:case"end":return e.stop()}},e,i)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function a(n,s){try{var l=t[n](s),r=l.value}catch(t){return void i(t)}if(!l.done)return Promise.resolve(r).then(function(t){a("next",t)},function(t){a("throw",t)});e(r)}("next")})})()},clicktheRadio:function(t){this.validType.index=t.validType}}},c=(i("529d"),i("d801")),d=Object(c.a)(o,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",[i("div",{attrs:{id:"breakCoupon"}},[t._m(0),t._v(" "),t._m(1),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"fl"},[i("el-input",{attrs:{placeholder:"请输入优惠券名称",maxlength:"20"},model:{value:t.couponName,callback:function(e){t.couponName=e},expression:"couponName"}})],1)]),t._v(" "),t._m(2),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"fl"},[i("el-input",{attrs:{placeholder:"请输入积分量"},model:{value:t.deratePrice,callback:function(e){t.deratePrice=e},expression:"deratePrice"}})],1)]),t._v(" "),t._m(3),t._v(" "),i("div",{staticClass:"right"},[i("el-radio-group",{staticClass:"fl",model:{value:t.validName,callback:function(e){t.validName=e},expression:"validName"}},t._l(t.validList,function(e,a){return i("el-radio",{key:a,attrs:{label:e.name,border:""},nativeOn:{change:function(i){t.clicktheRadio(e)}}})}))],1),t._v(" "),i("div",{staticClass:"left "}),t._v(" "),0==t.validType.index?i("div",{staticClass:"right"},[i("div",{staticClass:"line",staticStyle:{"text-align":"left"}},[t._v("\n\t\t\t\t领券后\n\t\t\t\t"),i("input",{directives:[{name:"model",rawName:"v-model.trim.number",value:t.validType.time,expression:"validType.time",modifiers:{trim:!0,number:!0}}],staticClass:"input couponinp",attrs:{maxlength:"3"},domProps:{value:t.validType.time},on:{input:function(e){e.target.composing||t.$set(t.validType,"time",t._n(e.target.value.trim()))},blur:function(e){t.$forceUpdate()}}}),t._v(" 日内有效\n\t\t\t")])]):t._e(),t._v(" "),1==t.validType.index?i("div",{staticClass:"right",staticStyle:{"padding-left":"10px"}},[i("el-date-picker",{staticClass:"fl",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp",clearable:!1},model:{value:t.validType.valueTime,callback:function(e){t.$set(t.validType,"valueTime",e)},expression:"validType.valueTime"}}),t._v(" "),i("div",{staticClass:"foday"},[t._v("\n\t\t\t\t共"+t._s(t.getValidDay())+"天\n\t\t\t")])],1):t._e(),t._v(" "),t._m(4),t._v(" "),i("div",{staticClass:"fl",staticStyle:{width:"100%"}}),t._v(" "),t._m(5),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"fl"},[i("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"20字",maxlength:"20"},model:{value:t.annotation,callback:function(e){t.annotation=e},expression:"annotation"}})],1)]),t._v(" "),t._m(6),t._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"fl"},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:8,maxRows:8},placeholder:"请输入内容",maxlength:"150"},model:{value:t.useKnow,callback:function(e){t.useKnow=e},expression:"useKnow"}}),t._v(" "),t._m(7)],1)]),t._v(" "),i("div",{staticClass:"save-coupon"},[i("el-button",{staticStyle:{width:"200px",height:"49px"},attrs:{type:"primary"},on:{click:t.getSendInfo}},[t._v("保存")])],1)])])},a,!1,null,"32b164ad",null);e.default=d.exports},f423:function(t,e,i){}}]);